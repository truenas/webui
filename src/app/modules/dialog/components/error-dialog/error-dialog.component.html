<h1 mat-dialog-title class="err-title">
  <tn-icon class="error-warning-icon" library="mdi" [name]="error.icon || 'alert-circle'"></tn-icon>
  {{ error.title | translate }}
</h1>

<div mat-dialog-content id="err-md-content" role="alertdialog">
  <div class="err-message-wrapper">
    <span [innerHTML]="error.message"></span>
    @if (error.hint) {
      <div class="hint-text">
        <tn-icon name="information" library="mdi" class="hint-icon"></tn-icon>
        <span>{{ error.hint | translate }}</span>
      </div>
    }
  </div>

  @if (error.details && error.details.length > 0) {
    <a
      ixTest="view-details"
      class="more-info"
      (click)="toggleDetails()"
    >
      @if (isDetailsOpen()) {
        <tn-icon name="minus-circle-outline" library="mdi"></tn-icon>
      } @else {
        <tn-icon name="plus-circle-outline" library="mdi"></tn-icon>
      }
      <span>{{ 'View Details' | translate }}</span>
    </a>

    <div
      class="details-panel"
      [class.open]="isDetailsOpen()"
    >
      <div class="details-content">
        <table class="details-table">
          @for (detail of error.details; track detail.label) {
            <tr>
              <td class="detail-label">{{ detail.label }}:</td>
              <td class="detail-value">
                @if (detail.label === TRACE_LABEL) {
                  @if (!isTraceOpen()) {
                    <a class="trace-toggle" (click)="toggleTrace()">
                      <tn-icon name="eye" library="mdi"></tn-icon>
                      <span>{{ 'Show' | translate }}</span>
                    </a>
                  } @else {
                    <a class="trace-toggle" (click)="toggleTrace()">
                      <tn-icon name="eye-off" library="mdi"></tn-icon>
                      <span>{{ 'Hide' | translate }}</span>
                    </a>
                    <pre>{{ detail.value }}</pre>
                  }
                } @else if (detail.value && detail.value.toString().includes('\n')) {
                  <pre>{{ detail.value }}</pre>
                } @else {
                  {{ detail.value || 'N/A' }}
                }
              </td>
            </tr>
          }
        </table>
      </div>

      <ix-copy-button [text]="getDetailsAsText()"></ix-copy-button>
    </div>
  }
</div>

<div mat-dialog-actions>
  <button
    mat-button
    ixTest="close-error-dialog"
    (click)="dialogRef.close(true)"
  >
    {{ 'Close' | translate }}
  </button>

  @if (error.logs) {
    <button
      mat-button
      ixTest="download-logs"
      (click)="downloadLogs()"
    >
      {{ 'Download Logs' | translate }}
    </button>
  }

  @for (action of error.actions; track action.label) {
    <button
      mat-button
      [ixTest]="'action-' + action.label"
      (click)="handleAction(action)"
    >
      {{ action.label | translate }}
    </button>
  }
</div>
