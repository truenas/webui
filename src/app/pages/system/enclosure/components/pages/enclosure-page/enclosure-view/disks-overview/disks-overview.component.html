<div class="container">
  <div class="disk-details-header">
    <span *ngIf="!selectedSlot()">{{ 'Disks Overview' | translate }}</span>
    <ng-container *ngIf="selectedSlot()">
      <button
        mat-mini-fab
        color="primary"
        ixTest="close-details"
        (click)="closeDetails()"
      >
        <ix-icon name="chevron_left"></ix-icon>
      </button>
      <span>
        {{ 'Disk Details for {disk}' | translate : { disk: diskName } }}
      </span>
    </ng-container>
  </div>
  <div *ngIf="selectedSlot(); else overview" class="disk-details-container">
    <div class="drive">
      <ix-enclosure-disk [data]="{ name: diskName, type: selectedSlot().type }"></ix-enclosure-disk>

      <div class="capacity">{{ selectedSlot().size | ixFileSize }}</div>
      <div class="disk-actions">
        <button
          *ngIf="selectedSlot().supports_identify_light"
          mat-button
          color="primary"
          ixTest="identify-drive"
        >
          {{ 'Identify Drive' | translate }}
        </button>
      </div>
    </div>
    <div class="details">
      <div class="details-grid">
        <div class="detail">
          <div class="label">{{ 'Pool' | translate }}</div>
          <div class="value">
            {{ selectedSlot().pool_info?.pool_name || ('Disk not attached to any pools.' | translate) }}
          </div>
        </div>
        <div class="detail">
          <div class="label">{{ 'Model' | translate }}</div>
          <div class="value">{{ selectedSlot().model || ('N/A' | translate) }}</div>
        </div>
        <div class="detail">
          <div class="label">{{ 'Serial' | translate }}</div>
          <div class="value">{{ selectedSlot().serial || ('N/A' | translate) }}</div>
        </div>
        <div class="detail">
          <div class="label">{{ 'Status' | translate }}</div>
          <div class="value">{{ selectedSlot().pool_info?.disk_status || ('N/A' | translate) }}</div>
        </div>
        <div class="detail">
          <div class="label">{{ 'Rotation Rate' | translate }}</div>
          <div class="value">
            {{ selectedSlot().rotationrate ? ('{n} RPM' | translate: { n: selectedSlot().rotationrate }) : ('N/A' | translate) }}
          </div>
        </div>
      </div>
    </div>
  </div>
  <ng-template #overview>
    <div class="disk-overview">
      <div class="tile" [class.active]="selectedView() === EnclosureView.Pools">
        <div class="primary-number">{{ poolsInfo().length }}</div>
        <div class="title">{{ '{n, plural, one {Pool in Enclosure} other {Pools in Enclosure}}' | translate: { n: poolsInfo().length } }}</div>
        <div class="subtitle">
          <ng-container *ngIf="unhealthyPoolsInfo().length === 0">
            {{ 'All pools are online.' | translate }}
          </ng-container>
          <ng-container *ngIf="unhealthyPoolsInfo().length === 1">
            {{ 'Pool {name} is {status}.' | translate: {
              name: unhealthyPoolsInfo()[0].pool_name,
              status: unhealthyPoolsInfo()[0].disk_status,
            } }}
          </ng-container>
          <ng-container *ngIf="unhealthyPoolsInfo().length > 1">
            {{ '{name} and {n, plural, one {# other pool} other {# other pools}} are not healthy.' | translate: {
              name: unhealthyPoolsInfo()[0].pool_name,
              n: unhealthyPoolsInfo().length - 1,
            } }}
          </ng-container>
        </div>
        <button
          mat-button
          color="default"
          [ixTest]="['show', EnclosureView.Pools]"
          (click)="setCurrentView(EnclosureView.Pools)"
        >
          {{ 'SHOW POOLS' | translate }}
        </button>
      </div>
      <div class="tile" [class.active]="selectedView() === EnclosureView.DiskStatus">
        <div class="primary-number">{{ failsCount() }}</div>
        <div class="title">{{ '{n, plural, one {Failed Disk} other {Failed Disks}}' | translate: { n: failsCount() } }}</div>
        <div class="subtitle">
          <ng-container *ngIf="failedPoolsInfo().length === 0">
            {{ 'All disks healthy.' | translate }}
          </ng-container>
          <ng-container *ngIf="failedPoolsInfo().length === 1">
            {{ 'Check {name}.' | translate: { name: failedPoolsInfo()[0].vdev_name } }}
          </ng-container>
          <ng-container *ngIf="failedPoolsInfo().length > 1">
            {{ 'Check {name} and {n, plural, one {# other disk} other {# other disks}}.' | translate: {
              name: failedPoolsInfo()[0].vdev_name,
              n: failedPoolsInfo().length - 1,
            } }}
          </ng-container>
        </div>
        <button
          mat-button
          color="default"
          [ixTest]="['show', EnclosureView.DiskStatus]"
          (click)="setCurrentView(EnclosureView.DiskStatus)"
        >
          {{ 'SHOW STATUS' | translate }}
        </button>
      </div>
      <div *ngIf="expanders().length" class="tile" [class.active]="selectedView() === EnclosureView.Expanders">
        <div class="primary-number">{{ expanders().length }}</div>
        <div class="title">{{ '{n, plural, one {SAS Expander} other {SAS Expanders}}' | translate: { n: expanders().length} }}</div>
        <div class="subtitle"> {{ 'on this enclosure.' | translate }} </div>
        <button
          mat-button
          color="default"
          [ixTest]="['show', EnclosureView.Expanders]"
          (click)="setCurrentView(EnclosureView.Expanders)"
        >
          {{ 'SHOW EXPANDER STATUS' | translate }}
        </button>
      </div>
    </div>
  </ng-template>
</div>
