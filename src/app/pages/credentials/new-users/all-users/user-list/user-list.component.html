<ix-users-search
  [dataProvider]="dataProvider()"
></ix-users-search>

@if (!isMobileView()) {
  <ng-container [ngTemplateOutlet]="thead"></ng-container>
}

<ix-table
  [ix-table-empty]="!(dataProvider().currentPageCount$ | async)"
  [emptyConfig]="emptyService.defaultEmptyConfig(dataProvider().emptyType$ | async)"
>
  @if (isMobileView()) {
    <ng-container [ngTemplateOutlet]="thead"></ng-container>
  }
  <tbody
    ix-table-body
    detailsRowIdentifier="uid"
    [columns]="columns"
    [dataProvider]="dataProvider()"
    [isLoading]="!!(dataProvider().isLoading$ | async)"
    (expanded)="expanded($event)"
  >
    <ng-template
      let-user
      ix-table-cell
      [columnIndex]="4"
      [dataProvider]="dataProvider()"
    >
      <div class="user-access-cell">
        @if (user?.roles?.length) {
          <ix-icon name="ix-truenas-logo-mark"></ix-icon>
        }

        <span>{{ getRoles(user) }}</span>

        @if (user.smb) {
          <ix-icon name="ix-smb-share"></ix-icon>
        }
        @if (user.twofactor_auth_configured) {
          <ix-icon name="mdi-cellphone-lock"></ix-icon>
        }
        @if (user.ssh_password_enabled) {
          <ix-icon name="mdi-ssh"></ix-icon>
        }
      </div>
    </ng-template>
  </tbody>
</ix-table>

<ix-table-pager
  [dataProvider]="dataProvider()"
  [pageSize]="dataProvider().pagination.pageSize"
  [currentPage]="dataProvider().pagination.pageNumber"
></ix-table-pager>

<ng-template #thead>
  <div class="sticky-header">
    <thead
      class="user-header-row"
      ix-table-head
      [columns]="columns"
      [dataProvider]="dataProvider()"
    ></thead>
  </div>
</ng-template>
