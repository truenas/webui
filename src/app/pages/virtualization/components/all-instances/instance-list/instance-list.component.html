<div class="container">
  <div class="table-container">
    <div class="table-header">
      <h2>{{ 'Instances' | translate }}</h2>

      @if (hasCheckedInstances) {
        <div class="bulk-actions-container">
          <div class="bulk-selected">
            <span>{{ checkedInstancesIds.length }}</span>
            <span>{{ 'Selected' | translate }}</span>
          </div>

          <div class="bulk-button-wrapper">
            <label>{{ 'Bulk Actions' | translate }}</label>
            <button
              *ixRequiresRoles="requiredRoles"
              mat-button
              ixTest="bulk-actions-menu"
              [matMenuTriggerFor]="menu"
            >
              {{ 'Select action' | translate }}
              <ix-icon name="mdi-menu-down" class="menu-caret"></ix-icon>
            </button>
          </div>

          <mat-menu #menu="matMenu">
            <button
              *ixRequiresRoles="requiredRoles"
              mat-menu-item
              ixTest="start-selected"
              [disabled]="isBulkStartDisabled()"
              (click)="onBulkStart()"
            >
              <span>{{ 'Start All Selected' | translate }}</span>
            </button>
            <button
              *ixRequiresRoles="requiredRoles"
              mat-menu-item
              ixTest="stop-selected"
              [disabled]="isBulkStopDisabled()"
              (click)="onBulkStop()"
            >
              <span>{{ 'Stop All Selected' | translate }}</span>
            </button>
            <button
              *ixRequiresRoles="requiredRoles"
              mat-menu-item
              ixTest="restart-selected"
              [disabled]="isBulkStopDisabled()"
              (click)="onBulkRestart()"
            >
              <span>{{ 'Restart All Selected' | translate }}</span>
            </button>
          </mat-menu>
        </div>
      }
    </div>

    <div class="item-search">
      @if (!showMobileDetails()) {
        <ix-fake-progress-bar
          class="loader-bar"
          [loading]="isLoading()"
        ></ix-fake-progress-bar>
      }

      <ix-search-input1
        [maxLength]="100"
        [disabled]="!instances().length"
        [value]="searchQuery()"
        (search)="onSearch($event)"
      ></ix-search-input1>
    </div>

    <div class="instances">
      <div class="instances-header-row">
        <div class="cell checkbox">
          <mat-checkbox
            color="primary"
            ixTest="select-all-app"
            [checked]="isAllSelected"
            [indeterminate]="!isAllSelected && !!selection.selected.length"
            [disabled]="filteredInstances()?.length === 0"
            (change)="toggleAllChecked($event.checked)"
          ></mat-checkbox>
        </div>
        <div class="cell">{{ 'Name' | translate }}</div>
        <div class="cell">{{ 'Type' | translate }}</div>
        <div class="cell">{{ 'Status' | translate }}</div>
        <div class="cell actions">{{ 'Controls' | translate }}</div>
      </div>

      @if (!filteredInstances()?.length) {
        <ix-empty [conf]="emptyConfig()"></ix-empty>
      }

      @for (instance of filteredInstances(); track instance.id) {
        <ix-instance-row
          [instance]="instance"
          [class.selected]="selectedInstance()?.id === instance.id"
          [selected]="selection.isSelected(instance.id)"
          (click)="navigateToDetails(instance)"
          (selectionChange)="selection.toggle(instance.id)"
          (keydown.enter)="navigateToDetails(instance)"
        ></ix-instance-row>
      }
    </div>
  </div>
</div>
