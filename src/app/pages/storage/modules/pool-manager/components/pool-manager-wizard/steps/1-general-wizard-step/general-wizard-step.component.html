<ng-container [formGroup]="form">
  <ix-input
    formControlName="name"
    [label]="'Name' | translate"
    [required]="true"
    [readonly]="isAddingVdevs()"
  ></ix-input>

  @if (!isAddingVdevs()) {
    <!-- Info box when SED disks are detected -->
    @if (hasSedCapableDisks$ | async; as hasSedDisks) {
      @if (hasSedDisks && (isEnterprise$ | async)) {
        <div class="sed-info-message" role="status">
          {{ helptext.sedInfoMessage | translate }}
        </div>
      }
    }

    <!-- Encryption type radio group -->
    <ix-radio-group
      formControlName="encryptionType"
      [label]="'Encryption' | translate"
      [options]="encryptionTypeOptions$"
    ></ix-radio-group>

    <!-- Software Encryption Standard dropdown -->
    @if (form.controls.encryptionType.value === EncryptionType.Software) {
      <ix-select
        formControlName="encryptionStandard"
        [label]="'Encryption Standard' | translate"
        [options]="encryptionAlgorithmOptions$"
        [required]="true"
      ></ix-select>
    }

    <!-- SED Password fields -->
    @if (form.controls.encryptionType.value === EncryptionType.Sed) {
      <!-- Show info if no password is set, warning if password exists -->
      @if (isSedPasswordSet$ | async; as isPasswordSet) {
        <div class="sed-global-password-warning" role="alert">
          {{ helptext.sedGlobalPasswordWarning | translate }}
        </div>

        <ix-input
          formControlName="sedPassword"
          [label]="helptext.sedPasswordLabel | translate"
          [type]="'password'"
          [required]="false"
          [tooltip]="'Leave blank to keep the existing password, or enter a new password to update it.' | translate"
        ></ix-input>

        <ix-input
          formControlName="sedPasswordConfirm"
          [label]="helptext.sedPasswordConfirmLabel | translate"
          [type]="'password'"
          [required]="false"
        ></ix-input>
      } @else {
        <div class="sed-info-message" role="status">
          {{ helptext.sedGlobalPasswordInfo | translate }}
        </div>

        <ix-input
          formControlName="sedPassword"
          [label]="helptext.sedPasswordLabel | translate"
          [type]="'password'"
          [required]="true"
          [tooltip]="helptext.sedPasswordTooltip | translate"
        ></ix-input>

        <ix-input
          formControlName="sedPasswordConfirm"
          [label]="helptext.sedPasswordConfirmLabel | translate"
          [type]="'password'"
          [required]="true"
        ></ix-input>
      }
    }
  } @else {
    <!-- Message when adding VDEVs to SED pool -->
    @if (pool()?.all_sed) {
      <div class="sed-info-message" role="status">
        {{ helptext.sedPoolVdevMessage | translate }}
      </div>
    }
  }

  <ix-pool-warnings></ix-pool-warnings>

  <ix-form-actions>
    <div class="step-buttons">
      <button
        mat-button
        matStepperNext
        color="primary"
        type="button"
        ixTest="next-general"
        [disabled]="form.invalid"
      >
        {{ 'Next' | translate }}
      </button>
    </div>
  </ix-form-actions>
</ng-container>
