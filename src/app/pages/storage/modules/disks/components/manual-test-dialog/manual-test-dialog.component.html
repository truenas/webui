<h1 matDialogTitle>{{ 'Manual S.M.A.R.T. Test' | translate }}</h1>

  <form
    class="ix-form-container"
    [formGroup]="form"
    (submit)="onSubmit()"
  >
    <div class="disks-list">
      @if (selectedDisksWithSmartSupport.length) {
        <div class="prompt">{{ 'Run manual test on disks:' }}</div>
        <ul class="disks">
          @for (disk of selectedDisksWithSmartSupport; track disk) {
            <li>
              <div class="list-item">
                <span>{{ disk.name }} ({{ disk.serial }})</span>
                @if (hasStartedTests()) {
                  @if (isTestDone(disk.name)) {
                    @if (hasErrorTest(disk.name)) {
                      <ix-icon name="error" class="red-icon"></ix-icon>
                    } @else {
                      <ix-icon name="check_circle" class="green-icon"></ix-icon>
                    }
                  }
                  @if (isTestDone(disk.name)) {
                    @if (hasLogs(disk.name) || hasErrorTest(disk.name)) {
                      <a
                        class="link"
                        [ixTest]="[disk.name, 'view-disk-test-logs']"
                        (click)="showLogs(disk.name)"
                      >
                        {{ 'View logs' | translate }}
                      </a>
                    }
                  } @else {
                    @if (getTestProgress(disk.name)) {
                      <mat-spinner
                        color="primary" 
                        mode="determinate" 
                        [diameter]="20" 
                        [value]="getTestProgress(disk.name)"
                      ></mat-spinner>
                    } @else {
                      <mat-spinner
                        color="primary" 
                        [diameter]="20" 
                      ></mat-spinner>
                    }
                  }
                }
              </div>
            </li>
          }
        </ul>
      }
      @if (selectedDisksWithoutSmartSupport.length) {
        <div class="prompt">
          {{ 'These disks do not support S.M.A.R.T. tests:' | translate }}
        </div>
        <ul class="disks">
          @for (disk of selectedDisksWithoutSmartSupport; track disk) {
            <li>
              <div class="list-item">
                <span>{{ disk.name }} ({{ disk.serial }})</span>
              </div>
            </li>
          }
        </ul>
      }
    </div>

    @if (!hasStartedTests()) {
      <ix-select
        formControlName="type"
        [required]="true"
        [label]="'Type' | translate"
        [options]="testTypes$"
      ></ix-select>
    }

    <ix-form-actions>
      <button mat-button type="button" ixTest="cancel" [matDialogClose]="false">
        {{ 'Cancel' | translate }}
      </button>

      <button
        *ixRequiresRoles="[Role.FullAdmin]"
        mat-button
        type="submit"
        color="primary"
        ixTest="start-test"
        [disabled]="form.invalid || !selectedDisksWithSmartSupport.length"
      >
        {{ 'Start' | translate }}
      </button>
    </ix-form-actions>
  </form>

