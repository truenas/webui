<mat-card class="card">
  <mat-card-content *ixWithLoadingState="application() as app" class="card-content">
    <div class="header">
      <h3>{{ 'App' | translate }}</h3>

      <div class="controls">
        <button
          mat-icon-button
          ixTest="apps-web-portal"
          matTooltipPosition="above"
          [attr.aria-label]="'Web Portal' | translate"
          [matTooltip]="'Web Portal' | translate"
        >
          <ix-icon name="mdi-web"></ix-icon>
        </button>

        <button
          mat-icon-button
          ixTest="apps-restart"
          matTooltipPosition="above"
          [attr.aria-label]="'Restart App' | translate"
          [matTooltip]="'Restart App' | translate"
          (click)="onRestartApp()"
        >
          <ix-icon name="mdi-restart"></ix-icon>
        </button>

        <button
          mat-icon-button
          ixTest="apps-details"
          matTooltipPosition="above"
          [attr.aria-label]="'Check Full Details' | translate"
          [matTooltip]="'Check Full Details' | translate"
          [routerLink]="['/apps', 'installed']"
        >
          <ix-icon name="mdi-cog"></ix-icon>
        </button>
      </div>
    </div>

    <div
      *ngIf="settings()?.appName; else configureWidgetTemplate"
      [class]="['container', size()]"
    >
      <div class="app-header-row">
        <ix-app-card-logo [url]="app?.chart_metadata?.icon"></ix-app-card-logo>

        <div class="app-info">
          <div class="header">
            <h3 class="name">{{ app.name }}</h3>
            <div class="version">v{{ app.chart_metadata?.appVersion }}</div>
          </div>
          <div class="status">
            <div>
              <ix-icon name="mdi-check-circle"></ix-icon>
              <span>{{ app.status | titlecase }}</span>
            </div>
            <div>
              <ix-icon name="mdi-check-circle"></ix-icon>
              <span>{{
                app.update_available || app.container_images_update_available
                ? ('Update available' | translate)
                : ('Up to date' | translate)
              }}</span>
            </div>
          </div>
        </div>
      </div>

      <div class="app-stats">
        <div class="app-stats-row">
          <div class="slot square">
            <h3 *ixWithLoadingState="stats() as stats">{{ stats.cpu.toFixed(0) }}<small>%</small></h3>
            <strong>{{ 'CPU Usage' | translate }}</strong>
          </div>
          <div class="slot rectangle">Chart</div>
        </div>
        <div class="app-stats-row">
          <div class="slot square">
            <h3 *ixWithLoadingState="stats() as stats">{{ stats.memory | ixFileSize }}</h3>
            <strong>{{ 'Memory Usage' | translate }}</strong>
          </div>
          <div class="slot rectangle">Chart</div>
        </div>
      </div>
    </div>
  </mat-card-content>
</mat-card>

<ng-template #configureWidgetTemplate>
  <div [class]="['empty', 'container', size()]">
    <ix-icon class="icon" name="mdi-widgets"></ix-icon>
    <h3>
      <div>{{ 'Widget is not configured.' | translate }}</div>
      <small>{{ 'Edit widget to choose an application.' | translate }}</small>
    </h3>
  </div>
</ng-template>
