<ix-modal-header
  [title]="'Settings' | translate"
  [loading]="isFormLoading()"
  [requiredRoles]="requiredRoles"
></ix-modal-header>

<mat-card>
  <mat-card-content>
    <form class="ix-form-container" [formGroup]="form" (submit)="onSubmit()">
      <ix-fieldset>
        <ix-checkbox-list
          class="trains"
          formControlName="preferred_trains"
          [label]="'Preferred Trains' | translate"
          [tooltip]="tooltips.preferred_trains | translate"
          [options]="allTrains$"
          [inlineFields]="true"
        ></ix-checkbox-list>

        <ix-list
          formArrayName="address_pools"
          class="address-pools"
          [empty]="form.controls.address_pools.controls.length === 0"
          [label]="'Address Pools' | translate"
          [formArray]="form.controls.address_pools"
          (add)="addAddressPool()"
        >
          @for (network of form.controls.address_pools.controls; track network; let i = $index) {
            <ix-list-item
              [formGroupName]="i"
              [label]="'Address Pool' | translate"
              (delete)="removeAddressPool(i)"
            >
              <div class="address-pool">
                <ix-ip-input-with-netmask
                  class="base"
                  formControlName="base"
                  [label]="'Base' | translate"
                  [required]="true"
                ></ix-ip-input-with-netmask>

                <ix-input
                  formControlName="size"
                  type="number"
                  class="size"
                  [required]="true"
                  [label]="'Size' | translate"
                  [tooltip]="helptext.dockerSettings.addressPoolsSize | translate"
                ></ix-input>
              </div>
            </ix-list-item>
          }
        </ix-list>

        @if (hasNvidiaCard$ | async) {
          <ix-checkbox
            formControlName="nvidia"
            [label]="'Install NVIDIA Drivers' | translate"
            [tooltip]="tooltips.install_nvidia_driver | translate"
          ></ix-checkbox>
        }

        <ix-list
          formArrayName="registry_mirrors"
          class="registry-mirrors"
          [empty]="form.controls.registry_mirrors.controls.length === 0"
          [label]="'Registry Mirrors' | translate"
          [tooltip]="tooltips.registry_mirrors | translate"
          [formArray]="form.controls.registry_mirrors"
          (add)="addRegistryMirror()"
        >
          @for (mirror of form.controls.registry_mirrors.controls; track mirror; let i = $index) {
            <ix-list-item
              [formGroupName]="i"
              [label]="'Registry Mirror' | translate"
              (delete)="removeRegistryMirror(i)"
            >
              <div class="registry-mirror">
                <ix-input
                  formControlName="url"
                  [label]="'Mirror URL' | translate"
                  [required]="true"
                ></ix-input>

                <ix-checkbox
                  formControlName="insecure"
                  [label]="'Insecure' | translate"
                ></ix-checkbox>
              </div>
            </ix-list-item>
          }
        </ix-list>

        <ix-checkbox
          formControlName="enable_image_updates"
          [label]="'Check for docker image updates' | translate"
        ></ix-checkbox>
      </ix-fieldset>

      <div class="actions">
        <ix-form-actions>
          <button
            *ixRequiresRoles="requiredRoles"
            mat-button
            type="submit"
            color="primary"
            ixTest="save"
            [disabled]="form.invalid || isFormLoading()"
          >
            {{ 'Save' | translate }}
          </button>
        </ix-form-actions>
      </div>
    </form>
  </mat-card-content>
</mat-card>
