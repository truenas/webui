<div mat-dialog-content>
  <div class="logo-container">
    <div class="logo">
      <img [src]="dialogConfig.appInfo.metadata.icon" [src-fallback]="imagePlaceholder" />
    </div>
    <div class="name-container">
      <strong class="app-name">{{ dialogConfig.appInfo.name }}</strong>
      <span class="version"> {{ dialogConfig.appInfo.human_version }}</span>
    </div>
  </div>

  @if (selectedVersion?.available_versions_for_upgrade?.length) {
    <div class="version-info">
      <div class="version-row">
        <span class="version-label">{{ 'Catalog Version' | translate }}:</span>
        <span class="version-value">
          {{ dialogConfig.appInfo.version }}
          <ix-icon name="mdi-arrow-right"></ix-icon>
          {{ selectedVersion.latest_version }}
        </span>
      </div>
      <div class="version-row">
        <span class="version-label">{{ 'App Version' | translate }}:</span>
        <span class="version-value">
          {{ dialogConfig.appInfo.metadata.app_version }}
          <ix-icon name="mdi-arrow-right"></ix-icon>
          {{ selectedVersion.latest_human_version }}
        </span>
      </div>
    </div>

    @if (versionOptions.size > 1) {
      <div class="resource">
        <span>{{ 'Version to be updated to' | translate }}:</span>
        <mat-form-field class="form-element">
          <mat-select
            ixTest="versions"
            [(ngModel)]="selectedVersionKey"
            (ngModelChange)="onVersionOptionChanged()"
          >
            @for (option of versionOptions | keyvalue: originalOrder; track option) {
              <mat-option
                [value]="option.key"
                [ixTest]="['versions', option.value.latest_human_version]"
              >
                {{ option.value.latest_human_version }}
              </mat-option>
            }
          </mat-select>
        </mat-form-field>
      </div>
    }

    @if (dialogConfig.appInfo.metadata.changelog_url) {
      <div class="changelog-link">
        <span class="changelog-label">{{ 'Changelog' | translate }}:</span>
        <a
          target="_blank"
          rel="noopener noreferrer"
          class="changelog-url"
          [href]="dialogConfig.appInfo.metadata.changelog_url"
          [attr.aria-label]="'View Upstream Release Notes (opens in new window)' | translate"
        >
          <ix-icon name="mdi-open-in-new"></ix-icon>
          {{ 'View Upstream Release Notes' | translate }}
        </a>
      </div>
    }
  } @else {
    <div class="resource">
      <span>{{ 'Only image(s) will be updated' | translate }}</span>
    </div>
  }

  <ix-form-actions>
    <button
      mat-button
      ixTest="close"
      (click)="dialogRef.close(false)"
    >
      {{ 'Close' | translate }}
    </button>
    <button
      *ixRequiresRoles="requiredRoles"
      mat-button
      color="primary"
      ixTest="update"
      (click)="dialogRef.close(selectedVersionKey)"
    >
      {{ 'Update' | translate }}
    </button>
  </ix-form-actions>

</div>
