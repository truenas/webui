<ng-template #pageHeader>
  <ix-page-title-header>
    <ix-search-input [disabled]="isLoading$ | async" [value]="dataset" (search)="onSearch($event)"></ix-search-input>
    <button
      mat-button
      color="primary"
      (click)="doAdd()"
    >{{ 'Add' | translate }}</button>
  </ix-page-title-header>
</ng-template>

<ix-entity-empty *ngIf="isLoading$ | async; else loaded" [conf]="loadingConfig"></ix-entity-empty>

<ng-template #loaded>
  <div *ngIf="checkboxColumn?.selection.selected.length" class="batch-actions-toolbar">
    <div class="title">
      <strong>{{ 'Batch Operations' | translate }}</strong>
    </div>

    <div class="actions">
      <button
        mat-button
        (click)="doBatchDelete(checkboxColumn?.selection.selected);"
        [matTooltip]="'Delete selections' | translate"
        matTooltipPosition="below"
      >
        <mat-icon>delete</mat-icon>
        {{ 'Delete' | translate }}
      </button>
    </div>
  </div>

  <table
    ix-table
    [dataSource]="dataSource"
    matSort
    matSortDisableClear="true"
    [matSortActive]="defaultSort.active"
    [matSortDirection]="defaultSort.direction"
    [fixedLayout]="true"
  >
    <ix-checkbox-column></ix-checkbox-column>

    <ng-container matColumnDef="dataset">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> {{ 'Dataset' | translate }} </th>
      <td mat-cell *matCellDef="let snapshot; dataSource: dataSource">{{ snapshot.dataset }}</td>
    </ng-container>

    <ng-container matColumnDef="snapshot_name">
      <th mat-header-cell *matHeaderCellDef mat-sort-header> {{ 'Snapshot' | translate }} </th>
      <td mat-cell *matCellDef="let snapshot; dataSource: dataSource">{{ snapshot.snapshot_name }}</td>
    </ng-container>

    <ix-expand-toggle-column [expandedRow]="expandedRow" (toggle)="onToggle($event)"></ix-expand-toggle-column>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr
      mat-row
      *matRowDef="let snapshot; columns: displayedColumns; dataSource: dataSource"
      [ixDetailRow]="snapshot"
      [ixDetailRowOptions]="{ colspan: displayedColumns.length }"
      [ixDetailRowTemplate]="expandedRowTemplate"
      (toggle)="onToggle($event)"
    ></tr>

    <tr class="mat-row mat-no-data-row" *matNoDataRow>
      <td class="mat-cell" [attr.colspan]="displayedColumns.length">
        <ix-entity-empty [conf]="emptyOrErrorConfig$ | async"></ix-entity-empty>
      </td>
    </tr>
  </table>

  <ix-table-paginator [dataSource]="dataSource" [pageSize]="10"></ix-table-paginator>
</ng-template>


<ng-template #notAvailable>
  {{ 'N/A' | translate }}
</ng-template>

<ng-template #expandedRowTemplate let-snapshot let-colspan="colspan">
  <ix-snapshot-details-row [snapshot]="snapshot" [colspan]="colspan"></ix-snapshot-details-row>
</ng-template>
