<ng-template #pageHeader>
  <ix-page-title-header>
    <button *ngIf="showImportData" mat-button color="primary" (click)="onImportData()">
      {{ 'Import Data' | translate }}
    </button>
  </ix-page-title-header>
</ng-template>

<div
  *ngIf="!isLoading && flatDataSource?.data.length === 0; else datasetContainer"
  class="entity-empty-wrapper"
  fxFlex="100%"
  fxLayout="row"
  fxLayoutAlign="center center"
  fxLayoutGap="32px"
>
  <ix-entity-empty [conf]="entityEmptyConf"></ix-entity-empty>
</div>

<ng-template #datasetContainer>
  <div class="container" fxLayoutGap="16px">
    <div class="table-container">
      <ix-fake-progress-bar
        *ngIf="!showMobileDetails"
        class="loader-bar"
        [loading]="isLoading$ | async"
      ></ix-fake-progress-bar>

      <div class="dataset-tree-search">
        <ix-search-input
          [disabled]="!flatDataSource?.data.length"
          (search)="onSearch($event)"
        ></ix-search-input>
      </div>

      <div
        #ixTreeHeader
        class="sticky-header"
        (scroll)="updateScroll(scrollTypes.IxTreeHeader)"
      >
        <div class="dataset-tree-header" [style.width.px]="ixTreeHeaderWidth">
          <div>
            <span class="dataset-name-header">
              {{ 'Dataset Name' | translate }}
            </span>
          </div>
          <div>
            {{ 'Used' | translate }}
            /
            {{ 'Available' | translate }}
          </div>
          <div>{{ 'Encryption' | translate }}</div>
          <div>{{ 'Roles' | translate }}</div>
        </div>
      </div>

      <div
        #ixTree
        class="dataset-tree-wrapper"
        (scroll)="updateScroll(scrollTypes.IxTree)"
      >
        <div class="dataset-tree-inner" (resized)="onIxTreeWidthChange($event)">
          <ix-tree-virtual-scroll-view
            class="dataset-tree"
            [ixDataSource]="flatDataSource"
            [ixTreeControl]="flatTreeControl"
            [ixItemSize]="48"
            [ixMinBufferPx]="48 * 10"
            [ixMaxBufferPx]="48 * 20"
          >
            <ix-tree-node
              *ixTreeNodeDef="let dataset; dataSource: flatDataSource"
              routerLinkActive="selected"
              ixTreeNodePadding
              [ixTreeNodePaddingIndent]="40"
              [ixTreeNodeDefDataSource]="flatDataSource"
              [routerLink]="['/datasets', dataset.id]"
              (click)="viewDetails(dataset)"
              (keydown.enter)="viewDetails(dataset)"
            >
              <button mat-icon-button disabled></button>
              <span>{{ dataset.id }}</span>
              <!-- <ix-dataset-node
                [dataset]="getDatasetDetails(dataset)"
                [isSystemDataset]="isSystemDataset(dataset)"
              ></ix-dataset-node> -->
              <ix-icon name="mdi-chevron-right" class="mobile-actions"></ix-icon>
            </ix-tree-node>

            <ix-tree-node
              *ixTreeNodeDef="let dataset; dataSource: flatDataSource; when: hasChild"
              routerLinkActive="selected"
              ixTreeNodePadding
              [ixTreeNodePaddingIndent]="40"
              [ixTreeNodeDefDataSource]="flatDataSource"
              [routerLink]="['/datasets', dataset.id]"
              (click)="viewDetails(dataset)"
              (keydown.enter)="viewDetails(dataset)"
            >
              <button
                mat-icon-button
                ixTreeNodeToggle
                [attr.aria-label]="'Toggle {row}' | translate: { row: dataset.name }"
                (keydown.enter)="$event.stopPropagation()"
              >
                <ix-icon
                  class="mat-icon-rtl-mirror"
                  [name]="flatTreeControl.isExpanded(dataset) ? 'expand_more' : 'chevron_right'"
                ></ix-icon>
              </button>
              <span>{{ dataset.id }}</span>
              <!-- <ix-dataset-node
                [dataset]="getDatasetDetails(dataset)"
                [isSystemDataset]="isSystemDataset(dataset)"
              ></ix-dataset-node> -->
              <ix-icon name="mdi-chevron-right" class="mobile-actions"></ix-icon>
            </ix-tree-node>
          </ix-tree-virtual-scroll-view>
        </div>
      </div>
    </div>

    <div
      *ngIf="selectedDataset$ | async as dataset"
      class="details-container"
      ixDetailsHeight="rightside-content-hold"
      [class.details-container-mobile]="showMobileDetails"
    >
      <ix-fake-progress-bar
        *ngIf="showMobileDetails"
        class="loader-bar"
        [loading]="isLoading$ | async"
      ></ix-fake-progress-bar>
      <ix-dataset-details-panel
        [dataset]="dataset"
        [systemDataset]="systemDataset"
      ></ix-dataset-details-panel>
    </div>
  </div>
</ng-template>
