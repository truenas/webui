@if(isDirectoryServicesDisabled()) {
  <div class="everything-disabled">
    <ix-empty [conf]="noDirectoryServicesConfig"></ix-empty>
    <div class="actions">
      <button
        *ixRequiresRoles="requiredRoles"
        mat-button
        ixTest="configure-active-directory"
        [ixUiSearch]="searchableElements.elements.configureDirectoryServices"
        (click)="openDirectoryServicesForm()"
      >
        {{ 'Configure Directory Services' | translate }}
      </button>
    </div>
  </div>
} @else {
  <div
    class="services"
    [ixUiSearch]="searchableElements.elements.directoryServices"
  >
    <ng-container *ngTemplateOutlet="dataCard; context: { card: getDataCard() }"></ng-container>
  </div>
}

<cdk-accordion-item
  #expansionPanel="cdkAccordionItem"
  class="advanced-settings"
  [class.expanded]="expansionPanel.expanded"
>
  <h3 class="header">
    {{ 'Advanced Settings' | translate }}

    @if (!expansionPanel.expanded) {
      <button
        mat-button
        ixTest="show-advanced-settings"
        (click)="onAdvancedSettingsOpened(expansionPanel)"
      >{{ 'Show' | translate }}</button>
    }
  </h3>

  @if (expansionPanel.expanded) {
    <div class="advanced-settings-cards">
      <ix-kerberos-realms-list [paginator]="false" [inCard]="true"></ix-kerberos-realms-list>
      <ix-kerberos-keytabs-list [paginator]="false" [inCard]="true"></ix-kerberos-keytabs-list>
    </div>
  }
</cdk-accordion-item>

<ng-template #dataCard let-card="card">
  @if (typeCard(card); as card) {
    <mat-card>
      <mat-toolbar-row>
        <h3>{{ card.title }}</h3>
        <div class="actions action-icon">
           <button
            mat-icon-button
            [matMenuTriggerFor]="actionsMenu"
            [attr.aria-label]="'More actions' | translate"
          >
            <ix-icon name="more_vert"></ix-icon>
          </button>

          <mat-menu #actionsMenu="matMenu">
            <button 
              mat-menu-item 
              [ixTest]="[card.title, 'settings']"
              [ixUiSearch]="searchableElements.elements.settings"
              (click)="card.onSettingsPressed()"
            >
              <ix-icon name="settings"></ix-icon>
              <span>{{ 'Settings' | translate }}</span>
            </button>
            <button 
              *ixRequiresRoles="requiredRoles"
              mat-menu-item
              [ixTest]="[card.title, 'rebuild-cache']"
              [attr.aria-label]="'Rebuild Directory Service Cache' | translate"
              [disabled]="isLoading()"
              (click)="onRebuildCachePressed()"
            >
              <ix-icon name="refresh"></ix-icon>
              <span>{{ 'Rebuild Directory Service Cache' | translate }}</span>
            </button>
            @if (card.showLeaveButton) {
              <button
                *ixRequiresRoles="requiredRoles"
                mat-menu-item
                [ixTest]="[card.title, 'leave']"
                (click)="card.onLeavePressed()"
              >
                <ix-icon name="cancel"></ix-icon>
                <span>{{ 'Leave' | translate }}</span>
              </button>
            }
          </mat-menu>
        </div>
      </mat-toolbar-row>
      <mat-card-content>
        <mat-list>
          @for (item of card.items; track item) {
            <mat-list-item class="card-list-item">
              <span class="label">{{ item.label | translate }}:</span>
              <span class="value">{{ item.value || ('None' | translate) }}</span>
            </mat-list-item>
          }
        </mat-list>
      </mat-card-content>
    </mat-card>
  }
</ng-template>
