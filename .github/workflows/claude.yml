name: Claude Review
on:
  pull_request:
    types: [opened, synchronize]
    branches:
      - master
    paths-ignore:
      - 'src/assets/i18n/**'
jobs:
  check-ux-team:
    permissions:
      contents: read
    uses: ./.github/workflows/check-ux-team.yml

  review:
    runs-on: ubuntu-latest
    timeout-minutes: 20
    needs: [check-ux-team]
    if: |
      needs.check-ux-team.outputs.is_member == 'true' &&
      !contains(github.event.pull_request.labels.*.name, 'skip-claude')
    permissions:
      contents: read
      issues: write
      pull-requests: write
      id-token: write
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 10

      - name: Automatic PR Review
        uses: anthropics/claude-code-action@v1.0.22
        with:
          anthropic_api_key: ${{ secrets.CLAUDE_API_KEY }}
          model: claude-opus-4-5-20251101
          track_progress: true
          use_sticky_comment: true
          prompt: |
            REPO: ${{ github.repository }}
            PR NUMBER: ${{ github.event.pull_request.number }}

            Please review this pull request using the guidelines below.
            It should be already checked out in the current directory.

            {{file:.claude/review-prompt.md}}
