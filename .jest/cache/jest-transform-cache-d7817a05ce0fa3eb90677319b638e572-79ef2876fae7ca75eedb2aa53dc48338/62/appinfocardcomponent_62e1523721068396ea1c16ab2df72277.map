{"file":"/Users/macbook/karpov-work/TrueNAS/webui/src/app/pages/apps/components/installed-apps/app-info-card/app-info-card.component.ts","mappings":"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","names":[],"sources":["/Users/macbook/karpov-work/TrueNAS/webui/src/app/pages/apps/components/installed-apps/app-info-card/app-info-card.component.ts"],"sourcesContent":["import {\n  ChangeDetectionStrategy, Component, computed, effect, Inject, input, output,\n  signal,\n  WritableSignal,\n} from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\nimport { Router } from '@angular/router';\nimport { untilDestroyed, UntilDestroy } from '@ngneat/until-destroy';\nimport { TranslateService } from '@ngx-translate/core';\nimport { isEmpty } from 'lodash-es';\nimport {\n  filter, map, switchMap, take, tap,\n} from 'rxjs';\nimport { appImagePlaceholder, customApp } from 'app/constants/catalog.constants';\nimport { AppState } from 'app/enums/app-state.enum';\nimport { Role } from 'app/enums/role.enum';\nimport { WINDOW } from 'app/helpers/window.helper';\nimport { helptextApps } from 'app/helptext/apps/apps';\nimport { AppUpgradeDialogConfig } from 'app/interfaces/app-upgrade-dialog-config.interface';\nimport { App } from 'app/interfaces/app.interface';\nimport { DialogService } from 'app/modules/dialog/dialog.service';\nimport { AppLoaderService } from 'app/modules/loader/app-loader.service';\nimport { CustomAppFormComponent } from 'app/pages/apps/components/custom-app-form/custom-app-form.component';\nimport { AppRollbackModalComponent } from 'app/pages/apps/components/installed-apps/app-rollback-modal/app-rollback-modal.component';\nimport { AppUpgradeDialogComponent } from 'app/pages/apps/components/installed-apps/app-upgrade-dialog/app-upgrade-dialog.component';\nimport { ApplicationsService } from 'app/pages/apps/services/applications.service';\nimport { InstalledAppsStore } from 'app/pages/apps/store/installed-apps-store.service';\nimport { ErrorHandlerService } from 'app/services/error-handler.service';\nimport { IxSlideInService } from 'app/services/ix-slide-in.service';\nimport { RedirectService } from 'app/services/redirect.service';\nimport { WebSocketService } from 'app/services/ws.service';\n\n@UntilDestroy()\n@Component({\n  selector: 'ix-app-info-card',\n  templateUrl: './app-info-card.component.html',\n  styleUrls: ['./app-info-card.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class AppInfoCardComponent {\n  readonly app = input<App>();\n  readonly startApp = output();\n  readonly stopApp = output();\n  protected readonly isCustomApp = computed(() => this.app()?.metadata?.name === customApp);\n  protected readonly requiredRoles = [Role.AppsWrite];\n  protected readonly isAppStopped = computed<boolean>(() => this.app()?.state === AppState.Stopped);\n  protected readonly inProgress = computed<boolean>(() => [AppState.Deploying].includes(this.app()?.state));\n  protected readonly imagePlaceholder = appImagePlaceholder;\n  protected readonly isEmpty = isEmpty;\n  protected readonly isRollbackPossible: WritableSignal<boolean> = signal(false);\n  protected rollbackUpdateButtonSetEffect = effect(() => {\n    const app = this.app();\n    this.isRollbackPossible.set(false);\n    this.updateRollbackSetup(app.name);\n  }, { allowSignalWrites: true });\n  protected readonly appDetailsRouterUrl = computed<string[]>(() => {\n    const app = this.app();\n    return ['/apps', 'available', app.metadata.train, app.id];\n  });\n\n  constructor(\n    private ws: WebSocketService,\n    private loader: AppLoaderService,\n    private redirect: RedirectService,\n    private errorHandler: ErrorHandlerService,\n    private appService: ApplicationsService,\n    private matDialog: MatDialog,\n    private dialogService: DialogService,\n    private translate: TranslateService,\n    private router: Router,\n    private installedAppsStore: InstalledAppsStore,\n    private slideIn: IxSlideInService,\n    @Inject(WINDOW) private window: Window,\n  ) {}\n\n  openPortalLink(app: App, name = 'web_portal'): void {\n    const portalUrl = new URL(app.portals[name]);\n\n    if (portalUrl.hostname === '0.0.0.0') {\n      portalUrl.hostname = this.window.location.hostname;\n    }\n\n    this.redirect.openWindow(portalUrl.href);\n  }\n\n  updateButtonPressed(): void {\n    const name = this.app().name;\n    this.appService.getAppUpgradeSummary(name).pipe(\n      this.loader.withLoader(),\n      switchMap(\n        (summary) => this.matDialog.open(AppUpgradeDialogComponent, {\n          width: '50vw',\n          minWidth: '500px',\n          maxWidth: '750px',\n          data: {\n            appInfo: this.app(),\n            upgradeSummary: summary,\n          } as AppUpgradeDialogConfig,\n        }).afterClosed(),\n      ),\n      filter(Boolean),\n      switchMap(\n        (version: string) => this.dialogService.jobDialog(\n          this.ws.job('app.upgrade', [name, { app_version: version }]),\n          { title: helptextApps.apps.upgrade_dialog.job },\n        ).afterClosed(),\n      ),\n      this.errorHandler.catchError(),\n      untilDestroyed(this),\n    ).subscribe();\n  }\n\n  editButtonPressed(): void {\n    const app = this.app();\n    if (app.custom_app) {\n      this.slideIn.open(CustomAppFormComponent, { data: app });\n    } else {\n      this.router.navigate(['/apps', 'installed', app.metadata.train, app.id, 'edit']);\n    }\n  }\n\n  deleteButtonPressed(): void {\n    const name = this.app().name;\n\n    this.dialogService.confirm({\n      title: helptextApps.apps.delete_dialog.title,\n      message: this.translate.instant('Delete {name}?', { name }),\n      secondaryCheckbox: true,\n      secondaryCheckboxText: this.translate.instant('Remove iX Volumes'),\n    })\n      .pipe(filter(({ confirmed }) => Boolean(confirmed)), untilDestroyed(this))\n      .subscribe(({ secondaryCheckbox }) => this.executeDelete(name, secondaryCheckbox));\n  }\n\n  executeDelete(name: string, removeIxVolumes = false): void {\n    this.dialogService.jobDialog(\n      this.ws.job('app.delete', [name, { remove_images: true, remove_ix_volumes: removeIxVolumes }]),\n      { title: helptextApps.apps.delete_dialog.job },\n    )\n      .afterClosed()\n      .pipe(\n        filter(Boolean),\n        this.errorHandler.catchError(),\n        untilDestroyed(this),\n      )\n      .subscribe(() => {\n        this.installedAppsStore.installedApps$.pipe(\n          map((apps) => !apps.length),\n          filter(Boolean),\n          take(1),\n          untilDestroyed(this),\n        ).subscribe(() => {\n          this.router.navigate(['/apps', 'installed'], { state: { hideMobileDetails: true } });\n        });\n      });\n  }\n\n  rollbackApp(): void {\n    this.matDialog\n      .open(AppRollbackModalComponent, { data: this.app() })\n      .afterClosed()\n      .pipe(untilDestroyed(this))\n      .subscribe();\n  }\n\n  private updateRollbackSetup(appName: string): void {\n    this.ws.call('app.rollback_versions', [appName]).pipe(\n      tap((versions) => this.isRollbackPossible.set(versions.length > 0)),\n      untilDestroyed(this),\n    ).subscribe();\n  }\n}\n"],"version":3}