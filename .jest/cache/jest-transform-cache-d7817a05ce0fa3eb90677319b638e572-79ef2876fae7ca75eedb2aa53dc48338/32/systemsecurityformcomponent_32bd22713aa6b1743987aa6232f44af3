63c0062421019b20bd3d8ad3a9772d60
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.SystemSecurityFormComponent = void 0;
const core_1 = require("@angular/core");
const forms_1 = require("@angular/forms");
const button_1 = require("@angular/material/button");
const card_1 = require("@angular/material/card");
const until_destroy_1 = require("@ngneat/until-destroy");
const store_1 = require("@ngrx/store");
const core_2 = require("@ngx-translate/core");
const rxjs_1 = require("rxjs");
const operators_1 = require("rxjs/operators");
const requires_roles_directive_1 = require("app/directives/requires-roles/requires-roles.directive");
const role_enum_1 = require("app/enums/role.enum");
const dialog_service_1 = require("app/modules/dialog/dialog.service");
const chained_component_ref_1 = require("app/modules/forms/ix-forms/components/ix-slide-in/chained-component-ref");
const ix_modal_header2_component_1 = require("app/modules/forms/ix-forms/components/ix-slide-in/components/ix-modal-header2/ix-modal-header2.component");
const ix_slide_toggle_component_1 = require("app/modules/forms/ix-forms/components/ix-slide-toggle/ix-slide-toggle.component");
const snackbar_service_1 = require("app/modules/snackbar/services/snackbar.service");
const test_directive_1 = require("app/modules/test-id/test.directive");
const error_handler_service_1 = require("app/services/error-handler.service");
const fips_service_1 = require("app/services/fips.service");
const ws_service_1 = require("app/services/ws.service");
const ha_info_selectors_1 = require("app/store/ha-info/ha-info.selectors");
let SystemSecurityFormComponent = class SystemSecurityFormComponent {
    constructor(formBuilder, cdr, translate, snackbar, chainedRef, fips, store$, dialogService, ws, errorHandler) {
        this.formBuilder = formBuilder;
        this.cdr = cdr;
        this.translate = translate;
        this.snackbar = snackbar;
        this.chainedRef = chainedRef;
        this.fips = fips;
        this.store$ = store$;
        this.dialogService = dialogService;
        this.ws = ws;
        this.errorHandler = errorHandler;
        this.requiredRoles = [role_enum_1.Role.FullAdmin];
        this.form = this.formBuilder.group({
            enable_fips: [false],
        });
        this.isHaLicensed$ = this.store$.select(ha_info_selectors_1.selectIsHaLicensed);
        this.systemSecurityConfig = this.chainedRef.getData();
    }
    ngOnInit() {
        if (this.systemSecurityConfig) {
            this.initSystemSecurityForm();
        }
    }
    onSubmit() {
        this.dialogService.jobDialog(this.ws.job('system.security.update', [this.form.value]), {
            title: this.translate.instant('Saving settings'),
        })
            .afterClosed()
            .pipe((0, operators_1.switchMap)(() => this.promptForRestart()), this.errorHandler.catchError(), (0, until_destroy_1.untilDestroyed)(this))
            .subscribe(() => {
            this.chainedRef.close({ response: true, error: null });
            this.snackbar.success(this.translate.instant('System Security Settings Updated.'));
        });
    }
    initSystemSecurityForm() {
        this.form.patchValue(this.systemSecurityConfig);
        this.cdr.markForCheck();
    }
    promptForRestart() {
        return this.isHaLicensed$
            .pipe((0, operators_1.take)(1), (0, operators_1.switchMap)((isHaLicensed) => {
            if (isHaLicensed) {
                // Restart will be handled in response to failover.disabled.reasons event in HaFipsEffects.
                return rxjs_1.EMPTY;
            }
            return this.fips.promptForRestart();
        }));
    }
};
exports.SystemSecurityFormComponent = SystemSecurityFormComponent;
SystemSecurityFormComponent.ctorParameters = () => [
    { type: forms_1.FormBuilder },
    { type: core_1.ChangeDetectorRef },
    { type: core_2.TranslateService },
    { type: snackbar_service_1.SnackbarService },
    { type: chained_component_ref_1.ChainedRef },
    { type: fips_service_1.FipsService },
    { type: store_1.Store },
    { type: dialog_service_1.DialogService },
    { type: ws_service_1.WebSocketService },
    { type: error_handler_service_1.ErrorHandlerService }
];
exports.SystemSecurityFormComponent = SystemSecurityFormComponent = __decorate([
    (0, until_destroy_1.UntilDestroy)(),
    (0, core_1.Component)({
        selector: 'ix-system-security-form',
        template: require("./system-security-form.component.html"),
        changeDetection: core_1.ChangeDetectionStrategy.OnPush,
        standalone: true,
        imports: [
            ix_modal_header2_component_1.IxModalHeader2Component,
            card_1.MatCard,
            card_1.MatCardContent,
            forms_1.ReactiveFormsModule,
            ix_slide_toggle_component_1.IxSlideToggleComponent,
            requires_roles_directive_1.RequiresRolesDirective,
            button_1.MatButton,
            test_directive_1.TestDirective,
            core_2.TranslateModule,
        ],
    })
], SystemSecurityFormComponent);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL21hY2Jvb2sva2FycG92LXdvcmsvVHJ1ZU5BUy93ZWJ1aS9zcmMvYXBwL3BhZ2VzL3N5c3RlbS9hZHZhbmNlZC9zeXN0ZW0tc2VjdXJpdHkvc3lzdGVtLXNlY3VyaXR5LWZvcm0vc3lzdGVtLXNlY3VyaXR5LWZvcm0uY29tcG9uZW50LnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBLHdDQUV1QjtBQUN2QiwwQ0FBa0U7QUFDbEUscURBQXFEO0FBQ3JELGlEQUFpRTtBQUNqRSx5REFBcUU7QUFDckUsdUNBQW9DO0FBQ3BDLDhDQUF3RTtBQUN4RSwrQkFBeUM7QUFDekMsOENBQWlEO0FBQ2pELHFHQUFnRztBQUNoRyxtREFBMkM7QUFFM0Msc0VBQWtFO0FBQ2xFLG1IQUFxRztBQUNyRyx5SkFBbUo7QUFDbkosK0hBQXlIO0FBQ3pILHFGQUFpRjtBQUNqRix1RUFBbUU7QUFDbkUsOEVBQXlFO0FBQ3pFLDREQUF3RDtBQUN4RCx3REFBMkQ7QUFFM0QsMkVBQXlFO0FBcUJsRSxJQUFNLDJCQUEyQixHQUFqQyxNQUFNLDJCQUEyQjtJQVd0QyxZQUNVLFdBQXdCLEVBQ3hCLEdBQXNCLEVBQ3RCLFNBQTJCLEVBQzNCLFFBQXlCLEVBQ3pCLFVBQTRDLEVBQzVDLElBQWlCLEVBQ2pCLE1BQXVCLEVBQ3ZCLGFBQTRCLEVBQzVCLEVBQW9CLEVBQ3BCLFlBQWlDO1FBVGpDLGdCQUFXLEdBQVgsV0FBVyxDQUFhO1FBQ3hCLFFBQUcsR0FBSCxHQUFHLENBQW1CO1FBQ3RCLGNBQVMsR0FBVCxTQUFTLENBQWtCO1FBQzNCLGFBQVEsR0FBUixRQUFRLENBQWlCO1FBQ3pCLGVBQVUsR0FBVixVQUFVLENBQWtDO1FBQzVDLFNBQUksR0FBSixJQUFJLENBQWE7UUFDakIsV0FBTSxHQUFOLE1BQU0sQ0FBaUI7UUFDdkIsa0JBQWEsR0FBYixhQUFhLENBQWU7UUFDNUIsT0FBRSxHQUFGLEVBQUUsQ0FBa0I7UUFDcEIsaUJBQVksR0FBWixZQUFZLENBQXFCO1FBcEJ4QixrQkFBYSxHQUFHLENBQUMsZ0JBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUVwRCxTQUFJLEdBQUcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxLQUFLLENBQUM7WUFDNUIsV0FBVyxFQUFFLENBQUMsS0FBSyxDQUFDO1NBQ3JCLENBQUMsQ0FBQztRQUVLLGtCQUFhLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsc0NBQWtCLENBQUMsQ0FBQztRQWdCN0QsSUFBSSxDQUFDLG9CQUFvQixHQUFHLElBQUksQ0FBQyxVQUFVLENBQUMsT0FBTyxFQUFFLENBQUM7SUFDeEQsQ0FBQztJQUVELFFBQVE7UUFDTixJQUFJLElBQUksQ0FBQyxvQkFBb0IsRUFBRSxDQUFDO1lBQzlCLElBQUksQ0FBQyxzQkFBc0IsRUFBRSxDQUFDO1FBQ2hDLENBQUM7SUFDSCxDQUFDO0lBRUQsUUFBUTtRQUNOLElBQUksQ0FBQyxhQUFhLENBQUMsU0FBUyxDQUMxQixJQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyx3QkFBd0IsRUFBRSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBNkIsQ0FBQyxDQUFDLEVBQ2hGO1lBQ0UsS0FBSyxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLGlCQUFpQixDQUFDO1NBQ2pELENBQ0Y7YUFDRSxXQUFXLEVBQUU7YUFDYixJQUFJLENBQ0gsSUFBQSxxQkFBUyxFQUFDLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDLEVBQ3hDLElBQUksQ0FBQyxZQUFZLENBQUMsVUFBVSxFQUFFLEVBQzlCLElBQUEsOEJBQWMsRUFBQyxJQUFJLENBQUMsQ0FDckI7YUFDQSxTQUFTLENBQUMsR0FBRyxFQUFFO1lBQ2QsSUFBSSxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO1lBQ3ZELElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLG1DQUFtQyxDQUFDLENBQUMsQ0FBQztRQUNyRixDQUFDLENBQUMsQ0FBQztJQUNQLENBQUM7SUFFTyxzQkFBc0I7UUFDNUIsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLG9CQUFvQixDQUFDLENBQUM7UUFDaEQsSUFBSSxDQUFDLEdBQUcsQ0FBQyxZQUFZLEVBQUUsQ0FBQztJQUMxQixDQUFDO0lBRU8sZ0JBQWdCO1FBQ3RCLE9BQU8sSUFBSSxDQUFDLGFBQWE7YUFDdEIsSUFBSSxDQUNILElBQUEsZ0JBQUksRUFBQyxDQUFDLENBQUMsRUFDUCxJQUFBLHFCQUFTLEVBQUMsQ0FBQyxZQUFZLEVBQUUsRUFBRTtZQUN6QixJQUFJLFlBQVksRUFBRSxDQUFDO2dCQUNqQiwyRkFBMkY7Z0JBQzNGLE9BQU8sWUFBSyxDQUFDO1lBQ2YsQ0FBQztZQUVELE9BQU8sSUFBSSxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1FBQ3RDLENBQUMsQ0FBQyxDQUNILENBQUM7SUFDTixDQUFDOztBQXJFVSxrRUFBMkI7Ozs7Ozs7Ozs7Ozs7c0NBQTNCLDJCQUEyQjtJQW5CdkMsSUFBQSw0QkFBWSxHQUFFO0lBQ2QsSUFBQSxnQkFBUyxFQUFDO1FBQ1QsUUFBUSxFQUFFLHlCQUF5QjtRQUNuQywwREFBb0Q7UUFFcEQsZUFBZSxFQUFFLDhCQUF1QixDQUFDLE1BQU07UUFDL0MsVUFBVSxFQUFFLElBQUk7UUFDaEIsT0FBTyxFQUFFO1lBQ1Asb0RBQXVCO1lBQ3ZCLGNBQU87WUFDUCxxQkFBYztZQUNkLDJCQUFtQjtZQUNuQixrREFBc0I7WUFDdEIsaURBQXNCO1lBQ3RCLGtCQUFTO1lBQ1QsOEJBQWE7WUFDYixzQkFBZTtTQUNoQjtLQUNGLENBQUM7R0FDVywyQkFBMkIsQ0FzRXZDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9tYWNib29rL2thcnBvdi13b3JrL1RydWVOQVMvd2VidWkvc3JjL2FwcC9wYWdlcy9zeXN0ZW0vYWR2YW5jZWQvc3lzdGVtLXNlY3VyaXR5L3N5c3RlbS1zZWN1cml0eS1mb3JtL3N5c3RlbS1zZWN1cml0eS1mb3JtLmNvbXBvbmVudC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSwgQ2hhbmdlRGV0ZWN0b3JSZWYsIENvbXBvbmVudCwgT25Jbml0LFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEZvcm1CdWlsZGVyLCBSZWFjdGl2ZUZvcm1zTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHsgTWF0QnV0dG9uIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwvYnV0dG9uJztcbmltcG9ydCB7IE1hdENhcmQsIE1hdENhcmRDb250ZW50IH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwvY2FyZCc7XG5pbXBvcnQgeyBVbnRpbERlc3Ryb3ksIHVudGlsRGVzdHJveWVkIH0gZnJvbSAnQG5nbmVhdC91bnRpbC1kZXN0cm95JztcbmltcG9ydCB7IFN0b3JlIH0gZnJvbSAnQG5ncngvc3RvcmUnO1xuaW1wb3J0IHsgVHJhbnNsYXRlU2VydmljZSwgVHJhbnNsYXRlTW9kdWxlIH0gZnJvbSAnQG5neC10cmFuc2xhdGUvY29yZSc7XG5pbXBvcnQgeyBFTVBUWSwgT2JzZXJ2YWJsZSB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgc3dpdGNoTWFwLCB0YWtlIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgUmVxdWlyZXNSb2xlc0RpcmVjdGl2ZSB9IGZyb20gJ2FwcC9kaXJlY3RpdmVzL3JlcXVpcmVzLXJvbGVzL3JlcXVpcmVzLXJvbGVzLmRpcmVjdGl2ZSc7XG5pbXBvcnQgeyBSb2xlIH0gZnJvbSAnYXBwL2VudW1zL3JvbGUuZW51bSc7XG5pbXBvcnQgeyBTeXN0ZW1TZWN1cml0eUNvbmZpZyB9IGZyb20gJ2FwcC9pbnRlcmZhY2VzL3N5c3RlbS1zZWN1cml0eS1jb25maWcuaW50ZXJmYWNlJztcbmltcG9ydCB7IERpYWxvZ1NlcnZpY2UgfSBmcm9tICdhcHAvbW9kdWxlcy9kaWFsb2cvZGlhbG9nLnNlcnZpY2UnO1xuaW1wb3J0IHsgQ2hhaW5lZFJlZiB9IGZyb20gJ2FwcC9tb2R1bGVzL2Zvcm1zL2l4LWZvcm1zL2NvbXBvbmVudHMvaXgtc2xpZGUtaW4vY2hhaW5lZC1jb21wb25lbnQtcmVmJztcbmltcG9ydCB7IEl4TW9kYWxIZWFkZXIyQ29tcG9uZW50IH0gZnJvbSAnYXBwL21vZHVsZXMvZm9ybXMvaXgtZm9ybXMvY29tcG9uZW50cy9peC1zbGlkZS1pbi9jb21wb25lbnRzL2l4LW1vZGFsLWhlYWRlcjIvaXgtbW9kYWwtaGVhZGVyMi5jb21wb25lbnQnO1xuaW1wb3J0IHsgSXhTbGlkZVRvZ2dsZUNvbXBvbmVudCB9IGZyb20gJ2FwcC9tb2R1bGVzL2Zvcm1zL2l4LWZvcm1zL2NvbXBvbmVudHMvaXgtc2xpZGUtdG9nZ2xlL2l4LXNsaWRlLXRvZ2dsZS5jb21wb25lbnQnO1xuaW1wb3J0IHsgU25hY2tiYXJTZXJ2aWNlIH0gZnJvbSAnYXBwL21vZHVsZXMvc25hY2tiYXIvc2VydmljZXMvc25hY2tiYXIuc2VydmljZSc7XG5pbXBvcnQgeyBUZXN0RGlyZWN0aXZlIH0gZnJvbSAnYXBwL21vZHVsZXMvdGVzdC1pZC90ZXN0LmRpcmVjdGl2ZSc7XG5pbXBvcnQgeyBFcnJvckhhbmRsZXJTZXJ2aWNlIH0gZnJvbSAnYXBwL3NlcnZpY2VzL2Vycm9yLWhhbmRsZXIuc2VydmljZSc7XG5pbXBvcnQgeyBGaXBzU2VydmljZSB9IGZyb20gJ2FwcC9zZXJ2aWNlcy9maXBzLnNlcnZpY2UnO1xuaW1wb3J0IHsgV2ViU29ja2V0U2VydmljZSB9IGZyb20gJ2FwcC9zZXJ2aWNlcy93cy5zZXJ2aWNlJztcbmltcG9ydCB7IEFwcFN0YXRlIH0gZnJvbSAnYXBwL3N0b3JlJztcbmltcG9ydCB7IHNlbGVjdElzSGFMaWNlbnNlZCB9IGZyb20gJ2FwcC9zdG9yZS9oYS1pbmZvL2hhLWluZm8uc2VsZWN0b3JzJztcblxuQFVudGlsRGVzdHJveSgpXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdpeC1zeXN0ZW0tc2VjdXJpdHktZm9ybScsXG4gIHRlbXBsYXRlVXJsOiAnLi9zeXN0ZW0tc2VjdXJpdHktZm9ybS5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL3N5c3RlbS1zZWN1cml0eS1mb3JtLmNvbXBvbmVudC5zY3NzJ10sXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxuICBzdGFuZGFsb25lOiB0cnVlLFxuICBpbXBvcnRzOiBbXG4gICAgSXhNb2RhbEhlYWRlcjJDb21wb25lbnQsXG4gICAgTWF0Q2FyZCxcbiAgICBNYXRDYXJkQ29udGVudCxcbiAgICBSZWFjdGl2ZUZvcm1zTW9kdWxlLFxuICAgIEl4U2xpZGVUb2dnbGVDb21wb25lbnQsXG4gICAgUmVxdWlyZXNSb2xlc0RpcmVjdGl2ZSxcbiAgICBNYXRCdXR0b24sXG4gICAgVGVzdERpcmVjdGl2ZSxcbiAgICBUcmFuc2xhdGVNb2R1bGUsXG4gIF0sXG59KVxuZXhwb3J0IGNsYXNzIFN5c3RlbVNlY3VyaXR5Rm9ybUNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG4gIHByb3RlY3RlZCByZWFkb25seSByZXF1aXJlZFJvbGVzID0gW1JvbGUuRnVsbEFkbWluXTtcblxuICBmb3JtID0gdGhpcy5mb3JtQnVpbGRlci5ncm91cCh7XG4gICAgZW5hYmxlX2ZpcHM6IFtmYWxzZV0sXG4gIH0pO1xuXG4gIHByaXZhdGUgaXNIYUxpY2Vuc2VkJCA9IHRoaXMuc3RvcmUkLnNlbGVjdChzZWxlY3RJc0hhTGljZW5zZWQpO1xuXG4gIHByaXZhdGUgc3lzdGVtU2VjdXJpdHlDb25maWc6IFN5c3RlbVNlY3VyaXR5Q29uZmlnO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgZm9ybUJ1aWxkZXI6IEZvcm1CdWlsZGVyLFxuICAgIHByaXZhdGUgY2RyOiBDaGFuZ2VEZXRlY3RvclJlZixcbiAgICBwcml2YXRlIHRyYW5zbGF0ZTogVHJhbnNsYXRlU2VydmljZSxcbiAgICBwcml2YXRlIHNuYWNrYmFyOiBTbmFja2JhclNlcnZpY2UsXG4gICAgcHJpdmF0ZSBjaGFpbmVkUmVmOiBDaGFpbmVkUmVmPFN5c3RlbVNlY3VyaXR5Q29uZmlnPixcbiAgICBwcml2YXRlIGZpcHM6IEZpcHNTZXJ2aWNlLFxuICAgIHByaXZhdGUgc3RvcmUkOiBTdG9yZTxBcHBTdGF0ZT4sXG4gICAgcHJpdmF0ZSBkaWFsb2dTZXJ2aWNlOiBEaWFsb2dTZXJ2aWNlLFxuICAgIHByaXZhdGUgd3M6IFdlYlNvY2tldFNlcnZpY2UsXG4gICAgcHJpdmF0ZSBlcnJvckhhbmRsZXI6IEVycm9ySGFuZGxlclNlcnZpY2UsXG4gICkge1xuICAgIHRoaXMuc3lzdGVtU2VjdXJpdHlDb25maWcgPSB0aGlzLmNoYWluZWRSZWYuZ2V0RGF0YSgpO1xuICB9XG5cbiAgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuc3lzdGVtU2VjdXJpdHlDb25maWcpIHtcbiAgICAgIHRoaXMuaW5pdFN5c3RlbVNlY3VyaXR5Rm9ybSgpO1xuICAgIH1cbiAgfVxuXG4gIG9uU3VibWl0KCk6IHZvaWQge1xuICAgIHRoaXMuZGlhbG9nU2VydmljZS5qb2JEaWFsb2coXG4gICAgICB0aGlzLndzLmpvYignc3lzdGVtLnNlY3VyaXR5LnVwZGF0ZScsIFt0aGlzLmZvcm0udmFsdWUgYXMgU3lzdGVtU2VjdXJpdHlDb25maWddKSxcbiAgICAgIHtcbiAgICAgICAgdGl0bGU6IHRoaXMudHJhbnNsYXRlLmluc3RhbnQoJ1NhdmluZyBzZXR0aW5ncycpLFxuICAgICAgfSxcbiAgICApXG4gICAgICAuYWZ0ZXJDbG9zZWQoKVxuICAgICAgLnBpcGUoXG4gICAgICAgIHN3aXRjaE1hcCgoKSA9PiB0aGlzLnByb21wdEZvclJlc3RhcnQoKSksXG4gICAgICAgIHRoaXMuZXJyb3JIYW5kbGVyLmNhdGNoRXJyb3IoKSxcbiAgICAgICAgdW50aWxEZXN0cm95ZWQodGhpcyksXG4gICAgICApXG4gICAgICAuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgdGhpcy5jaGFpbmVkUmVmLmNsb3NlKHsgcmVzcG9uc2U6IHRydWUsIGVycm9yOiBudWxsIH0pO1xuICAgICAgICB0aGlzLnNuYWNrYmFyLnN1Y2Nlc3ModGhpcy50cmFuc2xhdGUuaW5zdGFudCgnU3lzdGVtIFNlY3VyaXR5IFNldHRpbmdzIFVwZGF0ZWQuJykpO1xuICAgICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGluaXRTeXN0ZW1TZWN1cml0eUZvcm0oKTogdm9pZCB7XG4gICAgdGhpcy5mb3JtLnBhdGNoVmFsdWUodGhpcy5zeXN0ZW1TZWN1cml0eUNvbmZpZyk7XG4gICAgdGhpcy5jZHIubWFya0ZvckNoZWNrKCk7XG4gIH1cblxuICBwcml2YXRlIHByb21wdEZvclJlc3RhcnQoKTogT2JzZXJ2YWJsZTx1bmtub3duPiB7XG4gICAgcmV0dXJuIHRoaXMuaXNIYUxpY2Vuc2VkJFxuICAgICAgLnBpcGUoXG4gICAgICAgIHRha2UoMSksXG4gICAgICAgIHN3aXRjaE1hcCgoaXNIYUxpY2Vuc2VkKSA9PiB7XG4gICAgICAgICAgaWYgKGlzSGFMaWNlbnNlZCkge1xuICAgICAgICAgICAgLy8gUmVzdGFydCB3aWxsIGJlIGhhbmRsZWQgaW4gcmVzcG9uc2UgdG8gZmFpbG92ZXIuZGlzYWJsZWQucmVhc29ucyBldmVudCBpbiBIYUZpcHNFZmZlY3RzLlxuICAgICAgICAgICAgcmV0dXJuIEVNUFRZO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHJldHVybiB0aGlzLmZpcHMucHJvbXB0Rm9yUmVzdGFydCgpO1xuICAgICAgICB9KSxcbiAgICAgICk7XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==