a43c4b9ad4256766ca4dc5d7dfab1e29
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.StartServiceDialogComponent = void 0;
const scrolling_1 = require("@angular/cdk/scrolling");
const core_1 = require("@angular/core");
const forms_1 = require("@angular/forms");
const button_1 = require("@angular/material/button");
const dialog_1 = require("@angular/material/dialog");
const until_destroy_1 = require("@ngneat/until-destroy");
const store_1 = require("@ngrx/store");
const core_2 = require("@ngx-translate/core");
const rxjs_1 = require("rxjs");
const service_name_enum_1 = require("app/enums/service-name.enum");
const dialog_service_1 = require("app/modules/dialog/dialog.service");
const form_actions_component_1 = require("app/modules/forms/ix-forms/components/form-actions/form-actions.component");
const ix_slide_toggle_component_1 = require("app/modules/forms/ix-forms/components/ix-slide-toggle/ix-slide-toggle.component");
const fake_progress_bar_component_1 = require("app/modules/loader/components/fake-progress-bar/fake-progress-bar.component");
const snackbar_service_1 = require("app/modules/snackbar/services/snackbar.service");
const test_directive_1 = require("app/modules/test-id/test.directive");
const error_handler_service_1 = require("app/services/error-handler.service");
const ws_service_1 = require("app/services/ws.service");
const services_selectors_1 = require("app/store/services/services.selectors");
let StartServiceDialogComponent = class StartServiceDialogComponent {
    get serviceHumanName() {
        return service_name_enum_1.serviceNames.get(this.serviceName);
    }
    get isDisabled() {
        return !this.service.enable;
    }
    constructor(ws, cdr, translate, snackbar, dialogRef, store$, dialogService, errorHandler, serviceName) {
        this.ws = ws;
        this.cdr = cdr;
        this.translate = translate;
        this.snackbar = snackbar;
        this.dialogRef = dialogRef;
        this.store$ = store$;
        this.dialogService = dialogService;
        this.errorHandler = errorHandler;
        this.serviceName = serviceName;
        this.startAutomaticallyControl = new forms_1.FormControl(true);
        this.isLoading = false;
    }
    ngOnInit() {
        this.getService();
    }
    onCancel() {
        this.dialogRef.close({
            start: false,
            startAutomatically: false,
        });
    }
    onSubmit() {
        this.isLoading = true;
        const requests = [];
        const result = {
            start: true,
            startAutomatically: this.startAutomaticallyControl.value,
        };
        if (result.start && result.startAutomatically && this.isDisabled) {
            requests.push(this.ws.call('service.update', [this.service.id, { enable: result.startAutomatically }]));
        }
        if (result.start) {
            requests.push(this.ws.call('service.start', [this.serviceName, { silent: false }]));
        }
        (0, rxjs_1.forkJoin)(requests)
            .pipe((0, until_destroy_1.untilDestroyed)(this))
            .subscribe({
            next: () => {
                if (result.startAutomatically) {
                    this.snackbar.success(this.translate.instant('The {service} service is running and will auto-start after a system restart.', { service: this.serviceHumanName }));
                }
                else {
                    this.snackbar.success(this.translate.instant('The {service} service is running.', { service: this.serviceHumanName }));
                }
                this.isLoading = false;
                this.dialogRef.close(result);
            },
            error: (error) => {
                this.isLoading = false;
                this.dialogService.error(this.errorHandler.parseError(error));
                this.dialogRef.close({
                    start: false,
                    startAutomatically: false,
                });
            },
        });
    }
    getService() {
        this.store$.select((0, services_selectors_1.selectService)(this.serviceName))
            .pipe((0, until_destroy_1.untilDestroyed)(this))
            .subscribe((service) => {
            this.service = service;
            this.cdr.markForCheck();
        });
    }
};
exports.StartServiceDialogComponent = StartServiceDialogComponent;
StartServiceDialogComponent.ctorParameters = () => [
    { type: ws_service_1.WebSocketService },
    { type: core_1.ChangeDetectorRef },
    { type: core_2.TranslateService },
    { type: snackbar_service_1.SnackbarService },
    { type: dialog_1.MatDialogRef },
    { type: store_1.Store },
    { type: dialog_service_1.DialogService },
    { type: error_handler_service_1.ErrorHandlerService },
    { type: service_name_enum_1.ServiceName, decorators: [{ type: core_1.Inject, args: [dialog_1.MAT_DIALOG_DATA,] }] }
];
exports.StartServiceDialogComponent = StartServiceDialogComponent = __decorate([
    (0, until_destroy_1.UntilDestroy)(),
    (0, core_1.Component)({
        selector: 'ix-start-service-dialog',
        template: require("./start-service-dialog.component.html"),
        changeDetection: core_1.ChangeDetectionStrategy.OnPush,
        standalone: true,
        imports: [
            dialog_1.MatDialogTitle,
            scrolling_1.CdkScrollable,
            dialog_1.MatDialogContent,
            ix_slide_toggle_component_1.IxSlideToggleComponent,
            forms_1.ReactiveFormsModule,
            form_actions_component_1.FormActionsComponent,
            dialog_1.MatDialogActions,
            button_1.MatButton,
            core_2.TranslateModule,
            fake_progress_bar_component_1.FakeProgressBarComponent,
            test_directive_1.TestDirective,
        ],
    })
], StartServiceDialogComponent);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL21hY2Jvb2sva2FycG92LXdvcmsvVHJ1ZU5BUy93ZWJ1aS9zcmMvYXBwL21vZHVsZXMvZGlhbG9nL2NvbXBvbmVudHMvc3RhcnQtc2VydmljZS1kaWFsb2cvc3RhcnQtc2VydmljZS1kaWFsb2cuY29tcG9uZW50LnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBLHNEQUF1RDtBQUN2RCx3Q0FFdUI7QUFDdkIsMENBQWtFO0FBQ2xFLHFEQUFxRDtBQUNyRCxxREFFa0M7QUFDbEMseURBQXFFO0FBQ3JFLHVDQUFvQztBQUNwQyw4Q0FBd0U7QUFDeEUsK0JBQTRDO0FBQzVDLG1FQUF3RTtBQUV4RSxzRUFBa0U7QUFDbEUsc0hBQWlIO0FBQ2pILCtIQUF5SDtBQUN6SCw2SEFBdUg7QUFDdkgscUZBQWlGO0FBQ2pGLHVFQUFtRTtBQUNuRSw4RUFBeUU7QUFDekUsd0RBQTJEO0FBRTNELDhFQUFzRTtBQTJCL0QsSUFBTSwyQkFBMkIsR0FBakMsTUFBTSwyQkFBMkI7SUFLdEMsSUFBSSxnQkFBZ0I7UUFDbEIsT0FBTyxnQ0FBWSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUM7SUFDNUMsQ0FBQztJQUVELElBQUksVUFBVTtRQUNaLE9BQU8sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQztJQUM5QixDQUFDO0lBRUQsWUFDVSxFQUFvQixFQUNwQixHQUFzQixFQUN0QixTQUEyQixFQUMzQixRQUF5QixFQUN6QixTQUE4RSxFQUM5RSxNQUE0QixFQUM1QixhQUE0QixFQUM1QixZQUFpQyxFQUNULFdBQXdCO1FBUmhELE9BQUUsR0FBRixFQUFFLENBQWtCO1FBQ3BCLFFBQUcsR0FBSCxHQUFHLENBQW1CO1FBQ3RCLGNBQVMsR0FBVCxTQUFTLENBQWtCO1FBQzNCLGFBQVEsR0FBUixRQUFRLENBQWlCO1FBQ3pCLGNBQVMsR0FBVCxTQUFTLENBQXFFO1FBQzlFLFdBQU0sR0FBTixNQUFNLENBQXNCO1FBQzVCLGtCQUFhLEdBQWIsYUFBYSxDQUFl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LENBQUMsSUFBQSxrQ0FBYSxFQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQzthQUNoRCxJQUFJLENBQUMsSUFBQSw4QkFBYyxFQUFDLElBQUksQ0FBQyxDQUFDO2FBQzFCLFNBQVMsQ0FBQyxDQUFDLE9BQU8sRUFBRSxFQUFFO1lBQ3JCLElBQUksQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDO1lBQ3ZCLElBQUksQ0FBQyxHQUFHLENBQUMsWUFBWSxFQUFFLENBQUM7UUFDMUIsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDOztBQXpGVSxrRUFBMkI7Ozs7Ozs7Ozs7a0VBc0JuQyxhQUFNLFNBQUMsd0JBQWU7O3NDQXRCZCwyQkFBMkI7SUFwQnZDLElBQUEsNEJBQVksR0FBRTtJQUNkLElBQUEsZ0JBQVMsRUFBQztRQUNULFFBQVEsRUFBRSx5QkFBeUI7UUFDbkMsMERBQW9EO1FBQ3BELGVBQWUsRUFBRSw4QkFBdUIsQ0FBQyxNQUFNO1FBQy9DLFVBQVUsRUFBRSxJQUFJO1FBQ2hCLE9BQU8sRUFBRTtZQUNQLHVCQUFjO1lBQ2QseUJBQWE7WUFDYix5QkFBZ0I7WUFDaEIsa0RBQXNCO1lBQ3RCLDJCQUFtQjtZQUNuQiw2Q0FBb0I7WUFDcEIseUJBQWdCO1lBQ2hCLGtCQUFTO1lBQ1Qsc0JBQWU7WUFDZixzREFBd0I7WUFDeEIsOEJBQWE7U0FDZDtLQUNGLENBQUM7R0FDVywyQkFBMkIsQ0EwRnZDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9tYWNib29rL2thcnBvdi13b3JrL1RydWVOQVMvd2VidWkvc3JjL2FwcC9tb2R1bGVzL2RpYWxvZy9jb21wb25lbnRzL3N0YXJ0LXNlcnZpY2UtZGlhbG9nL3N0YXJ0LXNlcnZpY2UtZGlhbG9nLmNvbXBvbmVudC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDZGtTY3JvbGxhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY2RrL3Njcm9sbGluZyc7XG5pbXBvcnQge1xuICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSwgQ2hhbmdlRGV0ZWN0b3JSZWYsIENvbXBvbmVudCwgSW5qZWN0LCBPbkluaXQsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgRm9ybUNvbnRyb2wsIFJlYWN0aXZlRm9ybXNNb2R1bGUgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBNYXRCdXR0b24gfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbC9idXR0b24nO1xuaW1wb3J0IHtcbiAgTUFUX0RJQUxPR19EQVRBLCBNYXREaWFsb2dSZWYsIE1hdERpYWxvZ1RpdGxlLCBNYXREaWFsb2dDb250ZW50LCBNYXREaWFsb2dBY3Rpb25zLFxufSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbC9kaWFsb2cnO1xuaW1wb3J0IHsgVW50aWxEZXN0cm95LCB1bnRpbERlc3Ryb3llZCB9IGZyb20gJ0BuZ25lYXQvdW50aWwtZGVzdHJveSc7XG5pbXBvcnQgeyBTdG9yZSB9IGZyb20gJ0BuZ3J4L3N0b3JlJztcbmltcG9ydCB7IFRyYW5zbGF0ZVNlcnZpY2UsIFRyYW5zbGF0ZU1vZHVsZSB9IGZyb20gJ0BuZ3gtdHJhbnNsYXRlL2NvcmUnO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgZm9ya0pvaW4gfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IFNlcnZpY2VOYW1lLCBzZXJ2aWNlTmFtZXMgfSBmcm9tICdhcHAvZW51bXMvc2VydmljZS1uYW1lLmVudW0nO1xuaW1wb3J0IHsgU2VydmljZSB9IGZyb20gJ2FwcC9pbnRlcmZhY2VzL3NlcnZpY2UuaW50ZXJmYWNlJztcbmltcG9ydCB7IERpYWxvZ1NlcnZpY2UgfSBmcm9tICdhcHAvbW9kdWxlcy9kaWFsb2cvZGlhbG9nLnNlcnZpY2UnO1xuaW1wb3J0IHsgRm9ybUFjdGlvbnNDb21wb25lbnQgfSBmcm9tICdhcHAvbW9kdWxlcy9mb3Jtcy9peC1mb3Jtcy9jb21wb25lbnRzL2Zvcm0tYWN0aW9ucy9mb3JtLWFjdGlvbnMuY29tcG9uZW50JztcbmltcG9ydCB7IEl4U2xpZGVUb2dnbGVDb21wb25lbnQgfSBmcm9tICdhcHAvbW9kdWxlcy9mb3Jtcy9peC1mb3Jtcy9jb21wb25lbnRzL2l4LXNsaWRlLXRvZ2dsZS9peC1zbGlkZS10b2dnbGUuY29tcG9uZW50JztcbmltcG9ydCB7IEZha2VQcm9ncmVzc0JhckNvbXBvbmVudCB9IGZyb20gJ2FwcC9tb2R1bGVzL2xvYWRlci9jb21wb25lbnRzL2Zha2UtcHJvZ3Jlc3MtYmFyL2Zha2UtcHJvZ3Jlc3MtYmFyLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBTbmFja2JhclNlcnZpY2UgfSBmcm9tICdhcHAvbW9kdWxlcy9zbmFja2Jhci9zZXJ2aWNlcy9zbmFja2Jhci5zZXJ2aWNlJztcbmltcG9ydCB7IFRlc3REaXJlY3RpdmUgfSBmcm9tICdhcHAvbW9kdWxlcy90ZXN0LWlkL3Rlc3QuZGlyZWN0aXZlJztcbmltcG9ydCB7IEVycm9ySGFuZGxlclNlcnZpY2UgfSBmcm9tICdhcHAvc2VydmljZXMvZXJyb3ItaGFuZGxlci5zZXJ2aWNlJztcbmltcG9ydCB7IFdlYlNvY2tldFNlcnZpY2UgfSBmcm9tICdhcHAvc2VydmljZXMvd3Muc2VydmljZSc7XG5pbXBvcnQgeyBTZXJ2aWNlc1N0YXRlIH0gZnJvbSAnYXBwL3N0b3JlL3NlcnZpY2VzL3NlcnZpY2VzLnJlZHVjZXInO1xuaW1wb3J0IHsgc2VsZWN0U2VydmljZSB9IGZyb20gJ2FwcC9zdG9yZS9zZXJ2aWNlcy9zZXJ2aWNlcy5zZWxlY3RvcnMnO1xuXG5leHBvcnQgaW50ZXJmYWNlIFN0YXJ0U2VydmljZURpYWxvZ1Jlc3VsdCB7XG4gIHN0YXJ0OiBib29sZWFuO1xuICBzdGFydEF1dG9tYXRpY2FsbHk6IGJvb2xlYW47XG59XG5cbkBVbnRpbERlc3Ryb3koKVxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnaXgtc3RhcnQtc2VydmljZS1kaWFsb2cnLFxuICB0ZW1wbGF0ZVVybDogJy4vc3RhcnQtc2VydmljZS1kaWFsb2cuY29tcG9uZW50Lmh0bWwnLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcbiAgc3RhbmRhbG9uZTogdHJ1ZSxcbiAgaW1wb3J0czogW1xuICAgIE1hdERpYWxvZ1RpdGxlLFxuICAgIENka1Njcm9sbGFibGUsXG4gICAgTWF0RGlhbG9nQ29udGVudCxcbiAgICBJeFNsaWRlVG9nZ2xlQ29tcG9uZW50LFxuICAgIFJlYWN0aXZlRm9ybXNNb2R1bGUsXG4gICAgRm9ybUFjdGlvbnNDb21wb25lbnQsXG4gICAgTWF0RGlhbG9nQWN0aW9ucyxcbiAgICBNYXRCdXR0b24sXG4gICAgVHJhbnNsYXRlTW9kdWxlLFxuICAgIEZha2VQcm9ncmVzc0JhckNvbXBvbmVudCxcbiAgICBUZXN0RGlyZWN0aXZlLFxuICBdLFxufSlcbmV4cG9ydCBjbGFzcyBTdGFydFNlcnZpY2VEaWFsb2dDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuICBzdGFydEF1dG9tYXRpY2FsbHlDb250cm9sID0gbmV3IEZvcm1Db250cm9sKHRydWUpO1xuICBwcm90ZWN0ZWQgaXNMb2FkaW5nID0gZmFsc2U7XG4gIHByaXZhdGUgc2VydmljZTogU2VydmljZTtcblxuICBnZXQgc2VydmljZUh1bWFuTmFtZSgpOiBzdHJpbmcge1xuICAgIHJldHVybiBzZXJ2aWNlTmFtZXMuZ2V0KHRoaXMuc2VydmljZU5hbWUpO1xuICB9XG5cbiAgZ2V0IGlzRGlzYWJsZWQoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuICF0aGlzLnNlcnZpY2UuZW5hYmxlO1xuICB9XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSB3czogV2ViU29ja2V0U2VydmljZSxcbiAgICBwcml2YXRlIGNkcjogQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gICAgcHJpdmF0ZSB0cmFuc2xhdGU6IFRyYW5zbGF0ZVNlcnZpY2UsXG4gICAgcHJpdmF0ZSBzbmFja2JhcjogU25hY2tiYXJTZXJ2aWNlLFxuICAgIHByaXZhdGUgZGlhbG9nUmVmOiBNYXREaWFsb2dSZWY8U3RhcnRTZXJ2aWNlRGlhbG9nQ29tcG9uZW50LCBTdGFydFNlcnZpY2VEaWFsb2dSZXN1bHQ+LFxuICAgIHByaXZhdGUgc3RvcmUkOiBTdG9yZTxTZXJ2aWNlc1N0YXRlPixcbiAgICBwcml2YXRlIGRpYWxvZ1NlcnZpY2U6IERpYWxvZ1NlcnZpY2UsXG4gICAgcHJpdmF0ZSBlcnJvckhhbmRsZXI6IEVycm9ySGFuZGxlclNlcnZpY2UsXG4gICAgQEluamVjdChNQVRfRElBTE9HX0RBVEEpIHB1YmxpYyBzZXJ2aWNlTmFtZTogU2VydmljZU5hbWUsXG4gICkge31cblxuICBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICB0aGlzLmdldFNlcnZpY2UoKTtcbiAgfVxuXG4gIG9uQ2FuY2VsKCk6IHZvaWQge1xuICAgIHRoaXMuZGlhbG9nUmVmLmNsb3NlKHtcbiAgICAgIHN0YXJ0OiBmYWxzZSxcbiAgICAgIHN0YXJ0QXV0b21hdGljYWxseTogZmFsc2UsXG4gICAgfSk7XG4gIH1cblxuICBvblN1Ym1pdCgpOiB2b2lkIHtcbiAgICB0aGlzLmlzTG9hZGluZyA9IHRydWU7XG4gICAgY29uc3QgcmVxdWVzdHM6IE9ic2VydmFibGU8Ym9vbGVhbiB8IG51bWJlcj5bXSA9IFtdO1xuICAgIGNvbnN0IHJlc3VsdDogU3RhcnRTZXJ2aWNlRGlhbG9nUmVzdWx0ID0ge1xuICAgICAgc3RhcnQ6IHRydWUsXG4gICAgICBzdGFydEF1dG9tYXRpY2FsbHk6IHRoaXMuc3RhcnRBdXRvbWF0aWNhbGx5Q29udHJvbC52YWx1ZSxcbiAgICB9O1xuXG4gICAgaWYgKHJlc3VsdC5zdGFydCAmJiByZXN1bHQuc3RhcnRBdXRvbWF0aWNhbGx5ICYmIHRoaXMuaXNEaXNhYmxlZCkge1xuICAgICAgcmVxdWVzdHMucHVzaCh0aGlzLndzLmNhbGwoJ3NlcnZpY2UudXBkYXRlJywgW3RoaXMuc2VydmljZS5pZCwgeyBlbmFibGU6IHJlc3VsdC5zdGFydEF1dG9tYXRpY2FsbHkgfV0pKTtcbiAgICB9XG5cbiAgICBpZiAocmVzdWx0LnN0YXJ0KSB7XG4gICAgICByZXF1ZXN0cy5wdXNoKHRoaXMud3MuY2FsbCgnc2VydmljZS5zdGFydCcsIFt0aGlzLnNlcnZpY2VOYW1lLCB7IHNpbGVudDogZmFsc2UgfV0pKTtcbiAgICB9XG5cbiAgICBmb3JrSm9pbihyZXF1ZXN0cylcbiAgICAgIC5waXBlKHVudGlsRGVzdHJveWVkKHRoaXMpKVxuICAgICAgLnN1YnNjcmliZSh7XG4gICAgICAgIG5leHQ6ICgpID0+IHtcbiAgICAgICAgICBpZiAocmVzdWx0LnN0YXJ0QXV0b21hdGljYWxseSkge1xuICAgICAgICAgICAgdGhpcy5zbmFja2Jhci5zdWNjZXNzKFxuICAgICAgICAgICAgICB0aGlzLnRyYW5zbGF0ZS5pbnN0YW50KFxuICAgICAgICAgICAgICAgICdUaGUge3NlcnZpY2V9IHNlcnZpY2UgaXMgcnVubmluZyBhbmQgd2lsbCBhdXRvLXN0YXJ0IGFmdGVyIGEgc3lzdGVtIHJlc3RhcnQuJyxcbiAgICAgICAgICAgICAgICB7IHNlcnZpY2U6IHRoaXMuc2VydmljZUh1bWFuTmFtZSB9LFxuICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zbmFja2Jhci5zdWNjZXNzKFxuICAgICAgICAgICAgICB0aGlzLnRyYW5zbGF0ZS5pbnN0YW50KCdUaGUge3NlcnZpY2V9IHNlcnZpY2UgaXMgcnVubmluZy4nLCB7IHNlcnZpY2U6IHRoaXMuc2VydmljZUh1bWFuTmFtZSB9KSxcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgdGhpcy5kaWFsb2dSZWYuY2xvc2UocmVzdWx0KTtcbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3I6IChlcnJvcjogdW5rbm93bikgPT4ge1xuICAgICAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgdGhpcy5kaWFsb2dTZXJ2aWNlLmVycm9yKHRoaXMuZXJyb3JIYW5kbGVyLnBhcnNlRXJyb3IoZXJyb3IpKTtcbiAgICAgICAgICB0aGlzLmRpYWxvZ1JlZi5jbG9zZSh7XG4gICAgICAgICAgICBzdGFydDogZmFsc2UsXG4gICAgICAgICAgICBzdGFydEF1dG9tYXRpY2FsbHk6IGZhbHNlLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGdldFNlcnZpY2UoKTogdm9pZCB7XG4gICAgdGhpcy5zdG9yZSQuc2VsZWN0KHNlbGVjdFNlcnZpY2UodGhpcy5zZXJ2aWNlTmFtZSkpXG4gICAgICAucGlwZSh1bnRpbERlc3Ryb3llZCh0aGlzKSlcbiAgICAgIC5zdWJzY3JpYmUoKHNlcnZpY2UpID0+IHtcbiAgICAgICAgdGhpcy5zZXJ2aWNlID0gc2VydmljZTtcbiAgICAgICAgdGhpcy5jZHIubWFya0ZvckNoZWNrKCk7XG4gICAgICB9KTtcbiAgfVxufVxuIl0sInZlcnNpb24iOjN9