f4f6e26691233292bc8ad73f0391cc7b
"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.IxPermissionsHarness = void 0;
const testing_1 = require("@angular/cdk/testing");
const testing_2 = require("@angular/material/checkbox/testing");
const posix_acl_enum_1 = require("app/enums/posix-acl.enum");
const mode_helper_1 = require("app/helpers/mode.helper");
const ix_label_harness_1 = require("app/modules/forms/ix-forms/components/ix-label/ix-label.harness");
const harness_utils_1 = require("app/modules/forms/ix-forms/utils/harness.utils");
class IxPermissionsHarness extends testing_1.ComponentHarness {
    constructor() {
        super(...arguments);
        this.getMatCheckboxHarnesses = this.locatorForAll(testing_2.MatCheckboxHarness);
        this.getErrorText = harness_utils_1.getErrorText;
    }
    static with(options) {
        return new testing_1.HarnessPredicate(IxPermissionsHarness, options)
            .addOption('label', options.label, (harness, label) => testing_1.HarnessPredicate.stringMatches(harness.getLabelText(), label));
    }
    getLabelText() {
        return __awaiter(this, void 0, void 0, function* () {
            const label = yield this.locatorForOptional(ix_label_harness_1.IxLabelHarness)();
            if (!label) {
                return '';
            }
            return label.getLabel();
        });
    }
    getValue() {
        return __awaiter(this, void 0, void 0, function* () {
            const permissions = (yield this.getMatCheckboxHarnesses());
            let owner = 0;
            let grp = 0;
            let other = 0;
            if ((yield permissions[0].isChecked())) {
                owner += 4;
            }
            if ((yield permissions[1].isChecked())) {
                owner += 2;
            }
            if ((yield permissions[2].isChecked())) {
                owner += 1;
            }
            if ((yield permissions[3].isChecked())) {
                grp += 4;
            }
            if ((yield permissions[4].isChecked())) {
                grp += 2;
            }
            if ((yield permissions[5].isChecked())) {
                grp += 1;
            }
            if (permissions.length > 6) {
                if ((yield permissions[6].isChecked())) {
                    other += 4;
                }
                if ((yield permissions[7].isChecked())) {
                    other += 2;
                }
                if ((yield permissions[8].isChecked())) {
                    other += 1;
                }
            }
            return new Promise((resolve) => {
                resolve(owner.toString() + grp.toString() + other.toString());
            });
        });
    }
    setValue(value) {
        return __awaiter(this, void 0, void 0, function* () {
            const checkboxes = (yield this.getMatCheckboxHarnesses());
            return new Promise((resolve, reject) => {
                const permissions = (0, mode_helper_1.parseMode)(value);
                Promise.all([
                    permissions.owner[posix_acl_enum_1.PosixPermission.Read] ? checkboxes[0].check() : checkboxes[0].uncheck(),
                    permissions.owner[posix_acl_enum_1.PosixPermission.Write] ? checkboxes[1].check() : checkboxes[1].uncheck(),
                    permissions.owner[posix_acl_enum_1.PosixPermission.Execute] ? checkboxes[2].check() : checkboxes[2].uncheck(),
                    permissions.group[posix_acl_enum_1.PosixPermission.Read] ? checkboxes[3].check() : checkboxes[3].uncheck(),
                    permissions.group[posix_acl_enum_1.PosixPermission.Write] ? checkboxes[4].check() : checkboxes[4].uncheck(),
                    permissions.group[posix_acl_enum_1.PosixPermission.Execute] ? checkboxes[5].check() : checkboxes[5].uncheck(),
                    permissions.other[posix_acl_enum_1.PosixPermission.Read] ? checkboxes[6].check() : checkboxes[6].uncheck(),
                    permissions.other[posix_acl_enum_1.PosixPermission.Write] ? checkboxes[7].check() : checkboxes[7].uncheck(),
                    permissions.other[posix_acl_enum_1.PosixPermission.Execute] ? checkboxes[8].check() : checkboxes[8].uncheck(),
                ])
                    .then(() => {
                    resolve();
                })
                    .catch((errors) => {
                    reject(errors);
                });
            });
        });
    }
    isDisabled() {
        return __awaiter(this, void 0, void 0, function* () {
            const checkboxes = yield this.getMatCheckboxHarnesses();
            const inputState = yield (0, testing_1.parallel)(() => checkboxes.map((control) => control.isDisabled()));
            return new Promise((resolve) => {
                resolve(inputState.every((control) => !!control));
            });
        });
    }
}
exports.IxPermissionsHarness = IxPermissionsHarness;
IxPermissionsHarness.hostSelector = 'ix-permissions';
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL21hY2Jvb2sva2FycG92LXdvcmsvVHJ1ZU5BUy93ZWJ1aS9zcmMvYXBwL21vZHVsZXMvZm9ybXMvaXgtZm9ybXMvY29tcG9uZW50cy9peC1wZXJtaXNzaW9ucy9peC1wZXJtaXNzaW9ucy5oYXJuZXNzLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQUFBLGtEQUU4QjtBQUM5QixnRUFBd0U7QUFDeEUsNkRBQTJEO0FBQzNELHlEQUFvRDtBQUNwRCxzR0FBaUc7QUFFakcsa0ZBQThFO0FBTTlFLE1BQWEsb0JBQXFCLFNBQVEsMEJBQWdCO0lBQTFEOztRQVFFLDRCQUF1QixHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsNEJBQWtCLENBQUMsQ0FBQztRQUNqRSxpQkFBWSxHQUFHLDRCQUFZLENBQUM7SUE0RjlCLENBQUM7SUFsR0MsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFvQztRQUM5QyxPQUFPLElBQUksMEJBQWdCLENBQUMsb0JBQW9CLEVBQUUsT0FBTyxDQUFDO2FBQ3ZELFNBQVMsQ0FBQyxPQUFPLEVBQUUsT0FBTyxDQUFDLEtBQUssRUFBRSxDQUFDLE9BQU8sRUFBRSxLQUFLLEVBQUUsRUFBRSxDQUFDLDBCQUFnQixDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsWUFBWSxFQUFFLEVBQUUsS0FBSyxDQUFDLENBQUMsQ0FBQztJQUMxSCxDQUFDO0lBS0ssWUFBWTs7WUFDaEIsTUFBTSxLQUFLLEdBQUcsTUFBTSxJQUFJLENBQUMsa0JBQWtCLENBQUMsaUNBQWMsQ0FBQyxFQUFFLENBQUM7WUFDOUQsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO2dCQUNYLE9BQU8sRUFBRSxDQUFDO1lBQ1osQ0FBQztZQUNELE9BQU8sS0FBSyxDQUFDLFFBQVEsRUFBRSxDQUFDO1FBQzFCLENBQUM7S0FBQTtJQUVLLFFBQVE7O1lBQ1osTUFBTSxXQUFXLEdBQUcsQ0FBQyxNQUFNLElBQUksQ0FBQyx1QkFBdUIsRUFBRSxDQUFDLENBQUM7WUFDM0QsSUFBSSxLQUFLLEdBQUcsQ0FBQyxD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QWUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxFQUFFO2lCQUM3RixDQUFDO3FCQUNDLElBQUksQ0FBQyxHQUFHLEVBQUU7b0JBQ1QsT0FBTyxFQUFFLENBQUM7Z0JBQ1osQ0FBQyxDQUFDO3FCQUNELEtBQUssQ0FBQyxDQUFDLE1BQU0sRUFBRSxFQUFFO29CQUNoQixNQUFNLENBQUMsTUFBTSxDQUFDLENBQUM7Z0JBQ2pCLENBQUMsQ0FBQyxDQUFDO1lBQ1AsQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDO0tBQUE7SUFFSyxVQUFVOztZQUNkLE1BQU0sVUFBVSxHQUFHLE1BQU0sSUFBSSxDQUFDLHVCQUF1QixFQUFFLENBQUM7WUFDeEQsTUFBTSxVQUFVLEdBQUcsTUFBTSxJQUFBLGtCQUFRLEVBQUMsR0FBRyxFQUFFLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDLE9BQU8sRUFBRSxFQUFFLENBQUMsT0FBTyxDQUFDLFVBQVUsRUFBRSxDQUFDLENBQUMsQ0FBQztZQUUzRixPQUFPLElBQUksT0FBTyxDQUFDLENBQUMsT0FBTyxFQUFFLEVBQUU7Z0JBQzdCLE9BQU8sQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUMsT0FBTyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztZQUNwRCxDQUFDLENBQUMsQ0FBQztRQUNMLENBQUM7S0FBQTs7QUFwR0gsb0RBcUdDO0FBcEdRLGlDQUFZLEdBQUcsZ0JBQWdCLEFBQW5CLENBQW9CIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9tYWNib29rL2thcnBvdi13b3JrL1RydWVOQVMvd2VidWkvc3JjL2FwcC9tb2R1bGVzL2Zvcm1zL2l4LWZvcm1zL2NvbXBvbmVudHMvaXgtcGVybWlzc2lvbnMvaXgtcGVybWlzc2lvbnMuaGFybmVzcy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBCYXNlSGFybmVzc0ZpbHRlcnMsIENvbXBvbmVudEhhcm5lc3MsIEhhcm5lc3NQcmVkaWNhdGUsIHBhcmFsbGVsLFxufSBmcm9tICdAYW5ndWxhci9jZGsvdGVzdGluZyc7XG5pbXBvcnQgeyBNYXRDaGVja2JveEhhcm5lc3MgfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbC9jaGVja2JveC90ZXN0aW5nJztcbmltcG9ydCB7IFBvc2l4UGVybWlzc2lvbiB9IGZyb20gJ2FwcC9lbnVtcy9wb3NpeC1hY2wuZW51bSc7XG5pbXBvcnQgeyBwYXJzZU1vZGUgfSBmcm9tICdhcHAvaGVscGVycy9tb2RlLmhlbHBlcic7XG5pbXBvcnQgeyBJeExhYmVsSGFybmVzcyB9IGZyb20gJ2FwcC9tb2R1bGVzL2Zvcm1zL2l4LWZvcm1zL2NvbXBvbmVudHMvaXgtbGFiZWwvaXgtbGFiZWwuaGFybmVzcyc7XG5pbXBvcnQgeyBJeEZvcm1Db250cm9sSGFybmVzcyB9IGZyb20gJ2FwcC9tb2R1bGVzL2Zvcm1zL2l4LWZvcm1zL2ludGVyZmFjZXMvaXgtZm9ybS1jb250cm9sLWhhcm5lc3MuaW50ZXJmYWNlJztcbmltcG9ydCB7IGdldEVycm9yVGV4dCB9IGZyb20gJ2FwcC9tb2R1bGVzL2Zvcm1zL2l4LWZvcm1zL3V0aWxzL2hhcm5lc3MudXRpbHMnO1xuXG5leHBvcnQgaW50ZXJmYWNlIEl4UGVybWlzc2lvbnNIYXJuZXNzRmlsdGVycyBleHRlbmRzIEJhc2VIYXJuZXNzRmlsdGVycyB7XG4gIGxhYmVsOiBzdHJpbmc7XG59XG5cbmV4cG9ydCBjbGFzcyBJeFBlcm1pc3Npb25zSGFybmVzcyBleHRlbmRzIENvbXBvbmVudEhhcm5lc3MgaW1wbGVtZW50cyBJeEZvcm1Db250cm9sSGFybmVzcyB7XG4gIHN0YXRpYyBob3N0U2VsZWN0b3IgPSAnaXgtcGVybWlzc2lvbnMnO1xuXG4gIHN0YXRpYyB3aXRoKG9wdGlvbnM6IEl4UGVybWlzc2lvbnNIYXJuZXNzRmlsdGVycyk6IEhhcm5lc3NQcmVkaWNhdGU8SXhQZXJtaXNzaW9uc0hhcm5lc3M+IHtcbiAgICByZXR1cm4gbmV3IEhhcm5lc3NQcmVkaWNhdGUoSXhQZXJtaXNzaW9uc0hhcm5lc3MsIG9wdGlvbnMpXG4gICAgICAuYWRkT3B0aW9uKCdsYWJlbCcsIG9wdGlvbnMubGFiZWwsIChoYXJuZXNzLCBsYWJlbCkgPT4gSGFybmVzc1ByZWRpY2F0ZS5zdHJpbmdNYXRjaGVzKGhhcm5lc3MuZ2V0TGFiZWxUZXh0KCksIGxhYmVsKSk7XG4gIH1cblxuICBnZXRNYXRDaGVja2JveEhhcm5lc3NlcyA9IHRoaXMubG9jYXRvckZvckFsbChNYXRDaGVja2JveEhhcm5lc3MpO1xuICBnZXRFcnJvclRleHQgPSBnZXRFcnJvclRleHQ7XG5cbiAgYXN5bmMgZ2V0TGFiZWxUZXh0KCk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgY29uc3QgbGFiZWwgPSBhd2FpdCB0aGlzLmxvY2F0b3JGb3JPcHRpb25hbChJeExhYmVsSGFybmVzcykoKTtcbiAgICBpZiAoIWxhYmVsKSB7XG4gICAgICByZXR1cm4gJyc7XG4gICAgfVxuICAgIHJldHVybiBsYWJlbC5nZXRMYWJlbCgpO1xuICB9XG5cbiAgYXN5bmMgZ2V0VmFsdWUoKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICBjb25zdCBwZXJtaXNzaW9ucyA9IChhd2FpdCB0aGlzLmdldE1hdENoZWNrYm94SGFybmVzc2VzKCkpO1xuICAgIGxldCBvd25lciA9IDA7XG4gICAgbGV0IGdycCA9IDA7XG4gICAgbGV0IG90aGVyID0gMDtcblxuICAgIGlmICgoYXdhaXQgcGVybWlzc2lvbnNbMF0uaXNDaGVja2VkKCkpKSB7XG4gICAgICBvd25lciArPSA0O1xuICAgIH1cblxuICAgIGlmICgoYXdhaXQgcGVybWlzc2lvbnNbMV0uaXNDaGVja2VkKCkpKSB7XG4gICAgICBvd25lciArPSAyO1xuICAgIH1cblxuICAgIGlmICgoYXdhaXQgcGVybWlzc2lvbnNbMl0uaXNDaGVja2VkKCkpKSB7XG4gICAgICBvd25lciArPSAxO1xuICAgIH1cblxuICAgIGlmICgoYXdhaXQgcGVybWlzc2lvbnNbM10uaXNDaGVja2VkKCkpKSB7XG4gICAgICBncnAgKz0gNDtcbiAgICB9XG5cbiAgICBpZiAoKGF3YWl0IHBlcm1pc3Npb25zWzRdLmlzQ2hlY2tlZCgpKSkge1xuICAgICAgZ3JwICs9IDI7XG4gICAgfVxuXG4gICAgaWYgKChhd2FpdCBwZXJtaXNzaW9uc1s1XS5pc0NoZWNrZWQoKSkpIHtcbiAgICAgIGdycCArPSAxO1xuICAgIH1cblxuICAgIGlmIChwZXJtaXNzaW9ucy5sZW5ndGggPiA2KSB7XG4gICAgICBpZiAoKGF3YWl0IHBlcm1pc3Npb25zWzZdLmlzQ2hlY2tlZCgpKSkge1xuICAgICAgICBvdGhlciArPSA0O1xuICAgICAgfVxuXG4gICAgICBpZiAoKGF3YWl0IHBlcm1pc3Npb25zWzddLmlzQ2hlY2tlZCgpKSkge1xuICAgICAgICBvdGhlciArPSAyO1xuICAgICAgfVxuXG4gICAgICBpZiAoKGF3YWl0IHBlcm1pc3Npb25zWzhdLmlzQ2hlY2tlZCgpKSkge1xuICAgICAgICBvdGhlciArPSAxO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgICAgcmVzb2x2ZShvd25lci50b1N0cmluZygpICsgZ3JwLnRvU3RyaW5nKCkgKyBvdGhlci50b1N0cmluZygpKTtcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIHNldFZhbHVlKHZhbHVlOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBjaGVja2JveGVzID0gKGF3YWl0IHRoaXMuZ2V0TWF0Q2hlY2tib3hIYXJuZXNzZXMoKSk7XG5cbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgY29uc3QgcGVybWlzc2lvbnMgPSBwYXJzZU1vZGUodmFsdWUpO1xuICAgICAgUHJvbWlzZS5hbGwoW1xuICAgICAgICBwZXJtaXNzaW9ucy5vd25lcltQb3NpeFBlcm1pc3Npb24uUmVhZF0gPyBjaGVja2JveGVzWzBdLmNoZWNrKCkgOiBjaGVja2JveGVzWzBdLnVuY2hlY2soKSxcbiAgICAgICAgcGVybWlzc2lvbnMub3duZXJbUG9zaXhQZXJtaXNzaW9uLldyaXRlXSA/IGNoZWNrYm94ZXNbMV0uY2hlY2soKSA6IGNoZWNrYm94ZXNbMV0udW5jaGVjaygpLFxuICAgICAgICBwZXJtaXNzaW9ucy5vd25lcltQb3NpeFBlcm1pc3Npb24uRXhlY3V0ZV0gPyBjaGVja2JveGVzWzJdLmNoZWNrKCkgOiBjaGVja2JveGVzWzJdLnVuY2hlY2soKSxcbiAgICAgICAgcGVybWlzc2lvbnMuZ3JvdXBbUG9zaXhQZXJtaXNzaW9uLlJlYWRdID8gY2hlY2tib3hlc1szXS5jaGVjaygpIDogY2hlY2tib3hlc1szXS51bmNoZWNrKCksXG4gICAgICAgIHBlcm1pc3Npb25zLmdyb3VwW1Bvc2l4UGVybWlzc2lvbi5Xcml0ZV0gPyBjaGVja2JveGVzWzRdLmNoZWNrKCkgOiBjaGVja2JveGVzWzRdLnVuY2hlY2soKSxcbiAgICAgICAgcGVybWlzc2lvbnMuZ3JvdXBbUG9zaXhQZXJtaXNzaW9uLkV4ZWN1dGVdID8gY2hlY2tib3hlc1s1XS5jaGVjaygpIDogY2hlY2tib3hlc1s1XS51bmNoZWNrKCksXG4gICAgICAgIHBlcm1pc3Npb25zLm90aGVyW1Bvc2l4UGVybWlzc2lvbi5SZWFkXSA/IGNoZWNrYm94ZXNbNl0uY2hlY2soKSA6IGNoZWNrYm94ZXNbNl0udW5jaGVjaygpLFxuICAgICAgICBwZXJtaXNzaW9ucy5vdGhlcltQb3NpeFBlcm1pc3Npb24uV3JpdGVdID8gY2hlY2tib3hlc1s3XS5jaGVjaygpIDogY2hlY2tib3hlc1s3XS51bmNoZWNrKCksXG4gICAgICAgIHBlcm1pc3Npb25zLm90aGVyW1Bvc2l4UGVybWlzc2lvbi5FeGVjdXRlXSA/IGNoZWNrYm94ZXNbOF0uY2hlY2soKSA6IGNoZWNrYm94ZXNbOF0udW5jaGVjaygpLFxuICAgICAgXSlcbiAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKChlcnJvcnMpID0+IHtcbiAgICAgICAgICByZWplY3QoZXJyb3JzKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICBhc3luYyBpc0Rpc2FibGVkKCk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIGNvbnN0IGNoZWNrYm94ZXMgPSBhd2FpdCB0aGlzLmdldE1hdENoZWNrYm94SGFybmVzc2VzKCk7XG4gICAgY29uc3QgaW5wdXRTdGF0ZSA9IGF3YWl0IHBhcmFsbGVsKCgpID0+IGNoZWNrYm94ZXMubWFwKChjb250cm9sKSA9PiBjb250cm9sLmlzRGlzYWJsZWQoKSkpO1xuXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XG4gICAgICByZXNvbHZlKGlucHV0U3RhdGUuZXZlcnkoKGNvbnRyb2wpID0+ICEhY29udHJvbCkpO1xuICAgIH0pO1xuICB9XG59XG4iXSwidmVyc2lvbiI6M30=