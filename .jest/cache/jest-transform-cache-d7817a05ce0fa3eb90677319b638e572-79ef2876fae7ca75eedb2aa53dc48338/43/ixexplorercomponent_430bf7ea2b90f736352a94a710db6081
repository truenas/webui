c922eebf0df354798f78623038f4b4a9
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.IxExplorerComponent = void 0;
const core_1 = require("@angular/core");
const forms_1 = require("@angular/forms");
const button_1 = require("@angular/material/button");
const dialog_1 = require("@angular/material/dialog");
const form_field_1 = require("@angular/material/form-field");
const input_1 = require("@angular/material/input");
const angular_tree_component_1 = require("@bugsplat/angular-tree-component");
const until_destroy_1 = require("@ngneat/until-destroy");
const core_2 = require("@ngx-translate/core");
const rxjs_1 = require("rxjs");
const operators_1 = require("rxjs/operators");
const requires_roles_directive_1 = require("app/directives/requires-roles/requires-roles.directive");
const explorer_type_enum_1 = require("app/enums/explorer-type.enum");
const mnt_path_enum_1 = require("app/enums/mnt-path.enum");
const role_enum_1 = require("app/enums/role.enum");
const ix_errors_component_1 = require("app/modules/forms/ix-forms/components/ix-errors/ix-errors.component");
const create_dataset_dialog_component_1 = require("app/modules/forms/ix-forms/components/ix-explorer/create-dataset-dialog/create-dataset-dialog.component");
const ix_label_component_1 = require("app/modules/forms/ix-forms/components/ix-label/ix-label.component");
const ix_icon_component_1 = require("app/modules/ix-icon/ix-icon.component");
const test_override_directive_1 = require("app/modules/test-id/test-override/test-override.directive");
const test_directive_1 = require("app/modules/test-id/test.directive");
let IxExplorerComponent = class IxExplorerComponent {
    get createDatasetDisabled() {
        return !this.parentDatasetName(Array.isArray(this.value) ? this.value[0] : this.value).length
            || !this.tree.treeModel.selectedLeafNodes.every((node) => node.data.isMountpoint)
            || this.isDisabled;
    }
    constructor(controlDirective, cdr, matDialog, translate) {
        this.controlDirective = controlDirective;
        this.cdr = cdr;
        this.matDialog = matDialog;
        this.translate = translate;
        this.multiple = false;
        this.root = mnt_path_enum_1.mntPath;
        this.canCreateDataset = false;
        this.createDatasetProps = {};
        this.requiredRoles = [role_enum_1.Role.DatasetWrite];
        this.inputValue = '';
        this.isDisabled = false;
        this.nodes = [];
        this.onChange = () => { };
        this.onTouch = () => { };
        this.ExplorerNodeType = explorer_type_enum_1.ExplorerNodeType;
        this.actionMapping = {
            mouse: {
                dblClick: (tree, node, $event) => {
                    angular_tree_component_1.TREE_ACTIONS.TOGGLE_EXPANDED(tree, node, $event);
                },
                click: (tree, node, $event) => {
                    angular_tree_component_1.TREE_ACTIONS.TOGGLE_SELECTED(tree, node, $event);
                },
            },
            keys: {
                [angular_tree_component_1.KEYS.ENTER]: (tree, node, $event) => {
                    angular_tree_component_1.TREE_ACTIONS.TOGGLE_SELECTED(tree, node, $event);
                },
            },
        };
        this.treeOptions = {
            idField: 'path',
            displayField: 'name',
            getChildren: (node) => (0, rxjs_1.firstValueFrom)(this.loadChildren(node)),
            actionMapping: this.actionMapping,
            useTriState: false,
        };
        this.controlDirective.valueAccessor = this;
    }
    ngOnChanges(changes) {
        if ('multiple' in changes) {
            this.treeOptions.useCheckbox = this.multiple;
        }
        if ('nodeProvider' in changes || 'root' in changes) {
            this.setInitialNode();
            this.cdr.markForCheck();
        }
    }
    ngOnInit() {
        this.setInitialNode();
    }
    writeValue(value) {
        this.value = value;
        this.updateInputValue();
        this.selectTreeNodes(Array.isArray(value) ? value : [value]);
        this.cdr.markForCheck();
    }
    registerOnChange(onChange) {
        this.onChange = onChange;
    }
    registerOnTouched(onTouched) {
        this.onTouch = onTouched;
    }
    setDisabledState(isDisabled) {
        this.isDisabled = isDisabled;
        this.cdr.markForCheck();
    }
    onNodeSelect(event) {
        if (this.multiple) {
            this.selectTreeNodes([
                ...Object.keys(this.tree.treeModel.selectedLeafNodeIds),
                event.node.id,
            ]);
        }
        else {
            this.selectTreeNodes([event.node.id]);
        }
        this.onSelectionChanged();
    }
    onNodeDeselect(event) {
        if (this.multiple) {
            this.selectTreeNodes(Object.keys(this.tree.treeModel.selectedLeafNodeIds).filter((node) => node !== event.node.id));
        }
        else {
            this.selectTreeNodes([]);
        }
        this.onSelectionChanged();
    }
    ariaLabel(node) {
        return this.translate.instant('Highlighted path is {node}. Press \'Space\' to {expand}. Press \'Enter\' to {select}.', {
            expand: (node === null || node === void 0 ? void 0 : node.isExpanded) ? 'Collapse' : 'Expand',
            select: (node === null || node === void 0 ? void 0 : node.isSelected) ? 'Unselect' : 'Select',
            node: node.data.path.replace(/.{1}/g, '$&,').replace(/\//g, 'slash'),
        });
    }
    onSelectionChanged() {
        let newValue = Object.entries(this.tree.treeModel.selectedLeafNodeIds)
            .filter(([, isSelected]) => isSelected)
            .map(([nodeId]) => nodeId);
        if (!this.multiple) {
            newValue = newValue[0];
        }
        if (newValue === this.value) {
            return;
        }
        this.value = newValue;
        this.updateInputValue();
        this.onChange(newValue);
    }
    onInputChanged(inputValue) {
        this.inputValue = inputValue;
        this.value = this.multiple ? inputValue.split(',') : inputValue;
        this.selectTreeNodes(Array.isArray(this.value) ? this.value : [this.value]);
        this.onChange(this.value);
    }
    isPathSelected(path) {
        var _a;
        return typeof this.value === 'string' ? this.value === path : (_a = this.value) === null || _a === void 0 ? void 0 : _a.some((content) => content === path);
    }
    parentDatasetName(path) {
        return (!path || path === this.root) ? '' : path.replace(`${this.root}/`, '');
    }
    createDataset() {
        this.matDialog.open(create_dataset_dialog_component_1.CreateDatasetDialogComponent, {
            data: {
                parentId: this.parentDatasetName(Array.isArray(this.value) ? this.value[0] : this.value),
                dataset: this.createDatasetProps,
            },
        }).afterClosed()
            .pipe((0, until_destroy_1.untilDestroyed)(this))
            .subscribe((dataset) => {
            if (!dataset) {
                return;
            }
            const parentNode = this.tree.treeModel.selectedLeafNodes[0];
            parentNode === null || parentNode === void 0 ? void 0 : parentNode.expand();
            this.setInitialNode();
            this.writeValue(`${this.root}/${dataset.name}`);
            this.onChange(this.value);
            this.tree.treeModel.update();
        });
    }
    /**
     * Provides typing in templates
     */
    typeNode(node) {
        return node;
    }
    setInitialNode() {
        this.nodes = [
            {
                path: this.root,
                name: this.root,
                hasChildren: true,
                type: explorer_type_enum_1.ExplorerNodeType.Directory,
                isMountpoint: true,
            },
        ];
    }
    updateInputValue() {
        this.inputValue = Array.isArray(this.value) ? this.value.filter((value) => value.length).join(',') : this.value || '';
    }
    selectTreeNodes(nodeIds) {
        const treeState = Object.assign(Object.assign({}, this.tree.treeModel.getState()), { selectedLeafNodeIds: nodeIds.reduce((acc, nodeId) => (Object.assign(Object.assign({}, acc), { [nodeId]: true })), {}) });
        this.tree.treeModel.setState(treeState);
    }
    loadChildren(node) {
        this.loadingError = null;
        this.cdr.markForCheck();
        if (!this.nodeProvider) {
            return (0, rxjs_1.of)([]);
        }
        return this.nodeProvider(node).pipe((0, operators_1.catchError)((error) => {
            this.loadingError = 'reason' in error ? error.reason : error.message;
            this.cdr.markForCheck();
            return (0, rxjs_1.of)([]);
        }));
    }
};
exports.IxExplorerComponent = IxExplorerComponent;
IxExplorerComponent.ctorParameters = () => [
    { type: forms_1.NgControl },
    { type: core_1.ChangeDetectorRef },
    { type: dialog_1.MatDialog },
    { type: core_2.TranslateService }
];
IxExplorerComponent.propDecorators = {
    label: [{ type: core_1.Input }],
    hint: [{ type: core_1.Input }],
    multiple: [{ type: core_1.Input }],
    tooltip: [{ type: core_1.Input }],
    required: [{ type: core_1.Input }],
    root: [{ type: core_1.Input }],
    nodeProvider: [{ type: core_1.Input }],
    canCreateDataset: [{ type: core_1.Input }],
    createDatasetProps: [{ type: core_1.Input }],
    tree: [{ type: core_1.ViewChild, args: ['tree', { static: true },] }]
};
exports.IxExplorerComponent = IxExplorerComponent = __decorate([
    (0, until_destroy_1.UntilDestroy)(),
    (0, core_1.Component)({
        selector: 'ix-explorer',
        template: require("./ix-explorer.component.html"),
        changeDetection: core_1.ChangeDetectionStrategy.OnPush,
        standalone: true,
        imports: [
            ix_label_component_1.IxLabelComponent,
            input_1.MatInput,
            button_1.MatButton,
            ix_icon_component_1.IxIconComponent,
            angular_tree_component_1.TreeModule,
            form_field_1.MatError,
            ix_errors_component_1.IxErrorsComponent,
            form_field_1.MatHint,
            core_2.TranslateModule,
            requires_roles_directive_1.RequiresRolesDirective,
            test_directive_1.TestDirective,
            test_override_directive_1.TestOverrideDirective,
        ],
    })
], IxExplorerComponent);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL21hY2Jvb2sva2FycG92LXdvcmsvVHJ1ZU5BUy93ZWJ1aS9zcmMvYXBwL21vZHVsZXMvZm9ybXMvaXgtZm9ybXMvY29tcG9uZW50cy9peC1leHBsb3Jlci9peC1leHBsb3Jlci5jb21wb25lbnQudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUEsd0NBUXVCO0FBQ3ZCLDBDQUFpRTtBQUNqRSxxREFBcUQ7QUFDckQscURBQXFEO0FBQ3JELDZEQUFpRTtBQUNqRSxtREFBbUQ7QUFDbkQsNkVBRTBDO0FBQzFDLHlEQUFxRTtBQUNyRSw4Q0FBd0U7QUFDeEUsK0JBQXNEO0FBQ3RELDhDQUE0QztBQUM1QyxxR0FBZ0c7QUFDaEcscUVBQWdFO0FBQ2hFLDJEQUFrRDtBQUNsRCxtREFBMkM7QUFLM0MsNkdBQXdHO0FBQ3hHLDZKQUF1SjtBQUV2SiwwR0FBcUc7QUFDckcsNkVBQXdFO0FBQ3hFLHVHQUFrRztBQUNsRyx1RUFBbUU7QUF3QjVELElBQU0sbUJBQW1CLEdBQXpCLE1BQU0sbUJBQW1CO0lBMEI5QixJQUFJLHFCQUFxQjtRQUN2QixPQUFPLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsTUFBTTtlQUN4RixDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLGlCQUFpQixDQUFDLEtBQUssQ0FBQyxDQUFDLElBQWdDLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDO2VBQzFHLElBQUksQ0FBQyxVQUFVLENBQUM7SUFDdkIsQ0FBQztJQTBCRCxZQUNTLGdCQUEyQixFQUMxQixHQUFzQixFQUN0QixTQUFvQixFQUNwQixTQUEyQjtRQUg1QixxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQVc7UUFDMUIsUUFBRyxH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Q0FBQyxZQUFZLEdBQUcsUUFBUSxJQUFJLEtBQUssQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQztZQUNyRSxJQUFJLENBQUMsR0FBRyxDQUFDLFlBQVksRUFBRSxDQUFDO1lBQ3hCLE9BQU8sSUFBQSxTQUFFLEVBQUMsRUFBRSxDQUFDLENBQUM7UUFDaEIsQ0FBQyxDQUFDLENBQ0gsQ0FBQztJQUNKLENBQUM7O0FBL09VLGtEQUFtQjs7Ozs7Ozs7b0JBQzdCLFlBQUs7bUJBQ0wsWUFBSzt1QkFDTCxZQUFLO3NCQUNMLFlBQUs7dUJBQ0wsWUFBSzttQkFDTCxZQUFLOzJCQUNMLFlBQUs7K0JBQ0wsWUFBSztpQ0FDTCxZQUFLO21CQUVMLGdCQUFTLFNBQUMsTUFBTSxFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRTs7OEJBWHhCLG1CQUFtQjtJQXRCL0IsSUFBQSw0QkFBWSxHQUFFO0lBQ2QsSUFBQSxnQkFBUyxFQUFDO1FBQ1QsUUFBUSxFQUFFLGFBQWE7UUFDdkIsaURBQTJDO1FBRTNDLGVBQWUsRUFBRSw4QkFBdUIsQ0FBQyxNQUFNO1FBQy9DLFVBQVUsRUFBRSxJQUFJO1FBQ2hCLE9BQU8sRUFBRTtZQUNQLHFDQUFnQjtZQUNoQixnQkFBUTtZQUNSLGtCQUFTO1lBQ1QsbUNBQWU7WUFDZixtQ0FBVTtZQUNWLHFCQUFRO1lBQ1IsdUNBQWlCO1lBQ2pCLG9CQUFPO1lBQ1Asc0JBQWU7WUFDZixpREFBc0I7WUFDdEIsOEJBQWE7WUFDYiwrQ0FBcUI7U0FDdEI7S0FDRixDQUFDO0dBQ1csbUJBQW1CLENBZ1AvQiIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvbWFjYm9vay9rYXJwb3Ytd29yay9UcnVlTkFTL3dlYnVpL3NyYy9hcHAvbW9kdWxlcy9mb3Jtcy9peC1mb3Jtcy9jb21wb25lbnRzL2l4LWV4cGxvcmVyL2l4LWV4cGxvcmVyLmNvbXBvbmVudC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSxcbiAgQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gIENvbXBvbmVudCxcbiAgSW5wdXQsXG4gIE9uQ2hhbmdlcyxcbiAgT25Jbml0LFxuICBWaWV3Q2hpbGQsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQ29udHJvbFZhbHVlQWNjZXNzb3IsIE5nQ29udHJvbCB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IE1hdEJ1dHRvbiB9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsL2J1dHRvbic7XG5pbXBvcnQgeyBNYXREaWFsb2cgfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbC9kaWFsb2cnO1xuaW1wb3J0IHsgTWF0RXJyb3IsIE1hdEhpbnQgfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbC9mb3JtLWZpZWxkJztcbmltcG9ydCB7IE1hdElucHV0IH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwvaW5wdXQnO1xuaW1wb3J0IHtcbiAgSUFjdGlvbk1hcHBpbmcsIElUcmVlT3B0aW9ucywgS0VZUywgVFJFRV9BQ1RJT05TLCBUcmVlQ29tcG9uZW50LCBUcmVlTW9kdWxlLFxufSBmcm9tICdAYnVnc3BsYXQvYW5ndWxhci10cmVlLWNvbXBvbmVudCc7XG5pbXBvcnQgeyBVbnRpbERlc3Ryb3ksIHVudGlsRGVzdHJveWVkIH0gZnJvbSAnQG5nbmVhdC91bnRpbC1kZXN0cm95JztcbmltcG9ydCB7IFRyYW5zbGF0ZVNlcnZpY2UsIFRyYW5zbGF0ZU1vZHVsZSB9IGZyb20gJ0BuZ3gtdHJhbnNsYXRlL2NvcmUnO1xuaW1wb3J0IHsgZmlyc3RWYWx1ZUZyb20sIE9ic2VydmFibGUsIG9mIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBjYXRjaEVycm9yIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgUmVxdWlyZXNSb2xlc0RpcmVjdGl2ZSB9IGZyb20gJ2FwcC9kaXJlY3RpdmVzL3JlcXVpcmVzLXJvbGVzL3JlcXVpcmVzLXJvbGVzLmRpcmVjdGl2ZSc7XG5pbXBvcnQgeyBFeHBsb3Jlck5vZGVUeXBlIH0gZnJvbSAnYXBwL2VudW1zL2V4cGxvcmVyLXR5cGUuZW51bSc7XG5pbXBvcnQgeyBtbnRQYXRoIH0gZnJvbSAnYXBwL2VudW1zL21udC1wYXRoLmVudW0nO1xuaW1wb3J0IHsgUm9sZSB9IGZyb20gJ2FwcC9lbnVtcy9yb2xlLmVudW0nO1xuaW1wb3J0IHsgRGF0YXNldCwgRGF0YXNldENyZWF0ZSB9IGZyb20gJ2FwcC9pbnRlcmZhY2VzL2RhdGFzZXQuaW50ZXJmYWNlJztcbmltcG9ydCB7IEl4U2ltcGxlQ2hhbmdlcyB9IGZyb20gJ2FwcC9pbnRlcmZhY2VzL3NpbXBsZS1jaGFuZ2VzLmludGVyZmFjZSc7XG5pbXBvcnQgeyBFeHBsb3Jlck5vZGVEYXRhLCBUcmVlTm9kZSB9IGZyb20gJ2FwcC9pbnRlcmZhY2VzL3RyZWUtbm9kZS5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgV2ViU29ja2V0RXJyb3IgfSBmcm9tICdhcHAvaW50ZXJmYWNlcy93ZWJzb2NrZXQtZXJyb3IuaW50ZXJmYWNlJztcbmltcG9ydCB7IEl4RXJyb3JzQ29tcG9uZW50IH0gZnJvbSAnYXBwL21vZHVsZXMvZm9ybXMvaXgtZm9ybXMvY29tcG9uZW50cy9peC1lcnJvcnMvaXgtZXJyb3JzLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBDcmVhdGVEYXRhc2V0RGlhbG9nQ29tcG9uZW50IH0gZnJvbSAnYXBwL21vZHVsZXMvZm9ybXMvaXgtZm9ybXMvY29tcG9uZW50cy9peC1leHBsb3Jlci9jcmVhdGUtZGF0YXNldC1kaWFsb2cvY3JlYXRlLWRhdGFzZXQtZGlhbG9nLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBUcmVlTm9kZVByb3ZpZGVyIH0gZnJvbSAnYXBwL21vZHVsZXMvZm9ybXMvaXgtZm9ybXMvY29tcG9uZW50cy9peC1leHBsb3Jlci90cmVlLW5vZGUtcHJvdmlkZXIuaW50ZXJmYWNlJztcbmltcG9ydCB7IEl4TGFiZWxDb21wb25lbnQgfSBmcm9tICdhcHAvbW9kdWxlcy9mb3Jtcy9peC1mb3Jtcy9jb21wb25lbnRzL2l4LWxhYmVsL2l4LWxhYmVsLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBJeEljb25Db21wb25lbnQgfSBmcm9tICdhcHAvbW9kdWxlcy9peC1pY29uL2l4LWljb24uY29tcG9uZW50JztcbmltcG9ydCB7IFRlc3RPdmVycmlkZURpcmVjdGl2ZSB9IGZyb20gJ2FwcC9tb2R1bGVzL3Rlc3QtaWQvdGVzdC1vdmVycmlkZS90ZXN0LW92ZXJyaWRlLmRpcmVjdGl2ZSc7XG5pbXBvcnQgeyBUZXN0RGlyZWN0aXZlIH0gZnJvbSAnYXBwL21vZHVsZXMvdGVzdC1pZC90ZXN0LmRpcmVjdGl2ZSc7XG5cbkBVbnRpbERlc3Ryb3koKVxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnaXgtZXhwbG9yZXInLFxuICB0ZW1wbGF0ZVVybDogJy4vaXgtZXhwbG9yZXIuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9peC1leHBsb3Jlci5jb21wb25lbnQuc2NzcyddLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcbiAgc3RhbmRhbG9uZTogdHJ1ZSxcbiAgaW1wb3J0czogW1xuICAgIEl4TGFiZWxDb21wb25lbnQsXG4gICAgTWF0SW5wdXQsXG4gICAgTWF0QnV0dG9uLFxuICAgIEl4SWNvbkNvbXBvbmVudCxcbiAgICBUcmVlTW9kdWxlLFxuICAgIE1hdEVycm9yLFxuICAgIEl4RXJyb3JzQ29tcG9uZW50LFxuICAgIE1hdEhpbnQsXG4gICAgVHJhbnNsYXRlTW9kdWxlLFxuICAgIFJlcXVpcmVzUm9sZXNEaXJlY3RpdmUsXG4gICAgVGVzdERpcmVjdGl2ZSxcbiAgICBUZXN0T3ZlcnJpZGVEaXJlY3RpdmUsXG4gIF0sXG59KVxuZXhwb3J0IGNsYXNzIEl4RXhwbG9yZXJDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcywgQ29udHJvbFZhbHVlQWNjZXNzb3Ige1xuICBASW5wdXQoKSBsYWJlbDogc3RyaW5nO1xuICBASW5wdXQoKSBoaW50OiBzdHJpbmc7XG4gIEBJbnB1dCgpIG11bHRpcGxlID0gZmFsc2U7XG4gIEBJbnB1dCgpIHRvb2x0aXA6IHN0cmluZztcbiAgQElucHV0KCkgcmVxdWlyZWQ6IGJvb2xlYW47XG4gIEBJbnB1dCgpIHJvb3QgPSBtbnRQYXRoO1xuICBASW5wdXQoKSBub2RlUHJvdmlkZXI6IFRyZWVOb2RlUHJvdmlkZXI7XG4gIEBJbnB1dCgpIGNhbkNyZWF0ZURhdGFzZXQgPSBmYWxzZTtcbiAgQElucHV0KCkgY3JlYXRlRGF0YXNldFByb3BzOiBPbWl0PERhdGFzZXRDcmVhdGUsICduYW1lJz4gPSB7fTtcblxuICBAVmlld0NoaWxkKCd0cmVlJywgeyBzdGF0aWM6IHRydWUgfSkgdHJlZTogVHJlZUNvbXBvbmVudDtcblxuICByZWFkb25seSByZXF1aXJlZFJvbGVzID0gW1JvbGUuRGF0YXNldFdyaXRlXTtcblxuICBpbnB1dFZhbHVlID0gJyc7XG4gIHZhbHVlOiBzdHJpbmcgfCBzdHJpbmdbXTtcbiAgaXNEaXNhYmxlZCA9IGZhbHNlO1xuICBub2RlczogRXhwbG9yZXJOb2RlRGF0YVtdID0gW107XG4gIGxvYWRpbmdFcnJvcjogc3RyaW5nO1xuXG4gIG9uQ2hhbmdlOiAodmFsdWU6IHN0cmluZyB8IHN0cmluZ1tdKSA9PiB2b2lkID0gKCk6IHZvaWQgPT4ge307XG4gIG9uVG91Y2g6ICgpID0+IHZvaWQgPSAoKTogdm9pZCA9PiB7fTtcblxuICByZWFkb25seSBFeHBsb3Jlck5vZGVUeXBlID0gRXhwbG9yZXJOb2RlVHlwZTtcblxuICBnZXQgY3JlYXRlRGF0YXNldERpc2FibGVkKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiAhdGhpcy5wYXJlbnREYXRhc2V0TmFtZShBcnJheS5pc0FycmF5KHRoaXMudmFsdWUpID8gdGhpcy52YWx1ZVswXSA6IHRoaXMudmFsdWUpLmxlbmd0aFxuICAgICAgfHwgIXRoaXMudHJlZS50cmVlTW9kZWwuc2VsZWN0ZWRMZWFmTm9kZXMuZXZlcnkoKG5vZGU6IFRyZWVOb2RlPEV4cGxvcmVyTm9kZURhdGE+KSA9PiBub2RlLmRhdGEuaXNNb3VudHBvaW50KVxuICAgICAgfHwgdGhpcy5pc0Rpc2FibGVkO1xuICB9XG5cbiAgcHJpdmF0ZSByZWFkb25seSBhY3Rpb25NYXBwaW5nOiBJQWN0aW9uTWFwcGluZyA9IHtcbiAgICBtb3VzZToge1xuICAgICAgZGJsQ2xpY2s6ICh0cmVlLCBub2RlLCAkZXZlbnQpID0+IHtcbiAgICAgICAgVFJFRV9BQ1RJT05TLlRPR0dMRV9FWFBBTkRFRCh0cmVlLCBub2RlLCAkZXZlbnQpO1xuICAgICAgfSxcbiAgICAgIGNsaWNrOiAodHJlZSwgbm9kZSwgJGV2ZW50KSA9PiB7XG4gICAgICAgIFRSRUVfQUNUSU9OUy5UT0dHTEVfU0VMRUNURUQodHJlZSwgbm9kZSwgJGV2ZW50KTtcbiAgICAgIH0sXG4gICAgfSxcbiAgICBrZXlzOiB7XG4gICAgICBbS0VZUy5FTlRFUl06ICh0cmVlLCBub2RlLCAkZXZlbnQpID0+IHtcbiAgICAgICAgVFJFRV9BQ1RJT05TLlRPR0dMRV9TRUxFQ1RFRCh0cmVlLCBub2RlLCAkZXZlbnQpO1xuICAgICAgfSxcbiAgICB9LFxuICB9O1xuXG4gIHRyZWVPcHRpb25zOiBJVHJlZU9wdGlvbnMgPSB7XG4gICAgaWRGaWVsZDogJ3BhdGgnLFxuICAgIGRpc3BsYXlGaWVsZDogJ25hbWUnLFxuICAgIGdldENoaWxkcmVuOiAobm9kZTogVHJlZU5vZGU8RXhwbG9yZXJOb2RlRGF0YT4pID0+IGZpcnN0VmFsdWVGcm9tKHRoaXMubG9hZENoaWxkcmVuKG5vZGUpKSxcbiAgICBhY3Rpb25NYXBwaW5nOiB0aGlzLmFjdGlvbk1hcHBpbmcsXG4gICAgdXNlVHJpU3RhdGU6IGZhbHNlLFxuICB9O1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHB1YmxpYyBjb250cm9sRGlyZWN0aXZlOiBOZ0NvbnRyb2wsXG4gICAgcHJpdmF0ZSBjZHI6IENoYW5nZURldGVjdG9yUmVmLFxuICAgIHByaXZhdGUgbWF0RGlhbG9nOiBNYXREaWFsb2csXG4gICAgcHJpdmF0ZSB0cmFuc2xhdGU6IFRyYW5zbGF0ZVNlcnZpY2UsXG4gICkge1xuICAgIHRoaXMuY29udHJvbERpcmVjdGl2ZS52YWx1ZUFjY2Vzc29yID0gdGhpcztcbiAgfVxuXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IEl4U2ltcGxlQ2hhbmdlczx0aGlzPik6IHZvaWQge1xuICAgIGlmICgnbXVsdGlwbGUnIGluIGNoYW5nZXMpIHtcbiAgICAgIHRoaXMudHJlZU9wdGlvbnMudXNlQ2hlY2tib3ggPSB0aGlzLm11bHRpcGxlO1xuICAgIH1cblxuICAgIGlmICgnbm9kZVByb3ZpZGVyJyBpbiBjaGFuZ2VzIHx8ICdyb290JyBpbiBjaGFuZ2VzKSB7XG4gICAgICB0aGlzLnNldEluaXRpYWxOb2RlKCk7XG4gICAgICB0aGlzLmNkci5tYXJrRm9yQ2hlY2soKTtcbiAgICB9XG4gIH1cblxuICBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICB0aGlzLnNldEluaXRpYWxOb2RlKCk7XG4gIH1cblxuICB3cml0ZVZhbHVlKHZhbHVlOiBzdHJpbmcgfCBzdHJpbmdbXSk6IHZvaWQge1xuICAgIHRoaXMudmFsdWUgPSB2YWx1ZTtcbiAgICB0aGlzLnVwZGF0ZUlucHV0VmFsdWUoKTtcbiAgICB0aGlzLnNlbGVjdFRyZWVOb2RlcyhBcnJheS5pc0FycmF5KHZhbHVlKSA/IHZhbHVlIDogW3ZhbHVlXSk7XG4gICAgdGhpcy5jZHIubWFya0ZvckNoZWNrKCk7XG4gIH1cblxuICByZWdpc3Rlck9uQ2hhbmdlKG9uQ2hhbmdlOiAodmFsdWU6IHN0cmluZyB8IHN0cmluZ1tdKSA9PiB2b2lkKTogdm9pZCB7XG4gICAgdGhpcy5vbkNoYW5nZSA9IG9uQ2hhbmdlO1xuICB9XG5cbiAgcmVnaXN0ZXJPblRvdWNoZWQob25Ub3VjaGVkOiAoKSA9PiB2b2lkKTogdm9pZCB7XG4gICAgdGhpcy5vblRvdWNoID0gb25Ub3VjaGVkO1xuICB9XG5cbiAgc2V0RGlzYWJsZWRTdGF0ZT8oaXNEaXNhYmxlZDogYm9vbGVhbik6IHZvaWQge1xuICAgIHRoaXMuaXNEaXNhYmxlZCA9IGlzRGlzYWJsZWQ7XG4gICAgdGhpcy5jZHIubWFya0ZvckNoZWNrKCk7XG4gIH1cblxuICBvbk5vZGVTZWxlY3QoZXZlbnQ6IHsgbm9kZTogVHJlZU5vZGU8RXhwbG9yZXJOb2RlRGF0YT4gfSk6IHZvaWQge1xuICAgIGlmICh0aGlzLm11bHRpcGxlKSB7XG4gICAgICB0aGlzLnNlbGVjdFRyZWVOb2RlcyhbXG4gICAgICAgIC4uLk9iamVjdC5rZXlzKHRoaXMudHJlZS50cmVlTW9kZWwuc2VsZWN0ZWRMZWFmTm9kZUlkcyksXG4gICAgICAgIGV2ZW50Lm5vZGUuaWQgYXMgc3RyaW5nLFxuICAgICAgXSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuc2VsZWN0VHJlZU5vZGVzKFtldmVudC5ub2RlLmlkIGFzIHN0cmluZ10pO1xuICAgIH1cblxuICAgIHRoaXMub25TZWxlY3Rpb25DaGFuZ2VkKCk7XG4gIH1cblxuICBvbk5vZGVEZXNlbGVjdChldmVudDogeyBub2RlOiBUcmVlTm9kZTxFeHBsb3Jlck5vZGVEYXRhPiB9KTogdm9pZCB7XG4gICAgaWYgKHRoaXMubXVsdGlwbGUpIHtcbiAgICAgIHRoaXMuc2VsZWN0VHJlZU5vZGVzKFxuICAgICAgICBPYmplY3Qua2V5cyh0aGlzLnRyZWUudHJlZU1vZGVsLnNlbGVjdGVkTGVhZk5vZGVJZHMpLmZpbHRlcigobm9kZSkgPT4gbm9kZSAhPT0gZXZlbnQubm9kZS5pZCksXG4gICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnNlbGVjdFRyZWVOb2RlcyhbXSk7XG4gICAgfVxuXG4gICAgdGhpcy5vblNlbGVjdGlvbkNoYW5nZWQoKTtcbiAgfVxuXG4gIGFyaWFMYWJlbChub2RlOiBUcmVlTm9kZTxFeHBsb3Jlck5vZGVEYXRhPik6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMudHJhbnNsYXRlLmluc3RhbnQoXG4gICAgICAnSGlnaGxpZ2h0ZWQgcGF0aCBpcyB7bm9kZX0uIFByZXNzIFxcJ1NwYWNlXFwnIHRvIHtleHBhbmR9LiBQcmVzcyBcXCdFbnRlclxcJyB0byB7c2VsZWN0fS4nLFxuICAgICAge1xuICAgICAgICBleHBhbmQ6IG5vZGU/LmlzRXhwYW5kZWQgPyAnQ29sbGFwc2UnIDogJ0V4cGFuZCcsXG4gICAgICAgIHNlbGVjdDogbm9kZT8uaXNTZWxlY3RlZCA/ICdVbnNlbGVjdCcgOiAnU2VsZWN0JyxcbiAgICAgICAgbm9kZTogbm9kZS5kYXRhLnBhdGgucmVwbGFjZSgvLnsxfS9nLCAnJCYsJykucmVwbGFjZSgvXFwvL2csICdzbGFzaCcpLFxuICAgICAgfSxcbiAgICApO1xuICB9XG5cbiAgb25TZWxlY3Rpb25DaGFuZ2VkKCk6IHZvaWQge1xuICAgIGxldCBuZXdWYWx1ZTogc3RyaW5nW10gfCBzdHJpbmcgPSBPYmplY3QuZW50cmllcyh0aGlzLnRyZWUudHJlZU1vZGVsLnNlbGVjdGVkTGVhZk5vZGVJZHMpXG4gICAgICAuZmlsdGVyKChbLCBpc1NlbGVjdGVkXSkgPT4gaXNTZWxlY3RlZClcbiAgICAgIC5tYXAoKFtub2RlSWRdKSA9PiBub2RlSWQpO1xuXG4gICAgaWYgKCF0aGlzLm11bHRpcGxlKSB7XG4gICAgICBuZXdWYWx1ZSA9IG5ld1ZhbHVlWzBdO1xuICAgIH1cblxuICAgIGlmIChuZXdWYWx1ZSA9PT0gdGhpcy52YWx1ZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMudmFsdWUgPSBuZXdWYWx1ZTtcbiAgICB0aGlzLnVwZGF0ZUlucHV0VmFsdWUoKTtcbiAgICB0aGlzLm9uQ2hhbmdlKG5ld1ZhbHVlKTtcbiAgfVxuXG4gIG9uSW5wdXRDaGFuZ2VkKGlucHV0VmFsdWU6IHN0cmluZyk6IHZvaWQge1xuICAgIHRoaXMuaW5wdXRWYWx1ZSA9IGlucHV0VmFsdWU7XG4gICAgdGhpcy52YWx1ZSA9IHRoaXMubXVsdGlwbGUgPyBpbnB1dFZhbHVlLnNwbGl0KCcsJykgOiBpbnB1dFZhbHVlO1xuICAgIHRoaXMuc2VsZWN0VHJlZU5vZGVzKEFycmF5LmlzQXJyYXkodGhpcy52YWx1ZSkgPyB0aGlzLnZhbHVlIDogW3RoaXMudmFsdWVdKTtcbiAgICB0aGlzLm9uQ2hhbmdlKHRoaXMudmFsdWUpO1xuICB9XG5cbiAgaXNQYXRoU2VsZWN0ZWQocGF0aDogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHR5cGVvZiB0aGlzLnZhbHVlID09PSAnc3RyaW5nJyA/IHRoaXMudmFsdWUgPT09IHBhdGggOiB0aGlzLnZhbHVlPy5zb21lKChjb250ZW50OiBzdHJpbmcpID0+IGNvbnRlbnQgPT09IHBhdGgpO1xuICB9XG5cbiAgcGFyZW50RGF0YXNldE5hbWUocGF0aDogc3RyaW5nKTogc3RyaW5nIHtcbiAgICByZXR1cm4gKCFwYXRoIHx8IHBhdGggPT09IHRoaXMucm9vdCkgPyAnJyA6IHBhdGgucmVwbGFjZShgJHt0aGlzLnJvb3R9L2AsICcnKTtcbiAgfVxuXG4gIGNyZWF0ZURhdGFzZXQoKTogdm9pZCB7XG4gICAgdGhpcy5tYXREaWFsb2cub3BlbihDcmVhdGVEYXRhc2V0RGlhbG9nQ29tcG9uZW50LCB7XG4gICAgICBkYXRhOiB7XG4gICAgICAgIHBhcmVudElkOiB0aGlzLnBhcmVudERhdGFzZXROYW1lKEFycmF5LmlzQXJyYXkodGhpcy52YWx1ZSkgPyB0aGlzLnZhbHVlWzBdIDogdGhpcy52YWx1ZSksXG4gICAgICAgIGRhdGFzZXQ6IHRoaXMuY3JlYXRlRGF0YXNldFByb3BzLFxuICAgICAgfSxcbiAgICB9KS5hZnRlckNsb3NlZCgpXG4gICAgICAucGlwZSh1bnRpbERlc3Ryb3llZCh0aGlzKSlcbiAgICAgIC5zdWJzY3JpYmUoKGRhdGFzZXQ6IERhdGFzZXQpID0+IHtcbiAgICAgICAgaWYgKCFkYXRhc2V0KSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgcGFyZW50Tm9kZSA9IHRoaXMudHJlZS50cmVlTW9kZWwuc2VsZWN0ZWRMZWFmTm9kZXNbMF0gYXMgVHJlZU5vZGU8RXhwbG9yZXJOb2RlRGF0YT47XG4gICAgICAgIHBhcmVudE5vZGU/LmV4cGFuZCgpO1xuXG4gICAgICAgIHRoaXMuc2V0SW5pdGlhbE5vZGUoKTtcbiAgICAgICAgdGhpcy53cml0ZVZhbHVlKGAke3RoaXMucm9vdH0vJHtkYXRhc2V0Lm5hbWV9YCk7XG4gICAgICAgIHRoaXMub25DaGFuZ2UodGhpcy52YWx1ZSk7XG4gICAgICAgIHRoaXMudHJlZS50cmVlTW9kZWwudXBkYXRlKCk7XG4gICAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQcm92aWRlcyB0eXBpbmcgaW4gdGVtcGxhdGVzXG4gICAqL1xuICB0eXBlTm9kZShub2RlOiBUcmVlTm9kZTxFeHBsb3Jlck5vZGVEYXRhPik6IFRyZWVOb2RlPEV4cGxvcmVyTm9kZURhdGE+IHtcbiAgICByZXR1cm4gbm9kZTtcbiAgfVxuXG4gIHByaXZhdGUgc2V0SW5pdGlhbE5vZGUoKTogdm9pZCB7XG4gICAgdGhpcy5ub2RlcyA9IFtcbiAgICAgIHtcbiAgICAgICAgcGF0aDogdGhpcy5yb290LFxuICAgICAgICBuYW1lOiB0aGlzLnJvb3QsXG4gICAgICAgIGhhc0NoaWxkcmVuOiB0cnVlLFxuICAgICAgICB0eXBlOiBFeHBsb3Jlck5vZGVUeXBlLkRpcmVjdG9yeSxcbiAgICAgICAgaXNNb3VudHBvaW50OiB0cnVlLFxuICAgICAgfSxcbiAgICBdO1xuICB9XG5cbiAgcHJpdmF0ZSB1cGRhdGVJbnB1dFZhbHVlKCk6IHZvaWQge1xuICAgIHRoaXMuaW5wdXRWYWx1ZSA9IEFycmF5LmlzQXJyYXkodGhpcy52YWx1ZSkgPyB0aGlzLnZhbHVlLmZpbHRlcigodmFsdWUpID0+IHZhbHVlLmxlbmd0aCkuam9pbignLCcpIDogdGhpcy52YWx1ZSB8fCAnJztcbiAgfVxuXG4gIHByaXZhdGUgc2VsZWN0VHJlZU5vZGVzKG5vZGVJZHM6IHN0cmluZ1tdKTogdm9pZCB7XG4gICAgY29uc3QgdHJlZVN0YXRlID0ge1xuICAgICAgLi4udGhpcy50cmVlLnRyZWVNb2RlbC5nZXRTdGF0ZSgpLFxuICAgICAgc2VsZWN0ZWRMZWFmTm9kZUlkczogbm9kZUlkcy5yZWR1Y2UoKGFjYywgbm9kZUlkKSA9PiAoeyAuLi5hY2MsIFtub2RlSWRdOiB0cnVlIH0pLCB7fSksXG4gICAgfTtcblxuICAgIHRoaXMudHJlZS50cmVlTW9kZWwuc2V0U3RhdGUodHJlZVN0YXRlKTtcbiAgfVxuXG4gIHByaXZhdGUgbG9hZENoaWxkcmVuKG5vZGU6IFRyZWVOb2RlPEV4cGxvcmVyTm9kZURhdGE+KTogT2JzZXJ2YWJsZTxFeHBsb3Jlck5vZGVEYXRhW10+IHtcbiAgICB0aGlzLmxvYWRpbmdFcnJvciA9IG51bGw7XG4gICAgdGhpcy5jZHIubWFya0ZvckNoZWNrKCk7XG5cbiAgICBpZiAoIXRoaXMubm9kZVByb3ZpZGVyKSB7XG4gICAgICByZXR1cm4gb2YoW10pO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLm5vZGVQcm92aWRlcihub2RlKS5waXBlKFxuICAgICAgY2F0Y2hFcnJvcigoZXJyb3I6IFdlYlNvY2tldEVycm9yIHwgRXJyb3IpID0+IHtcbiAgICAgICAgdGhpcy5sb2FkaW5nRXJyb3IgPSAncmVhc29uJyBpbiBlcnJvciA/IGVycm9yLnJlYXNvbiA6IGVycm9yLm1lc3NhZ2U7XG4gICAgICAgIHRoaXMuY2RyLm1hcmtGb3JDaGVjaygpO1xuICAgICAgICByZXR1cm4gb2YoW10pO1xuICAgICAgfSksXG4gICAgKTtcbiAgfVxufVxuIl0sInZlcnNpb24iOjN9