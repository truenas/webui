{"file":"/Users/macbook/karpov-work/TrueNAS/webui/src/app/modules/feedback/components/file-ticket-licensed/file-ticket-licensed.component.ts","mappings":"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","names":[],"sources":["/Users/macbook/karpov-work/TrueNAS/webui/src/app/modules/feedback/components/file-ticket-licensed/file-ticket-licensed.component.ts"],"sourcesContent":["import { CdkScrollable } from '@angular/cdk/scrolling';\nimport {\n  ChangeDetectionStrategy,\n  Component, Inject, Input, output,\n} from '@angular/core';\nimport {\n  AbstractControl, FormBuilder, Validators, ReactiveFormsModule,\n} from '@angular/forms';\nimport { MatButton } from '@angular/material/button';\nimport { MatDialogRef, MatDialogContent, MatDialogActions } from '@angular/material/dialog';\nimport { Router } from '@angular/router';\nimport { UntilDestroy, untilDestroyed } from '@ngneat/until-destroy';\nimport { TranslateService, TranslateModule } from '@ngx-translate/core';\nimport * as EmailValidator from 'email-validator';\nimport { finalize, of } from 'rxjs';\nimport { MiB } from 'app/constants/bytes.constant';\nimport {\n  ticketAcceptedFiles,\n  TicketCategory, ticketCategoryLabels,\n  TicketCriticality, ticketCriticalityLabels,\n  TicketEnvironment, ticketEnvironmentLabels,\n} from 'app/enums/file-ticket.enum';\nimport { mapToOptions } from 'app/helpers/options.helper';\nimport { WINDOW } from 'app/helpers/window.helper';\nimport { helptextSystemSupport as helptext } from 'app/helptext/system/support';\nimport { FeedbackDialogComponent } from 'app/modules/feedback/components/feedback-dialog/feedback-dialog.component';\nimport { FeedbackService } from 'app/modules/feedback/services/feedback.service';\nimport { FormActionsComponent } from 'app/modules/forms/ix-forms/components/form-actions/form-actions.component';\nimport { IxCheckboxComponent } from 'app/modules/forms/ix-forms/components/ix-checkbox/ix-checkbox.component';\nimport { IxChipsComponent } from 'app/modules/forms/ix-forms/components/ix-chips/ix-chips.component';\nimport { IxFileInputComponent } from 'app/modules/forms/ix-forms/components/ix-file-input/ix-file-input.component';\nimport { IxInputComponent } from 'app/modules/forms/ix-forms/components/ix-input/ix-input.component';\nimport { IxSelectComponent } from 'app/modules/forms/ix-forms/components/ix-select/ix-select.component';\nimport { IxTextareaComponent } from 'app/modules/forms/ix-forms/components/ix-textarea/ix-textarea.component';\nimport { FormErrorHandlerService } from 'app/modules/forms/ix-forms/services/form-error-handler.service';\nimport { IxValidatorsService } from 'app/modules/forms/ix-forms/services/ix-validators.service';\nimport { emailValidator } from 'app/modules/forms/ix-forms/validators/email-validation/email-validation';\nimport { ImageValidatorService } from 'app/modules/forms/ix-forms/validators/image-validator/image-validator.service';\nimport { TestDirective } from 'app/modules/test-id/test.directive';\nimport { WebSocketService } from 'app/services/ws.service';\n\n@UntilDestroy()\n@Component({\n  selector: 'ix-file-ticket-licensed',\n  styleUrls: ['file-ticket-licensed.component.scss'],\n  templateUrl: './file-ticket-licensed.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    CdkScrollable,\n    MatDialogContent,\n    ReactiveFormsModule,\n    IxInputComponent,\n    IxChipsComponent,\n    IxSelectComponent,\n    IxTextareaComponent,\n    IxCheckboxComponent,\n    IxFileInputComponent,\n    MatDialogActions,\n    FormActionsComponent,\n    MatButton,\n    TestDirective,\n    TranslateModule,\n  ],\n})\nexport class FileTicketLicensedComponent {\n  @Input() dialogRef: MatDialogRef<FeedbackDialogComponent>;\n  @Input() isLoading: boolean;\n\n  readonly isLoadingChange = output<boolean>();\n\n  protected form = this.formBuilder.group({\n    name: ['', [Validators.required]],\n    email: ['', [Validators.required, emailValidator()]],\n    cc: [[] as string[], [\n      this.validatorsService.customValidator(\n        (control: AbstractControl<string[]>) => {\n          return control.value?.every((item: string) => EmailValidator.validate(item));\n        },\n        this.translate.instant(helptext.cc.err),\n      ),\n    ]],\n    phone: ['', [Validators.required]],\n    category: [TicketCategory.Bug, [Validators.required]],\n    environment: [TicketEnvironment.Production, [Validators.required]],\n    criticality: [TicketCriticality.Inquiry, [Validators.required]],\n    title: ['', [Validators.required, Validators.maxLength(200)]],\n\n    message: ['', [Validators.maxLength(20000)]],\n    images: [[] as File[], []],\n    attach_debug: [true],\n    attach_images: [false],\n    take_screenshot: [true],\n  });\n\n  protected readonly messagePlaceholder = helptext.bug.message.placeholder;\n  protected readonly acceptedFiles = ticketAcceptedFiles;\n\n  readonly categoryOptions$ = of(mapToOptions(ticketCategoryLabels, this.translate));\n  readonly environmentOptions$ = of(mapToOptions(ticketEnvironmentLabels, this.translate));\n  readonly criticalityOptions$ = of(mapToOptions(ticketCriticalityLabels, this.translate));\n\n  readonly tooltips = {\n    name: helptext.name.tooltip,\n    email: helptext.email.tooltip,\n    cc: helptext.cc.tooltip,\n    phone: helptext.phone.tooltip,\n    category: helptext.type.tooltip,\n    environment: helptext.environment.tooltip,\n    criticality: helptext.criticality.tooltip,\n    title: helptext.title.tooltip,\n    attach_debug: helptext.attach_debug.tooltip,\n  };\n\n  constructor(\n    private formBuilder: FormBuilder,\n    private translate: TranslateService,\n    private validatorsService: IxValidatorsService,\n    private feedbackService: FeedbackService,\n    private router: Router,\n    private imageValidator: ImageValidatorService,\n    private formErrorHandler: FormErrorHandlerService,\n    @Inject(WINDOW) private window: Window,\n    private ws: WebSocketService,\n  ) {\n    this.getSystemFileSizeLimit();\n  }\n\n  onUserGuidePressed(): void {\n    this.window.open('https://www.truenas.com/docs/hub/');\n  }\n\n  onEulaPressed(): void {\n    this.router.navigate(['system', 'support', 'eula']).then(() => {\n      this.dialogRef.close();\n    });\n  }\n\n  onSubmit(): void {\n    this.isLoadingChange.emit(true);\n\n    this.feedbackService.createTicketLicensed(this.form.value).pipe(\n      finalize(() => this.isLoadingChange.emit(false)),\n      untilDestroyed(this),\n    ).subscribe({\n      next: (createdTicket) => this.onSuccess(createdTicket.url),\n      error: (error) => this.formErrorHandler.handleWsFormError(error, this.form),\n    });\n  }\n\n  private onSuccess(ticketUrl: string): void {\n    this.feedbackService.showTicketSuccessMsg(ticketUrl);\n    this.dialogRef.close();\n  }\n\n  private getSystemFileSizeLimit(): void {\n    this.ws.call('support.attach_ticket_max_size').pipe(untilDestroyed(this)).subscribe((size) => {\n      this.form.controls.images.addAsyncValidators(\n        this.imageValidator.getImagesValidator(size * MiB),\n      );\n      this.form.controls.images.updateValueAndValidity();\n    });\n  }\n}\n"],"version":3}