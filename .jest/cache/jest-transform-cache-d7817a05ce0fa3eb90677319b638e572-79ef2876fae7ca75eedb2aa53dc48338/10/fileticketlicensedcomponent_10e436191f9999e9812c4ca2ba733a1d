a1539f15f6ee3910edeebbc122cde375
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.FileTicketLicensedComponent = void 0;
const scrolling_1 = require("@angular/cdk/scrolling");
const core_1 = require("@angular/core");
const forms_1 = require("@angular/forms");
const button_1 = require("@angular/material/button");
const dialog_1 = require("@angular/material/dialog");
const router_1 = require("@angular/router");
const until_destroy_1 = require("@ngneat/until-destroy");
const core_2 = require("@ngx-translate/core");
const EmailValidator = __importStar(require("email-validator"));
const rxjs_1 = require("rxjs");
const bytes_constant_1 = require("app/constants/bytes.constant");
const file_ticket_enum_1 = require("app/enums/file-ticket.enum");
const options_helper_1 = require("app/helpers/options.helper");
const window_helper_1 = require("app/helpers/window.helper");
const support_1 = require("app/helptext/system/support");
const feedback_service_1 = require("app/modules/feedback/services/feedback.service");
const form_actions_component_1 = require("app/modules/forms/ix-forms/components/form-actions/form-actions.component");
const ix_checkbox_component_1 = require("app/modules/forms/ix-forms/components/ix-checkbox/ix-checkbox.component");
const ix_chips_component_1 = require("app/modules/forms/ix-forms/components/ix-chips/ix-chips.component");
const ix_file_input_component_1 = require("app/modules/forms/ix-forms/components/ix-file-input/ix-file-input.component");
const ix_input_component_1 = require("app/modules/forms/ix-forms/components/ix-input/ix-input.component");
const ix_select_component_1 = require("app/modules/forms/ix-forms/components/ix-select/ix-select.component");
const ix_textarea_component_1 = require("app/modules/forms/ix-forms/components/ix-textarea/ix-textarea.component");
const form_error_handler_service_1 = require("app/modules/forms/ix-forms/services/form-error-handler.service");
const ix_validators_service_1 = require("app/modules/forms/ix-forms/services/ix-validators.service");
const email_validation_1 = require("app/modules/forms/ix-forms/validators/email-validation/email-validation");
const image_validator_service_1 = require("app/modules/forms/ix-forms/validators/image-validator/image-validator.service");
const test_directive_1 = require("app/modules/test-id/test.directive");
const ws_service_1 = require("app/services/ws.service");
const i0 = __importStar(require("@angular/core"));
let FileTicketLicensedComponent = class FileTicketLicensedComponent {
    constructor(formBuilder, translate, validatorsService, feedbackService, router, imageValidator, formErrorHandler, window, ws) {
        this.formBuilder = formBuilder;
        this.translate = translate;
        this.validatorsService = validatorsService;
        this.feedbackService = feedbackService;
        this.router = router;
        this.imageValidator = imageValidator;
        this.formErrorHandler = formErrorHandler;
        this.window = window;
        this.ws = ws;
        this.isLoadingChange = (0, core_1.output)();
        this.form = this.formBuilder.group({
            name: ['', [forms_1.Validators.required]],
            email: ['', [forms_1.Validators.required, (0, email_validation_1.emailValidator)()]],
            cc: [[], [
                    this.validatorsService.customValidator((control) => {
                        var _a;
                        return (_a = control.value) === null || _a === void 0 ? void 0 : _a.every((item) => EmailValidator.validate(item));
                    }, this.translate.instant(support_1.helptextSystemSupport.cc.err)),
                ]],
            phone: ['', [forms_1.Validators.required]],
            category: [file_ticket_enum_1.TicketCategory.Bug, [forms_1.Validators.required]],
            environment: [file_ticket_enum_1.TicketEnvironment.Production, [forms_1.Validators.required]],
            criticality: [file_ticket_enum_1.TicketCriticality.Inquiry, [forms_1.Validators.required]],
            title: ['', [forms_1.Validators.required, forms_1.Validators.maxLength(200)]],
            message: ['', [forms_1.Validators.maxLength(20000)]],
            images: [[], []],
            attach_debug: [true],
            attach_images: [false],
            take_screenshot: [true],
        });
        this.messagePlaceholder = support_1.helptextSystemSupport.bug.message.placeholder;
        this.acceptedFiles = file_ticket_enum_1.ticketAcceptedFiles;
        this.categoryOptions$ = (0, rxjs_1.of)((0, options_helper_1.mapToOptions)(file_ticket_enum_1.ticketCategoryLabels, this.translate));
        this.environmentOptions$ = (0, rxjs_1.of)((0, options_helper_1.mapToOptions)(file_ticket_enum_1.ticketEnvironmentLabels, this.translate));
        this.criticalityOptions$ = (0, rxjs_1.of)((0, options_helper_1.mapToOptions)(file_ticket_enum_1.ticketCriticalityLabels, this.translate));
        this.tooltips = {
            name: support_1.helptextSystemSupport.name.tooltip,
            email: support_1.helptextSystemSupport.email.tooltip,
            cc: support_1.helptextSystemSupport.cc.tooltip,
            phone: support_1.helptextSystemSupport.phone.tooltip,
            category: support_1.helptextSystemSupport.type.tooltip,
            environment: support_1.helptextSystemSupport.environment.tooltip,
            criticality: support_1.helptextSystemSupport.criticality.tooltip,
            title: support_1.helptextSystemSupport.title.tooltip,
            attach_debug: support_1.helptextSystemSupport.attach_debug.tooltip,
        };
        this.getSystemFileSizeLimit();
    }
    onUserGuidePressed() {
        this.window.open('https://www.truenas.com/docs/hub/');
    }
    onEulaPressed() {
        this.router.navigate(['system', 'support', 'eula']).then(() => {
            this.dialogRef.close();
        });
    }
    onSubmit() {
        this.isLoadingChange.emit(true);
        this.feedbackService.createTicketLicensed(this.form.value).pipe((0, rxjs_1.finalize)(() => this.isLoadingChange.emit(false)), (0, until_destroy_1.untilDestroyed)(this)).subscribe({
            next: (createdTicket) => this.onSuccess(createdTicket.url),
            error: (error) => this.formErrorHandler.handleWsFormError(error, this.form),
        });
    }
    onSuccess(ticketUrl) {
        this.feedbackService.showTicketSuccessMsg(ticketUrl);
        this.dialogRef.close();
    }
    getSystemFileSizeLimit() {
        this.ws.call('support.attach_ticket_max_size').pipe((0, until_destroy_1.untilDestroyed)(this)).subscribe((size) => {
            this.form.controls.images.addAsyncValidators(this.imageValidator.getImagesValidator(size * bytes_constant_1.MiB));
            this.form.controls.images.updateValueAndValidity();
        });
    }
};
exports.FileTicketLicensedComponent = FileTicketLicensedComponent;
FileTicketLicensedComponent.ctorParameters = () => [
    { type: forms_1.FormBuilder },
    { type: core_2.TranslateService },
    { type: ix_validators_service_1.IxValidatorsService },
    { type: feedback_service_1.FeedbackService },
    { type: router_1.Router },
    { type: image_validator_service_1.ImageValidatorService },
    { type: form_error_handler_service_1.FormErrorHandlerService },
    { type: Window, decorators: [{ type: core_1.Inject, args: [window_helper_1.WINDOW,] }] },
    { type: ws_service_1.WebSocketService }
];
FileTicketLicensedComponent.propDecorators = {
    dialogRef: [{ type: core_1.Input }],
    isLoading: [{ type: core_1.Input }],
    isLoadingChange: [{ type: i0.Output, args: ["isLoadingChange",] }]
};
exports.FileTicketLicensedComponent = FileTicketLicensedComponent = __decorate([
    (0, until_destroy_1.UntilDestroy)(),
    (0, core_1.Component)({
        selector: 'ix-file-ticket-licensed',
        template: require("./file-ticket-licensed.component.html"),
        changeDetection: core_1.ChangeDetectionStrategy.OnPush,
        standalone: true,
        imports: [
            scrolling_1.CdkScrollable,
            dialog_1.MatDialogContent,
            forms_1.ReactiveFormsModule,
            ix_input_component_1.IxInputComponent,
            ix_chips_component_1.IxChipsComponent,
            ix_select_component_1.IxSelectComponent,
            ix_textarea_component_1.IxTextareaComponent,
            ix_checkbox_component_1.IxCheckboxComponent,
            ix_file_input_component_1.IxFileInputComponent,
            dialog_1.MatDialogActions,
            form_actions_component_1.FormActionsComponent,
            button_1.MatButton,
            test_directive_1.TestDirective,
            core_2.TranslateModule,
        ],
    })
], FileTicketLicensedComponent);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL21hY2Jvb2sva2FycG92LXdvcmsvVHJ1ZU5BUy93ZWJ1aS9zcmMvYXBwL21vZHVsZXMvZmVlZGJhY2svY29tcG9uZW50cy9maWxlLXRpY2tldC1saWNlbnNlZC9maWxlLXRpY2tldC1saWNlbnNlZC5jb21wb25lbnQudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxzREFBdUQ7QUFDdkQsd0NBR3VCO0FBQ3ZCLDBDQUV3QjtBQUN4QixxREFBcUQ7QUFDckQscURBQTRGO0FBQzVGLDRDQUF5QztBQUN6Qyx5REFBcUU7QUFDckUsOENBQXdFO0FBQ3hFLGdFQUFrRDtBQUNsRCwrQkFBb0M7QUFDcEMsaUVBQW1EO0FBQ25ELGlFQUtvQztBQUNwQywrREFBMEQ7QUFDMUQsNkRBQW1EO0FBQ25ELHlEQUFnRjtBQUVoRixxRkFBaUY7QUFDakYsc0hBQWlIO0FBQ2pILG1IQUE4RztBQUM5RywwR0FBcUc7QUFDckcseUhBQW1IO0FBQ25ILDBHQUFxRztBQUNyRyw2R0FBd0c7QUFDeEcsbUhBQThHO0FBQzlHLCtHQUF5RztBQUN6RyxxR0FBZ0c7QUFDaEcsOEdBQXlHO0FBQ3pHLDJIQUFzSDtBQUN0SCx1RUFBbUU7QUFDbkUsd0RBQTJEOztBQTBCcEQsSUFBTSwyQkFBMkIsR0FBakMsTUFBTSwyQkFBMkI7SUFpRHRDLFlBQ1UsV0FBd0IsRUFDeEIsU0FBMkIsRUFDM0IsaUJBQXNDLEVBQ3RDLGVBQWdDLEVBQ2hDLE1BQWMsRUFDZCxjQUFxQyxFQUNyQyxnQkFBeUMsRUFDekIsTUFBYyxFQUM5QixFQUFvQjtRQVJwQixnQkFBVyxHQUFYLFdBQVcsQ0FBYTtRQUN4QixjQUFTLEdBQVQsU0FBUyxDQUFrQjtRQUMzQixzQkFBaUIsR0FBakIsaUJBQWlCLENBQXFCO1FBQ3RDLG9CQUFlLEdBQWYsZUFBZSxDQUFpQjtRQUNoQyxXQUFNLEdBQU4sTUFBTSxDQUFRO1FBQ2QsbUJBQWMsR0FBZCxjQUFjLENBQXVCO1FBQ3JDLHFCQUFnQixHQUFoQixn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Q0FBb0I7WUFDcEIsa0JBQVM7WUFDVCw4QkFBYTtZQUNiLHNCQUFlO1NBQ2hCO0tBQ0YsQ0FBQztHQUNXLDJCQUEyQixDQWtHdkMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL21hY2Jvb2sva2FycG92LXdvcmsvVHJ1ZU5BUy93ZWJ1aS9zcmMvYXBwL21vZHVsZXMvZmVlZGJhY2svY29tcG9uZW50cy9maWxlLXRpY2tldC1saWNlbnNlZC9maWxlLXRpY2tldC1saWNlbnNlZC5jb21wb25lbnQudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ2RrU2Nyb2xsYWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9zY3JvbGxpbmcnO1xuaW1wb3J0IHtcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXG4gIENvbXBvbmVudCwgSW5qZWN0LCBJbnB1dCwgb3V0cHV0LFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7XG4gIEFic3RyYWN0Q29udHJvbCwgRm9ybUJ1aWxkZXIsIFZhbGlkYXRvcnMsIFJlYWN0aXZlRm9ybXNNb2R1bGUsXG59IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IE1hdEJ1dHRvbiB9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsL2J1dHRvbic7XG5pbXBvcnQgeyBNYXREaWFsb2dSZWYsIE1hdERpYWxvZ0NvbnRlbnQsIE1hdERpYWxvZ0FjdGlvbnMgfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbC9kaWFsb2cnO1xuaW1wb3J0IHsgUm91dGVyIH0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyJztcbmltcG9ydCB7IFVudGlsRGVzdHJveSwgdW50aWxEZXN0cm95ZWQgfSBmcm9tICdAbmduZWF0L3VudGlsLWRlc3Ryb3knO1xuaW1wb3J0IHsgVHJhbnNsYXRlU2VydmljZSwgVHJhbnNsYXRlTW9kdWxlIH0gZnJvbSAnQG5neC10cmFuc2xhdGUvY29yZSc7XG5pbXBvcnQgKiBhcyBFbWFpbFZhbGlkYXRvciBmcm9tICdlbWFpbC12YWxpZGF0b3InO1xuaW1wb3J0IHsgZmluYWxpemUsIG9mIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBNaUIgfSBmcm9tICdhcHAvY29uc3RhbnRzL2J5dGVzLmNvbnN0YW50JztcbmltcG9ydCB7XG4gIHRpY2tldEFjY2VwdGVkRmlsZXMsXG4gIFRpY2tldENhdGVnb3J5LCB0aWNrZXRDYXRlZ29yeUxhYmVscyxcbiAgVGlja2V0Q3JpdGljYWxpdHksIHRpY2tldENyaXRpY2FsaXR5TGFiZWxzLFxuICBUaWNrZXRFbnZpcm9ubWVudCwgdGlja2V0RW52aXJvbm1lbnRMYWJlbHMsXG59IGZyb20gJ2FwcC9lbnVtcy9maWxlLXRpY2tldC5lbnVtJztcbmltcG9ydCB7IG1hcFRvT3B0aW9ucyB9IGZyb20gJ2FwcC9oZWxwZXJzL29wdGlvbnMuaGVscGVyJztcbmltcG9ydCB7IFdJTkRPVyB9IGZyb20gJ2FwcC9oZWxwZXJzL3dpbmRvdy5oZWxwZXInO1xuaW1wb3J0IHsgaGVscHRleHRTeXN0ZW1TdXBwb3J0IGFzIGhlbHB0ZXh0IH0gZnJvbSAnYXBwL2hlbHB0ZXh0L3N5c3RlbS9zdXBwb3J0JztcbmltcG9ydCB7IEZlZWRiYWNrRGlhbG9nQ29tcG9uZW50IH0gZnJvbSAnYXBwL21vZHVsZXMvZmVlZGJhY2svY29tcG9uZW50cy9mZWVkYmFjay1kaWFsb2cvZmVlZGJhY2stZGlhbG9nLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBGZWVkYmFja1NlcnZpY2UgfSBmcm9tICdhcHAvbW9kdWxlcy9mZWVkYmFjay9zZXJ2aWNlcy9mZWVkYmFjay5zZXJ2aWNlJztcbmltcG9ydCB7IEZvcm1BY3Rpb25zQ29tcG9uZW50IH0gZnJvbSAnYXBwL21vZHVsZXMvZm9ybXMvaXgtZm9ybXMvY29tcG9uZW50cy9mb3JtLWFjdGlvbnMvZm9ybS1hY3Rpb25zLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBJeENoZWNrYm94Q29tcG9uZW50IH0gZnJvbSAnYXBwL21vZHVsZXMvZm9ybXMvaXgtZm9ybXMvY29tcG9uZW50cy9peC1jaGVja2JveC9peC1jaGVja2JveC5jb21wb25lbnQnO1xuaW1wb3J0IHsgSXhDaGlwc0NvbXBvbmVudCB9IGZyb20gJ2FwcC9tb2R1bGVzL2Zvcm1zL2l4LWZvcm1zL2NvbXBvbmVudHMvaXgtY2hpcHMvaXgtY2hpcHMuY29tcG9uZW50JztcbmltcG9ydCB7IEl4RmlsZUlucHV0Q29tcG9uZW50IH0gZnJvbSAnYXBwL21vZHVsZXMvZm9ybXMvaXgtZm9ybXMvY29tcG9uZW50cy9peC1maWxlLWlucHV0L2l4LWZpbGUtaW5wdXQuY29tcG9uZW50JztcbmltcG9ydCB7IEl4SW5wdXRDb21wb25lbnQgfSBmcm9tICdhcHAvbW9kdWxlcy9mb3Jtcy9peC1mb3Jtcy9jb21wb25lbnRzL2l4LWlucHV0L2l4LWlucHV0LmNvbXBvbmVudCc7XG5pbXBvcnQgeyBJeFNlbGVjdENvbXBvbmVudCB9IGZyb20gJ2FwcC9tb2R1bGVzL2Zvcm1zL2l4LWZvcm1zL2NvbXBvbmVudHMvaXgtc2VsZWN0L2l4LXNlbGVjdC5jb21wb25lbnQnO1xuaW1wb3J0IHsgSXhUZXh0YXJlYUNvbXBvbmVudCB9IGZyb20gJ2FwcC9tb2R1bGVzL2Zvcm1zL2l4LWZvcm1zL2NvbXBvbmVudHMvaXgtdGV4dGFyZWEvaXgtdGV4dGFyZWEuY29tcG9uZW50JztcbmltcG9ydCB7IEZvcm1FcnJvckhhbmRsZXJTZXJ2aWNlIH0gZnJvbSAnYXBwL21vZHVsZXMvZm9ybXMvaXgtZm9ybXMvc2VydmljZXMvZm9ybS1lcnJvci1oYW5kbGVyLnNlcnZpY2UnO1xuaW1wb3J0IHsgSXhWYWxpZGF0b3JzU2VydmljZSB9IGZyb20gJ2FwcC9tb2R1bGVzL2Zvcm1zL2l4LWZvcm1zL3NlcnZpY2VzL2l4LXZhbGlkYXRvcnMuc2VydmljZSc7XG5pbXBvcnQgeyBlbWFpbFZhbGlkYXRvciB9IGZyb20gJ2FwcC9tb2R1bGVzL2Zvcm1zL2l4LWZvcm1zL3ZhbGlkYXRvcnMvZW1haWwtdmFsaWRhdGlvbi9lbWFpbC12YWxpZGF0aW9uJztcbmltcG9ydCB7IEltYWdlVmFsaWRhdG9yU2VydmljZSB9IGZyb20gJ2FwcC9tb2R1bGVzL2Zvcm1zL2l4LWZvcm1zL3ZhbGlkYXRvcnMvaW1hZ2UtdmFsaWRhdG9yL2ltYWdlLXZhbGlkYXRvci5zZXJ2aWNlJztcbmltcG9ydCB7IFRlc3REaXJlY3RpdmUgfSBmcm9tICdhcHAvbW9kdWxlcy90ZXN0LWlkL3Rlc3QuZGlyZWN0aXZlJztcbmltcG9ydCB7IFdlYlNvY2tldFNlcnZpY2UgfSBmcm9tICdhcHAvc2VydmljZXMvd3Muc2VydmljZSc7XG5cbkBVbnRpbERlc3Ryb3koKVxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnaXgtZmlsZS10aWNrZXQtbGljZW5zZWQnLFxuICBzdHlsZVVybHM6IFsnZmlsZS10aWNrZXQtbGljZW5zZWQuY29tcG9uZW50LnNjc3MnXSxcbiAgdGVtcGxhdGVVcmw6ICcuL2ZpbGUtdGlja2V0LWxpY2Vuc2VkLmNvbXBvbmVudC5odG1sJyxcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXG4gIHN0YW5kYWxvbmU6IHRydWUsXG4gIGltcG9ydHM6IFtcbiAgICBDZGtTY3JvbGxhYmxlLFxuICAgIE1hdERpYWxvZ0NvbnRlbnQsXG4gICAgUmVhY3RpdmVGb3Jtc01vZHVsZSxcbiAgICBJeElucHV0Q29tcG9uZW50LFxuICAgIEl4Q2hpcHNDb21wb25lbnQsXG4gICAgSXhTZWxlY3RDb21wb25lbnQsXG4gICAgSXhUZXh0YXJlYUNvbXBvbmVudCxcbiAgICBJeENoZWNrYm94Q29tcG9uZW50LFxuICAgIEl4RmlsZUlucHV0Q29tcG9uZW50LFxuICAgIE1hdERpYWxvZ0FjdGlvbnMsXG4gICAgRm9ybUFjdGlvbnNDb21wb25lbnQsXG4gICAgTWF0QnV0dG9uLFxuICAgIFRlc3REaXJlY3RpdmUsXG4gICAgVHJhbnNsYXRlTW9kdWxlLFxuICBdLFxufSlcbmV4cG9ydCBjbGFzcyBGaWxlVGlja2V0TGljZW5zZWRDb21wb25lbnQge1xuICBASW5wdXQoKSBkaWFsb2dSZWY6IE1hdERpYWxvZ1JlZjxGZWVkYmFja0RpYWxvZ0NvbXBvbmVudD47XG4gIEBJbnB1dCgpIGlzTG9hZGluZzogYm9vbGVhbjtcblxuICByZWFkb25seSBpc0xvYWRpbmdDaGFuZ2UgPSBvdXRwdXQ8Ym9vbGVhbj4oKTtcblxuICBwcm90ZWN0ZWQgZm9ybSA9IHRoaXMuZm9ybUJ1aWxkZXIuZ3JvdXAoe1xuICAgIG5hbWU6IFsnJywgW1ZhbGlkYXRvcnMucmVxdWlyZWRdXSxcbiAgICBlbWFpbDogWycnLCBbVmFsaWRhdG9ycy5yZXF1aXJlZCwgZW1haWxWYWxpZGF0b3IoKV1dLFxuICAgIGNjOiBbW10gYXMgc3RyaW5nW10sIFtcbiAgICAgIHRoaXMudmFsaWRhdG9yc1NlcnZpY2UuY3VzdG9tVmFsaWRhdG9yKFxuICAgICAgICAoY29udHJvbDogQWJzdHJhY3RDb250cm9sPHN0cmluZ1tdPikgPT4ge1xuICAgICAgICAgIHJldHVybiBjb250cm9sLnZhbHVlPy5ldmVyeSgoaXRlbTogc3RyaW5nKSA9PiBFbWFpbFZhbGlkYXRvci52YWxpZGF0ZShpdGVtKSk7XG4gICAgICAgIH0sXG4gICAgICAgIHRoaXMudHJhbnNsYXRlLmluc3RhbnQoaGVscHRleHQuY2MuZXJyKSxcbiAgICAgICksXG4gICAgXV0sXG4gICAgcGhvbmU6IFsnJywgW1ZhbGlkYXRvcnMucmVxdWlyZWRdXSxcbiAgICBjYXRlZ29yeTogW1RpY2tldENhdGVnb3J5LkJ1ZywgW1ZhbGlkYXRvcnMucmVxdWlyZWRdXSxcbiAgICBlbnZpcm9ubWVudDogW1RpY2tldEVudmlyb25tZW50LlByb2R1Y3Rpb24sIFtWYWxpZGF0b3JzLnJlcXVpcmVkXV0sXG4gICAgY3JpdGljYWxpdHk6IFtUaWNrZXRDcml0aWNhbGl0eS5JbnF1aXJ5LCBbVmFsaWRhdG9ycy5yZXF1aXJlZF1dLFxuICAgIHRpdGxlOiBbJycsIFtWYWxpZGF0b3JzLnJlcXVpcmVkLCBWYWxpZGF0b3JzLm1heExlbmd0aCgyMDApXV0sXG5cbiAgICBtZXNzYWdlOiBbJycsIFtWYWxpZGF0b3JzLm1heExlbmd0aCgyMDAwMCldXSxcbiAgICBpbWFnZXM6IFtbXSBhcyBGaWxlW10sIFtdXSxcbiAgICBhdHRhY2hfZGVidWc6IFt0cnVlXSxcbiAgICBhdHRhY2hfaW1hZ2VzOiBbZmFsc2VdLFxuICAgIHRha2Vfc2NyZWVuc2hvdDogW3RydWVdLFxuICB9KTtcblxuICBwcm90ZWN0ZWQgcmVhZG9ubHkgbWVzc2FnZVBsYWNlaG9sZGVyID0gaGVscHRleHQuYnVnLm1lc3NhZ2UucGxhY2Vob2xkZXI7XG4gIHByb3RlY3RlZCByZWFkb25seSBhY2NlcHRlZEZpbGVzID0gdGlja2V0QWNjZXB0ZWRGaWxlcztcblxuICByZWFkb25seSBjYXRlZ29yeU9wdGlvbnMkID0gb2YobWFwVG9PcHRpb25zKHRpY2tldENhdGVnb3J5TGFiZWxzLCB0aGlzLnRyYW5zbGF0ZSkpO1xuICByZWFkb25seSBlbnZpcm9ubWVudE9wdGlvbnMkID0gb2YobWFwVG9PcHRpb25zKHRpY2tldEVudmlyb25tZW50TGFiZWxzLCB0aGlzLnRyYW5zbGF0ZSkpO1xuICByZWFkb25seSBjcml0aWNhbGl0eU9wdGlvbnMkID0gb2YobWFwVG9PcHRpb25zKHRpY2tldENyaXRpY2FsaXR5TGFiZWxzLCB0aGlzLnRyYW5zbGF0ZSkpO1xuXG4gIHJlYWRvbmx5IHRvb2x0aXBzID0ge1xuICAgIG5hbWU6IGhlbHB0ZXh0Lm5hbWUudG9vbHRpcCxcbiAgICBlbWFpbDogaGVscHRleHQuZW1haWwudG9vbHRpcCxcbiAgICBjYzogaGVscHRleHQuY2MudG9vbHRpcCxcbiAgICBwaG9uZTogaGVscHRleHQucGhvbmUudG9vbHRpcCxcbiAgICBjYXRlZ29yeTogaGVscHRleHQudHlwZS50b29sdGlwLFxuICAgIGVudmlyb25tZW50OiBoZWxwdGV4dC5lbnZpcm9ubWVudC50b29sdGlwLFxuICAgIGNyaXRpY2FsaXR5OiBoZWxwdGV4dC5jcml0aWNhbGl0eS50b29sdGlwLFxuICAgIHRpdGxlOiBoZWxwdGV4dC50aXRsZS50b29sdGlwLFxuICAgIGF0dGFjaF9kZWJ1ZzogaGVscHRleHQuYXR0YWNoX2RlYnVnLnRvb2x0aXAsXG4gIH07XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBmb3JtQnVpbGRlcjogRm9ybUJ1aWxkZXIsXG4gICAgcHJpdmF0ZSB0cmFuc2xhdGU6IFRyYW5zbGF0ZVNlcnZpY2UsXG4gICAgcHJpdmF0ZSB2YWxpZGF0b3JzU2VydmljZTogSXhWYWxpZGF0b3JzU2VydmljZSxcbiAgICBwcml2YXRlIGZlZWRiYWNrU2VydmljZTogRmVlZGJhY2tTZXJ2aWNlLFxuICAgIHByaXZhdGUgcm91dGVyOiBSb3V0ZXIsXG4gICAgcHJpdmF0ZSBpbWFnZVZhbGlkYXRvcjogSW1hZ2VWYWxpZGF0b3JTZXJ2aWNlLFxuICAgIHByaXZhdGUgZm9ybUVycm9ySGFuZGxlcjogRm9ybUVycm9ySGFuZGxlclNlcnZpY2UsXG4gICAgQEluamVjdChXSU5ET1cpIHByaXZhdGUgd2luZG93OiBXaW5kb3csXG4gICAgcHJpdmF0ZSB3czogV2ViU29ja2V0U2VydmljZSxcbiAgKSB7XG4gICAgdGhpcy5nZXRTeXN0ZW1GaWxlU2l6ZUxpbWl0KCk7XG4gIH1cblxuICBvblVzZXJHdWlkZVByZXNzZWQoKTogdm9pZCB7XG4gICAgdGhpcy53aW5kb3cub3BlbignaHR0cHM6Ly93d3cudHJ1ZW5hcy5jb20vZG9jcy9odWIvJyk7XG4gIH1cblxuICBvbkV1bGFQcmVzc2VkKCk6IHZvaWQge1xuICAgIHRoaXMucm91dGVyLm5hdmlnYXRlKFsnc3lzdGVtJywgJ3N1cHBvcnQnLCAnZXVsYSddKS50aGVuKCgpID0+IHtcbiAgICAgIHRoaXMuZGlhbG9nUmVmLmNsb3NlKCk7XG4gICAgfSk7XG4gIH1cblxuICBvblN1Ym1pdCgpOiB2b2lkIHtcbiAgICB0aGlzLmlzTG9hZGluZ0NoYW5nZS5lbWl0KHRydWUpO1xuXG4gICAgdGhpcy5mZWVkYmFja1NlcnZpY2UuY3JlYXRlVGlja2V0TGljZW5zZWQodGhpcy5mb3JtLnZhbHVlKS5waXBlKFxuICAgICAgZmluYWxpemUoKCkgPT4gdGhpcy5pc0xvYWRpbmdDaGFuZ2UuZW1pdChmYWxzZSkpLFxuICAgICAgdW50aWxEZXN0cm95ZWQodGhpcyksXG4gICAgKS5zdWJzY3JpYmUoe1xuICAgICAgbmV4dDogKGNyZWF0ZWRUaWNrZXQpID0+IHRoaXMub25TdWNjZXNzKGNyZWF0ZWRUaWNrZXQudXJsKSxcbiAgICAgIGVycm9yOiAoZXJyb3IpID0+IHRoaXMuZm9ybUVycm9ySGFuZGxlci5oYW5kbGVXc0Zvcm1FcnJvcihlcnJvciwgdGhpcy5mb3JtKSxcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgb25TdWNjZXNzKHRpY2tldFVybDogc3RyaW5nKTogdm9pZCB7XG4gICAgdGhpcy5mZWVkYmFja1NlcnZpY2Uuc2hvd1RpY2tldFN1Y2Nlc3NNc2codGlja2V0VXJsKTtcbiAgICB0aGlzLmRpYWxvZ1JlZi5jbG9zZSgpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRTeXN0ZW1GaWxlU2l6ZUxpbWl0KCk6IHZvaWQge1xuICAgIHRoaXMud3MuY2FsbCgnc3VwcG9ydC5hdHRhY2hfdGlja2V0X21heF9zaXplJykucGlwZSh1bnRpbERlc3Ryb3llZCh0aGlzKSkuc3Vic2NyaWJlKChzaXplKSA9PiB7XG4gICAgICB0aGlzLmZvcm0uY29udHJvbHMuaW1hZ2VzLmFkZEFzeW5jVmFsaWRhdG9ycyhcbiAgICAgICAgdGhpcy5pbWFnZVZhbGlkYXRvci5nZXRJbWFnZXNWYWxpZGF0b3Ioc2l6ZSAqIE1pQiksXG4gICAgICApO1xuICAgICAgdGhpcy5mb3JtLmNvbnRyb2xzLmltYWdlcy51cGRhdGVWYWx1ZUFuZFZhbGlkaXR5KCk7XG4gICAgfSk7XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==