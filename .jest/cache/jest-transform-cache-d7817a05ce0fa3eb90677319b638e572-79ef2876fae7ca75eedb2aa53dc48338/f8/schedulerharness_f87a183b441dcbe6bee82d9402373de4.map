{"file":"/Users/macbook/karpov-work/TrueNAS/webui/src/app/modules/scheduler/components/scheduler/scheduler.harness.ts","mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,kDAA0E;AAC1E,8DAA0F;AAC1F,wDAA0C;AAC1C,sGAAiG;AAEjG,kFAA8E;AAC9E,sHAAiH;AAMjH,MAAa,gBAAiB,SAAQ,0BAAgB;IAAtD;;QAQE,qBAAgB,GAAG,IAAI,CAAC,UAAU,CAAC,0BAAgB,CAAC,CAAC;QACrD,iBAAY,GAAG,4BAAY,CAAC;IAwD9B,CAAC;IA9DC,MAAM,CAAC,IAAI,CAAC,OAAyB;QACnC,OAAO,IAAI,0BAAgB,CAAC,gBAAgB,EAAE,OAAO,CAAC;aACnD,SAAS,CAAC,OAAO,EAAE,OAAO,CAAC,KAAK,EAAE,CAAC,OAAO,EAAE,KAAK,EAAE,EAAE,CAAC,0BAAgB,CAAC,aAAa,CAAC,OAAO,CAAC,YAAY,EAAE,EAAE,KAAK,CAAC,CAAC,CAAC;IAC1H,CAAC;IAKK,YAAY;;YAChB,MAAM,KAAK,GAAG,MAAM,IAAI,CAAC,kBAAkB,CAAC,iCAAc,CAAC,EAAE,CAAC;YAC9D,IAAI,CAAC,KAAK,EAAE,CAAC;gBACX,OAAO,EAAE,CAAC;YACZ,CAAC;YACD,OAAO,KAAK,CAAC,QAAQ,EAAE,CAAC;QAC1B,CAAC;KAAA;IAEK,eAAe;;YACnB,MAAM,MAAM,GAAG,MAAM,IAAI,CAAC,gBAAgB,EAAE,CAAC;YAC7C,MAAM,MAAM,CAAC,IAAI,EAAE,CAAC;YACpB,MAAM,MAAM,CAAC,YAAY,CAAC,EAAE,IAAI,EAAE,QAAQ,EAAE,CAAC,CAAC;QAChD,CAAC;KAAA;IAEK,QAAQ;;YACZ,OAAO,CAAC,MAAM,IAAI,CAAC,gBAAgB,EAAE,CAAC,CAAC,YAAY,EAAE,CAAC;QACxD,CAAC;KAAA;IAEK,QAAQ,CAAC,OAAe;;YAC5B,MAAM,IAAI,CAAC,eAAe,EAAE,CAAC;YAE7B,MAAM,OAAO,GAAG,IAAI,CAAC,0BAA0B,EAAE,CAAC;YAClD,IAAI,CAAC;gBACH,MAAM,KAAK,GAAG,MAAM,OAAO,CAAC,UAAU,CAAC,+CAAqB,CAAC,EAAE,CAAC;gBAEhE,MAAM,KAAK,GAAG,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;gBACjC,MAAM,UAAU,GAAG,KAAK,CAAC,MAAM,KAAK,CAAC,CAAC;gBAEtC,IAAI,UAAU,EAAE,CAAC;oBACf,MAAM,KAAK,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;oBACjC,MAAM,KAAK,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;oBAC/B,MAAM,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;gBAChC,CAAC;qBAAM,CAAC;oBACN,MAAM,KAAK,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;oBAC/B,MAAM,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;gBAChC,CAAC;gBAED,MAAM,MAAM,GAAG,UAAU,CAAC,eAAe,CAAC,UAAU,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,KAAK,OAAO,EAAE,CAAC,CAAC;gBACjF,MAAM,KAAK,CAAC,SAAS,CAAC,MAAM,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;gBAC3C,MAAM,KAAK,CAAC,aAAa,CAAC,MAAM,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;gBACnD,MAAM,KAAK,CAAC,SAAS,EAAE,CAAC;YAC1B,CAAC;YAAC,OAAO,KAAc,EAAE,CAAC;gBACxB,IAAK,KAAe,CAAC,OAAO,CAAC,QAAQ,CAAC,wBAAwB,CAAC;uBACzD,KAAe,CAAC,OAAO,CAAC,QAAQ,CAAC,oBAAoB,CAAC,EAAE,CAAC;oBAC7D,MAAM,IAAI,KAAK,CAAC,4FAA4F,CAAC,CAAC;gBAChH,CAAC;gBAED,MAAM,KAAK,CAAC;YACd,CAAC;QACH,CAAC;KAAA;IAEK,UAAU;;YACd,OAAO,CAAC,MAAM,IAAI,CAAC,gBAAgB,EAAE,CAAC,CAAC,UAAU,EAAE,CAAC;QACtD,CAAC;KAAA;;AAhEH,4CAiEC;AAhEQ,6BAAY,GAAG,cAAc,AAAjB,CAAkB","names":[],"sources":["/Users/macbook/karpov-work/TrueNAS/webui/src/app/modules/scheduler/components/scheduler/scheduler.harness.ts"],"sourcesContent":["import { ComponentHarness, HarnessPredicate } from '@angular/cdk/testing';\nimport { MatSelectHarness, SelectHarnessFilters } from '@angular/material/select/testing';\nimport * as cronParser from 'cron-parser';\nimport { IxLabelHarness } from 'app/modules/forms/ix-forms/components/ix-label/ix-label.harness';\nimport { IxFormControlHarness } from 'app/modules/forms/ix-forms/interfaces/ix-form-control-harness.interface';\nimport { getErrorText } from 'app/modules/forms/ix-forms/utils/harness.utils';\nimport { SchedulerModalHarness } from 'app/modules/scheduler/components/scheduler-modal/scheduler-modal.harness';\n\nexport interface SchedulerFilters extends SelectHarnessFilters {\n  label?: string;\n}\n\nexport class SchedulerHarness extends ComponentHarness implements IxFormControlHarness {\n  static hostSelector = 'ix-scheduler';\n\n  static with(options: SchedulerFilters): HarnessPredicate<SchedulerHarness> {\n    return new HarnessPredicate(SchedulerHarness, options)\n      .addOption('label', options.label, (harness, label) => HarnessPredicate.stringMatches(harness.getLabelText(), label));\n  }\n\n  getSelectHarness = this.locatorFor(MatSelectHarness);\n  getErrorText = getErrorText;\n\n  async getLabelText(): Promise<string> {\n    const label = await this.locatorForOptional(IxLabelHarness)();\n    if (!label) {\n      return '';\n    }\n    return label.getLabel();\n  }\n\n  async openCustomModal(): Promise<void> {\n    const select = await this.getSelectHarness();\n    await select.open();\n    await select.clickOptions({ text: /Create/ });\n  }\n\n  async getValue(): Promise<string> {\n    return (await this.getSelectHarness()).getValueText();\n  }\n\n  async setValue(crontab: string): Promise<void> {\n    await this.openCustomModal();\n\n    const locator = this.documentRootLocatorFactory();\n    try {\n      const modal = await locator.locatorFor(SchedulerModalHarness)();\n\n      const parts = crontab.split(' ');\n      const hasMinutes = parts.length === 5;\n\n      if (hasMinutes) {\n        await modal.setMinutes(parts[0]);\n        await modal.setHours(parts[1]);\n        await modal.setDays(parts[2]);\n      } else {\n        await modal.setHours(parts[0]);\n        await modal.setDays(parts[1]);\n      }\n\n      const parsed = cronParser.parseExpression(hasMinutes ? crontab : `0 ${crontab}`);\n      await modal.setMonths(parsed.fields.month);\n      await modal.setDaysOfWeek(parsed.fields.dayOfWeek);\n      await modal.pressDone();\n    } catch (error: unknown) {\n      if ((error as Error).message.includes('Failed to find element')\n        && (error as Error).message.includes('ix-scheduler-modal')) {\n        throw new Error('Failed to find ix-scheduler-modal. This may happen if Store with timezone is not provided.');\n      }\n\n      throw error;\n    }\n  }\n\n  async isDisabled(): Promise<boolean> {\n    return (await this.getSelectHarness()).isDisabled();\n  }\n}\n"],"version":3}