000a705943122792bb561c01ffc1caf6
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.FileTicketComponent = void 0;
const scrolling_1 = require("@angular/cdk/scrolling");
const core_1 = require("@angular/core");
const forms_1 = require("@angular/forms");
const dialog_1 = require("@angular/material/dialog");
const until_destroy_1 = require("@ngneat/until-destroy");
const core_2 = require("@ngx-translate/core");
const rxjs_1 = require("rxjs");
const bytes_constant_1 = require("app/constants/bytes.constant");
const file_ticket_enum_1 = require("app/enums/file-ticket.enum");
const support_1 = require("app/helptext/system/support");
const oauth_button_interface_1 = require("app/modules/buttons/oauth-button/interfaces/oauth-button.interface");
const oauth_button_module_1 = require("app/modules/buttons/oauth-button/oauth-button.module");
const similar_issues_component_1 = require("app/modules/feedback/components/similar-issues/similar-issues.component");
const feedback_interface_1 = require("app/modules/feedback/interfaces/feedback.interface");
const feedback_service_1 = require("app/modules/feedback/services/feedback.service");
const form_actions_component_1 = require("app/modules/forms/ix-forms/components/form-actions/form-actions.component");
const ix_checkbox_component_1 = require("app/modules/forms/ix-forms/components/ix-checkbox/ix-checkbox.component");
const ix_file_input_component_1 = require("app/modules/forms/ix-forms/components/ix-file-input/ix-file-input.component");
const ix_input_component_1 = require("app/modules/forms/ix-forms/components/ix-input/ix-input.component");
const ix_textarea_component_1 = require("app/modules/forms/ix-forms/components/ix-textarea/ix-textarea.component");
const form_error_handler_service_1 = require("app/modules/forms/ix-forms/services/form-error-handler.service");
const image_validator_service_1 = require("app/modules/forms/ix-forms/validators/image-validator/image-validator.service");
const ws_service_1 = require("app/services/ws.service");
const i0 = __importStar(require("@angular/core"));
let FileTicketComponent = class FileTicketComponent {
    get ticketType() {
        return this.type === feedback_interface_1.FeedbackType.Bug ? file_ticket_enum_1.TicketType.Bug : file_ticket_enum_1.TicketType.Suggestion;
    }
    constructor(formBuilder, feedbackService, imageValidator, formErrorHandler, ws) {
        this.formBuilder = formBuilder;
        this.feedbackService = feedbackService;
        this.imageValidator = imageValidator;
        this.formErrorHandler = formErrorHandler;
        this.ws = ws;
        this.isLoadingChange = (0, core_1.output)();
        this.form = this.formBuilder.group({
            title: ['', [forms_1.Validators.maxLength(200)]],
            message: ['', [forms_1.Validators.maxLength(20000)]],
            images: [[], []],
            attach_debug: [true],
            attach_images: [false],
            take_screenshot: [true],
        });
        this.OauthButtonType = oauth_button_interface_1.OauthButtonType;
        this.oauthUrl = 'https://support-proxy.ixsystems.com/oauth/initiate?origin=';
        this.messagePlaceholder = support_1.helptextSystemSupport.bug.message.placeholder;
        this.acceptedFiles = file_ticket_enum_1.ticketAcceptedFiles;
        this.tooltips = {
            title: support_1.helptextSystemSupport.title.tooltip,
            attach_debug: support_1.helptextSystemSupport.attach_debug.tooltip,
        };
        this.getSystemFileSizeLimit();
    }
    onSubmit(token) {
        this.isLoadingChange.emit(true);
        this.feedbackService.createTicket(token, this.ticketType, this.form.value).pipe((0, rxjs_1.finalize)(() => this.isLoadingChange.emit(false)), (0, until_destroy_1.untilDestroyed)(this)).subscribe({
            next: (createdTicket) => this.onSuccess(createdTicket.url),
            error: (error) => this.formErrorHandler.handleWsFormError(error, this.form),
        });
    }
    onSuccess(ticketUrl) {
        this.feedbackService.showTicketSuccessMsg(ticketUrl);
        this.dialogRef.close();
    }
    getSystemFileSizeLimit() {
        this.ws.call('support.attach_ticket_max_size').pipe((0, until_destroy_1.untilDestroyed)(this)).subscribe((size) => {
            this.form.controls.images.addAsyncValidators(this.imageValidator.getImagesValidator(size * bytes_constant_1.MiB));
            this.form.controls.images.updateValueAndValidity();
        });
    }
};
exports.FileTicketComponent = FileTicketComponent;
FileTicketComponent.ctorParameters = () => [
    { type: forms_1.FormBuilder },
    { type: feedback_service_1.FeedbackService },
    { type: image_validator_service_1.ImageValidatorService },
    { type: form_error_handler_service_1.FormErrorHandlerService },
    { type: ws_service_1.WebSocketService }
];
FileTicketComponent.propDecorators = {
    type: [{ type: core_1.Input }],
    dialogRef: [{ type: core_1.Input }],
    isLoading: [{ type: core_1.Input }],
    isLoadingChange: [{ type: i0.Output, args: ["isLoadingChange",] }]
};
exports.FileTicketComponent = FileTicketComponent = __decorate([
    (0, until_destroy_1.UntilDestroy)(),
    (0, core_1.Component)({
        selector: 'ix-file-ticket',
        template: require("./file-ticket.component.html"),
        changeDetection: core_1.ChangeDetectionStrategy.OnPush,
        standalone: true,
        imports: [
            scrolling_1.CdkScrollable,
            dialog_1.MatDialogContent,
            forms_1.ReactiveFormsModule,
            ix_input_component_1.IxInputComponent,
            similar_issues_component_1.SimilarIssuesComponent,
            ix_textarea_component_1.IxTextareaComponent,
            ix_checkbox_component_1.IxCheckboxComponent,
            ix_file_input_component_1.IxFileInputComponent,
            dialog_1.MatDialogActions,
            form_actions_component_1.FormActionsComponent,
            oauth_button_module_1.OauthButtonModule,
            core_2.TranslateModule,
        ],
    })
], FileTicketComponent);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL21hY2Jvb2sva2FycG92LXdvcmsvVHJ1ZU5BUy93ZWJ1aS9zcmMvYXBwL21vZHVsZXMvZmVlZGJhY2svY29tcG9uZW50cy9maWxlLXRpY2tldC9maWxlLXRpY2tldC5jb21wb25lbnQudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxzREFBdUQ7QUFDdkQsd0NBR3VCO0FBQ3ZCLDBDQUE4RTtBQUM5RSxxREFBNEY7QUFDNUYseURBQXFFO0FBQ3JFLDhDQUFzRDtBQUN0RCwrQkFBZ0M7QUFDaEMsaUVBQW1EO0FBQ25ELGlFQUE2RTtBQUM3RSx5REFBZ0Y7QUFDaEYsK0dBQXFHO0FBQ3JHLDhGQUF5RjtBQUV6RixzSEFBaUg7QUFDakgsMkZBQWtGO0FBQ2xGLHFGQUFpRjtBQUNqRixzSEFBaUg7QUFDakgsbUhBQThHO0FBQzlHLHlIQUFtSDtBQUNuSCwwR0FBcUc7QUFDckcsbUhBQThHO0FBQzlHLCtHQUF5RztBQUN6RywySEFBc0g7QUFDdEgsd0RBQTJEOztBQXdCcEQsSUFBTSxtQkFBbUIsR0FBekIsTUFBTSxtQkFBbUI7SUEwQjlCLElBQVksVUFBVTtRQUNwQixPQUFPLElBQUksQ0FBQyxJQUFJLEtBQUssaUNBQVksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLDZCQUFVLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyw2QkFBVSxDQUFDLFVBQVUsQ0FBQztJQUNqRixDQUFDO0lBRUQsWUFDVSxXQUF3QixFQUN4QixlQUFnQyxFQUNoQyxjQUFxQyxFQUNyQyxnQkFBeUMsRUFDekMsRUFBb0I7UUFKcEIsZ0JBQVcsR0FBWCxXQUFXLENBQWE7UUFDeEIsb0JBQWUsR0FBZixlQUFlLENBQWlCO1FBQ2hDLG1CQUFjLEdBQWQsY0FBYyxDQUF1QjtRQUNyQyxxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQXlCO1FBQ3pDLE9BQUUsR0FBRixFQUFFLENBQWtCO1FBOUJyQixvQkFBZSxHQUFHLElBQUEsYUFBTSxHQUFXO1FBRWxDLFNBQUksR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQztZQUN0QyxLQUFLLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxrQkFBVSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQ3hDLE9BQU8sRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLGtCQUFVLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7WUFDNUMsTUFBTSxFQUFFLENBQUMsRUFBWSxFQUFFLEVBQUUsQ0FBQztZQUMxQixZQUFZLEVBQUUsQ0FBQyxJQUFJLENBQUM7WUFDcEIsYUFBYSxFQUFFLENBQUMsS0FBSyxDQUFDO1lBQ3RCLGVBQWUsRUFBRSxDQUFDLElBQUksQ0FBQztTQUN4QixDQUFDLENBQUM7UUFFTyxvQkFBZSxHQUFHLHdDQUFlLENBQUM7UUFDekIsYUFBUSxHQUFHLDREQUE0RCxDQUFDO1FBQ3hFLHVCQUFrQixHQUFHLCtCQUFRLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxXQUFXLENBQUM7UUFDdEQsa0JBQWEsR0FBRyxzQ0FBbUIsQ0FBQztRQUVwQyxhQUFRLEdBQUc7WUFDNUIsS0FBSyxFQUFFLCtCQUFRLENBQUMsS0FBSyxDQUFDLE9BQU87WUFDN0IsWUFBWSxFQUFFLCtCQUFRLENBQUMsWUFBWSxDQUFDLE9BQU87U0FDNUMsQ0FBQztRQWFBLElBQUksQ0FBQyxzQkFBc0IsRUFBRSxDQUFDO0lBQ2hDLENBQUM7SUFFRCxRQUFRLENBQUMsS0FBYztRQUNyQixJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUVoQyxJQUFJLENBQUMsZUFBZSxDQUFDLFlBQVksQ0FBQyxLQUFlLEVBQUUsSUFBSSxDQUFDLFVBQVUsRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLElBQUksQ0FDdkYsSUFBQSxlQUFRLEVBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsRUFDaEQsSUFBQSw4QkFBYyxFQUFDLElBQUksQ0FBQyxDQUNyQixDQUFDLFNBQVMsQ0FBQztZQUNWLElBQUksRUFBRSxDQUFDLGFBQWEsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFDO1lBQzFELEtBQUssRUFBRSxDQUFDLEtBQUssRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLGlCQUFpQixDQUFDLEtBQUssRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDO1NBQzVFLENBQUMsQ0FBQztJQUNMLENBQUM7SUFFTyxTQUFTLENBQUMsU0FBaUI7UUFDakMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxvQkFBb0IsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUNyRCxJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssRUFBRSxDQUFDO0lBQ3pCLENBQUM7SUFFTyxzQkFBc0I7UUFDNUIsSUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsZ0NBQWdDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBQSw4QkFBYyxFQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUU7WUFDM0YsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsa0JBQWtCLENBQUMsSUFBSSxHQUFHLG9CQUFHLENBQUMsQ0FBQyxDQUFDO1lBQ2pHLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FBQyxzQkFBc0IsRUFBRSxDQUFDO1FBQ3JELENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQzs7QUE5RFUsa0RBQW1COzs7Ozs7Ozs7bUJBQzdCLFlBQUs7d0JBQ0wsWUFBSzt3QkFDTCxZQUFLOzs7OEJBSEssbUJBQW1CO0lBdEIvQixJQUFBLDRCQUFZLEdBQUU7SUFDZCxJQUFBLGdCQUFTLEVBQUM7UUFDVCxRQUFRLEVBQUUsZ0JBQWdCO1FBRTFCLGlEQUEyQztRQUMzQyxlQUFlLEVBQUUsOEJBQXVCLENBQUMsTUFBTTtRQUMvQyxVQUFVLEVBQUUsSUFBSTtRQUNoQixPQUFPLEVBQUU7WUFDUCx5QkFBYTtZQUNiLHlCQUFnQjtZQUNoQiwyQkFBbUI7WUFDbkIscUNBQWdCO1lBQ2hCLGlEQUFzQjtZQUN0QiwyQ0FBbUI7WUFDbkIsMkNBQW1CO1lBQ25CLDhDQUFvQjtZQUNwQix5QkFBZ0I7WUFDaEIsNkNBQW9CO1lBQ3BCLHVDQUFpQjtZQUNqQixzQkFBZTtTQUNoQjtLQUNGLENBQUM7R0FDVyxtQkFBbUIsQ0ErRC9CIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9tYWNib29rL2thcnBvdi13b3JrL1RydWVOQVMvd2VidWkvc3JjL2FwcC9tb2R1bGVzL2ZlZWRiYWNrL2NvbXBvbmVudHMvZmlsZS10aWNrZXQvZmlsZS10aWNrZXQuY29tcG9uZW50LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENka1Njcm9sbGFibGUgfSBmcm9tICdAYW5ndWxhci9jZGsvc2Nyb2xsaW5nJztcbmltcG9ydCB7XG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICBDb21wb25lbnQsIElucHV0LCBvdXRwdXQsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgRm9ybUJ1aWxkZXIsIFZhbGlkYXRvcnMsIFJlYWN0aXZlRm9ybXNNb2R1bGUgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBNYXREaWFsb2dSZWYsIE1hdERpYWxvZ0NvbnRlbnQsIE1hdERpYWxvZ0FjdGlvbnMgfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbC9kaWFsb2cnO1xuaW1wb3J0IHsgVW50aWxEZXN0cm95LCB1bnRpbERlc3Ryb3llZCB9IGZyb20gJ0BuZ25lYXQvdW50aWwtZGVzdHJveSc7XG5pbXBvcnQgeyBUcmFuc2xhdGVNb2R1bGUgfSBmcm9tICdAbmd4LXRyYW5zbGF0ZS9jb3JlJztcbmltcG9ydCB7IGZpbmFsaXplIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBNaUIgfSBmcm9tICdhcHAvY29uc3RhbnRzL2J5dGVzLmNvbnN0YW50JztcbmltcG9ydCB7IFRpY2tldFR5cGUsIHRpY2tldEFjY2VwdGVkRmlsZXMgfSBmcm9tICdhcHAvZW51bXMvZmlsZS10aWNrZXQuZW51bSc7XG5pbXBvcnQgeyBoZWxwdGV4dFN5c3RlbVN1cHBvcnQgYXMgaGVscHRleHQgfSBmcm9tICdhcHAvaGVscHRleHQvc3lzdGVtL3N1cHBvcnQnO1xuaW1wb3J0IHsgT2F1dGhCdXR0b25UeXBlIH0gZnJvbSAnYXBwL21vZHVsZXMvYnV0dG9ucy9vYXV0aC1idXR0b24vaW50ZXJmYWNlcy9vYXV0aC1idXR0b24uaW50ZXJmYWNlJztcbmltcG9ydCB7IE9hdXRoQnV0dG9uTW9kdWxlIH0gZnJvbSAnYXBwL21vZHVsZXMvYnV0dG9ucy9vYXV0aC1idXR0b24vb2F1dGgtYnV0dG9uLm1vZHVsZSc7XG5pbXBvcnQgeyBGZWVkYmFja0RpYWxvZ0NvbXBvbmVudCB9IGZyb20gJ2FwcC9tb2R1bGVzL2ZlZWRiYWNrL2NvbXBvbmVudHMvZmVlZGJhY2stZGlhbG9nL2ZlZWRiYWNrLWRpYWxvZy5jb21wb25lbnQnO1xuaW1wb3J0IHsgU2ltaWxhcklzc3Vlc0NvbXBvbmVudCB9IGZyb20gJ2FwcC9tb2R1bGVzL2ZlZWRiYWNrL2NvbXBvbmVudHMvc2ltaWxhci1pc3N1ZXMvc2ltaWxhci1pc3N1ZXMuY29tcG9uZW50JztcbmltcG9ydCB7IEZlZWRiYWNrVHlwZSB9IGZyb20gJ2FwcC9tb2R1bGVzL2ZlZWRiYWNrL2ludGVyZmFjZXMvZmVlZGJhY2suaW50ZXJmYWNlJztcbmltcG9ydCB7IEZlZWRiYWNrU2VydmljZSB9IGZyb20gJ2FwcC9tb2R1bGVzL2ZlZWRiYWNrL3NlcnZpY2VzL2ZlZWRiYWNrLnNlcnZpY2UnO1xuaW1wb3J0IHsgRm9ybUFjdGlvbnNDb21wb25lbnQgfSBmcm9tICdhcHAvbW9kdWxlcy9mb3Jtcy9peC1mb3Jtcy9jb21wb25lbnRzL2Zvcm0tYWN0aW9ucy9mb3JtLWFjdGlvbnMuY29tcG9uZW50JztcbmltcG9ydCB7IEl4Q2hlY2tib3hDb21wb25lbnQgfSBmcm9tICdhcHAvbW9kdWxlcy9mb3Jtcy9peC1mb3Jtcy9jb21wb25lbnRzL2l4LWNoZWNrYm94L2l4LWNoZWNrYm94LmNvbXBvbmVudCc7XG5pbXBvcnQgeyBJeEZpbGVJbnB1dENvbXBvbmVudCB9IGZyb20gJ2FwcC9tb2R1bGVzL2Zvcm1zL2l4LWZvcm1zL2NvbXBvbmVudHMvaXgtZmlsZS1pbnB1dC9peC1maWxlLWlucHV0LmNvbXBvbmVudCc7XG5pbXBvcnQgeyBJeElucHV0Q29tcG9uZW50IH0gZnJvbSAnYXBwL21vZHVsZXMvZm9ybXMvaXgtZm9ybXMvY29tcG9uZW50cy9peC1pbnB1dC9peC1pbnB1dC5jb21wb25lbnQnO1xuaW1wb3J0IHsgSXhUZXh0YXJlYUNvbXBvbmVudCB9IGZyb20gJ2FwcC9tb2R1bGVzL2Zvcm1zL2l4LWZvcm1zL2NvbXBvbmVudHMvaXgtdGV4dGFyZWEvaXgtdGV4dGFyZWEuY29tcG9uZW50JztcbmltcG9ydCB7IEZvcm1FcnJvckhhbmRsZXJTZXJ2aWNlIH0gZnJvbSAnYXBwL21vZHVsZXMvZm9ybXMvaXgtZm9ybXMvc2VydmljZXMvZm9ybS1lcnJvci1oYW5kbGVyLnNlcnZpY2UnO1xuaW1wb3J0IHsgSW1hZ2VWYWxpZGF0b3JTZXJ2aWNlIH0gZnJvbSAnYXBwL21vZHVsZXMvZm9ybXMvaXgtZm9ybXMvdmFsaWRhdG9ycy9pbWFnZS12YWxpZGF0b3IvaW1hZ2UtdmFsaWRhdG9yLnNlcnZpY2UnO1xuaW1wb3J0IHsgV2ViU29ja2V0U2VydmljZSB9IGZyb20gJ2FwcC9zZXJ2aWNlcy93cy5zZXJ2aWNlJztcblxuQFVudGlsRGVzdHJveSgpXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdpeC1maWxlLXRpY2tldCcsXG4gIHN0eWxlVXJsczogWycuL2ZpbGUtdGlja2V0LmNvbXBvbmVudC5zY3NzJ10sXG4gIHRlbXBsYXRlVXJsOiAnLi9maWxlLXRpY2tldC5jb21wb25lbnQuaHRtbCcsXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxuICBzdGFuZGFsb25lOiB0cnVlLFxuICBpbXBvcnRzOiBbXG4gICAgQ2RrU2Nyb2xsYWJsZSxcbiAgICBNYXREaWFsb2dDb250ZW50LFxuICAgIFJlYWN0aXZlRm9ybXNNb2R1bGUsXG4gICAgSXhJbnB1dENvbXBvbmVudCxcbiAgICBTaW1pbGFySXNzdWVzQ29tcG9uZW50LFxuICAgIEl4VGV4dGFyZWFDb21wb25lbnQsXG4gICAgSXhDaGVja2JveENvbXBvbmVudCxcbiAgICBJeEZpbGVJbnB1dENvbXBvbmVudCxcbiAgICBNYXREaWFsb2dBY3Rpb25zLFxuICAgIEZvcm1BY3Rpb25zQ29tcG9uZW50LFxuICAgIE9hdXRoQnV0dG9uTW9kdWxlLFxuICAgIFRyYW5zbGF0ZU1vZHVsZSxcbiAgXSxcbn0pXG5leHBvcnQgY2xhc3MgRmlsZVRpY2tldENvbXBvbmVudCB7XG4gIEBJbnB1dCgpIHR5cGU6IEZlZWRiYWNrVHlwZS5CdWcgfCBGZWVkYmFja1R5cGUuU3VnZ2VzdGlvbjtcbiAgQElucHV0KCkgZGlhbG9nUmVmOiBNYXREaWFsb2dSZWY8RmVlZGJhY2tEaWFsb2dDb21wb25lbnQ+O1xuICBASW5wdXQoKSBpc0xvYWRpbmc6IGJvb2xlYW47XG5cbiAgcmVhZG9ubHkgaXNMb2FkaW5nQ2hhbmdlID0gb3V0cHV0PGJvb2xlYW4+KCk7XG5cbiAgcHJvdGVjdGVkIGZvcm0gPSB0aGlzLmZvcm1CdWlsZGVyLmdyb3VwKHtcbiAgICB0aXRsZTogWycnLCBbVmFsaWRhdG9ycy5tYXhMZW5ndGgoMjAwKV1dLFxuICAgIG1lc3NhZ2U6IFsnJywgW1ZhbGlkYXRvcnMubWF4TGVuZ3RoKDIwMDAwKV1dLFxuICAgIGltYWdlczogW1tdIGFzIEZpbGVbXSwgW11dLFxuICAgIGF0dGFjaF9kZWJ1ZzogW3RydWVdLFxuICAgIGF0dGFjaF9pbWFnZXM6IFtmYWxzZV0sXG4gICAgdGFrZV9zY3JlZW5zaG90OiBbdHJ1ZV0sXG4gIH0pO1xuXG4gIHByb3RlY3RlZCBPYXV0aEJ1dHRvblR5cGUgPSBPYXV0aEJ1dHRvblR5cGU7XG4gIHByb3RlY3RlZCByZWFkb25seSBvYXV0aFVybCA9ICdodHRwczovL3N1cHBvcnQtcHJveHkuaXhzeXN0ZW1zLmNvbS9vYXV0aC9pbml0aWF0ZT9vcmlnaW49JztcbiAgcHJvdGVjdGVkIHJlYWRvbmx5IG1lc3NhZ2VQbGFjZWhvbGRlciA9IGhlbHB0ZXh0LmJ1Zy5tZXNzYWdlLnBsYWNlaG9sZGVyO1xuICBwcm90ZWN0ZWQgcmVhZG9ubHkgYWNjZXB0ZWRGaWxlcyA9IHRpY2tldEFjY2VwdGVkRmlsZXM7XG5cbiAgcHJvdGVjdGVkIHJlYWRvbmx5IHRvb2x0aXBzID0ge1xuICAgIHRpdGxlOiBoZWxwdGV4dC50aXRsZS50b29sdGlwLFxuICAgIGF0dGFjaF9kZWJ1ZzogaGVscHRleHQuYXR0YWNoX2RlYnVnLnRvb2x0aXAsXG4gIH07XG5cbiAgcHJpdmF0ZSBnZXQgdGlja2V0VHlwZSgpOiBUaWNrZXRUeXBlIHtcbiAgICByZXR1cm4gdGhpcy50eXBlID09PSBGZWVkYmFja1R5cGUuQnVnID8gVGlja2V0VHlwZS5CdWcgOiBUaWNrZXRUeXBlLlN1Z2dlc3Rpb247XG4gIH1cblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIGZvcm1CdWlsZGVyOiBGb3JtQnVpbGRlcixcbiAgICBwcml2YXRlIGZlZWRiYWNrU2VydmljZTogRmVlZGJhY2tTZXJ2aWNlLFxuICAgIHByaXZhdGUgaW1hZ2VWYWxpZGF0b3I6IEltYWdlVmFsaWRhdG9yU2VydmljZSxcbiAgICBwcml2YXRlIGZvcm1FcnJvckhhbmRsZXI6IEZvcm1FcnJvckhhbmRsZXJTZXJ2aWNlLFxuICAgIHByaXZhdGUgd3M6IFdlYlNvY2tldFNlcnZpY2UsXG4gICkge1xuICAgIHRoaXMuZ2V0U3lzdGVtRmlsZVNpemVMaW1pdCgpO1xuICB9XG5cbiAgb25TdWJtaXQodG9rZW46IHVua25vd24pOiB2b2lkIHtcbiAgICB0aGlzLmlzTG9hZGluZ0NoYW5nZS5lbWl0KHRydWUpO1xuXG4gICAgdGhpcy5mZWVkYmFja1NlcnZpY2UuY3JlYXRlVGlja2V0KHRva2VuIGFzIHN0cmluZywgdGhpcy50aWNrZXRUeXBlLCB0aGlzLmZvcm0udmFsdWUpLnBpcGUoXG4gICAgICBmaW5hbGl6ZSgoKSA9PiB0aGlzLmlzTG9hZGluZ0NoYW5nZS5lbWl0KGZhbHNlKSksXG4gICAgICB1bnRpbERlc3Ryb3llZCh0aGlzKSxcbiAgICApLnN1YnNjcmliZSh7XG4gICAgICBuZXh0OiAoY3JlYXRlZFRpY2tldCkgPT4gdGhpcy5vblN1Y2Nlc3MoY3JlYXRlZFRpY2tldC51cmwpLFxuICAgICAgZXJyb3I6IChlcnJvcikgPT4gdGhpcy5mb3JtRXJyb3JIYW5kbGVyLmhhbmRsZVdzRm9ybUVycm9yKGVycm9yLCB0aGlzLmZvcm0pLFxuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBvblN1Y2Nlc3ModGlja2V0VXJsOiBzdHJpbmcpOiB2b2lkIHtcbiAgICB0aGlzLmZlZWRiYWNrU2VydmljZS5zaG93VGlja2V0U3VjY2Vzc01zZyh0aWNrZXRVcmwpO1xuICAgIHRoaXMuZGlhbG9nUmVmLmNsb3NlKCk7XG4gIH1cblxuICBwcml2YXRlIGdldFN5c3RlbUZpbGVTaXplTGltaXQoKTogdm9pZCB7XG4gICAgdGhpcy53cy5jYWxsKCdzdXBwb3J0LmF0dGFjaF90aWNrZXRfbWF4X3NpemUnKS5waXBlKHVudGlsRGVzdHJveWVkKHRoaXMpKS5zdWJzY3JpYmUoKHNpemUpID0+IHtcbiAgICAgIHRoaXMuZm9ybS5jb250cm9scy5pbWFnZXMuYWRkQXN5bmNWYWxpZGF0b3JzKHRoaXMuaW1hZ2VWYWxpZGF0b3IuZ2V0SW1hZ2VzVmFsaWRhdG9yKHNpemUgKiBNaUIpKTtcbiAgICAgIHRoaXMuZm9ybS5jb250cm9scy5pbWFnZXMudXBkYXRlVmFsdWVBbmRWYWxpZGl0eSgpO1xuICAgIH0pO1xuICB9XG59XG4iXSwidmVyc2lvbiI6M30=