{"file":"/Users/macbook/karpov-work/TrueNAS/webui/src/app/modules/feedback/components/file-ticket/file-ticket.component.ts","mappings":"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","names":[],"sources":["/Users/macbook/karpov-work/TrueNAS/webui/src/app/modules/feedback/components/file-ticket/file-ticket.component.ts"],"sourcesContent":["import { CdkScrollable } from '@angular/cdk/scrolling';\nimport {\n  ChangeDetectionStrategy,\n  Component, Input, output,\n} from '@angular/core';\nimport { FormBuilder, Validators, ReactiveFormsModule } from '@angular/forms';\nimport { MatDialogRef, MatDialogContent, MatDialogActions } from '@angular/material/dialog';\nimport { UntilDestroy, untilDestroyed } from '@ngneat/until-destroy';\nimport { TranslateModule } from '@ngx-translate/core';\nimport { finalize } from 'rxjs';\nimport { MiB } from 'app/constants/bytes.constant';\nimport { TicketType, ticketAcceptedFiles } from 'app/enums/file-ticket.enum';\nimport { helptextSystemSupport as helptext } from 'app/helptext/system/support';\nimport { OauthButtonType } from 'app/modules/buttons/oauth-button/interfaces/oauth-button.interface';\nimport { OauthButtonModule } from 'app/modules/buttons/oauth-button/oauth-button.module';\nimport { FeedbackDialogComponent } from 'app/modules/feedback/components/feedback-dialog/feedback-dialog.component';\nimport { SimilarIssuesComponent } from 'app/modules/feedback/components/similar-issues/similar-issues.component';\nimport { FeedbackType } from 'app/modules/feedback/interfaces/feedback.interface';\nimport { FeedbackService } from 'app/modules/feedback/services/feedback.service';\nimport { FormActionsComponent } from 'app/modules/forms/ix-forms/components/form-actions/form-actions.component';\nimport { IxCheckboxComponent } from 'app/modules/forms/ix-forms/components/ix-checkbox/ix-checkbox.component';\nimport { IxFileInputComponent } from 'app/modules/forms/ix-forms/components/ix-file-input/ix-file-input.component';\nimport { IxInputComponent } from 'app/modules/forms/ix-forms/components/ix-input/ix-input.component';\nimport { IxTextareaComponent } from 'app/modules/forms/ix-forms/components/ix-textarea/ix-textarea.component';\nimport { FormErrorHandlerService } from 'app/modules/forms/ix-forms/services/form-error-handler.service';\nimport { ImageValidatorService } from 'app/modules/forms/ix-forms/validators/image-validator/image-validator.service';\nimport { WebSocketService } from 'app/services/ws.service';\n\n@UntilDestroy()\n@Component({\n  selector: 'ix-file-ticket',\n  styleUrls: ['./file-ticket.component.scss'],\n  templateUrl: './file-ticket.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    CdkScrollable,\n    MatDialogContent,\n    ReactiveFormsModule,\n    IxInputComponent,\n    SimilarIssuesComponent,\n    IxTextareaComponent,\n    IxCheckboxComponent,\n    IxFileInputComponent,\n    MatDialogActions,\n    FormActionsComponent,\n    OauthButtonModule,\n    TranslateModule,\n  ],\n})\nexport class FileTicketComponent {\n  @Input() type: FeedbackType.Bug | FeedbackType.Suggestion;\n  @Input() dialogRef: MatDialogRef<FeedbackDialogComponent>;\n  @Input() isLoading: boolean;\n\n  readonly isLoadingChange = output<boolean>();\n\n  protected form = this.formBuilder.group({\n    title: ['', [Validators.maxLength(200)]],\n    message: ['', [Validators.maxLength(20000)]],\n    images: [[] as File[], []],\n    attach_debug: [true],\n    attach_images: [false],\n    take_screenshot: [true],\n  });\n\n  protected OauthButtonType = OauthButtonType;\n  protected readonly oauthUrl = 'https://support-proxy.ixsystems.com/oauth/initiate?origin=';\n  protected readonly messagePlaceholder = helptext.bug.message.placeholder;\n  protected readonly acceptedFiles = ticketAcceptedFiles;\n\n  protected readonly tooltips = {\n    title: helptext.title.tooltip,\n    attach_debug: helptext.attach_debug.tooltip,\n  };\n\n  private get ticketType(): TicketType {\n    return this.type === FeedbackType.Bug ? TicketType.Bug : TicketType.Suggestion;\n  }\n\n  constructor(\n    private formBuilder: FormBuilder,\n    private feedbackService: FeedbackService,\n    private imageValidator: ImageValidatorService,\n    private formErrorHandler: FormErrorHandlerService,\n    private ws: WebSocketService,\n  ) {\n    this.getSystemFileSizeLimit();\n  }\n\n  onSubmit(token: unknown): void {\n    this.isLoadingChange.emit(true);\n\n    this.feedbackService.createTicket(token as string, this.ticketType, this.form.value).pipe(\n      finalize(() => this.isLoadingChange.emit(false)),\n      untilDestroyed(this),\n    ).subscribe({\n      next: (createdTicket) => this.onSuccess(createdTicket.url),\n      error: (error) => this.formErrorHandler.handleWsFormError(error, this.form),\n    });\n  }\n\n  private onSuccess(ticketUrl: string): void {\n    this.feedbackService.showTicketSuccessMsg(ticketUrl);\n    this.dialogRef.close();\n  }\n\n  private getSystemFileSizeLimit(): void {\n    this.ws.call('support.attach_ticket_max_size').pipe(untilDestroyed(this)).subscribe((size) => {\n      this.form.controls.images.addAsyncValidators(this.imageValidator.getImagesValidator(size * MiB));\n      this.form.controls.images.updateValueAndValidity();\n    });\n  }\n}\n"],"version":3}