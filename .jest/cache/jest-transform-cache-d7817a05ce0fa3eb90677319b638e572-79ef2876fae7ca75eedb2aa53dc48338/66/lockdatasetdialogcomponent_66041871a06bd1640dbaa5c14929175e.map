{"file":"/Users/macbook/karpov-work/TrueNAS/webui/src/app/pages/datasets/modules/encryption/components/lock-dataset-dialog/lock-dataset-dialog.component.ts","mappings":";;;;;;;;;AAAA,wCAEuB;AACvB,0CAA6C;AAC7C,qDAAyE;AACzE,yDAAqE;AACrE,8CAAuD;AACvD,mDAA2C;AAC3C,0EAA2E;AAC3E,wEAA2D;AAC3D,sEAAkE;AAClE,qFAAiF;AACjF,8EAAyE;AACzE,wDAA2D;AASpD,IAAM,0BAA0B,GAAhC,MAAM,0BAA0B;IAKrC,YACU,EAAoB,EACpB,YAAiC,EACjC,SAA2B,EAC3B,QAAyB,EACzB,SAAmD,EACnD,aAA4B,EACJ,OAAgB;QANxC,OAAE,GAAF,EAAE,CAAkB;QACpB,iBAAY,GAAZ,YAAY,CAAqB;QACjC,cAAS,GAAT,SAAS,CAAkB;QAC3B,aAAQ,GAAR,QAAQ,CAAiB;QACzB,cAAS,GAAT,SAAS,CAA0C;QACnD,kBAAa,GAAb,aAAa,CAAe;QACJ,YAAO,GAAP,OAAO,CAAS;QAXzC,kBAAa,GAAG,CAAC,gBAAI,CAAC,YAAY,CAAC,CAAC;QAE7C,kBAAa,GAAG,IAAI,mBAAW,CAAC,KAAK,CAAC,CAAC;IAUnC,CAAC;IAEL,QAAQ,CAAC,MAAmB;QAC1B,MAAM,CAAC,cAAc,EAAE,CAAC;QAExB,MAAM,KAAK,GAAG,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC;QACvC,IAAI,CAAC,aAAa,CAAC,SAAS,CAC1B,IAAI,CAAC,EAAE,CAAC,GAAG,CAAC,mBAAmB,EAAE,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,EAAE,EAAE,YAAY,EAAE,KAAK,EAAE,CAAC,CAAC,EAC5E,EAAE,KAAK,EAAE,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,6BAAe,CAAC,mBAAmB,CAAC,eAAe,CAAC,EAAE,CACvF;aACE,WAAW,EAAE;aACb,IAAI,CACH,IAAI,CAAC,YAAY,CAAC,UAAU,EAAE,EAC9B,IAAA,8BAAc,EAAC,IAAI,CAAC,CACrB;aACA,SAAS,CAAC,GAAG,EAAE;YACd,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,gBAAgB,CAAC,CAAC,CAAC;YAChE,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;QAC7B,CAAC,CAAC,CAAC;IACP,CAAC;;AAhCU,gEAA0B;;;;;;;;8DAYlC,aAAM,SAAC,wBAAe;;qCAZd,0BAA0B;IAPtC,IAAA,4BAAY,GAAE;IACd,IAAA,gBAAS,EAAC;QACT,QAAQ,EAAE,wBAAwB;QAClC,yDAAmD;QAEnD,eAAe,EAAE,8BAAuB,CAAC,MAAM;KAChD,CAAC;GACW,0BAA0B,CAiCtC","names":[],"sources":["/Users/macbook/karpov-work/TrueNAS/webui/src/app/pages/datasets/modules/encryption/components/lock-dataset-dialog/lock-dataset-dialog.component.ts"],"sourcesContent":["import {\n  ChangeDetectionStrategy, Component, Inject,\n} from '@angular/core';\nimport { FormControl } from '@angular/forms';\nimport { MAT_DIALOG_DATA, MatDialogRef } from '@angular/material/dialog';\nimport { UntilDestroy, untilDestroyed } from '@ngneat/until-destroy';\nimport { TranslateService } from '@ngx-translate/core';\nimport { Role } from 'app/enums/role.enum';\nimport { helptextVolumes } from 'app/helptext/storage/volumes/volume-list';\nimport { Dataset } from 'app/interfaces/dataset.interface';\nimport { DialogService } from 'app/modules/dialog/dialog.service';\nimport { SnackbarService } from 'app/modules/snackbar/services/snackbar.service';\nimport { ErrorHandlerService } from 'app/services/error-handler.service';\nimport { WebSocketService } from 'app/services/ws.service';\n\n@UntilDestroy()\n@Component({\n  selector: 'ix-lock-dataset-dialog',\n  templateUrl: './lock-dataset-dialog.component.html',\n  styleUrls: ['./lock-dataset-dialog.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class LockDatasetDialogComponent {\n  readonly requiredRoles = [Role.DatasetWrite];\n\n  forceCheckbox = new FormControl(false);\n\n  constructor(\n    private ws: WebSocketService,\n    private errorHandler: ErrorHandlerService,\n    private translate: TranslateService,\n    private snackbar: SnackbarService,\n    private dialogRef: MatDialogRef<LockDatasetDialogComponent>,\n    private dialogService: DialogService,\n    @Inject(MAT_DIALOG_DATA) public dataset: Dataset,\n  ) { }\n\n  onSubmit($event: SubmitEvent): void {\n    $event.preventDefault();\n\n    const force = this.forceCheckbox.value;\n    this.dialogService.jobDialog(\n      this.ws.job('pool.dataset.lock', [this.dataset.id, { force_umount: force }]),\n      { title: this.translate.instant(helptextVolumes.lock_dataset_dialog.locking_dataset) },\n    )\n      .afterClosed()\n      .pipe(\n        this.errorHandler.catchError(),\n        untilDestroyed(this),\n      )\n      .subscribe(() => {\n        this.snackbar.success(this.translate.instant('Dataset locked'));\n        this.dialogRef.close(true);\n      });\n  }\n}\n"],"version":3}