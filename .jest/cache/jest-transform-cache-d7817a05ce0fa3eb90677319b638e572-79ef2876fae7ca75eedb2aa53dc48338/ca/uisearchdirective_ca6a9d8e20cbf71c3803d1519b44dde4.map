{"file":"/Users/macbook/karpov-work/TrueNAS/webui/src/app/directives/ui-search.directive.ts","mappings":"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","names":[],"sources":["/Users/macbook/karpov-work/TrueNAS/webui/src/app/directives/ui-search.directive.ts"],"sourcesContent":["import {\n  Directive, Input, ElementRef, Renderer2, OnInit,\n  OnDestroy,\n} from '@angular/core';\nimport { Timeout } from 'app/interfaces/timeout.interface';\nimport { searchDelayConst } from 'app/modules/global-search/constants/delay.const';\nimport { getSearchableElementId } from 'app/modules/global-search/helpers/get-searchable-element-id';\nimport { UiSearchableElement } from 'app/modules/global-search/interfaces/ui-searchable-element.interface';\nimport { UiSearchDirectivesService } from 'app/modules/global-search/services/ui-search-directives.service';\n\n@Directive({\n  selector: '[ixUiSearch]',\n  standalone: true,\n})\nexport class UiSearchDirective implements OnInit, OnDestroy {\n  @Input({ required: true, alias: 'ixUiSearch' }) config: UiSearchableElement;\n\n  get id(): string {\n    return getSearchableElementId(this.config);\n  }\n\n  get ariaLabel(): string {\n    const hierarchyItem = this.config.hierarchy?.[this.config.hierarchy.length - 1] || '';\n    const isSingleWord = hierarchyItem.trim().split(/\\s+/).length === 1;\n\n    if (isSingleWord && this.config.synonyms?.length > 0) {\n      return this.config.synonyms.reduce((best, synonym) => {\n        const synonymWordCount = synonym.trim().split(/\\s+/).length;\n        const bestWordCount = best.trim().split(/\\s+/).length;\n        return synonymWordCount > bestWordCount ? synonym : best;\n      }, hierarchyItem);\n    }\n    return hierarchyItem;\n  }\n\n  private highlightTimeout: Timeout = null;\n\n  constructor(\n    private renderer: Renderer2,\n    private elementRef: ElementRef<HTMLElement>,\n    private searchDirectives: UiSearchDirectivesService,\n  ) {}\n\n  ngOnInit(): void {\n    if (this.id) {\n      this.renderer.setAttribute(this.elementRef.nativeElement, 'id', this.id);\n      this.renderer.setAttribute(this.elementRef.nativeElement, 'aria-label', this.ariaLabel);\n    }\n    this.searchDirectives.register(this);\n  }\n\n  ngOnDestroy(): void {\n    this.searchDirectives.unregister(this);\n  }\n\n  highlight(parentElement: UiSearchableElement): void {\n    this.tryHighlightAnchors(parentElement, 0);\n  }\n\n  private tryHighlightAnchors(element: UiSearchableElement, attemptCount: number): void {\n    if (this.elementRef.nativeElement) {\n      this.highlightAndClickElement(this.elementRef.nativeElement, !!element.triggerAnchor);\n      if (this.elementRef.nativeElement.id !== element.anchor) {\n        this.highlightElementAnchor(element.anchor);\n      }\n    } else if (attemptCount < 2) {\n      setTimeout(() => this.tryHighlightAnchors(element, attemptCount + 1), searchDelayConst * 3);\n    }\n  }\n\n  private highlightElementAnchor(elementAnchor: string): void {\n    setTimeout(() => {\n      const rootNode = this.elementRef.nativeElement.getRootNode() as HTMLElement;\n      const anchorRef: HTMLElement = rootNode?.querySelector(`#${elementAnchor}`);\n\n      if (anchorRef) {\n        this.highlightAndClickElement(anchorRef);\n      }\n    }, searchDelayConst * 1.5);\n  }\n\n  private highlightAndClickElement(anchorRef: HTMLElement, shouldClick = false): void {\n    if (shouldClick && anchorRef) setTimeout(() => anchorRef.click(), searchDelayConst);\n\n    if (!anchorRef || shouldClick) return;\n\n    this.renderer.addClass(anchorRef, 'search-element-highlighted');\n\n    const removeHighlightStyling = (): void => {\n      this.renderer.removeClass(anchorRef, 'search-element-highlighted');\n      ['click', 'keydown'].forEach((event) => document.removeEventListener(event, removeHighlightStyling));\n    };\n\n    setTimeout(() => {\n      anchorRef.focus();\n      anchorRef.scrollIntoView();\n      document.querySelector<HTMLElement>('.rightside-content-hold').scrollBy(0, -20);\n      ['click', 'keydown'].forEach((event) => document.addEventListener(event, removeHighlightStyling, { once: true }));\n    }, searchDelayConst);\n\n    if (this.highlightTimeout) {\n      clearTimeout(this.highlightTimeout);\n    }\n\n    this.highlightTimeout = setTimeout(() => removeHighlightStyling(), 4000);\n  }\n}\n"],"version":3}