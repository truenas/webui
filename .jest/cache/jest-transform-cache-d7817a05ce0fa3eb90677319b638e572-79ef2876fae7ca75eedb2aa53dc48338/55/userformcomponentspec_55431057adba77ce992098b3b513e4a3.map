{"file":"/Users/macbook/karpov-work/TrueNAS/webui/src/app/pages/credentials/users/user-form/user-form.component.spec.ts","mappings":"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","names":[],"sources":["/Users/macbook/karpov-work/TrueNAS/webui/src/app/pages/credentials/users/user-form/user-form.component.spec.ts"],"sourcesContent":["import { HarnessLoader } from '@angular/cdk/testing';\nimport { TestbedHarnessEnvironment } from '@angular/cdk/testing/testbed';\nimport { ReactiveFormsModule } from '@angular/forms';\nimport { MatButtonHarness } from '@angular/material/button/testing';\nimport { Spectator } from '@ngneat/spectator';\nimport { createComponentFactory, mockProvider } from '@ngneat/spectator/jest';\nimport { provideMockStore } from '@ngrx/store/testing';\nimport { of } from 'rxjs';\nimport { allCommands } from 'app/constants/all-commands.constant';\nimport { mockAuth } from 'app/core/testing/utils/mock-auth.utils';\nimport { mockCall, mockWebSocket } from 'app/core/testing/utils/mock-websocket.utils';\nimport { Choices } from 'app/interfaces/choices.interface';\nimport { Group } from 'app/interfaces/group.interface';\nimport { SmbShare } from 'app/interfaces/smb-share.interface';\nimport { User } from 'app/interfaces/user.interface';\nimport { DialogService } from 'app/modules/dialog/dialog.service';\nimport { IxExplorerHarness } from 'app/modules/forms/ix-forms/components/ix-explorer/ix-explorer.harness';\nimport { IxInputHarness } from 'app/modules/forms/ix-forms/components/ix-input/ix-input.harness';\nimport { IxPermissionsComponent } from 'app/modules/forms/ix-forms/components/ix-permissions/ix-permissions.component';\nimport { IxSlideInRef } from 'app/modules/forms/ix-forms/components/ix-slide-in/ix-slide-in-ref';\nimport { SLIDE_IN_DATA } from 'app/modules/forms/ix-forms/components/ix-slide-in/ix-slide-in.token';\nimport { FormErrorHandlerService } from 'app/modules/forms/ix-forms/services/form-error-handler.service';\nimport { IxFormHarness } from 'app/modules/forms/ix-forms/testing/ix-form.harness';\nimport { selectUsers } from 'app/pages/credentials/users/store/user.selectors';\nimport { DownloadService } from 'app/services/download.service';\nimport { FilesystemService } from 'app/services/filesystem.service';\nimport { StorageService } from 'app/services/storage.service';\nimport { UserService } from 'app/services/user.service';\nimport { WebSocketService } from 'app/services/ws.service';\nimport { UserFormComponent } from './user-form.component';\n\ndescribe('UserFormComponent', () => {\n  const mockGroups = [{\n    id: 101,\n    group: 'test-group',\n  }, {\n    id: 102,\n    group: 'mock-group',\n  }] as Group[];\n\n  const mockUser = {\n    id: 69,\n    uid: 1004,\n    username: 'test',\n    home: '/home/test',\n    shell: '/usr/bin/bash',\n    full_name: 'test',\n    builtin: false,\n    smb: true,\n    ssh_password_enabled: true,\n    password_disabled: false,\n    locked: false,\n    sudo_commands_nopasswd: ['rm -rf /'],\n    sudo_commands: [allCommands],\n    email: null,\n    sshpubkey: null,\n    group: {\n      id: 101,\n    },\n    groups: [101],\n    immutable: false,\n  } as User;\n  const builtinUser = { ...mockUser, builtin: true, immutable: true };\n  let spectator: Spectator<UserFormComponent>;\n  let loader: HarnessLoader;\n  let ws: WebSocketService;\n  const createComponent = createComponentFactory({\n    component: UserFormComponent,\n    imports: [\n      ReactiveFormsModule,\n      IxPermissionsComponent,\n    ],\n    providers: [\n      mockWebSocket([\n        mockCall('user.query'),\n        mockCall('user.create'),\n        mockCall('user.update'),\n        mockCall('user.shell_choices', {\n          '/usr/bin/bash': 'bash',\n          '/usr/bin/zsh': 'zsh',\n        } as Choices),\n        mockCall('user.get_next_uid', 1234),\n        mockCall('group.query', mockGroups),\n        mockCall('sharing.smb.query', [{ path: '/mnt/users' }] as SmbShare[]),\n      ]),\n      mockProvider(DialogService, {\n        confirm: jest.fn(() => of(true)),\n      }),\n      mockProvider(IxSlideInRef),\n      mockProvider(StorageService, {\n        filesystemStat: jest.fn(() => of({ mode: 16832 })),\n      }),\n      mockProvider(DownloadService, {\n        downloadBlob: jest.fn(),\n      }),\n      mockProvider(FormErrorHandlerService),\n      mockProvider(UserService, {\n        groupQueryDsCache: jest.fn(() => of(mockGroups)),\n      }),\n      mockProvider(FilesystemService, {\n        getFilesystemNodeProvider: jest.fn(() => of()),\n      }),\n      provideMockStore({\n        selectors: [{\n          selector: selectUsers,\n          value: [mockUser],\n        }],\n      }),\n      mockAuth(),\n      { provide: SLIDE_IN_DATA, useValue: undefined },\n    ],\n  });\n\n  describe('adding a user', () => {\n    beforeEach(() => {\n      spectator = createComponent();\n      loader = TestbedHarnessEnvironment.loader(spectator.fixture);\n      ws = spectator.inject(WebSocketService);\n      spectator.component.setupForm();\n    });\n\n    it('loads next uid and puts it in uid field', async () => {\n      const uidInput = await loader.getHarness(IxInputHarness.with({ label: 'UID' }));\n      const value = await uidInput.getValue();\n\n      expect(ws.call).toHaveBeenCalledWith('user.get_next_uid');\n      expect(value).toBe('1234');\n    });\n\n    it('loads home share path and puts it in home field', async () => {\n      const homeInput = await loader.getHarness(IxExplorerHarness.with({ label: 'Home Directory' }));\n      expect(ws.call).toHaveBeenCalledWith('sharing.smb.query', [[['enabled', '=', true], ['home', '=', true]]]);\n      expect(await homeInput.getValue()).toBe('/mnt/users');\n\n      const usernameInput = await loader.getHarness(IxInputHarness.with({ label: 'Username' }));\n      await usernameInput.setValue('test');\n      expect(await homeInput.getValue()).toBe('/mnt/users');\n    });\n\n    it('checks download ssh key button is hidden', async () => {\n      const downloadButtons = await loader.getAllHarnesses(MatButtonHarness.with({ text: 'Download Authorized Keys' }));\n      expect(downloadButtons).toHaveLength(0);\n    });\n\n    it('sends a create payload to websocket and closes modal when save is pressed', async () => {\n      const form = await loader.getHarness(IxFormHarness);\n      await form.fillForm({\n        'Full Name': 'John Smith',\n        Password: 'test-pass',\n        'Confirm Password': 'test-pass',\n      });\n\n      const saveButton = await loader.getHarness(MatButtonHarness.with({ text: 'Save' }));\n      await saveButton.click();\n\n      expect(ws.call).toHaveBeenCalledWith('user.create', [expect.objectContaining({\n        full_name: 'John Smith',\n        group_create: true,\n        password: 'test-pass',\n        uid: 1234,\n        username: 'jsmith',\n      })]);\n    });\n\n    it('set disable password is true and check inputs', async () => {\n      const form = await loader.getHarness(IxFormHarness);\n      form.fillForm({\n        'Disable Password': true,\n      });\n\n      const disabled = await form.getDisabledState();\n      expect(disabled).toEqual(expect.objectContaining({\n        'Confirm Password': true,\n        'Lock User': true,\n        Password: true,\n      }));\n    });\n  });\n\n  describe('editing a user', () => {\n    beforeEach(() => {\n      spectator = createComponent({\n        providers: [\n          { provide: SLIDE_IN_DATA, useValue: mockUser },\n        ],\n      });\n      loader = TestbedHarnessEnvironment.loader(spectator.fixture);\n      ws = spectator.inject(WebSocketService);\n      spectator.component.setupForm();\n    });\n\n    it('check uid field is disabled', async () => {\n      const uidInput = await loader.getHarness(IxInputHarness.with({ label: 'UID' }));\n      expect(await uidInput.isDisabled()).toBeTruthy();\n    });\n\n    it('check change password', async () => {\n      const form = await loader.getHarness(IxFormHarness);\n      await form.fillForm({\n        'New Password': 'changepwd',\n        'Confirm New Password': 'changepwd',\n      });\n\n      const saveButton = await loader.getHarness(MatButtonHarness.with({ text: 'Save' }));\n      await saveButton.click();\n\n      expect(ws.call).toHaveBeenCalledWith('user.update', [69, expect.objectContaining({\n        password: 'changepwd',\n      })]);\n    });\n\n    it('shows download ssh key button', async () => {\n      const form = await loader.getHarness(IxFormHarness);\n      await form.fillForm({\n        'Authorized Keys': 'test-key',\n        Username: 'test-user',\n      });\n\n      const downloadButton = await loader.getHarness(MatButtonHarness.with({ text: 'Download Authorized Keys' }));\n      await downloadButton.click();\n\n      expect(spectator.inject(DownloadService).downloadBlob).toHaveBeenCalledWith(new Blob(), 'test-user_public_key_rsa');\n    });\n\n    it('shows current group values when form is being edited', async () => {\n      const form = await loader.getHarness(IxFormHarness);\n      const values = await form.getValues();\n\n      expect(values).toEqual({\n        'Auxiliary Groups': ['test-group'],\n        'SSH password login enabled': true,\n        'Confirm New Password': '',\n        'Create New Primary Group': false,\n        'Disable Password': false,\n        'Full Name': 'test',\n        'Home Directory Permissions': '700',\n        'Home Directory': '/home/test',\n        'Lock User': false,\n        'Primary Group': 'test-group',\n        'SMB User': true,\n        'Authorized Keys': '',\n        'Upload SSH Key': [],\n        'Create Home Directory': false,\n        UID: '1004',\n        Email: '',\n        'New Password': '',\n        Shell: 'bash',\n        Username: 'test',\n        'Allowed sudo commands': [],\n        'Allow all sudo commands': true,\n        'Allowed sudo commands with no password': ['rm -rf /'],\n        'Allow all sudo commands with no password': false,\n      });\n    });\n\n    it('sends an update payload to websocket and closes modal when save is pressed', async () => {\n      const form = await loader.getHarness(IxFormHarness);\n\n      await form.fillForm(\n        {\n          'Auxiliary Groups': ['mock-group', 'test-group'],\n          'Full Name': 'updated',\n          'Home Directory': '/home/updated',\n          'Primary Group': 'mock-group',\n          'Create Home Directory': true,\n          'SMB User': false,\n          'Lock User': true,\n          Shell: 'zsh',\n          Username: 'updated',\n          'Allow all sudo commands': false,\n          'Allowed sudo commands': ['pwd'],\n          'Allowed sudo commands with no password': [],\n          'Allow all sudo commands with no password': true,\n          'Home Directory Permissions': '755',\n        },\n      );\n\n      const saveButton = await loader.getHarness(MatButtonHarness.with({ text: 'Save' }));\n      await saveButton.click();\n\n      expect(ws.call).toHaveBeenCalledWith('user.update', [\n        69, { home: '/home/updated', home_create: true },\n      ]);\n\n      expect(ws.call).toHaveBeenLastCalledWith('user.update', [\n        69,\n        {\n          email: null,\n          full_name: 'updated',\n          group: 102,\n          groups: [102, 101],\n          home_mode: '755',\n          locked: true,\n          password_disabled: false,\n          shell: '/usr/bin/zsh',\n          smb: false,\n          ssh_password_enabled: true,\n          sshpubkey: null,\n          sudo_commands: ['pwd'],\n          sudo_commands_nopasswd: [allCommands],\n          username: 'updated',\n        },\n      ]);\n    });\n  });\n\n  describe('checks form states', () => {\n    beforeEach(() => {\n      spectator = createComponent({\n        providers: [\n          { provide: SLIDE_IN_DATA, useValue: builtinUser },\n        ],\n      });\n      loader = TestbedHarnessEnvironment.loader(spectator.fixture);\n      ws = spectator.inject(WebSocketService);\n      spectator.component.setupForm();\n    });\n\n    it('check form inputs when user is builtin', async () => {\n      spectator.component.setupForm();\n\n      const form = await loader.getHarness(IxFormHarness);\n      const disabled = await form.getDisabledState();\n\n      expect(disabled).toEqual(expect.objectContaining({\n        'Home Directory': true,\n        'Primary Group': true,\n        Username: true,\n        'SMB User': true,\n      }));\n    });\n  });\n});\n"],"version":3}