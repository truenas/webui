{"file":"/Users/macbook/karpov-work/TrueNAS/webui/src/app/pages/system/update/components/manual-update-form/manual-update-form.component.ts","mappings":"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","names":[],"sources":["/Users/macbook/karpov-work/TrueNAS/webui/src/app/pages/system/update/components/manual-update-form/manual-update-form.component.ts"],"sourcesContent":["import { AsyncPipe } from '@angular/common';\nimport {\n  ChangeDetectionStrategy, ChangeDetectorRef, Component, OnInit,\n} from '@angular/core';\nimport { FormBuilder, Validators, ReactiveFormsModule } from '@angular/forms';\nimport { MatButton } from '@angular/material/button';\nimport { MatCard, MatCardContent } from '@angular/material/card';\nimport { MatDialog } from '@angular/material/dialog';\nimport { MatProgressBar } from '@angular/material/progress-bar';\nimport { Router } from '@angular/router';\nimport { UntilDestroy, untilDestroyed } from '@ngneat/until-destroy';\nimport { select, Store } from '@ngrx/store';\nimport { TranslateService, TranslateModule } from '@ngx-translate/core';\nimport {\n  BehaviorSubject, finalize, noop, Observable, of,\n} from 'rxjs';\nimport {\n  filter, tap,\n} from 'rxjs/operators';\nimport { RequiresRolesDirective } from 'app/directives/requires-roles/requires-roles.directive';\nimport { UiSearchDirective } from 'app/directives/ui-search.directive';\nimport { JobState } from 'app/enums/job-state.enum';\nimport { Role } from 'app/enums/role.enum';\nimport { observeJob } from 'app/helpers/operators/observe-job.operator';\nimport { helptextSystemUpdate as helptext } from 'app/helptext/system/update';\nimport { ApiJobMethod } from 'app/interfaces/api/api-job-directory.interface';\nimport { Job } from 'app/interfaces/job.interface';\nimport { Option } from 'app/interfaces/option.interface';\nimport { DialogService } from 'app/modules/dialog/dialog.service';\nimport { IxCheckboxComponent } from 'app/modules/forms/ix-forms/components/ix-checkbox/ix-checkbox.component';\nimport { IxFieldsetComponent } from 'app/modules/forms/ix-forms/components/ix-fieldset/ix-fieldset.component';\nimport { IxFileInputComponent } from 'app/modules/forms/ix-forms/components/ix-file-input/ix-file-input.component';\nimport { IxSelectComponent } from 'app/modules/forms/ix-forms/components/ix-select/ix-select.component';\nimport { selectJob } from 'app/modules/jobs/store/job.selectors';\nimport { TestDirective } from 'app/modules/test-id/test.directive';\nimport { systemManualUpdateFormElements } from 'app/pages/system/update/components/manual-update-form/manual-update-form.elements';\nimport { updateAgainCode } from 'app/pages/system/update/utils/update-again-code.constant';\nimport { AuthService } from 'app/services/auth/auth.service';\nimport { ErrorHandlerService } from 'app/services/error-handler.service';\nimport { SystemGeneralService } from 'app/services/system-general.service';\nimport { UploadOptions, UploadService } from 'app/services/upload.service';\nimport { WebSocketService } from 'app/services/ws.service';\nimport { AppState } from 'app/store';\nimport { selectIsHaLicensed } from 'app/store/ha-info/ha-info.selectors';\nimport { updateRebootAfterManualUpdate } from 'app/store/preferences/preferences.actions';\nimport { waitForPreferences } from 'app/store/preferences/preferences.selectors';\nimport { waitForSystemInfo } from 'app/store/system-info/system-info.selectors';\n\n@UntilDestroy()\n@Component({\n  selector: 'ix-manual-update-form',\n  templateUrl: './manual-update-form.component.html',\n  styleUrls: ['manual-update-form.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    MatCard,\n    UiSearchDirective,\n    MatCardContent,\n    MatProgressBar,\n    ReactiveFormsModule,\n    IxFieldsetComponent,\n    IxFileInputComponent,\n    IxSelectComponent,\n    IxCheckboxComponent,\n    RequiresRolesDirective,\n    MatButton,\n    TestDirective,\n    TranslateModule,\n    AsyncPipe,\n  ],\n})\nexport class ManualUpdateFormComponent implements OnInit {\n  protected readonly requiredRoles = [Role.FullAdmin];\n  protected readonly searchableElements = systemManualUpdateFormElements;\n\n  isFormLoading$ = new BehaviorSubject(false);\n  form = this.formBuilder.group({\n    filelocation: ['', Validators.required],\n    updateFile: [null as FileList],\n    rebootAfterManualUpdate: [false],\n  });\n\n  private apiEndPoint: string;\n\n  readonly helptext = helptext;\n  currentVersion = '';\n  fileLocationOptions$: Observable<Option[]>;\n\n  isHaLicensed = false;\n\n  constructor(\n    private dialogService: DialogService,\n    private matDialog: MatDialog,\n    protected router: Router,\n    public systemService: SystemGeneralService,\n    private formBuilder: FormBuilder,\n    private ws: WebSocketService,\n    private errorHandler: ErrorHandlerService,\n    private authService: AuthService,\n    private translate: TranslateService,\n    private store$: Store<AppState>,\n    private cdr: ChangeDetectorRef,\n    private upload: UploadService,\n  ) {\n    this.authService.authToken$.pipe(\n      tap((token) => {\n        this.apiEndPoint = '/_upload?auth_token=' + token;\n      }),\n      untilDestroyed(this),\n    ).subscribe();\n  }\n\n  ngOnInit(): void {\n    this.checkHaLicenseAndUpdateStatus();\n    this.getVersionNoFromSysInfo();\n    this.setPoolOptions();\n    this.getUserPrefs();\n  }\n\n  getUserPrefs(): void {\n    this.store$.pipe(waitForPreferences).pipe(\n      tap((userPrefs) => {\n        if (userPrefs.rebootAfterManualUpdate === undefined) {\n          userPrefs.rebootAfterManualUpdate = false;\n        }\n        this.form.controls.rebootAfterManualUpdate.setValue(userPrefs.rebootAfterManualUpdate);\n      }),\n      untilDestroyed(this),\n    ).subscribe(noop);\n  }\n\n  getVersionNoFromSysInfo(): void {\n    this.store$.pipe(waitForSystemInfo, untilDestroyed(this)).subscribe((sysInfo) => {\n      this.currentVersion = sysInfo.version;\n      this.cdr.markForCheck();\n    });\n  }\n\n  setPoolOptions(): void {\n    this.ws.call('pool.query').pipe(untilDestroyed(this)).subscribe((pools) => {\n      if (!pools) {\n        return;\n      }\n      const options = [{ label: this.translate.instant('Memory device'), value: ':temp:' }];\n      pools.forEach((pool) => {\n        options.push({\n          label: '/mnt/' + pool.name, value: '/mnt/' + pool.name,\n        });\n      });\n      this.fileLocationOptions$ = of(options);\n    });\n  }\n\n  checkHaLicenseAndUpdateStatus(): void {\n    if (this.systemService.isEnterprise) {\n      this.store$.select(selectIsHaLicensed).pipe(untilDestroyed(this)).subscribe((isHaLicensed) => {\n        this.isHaLicensed = isHaLicensed;\n        this.checkForUpdateRunning();\n        this.cdr.markForCheck();\n\n        if (this.isHaLicensed) {\n          this.form.removeControl('filelocation');\n        }\n      });\n    }\n  }\n\n  checkForUpdateRunning(): void {\n    this.ws.call('core.get_jobs', [[['method', '=', 'failover.upgrade'], ['state', '=', JobState.Running]]])\n      .pipe(untilDestroyed(this)).subscribe({\n        next: (jobs) => {\n          if (jobs && jobs.length > 0) {\n            this.showRunningUpdate(jobs[0].id);\n          }\n        },\n        error: (err) => {\n          console.error(err);\n        },\n      });\n  }\n\n  // TODO: Same code as in update-actions-card\n  showRunningUpdate(jobId: number): void {\n    const job$ = this.store$.pipe(\n      select(selectJob(jobId)),\n      observeJob(),\n    ) as Observable<Job<ApiJobMethod>>;\n\n    this.dialogService.jobDialog(\n      job$,\n      {\n        title: this.translate.instant('Update'),\n        canMinimize: true,\n      },\n    )\n      .afterClosed()\n      .pipe(\n        this.errorHandler.catchError(),\n        untilDestroyed(this),\n      )\n      .subscribe(() => {\n        this.router.navigate(['/system-tasks/restart'], { skipLocationChange: true });\n      });\n  }\n\n  onSubmit(): void {\n    this.isFormLoading$.next(true);\n    const value = this.form.value;\n    value.filelocation = value.filelocation === ':temp:' ? null : value.filelocation;\n    this.store$.dispatch(updateRebootAfterManualUpdate({\n      rebootAfterManualUpdate: value.rebootAfterManualUpdate,\n    }));\n    this.systemService.updateRunningNoticeSent.emit();\n    this.cdr.markForCheck();\n    this.setupAndOpenUpdateJobDialog(value.updateFile, value.filelocation);\n  }\n\n  setupAndOpenUpdateJobDialog(files: FileList, fileLocation: string): void {\n    if (!files.length) {\n      return;\n    }\n\n    const params: UploadOptions = this.isHaLicensed\n      ? {\n        method: 'failover.upgrade',\n        file: files[0],\n      }\n      : {\n        method: 'update.file',\n        params: [{ destination: fileLocation }],\n        file: files[0],\n      };\n\n    const job$ = this.upload.uploadAsJob(params);\n    this.dialogService\n      .jobDialog(job$, { title: this.translate.instant(helptext.manual_update_action) })\n      .afterClosed()\n      .pipe(\n        finalize(() => {\n          this.isFormLoading$.next(false);\n          this.cdr.markForCheck();\n        }),\n        untilDestroyed(this),\n      )\n      .subscribe({\n        next: () => this.handleUpdateSuccess(),\n        error: (job: Job) => this.handleUpdateFailure(job),\n      });\n  }\n\n  finishNonHaUpdate(): void {\n    if (this.form.value.rebootAfterManualUpdate) {\n      this.router.navigate(['/system-tasks/restart'], { skipLocationChange: true });\n    } else {\n      this.dialogService.confirm({\n        title: this.translate.instant('Restart'),\n        message: this.translate.instant(helptext.rebootAfterManualUpdate.manual_reboot_msg),\n      }).pipe(\n        filter(Boolean),\n        untilDestroyed(this),\n      ).subscribe(() => this.router.navigate(['/system-tasks/restart'], { skipLocationChange: true }));\n    }\n  }\n\n  finishHaUpdate(): void {\n    this.dialogService.closeAllDialogs();\n    this.systemService.updateDone(); // Send 'finished' signal to topbar\n    this.cdr.markForCheck();\n    this.router.navigate(['/']);\n    this.dialogService.confirm({\n      title: helptext.ha_update.complete_title,\n      message: helptext.ha_update.complete_msg,\n      hideCheckbox: true,\n      buttonText: helptext.ha_update.complete_action,\n      hideCancel: true,\n    }).pipe(untilDestroyed(this)).subscribe(() => {});\n  }\n\n  handleUpdateSuccess(): void {\n    if (this.isHaLicensed) {\n      this.finishHaUpdate();\n    } else {\n      this.finishNonHaUpdate();\n    }\n  }\n\n  handleUpdateFailure = (failure: Job): void => {\n    this.isFormLoading$.next(false);\n    this.cdr.markForCheck();\n    if (failure.error.includes(updateAgainCode)) {\n      this.dialogService.confirm({\n        title: helptext.continueDialogTitle,\n        message: failure.error.replace(updateAgainCode, ''),\n        buttonText: helptext.continueDialogAction,\n      }).pipe(\n        filter(Boolean),\n        untilDestroyed(this),\n      ).subscribe(() => {\n        this.resumeUpdateAfterFailure();\n      });\n      return;\n    }\n    this.dialogService.error(this.errorHandler.parseError(failure));\n  };\n\n  private resumeUpdateAfterFailure(): void {\n    const job$: Observable<Job> = this.isHaLicensed\n      ? this.ws.job('failover.upgrade', [{ resume: true, resume_manual: true }])\n      : this.ws.job('update.file', [{ resume: true }]);\n\n    this.dialogService\n      .jobDialog(job$, { title: helptext.manual_update_action })\n      .afterClosed()\n      .pipe(untilDestroyed(this))\n      .subscribe({\n        next: () => this.handleUpdateSuccess(),\n        error: (job: Job) => this.handleUpdateFailure(job),\n      });\n  }\n}\n"],"version":3}