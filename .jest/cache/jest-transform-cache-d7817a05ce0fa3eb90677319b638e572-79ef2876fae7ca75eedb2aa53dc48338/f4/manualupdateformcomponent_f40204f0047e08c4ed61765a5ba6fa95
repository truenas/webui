68b37a58058a5aea97909debd8f10618
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.ManualUpdateFormComponent = void 0;
const common_1 = require("@angular/common");
const core_1 = require("@angular/core");
const forms_1 = require("@angular/forms");
const button_1 = require("@angular/material/button");
const card_1 = require("@angular/material/card");
const dialog_1 = require("@angular/material/dialog");
const progress_bar_1 = require("@angular/material/progress-bar");
const router_1 = require("@angular/router");
const until_destroy_1 = require("@ngneat/until-destroy");
const store_1 = require("@ngrx/store");
const core_2 = require("@ngx-translate/core");
const rxjs_1 = require("rxjs");
const operators_1 = require("rxjs/operators");
const requires_roles_directive_1 = require("app/directives/requires-roles/requires-roles.directive");
const ui_search_directive_1 = require("app/directives/ui-search.directive");
const job_state_enum_1 = require("app/enums/job-state.enum");
const role_enum_1 = require("app/enums/role.enum");
const observe_job_operator_1 = require("app/helpers/operators/observe-job.operator");
const update_1 = require("app/helptext/system/update");
const dialog_service_1 = require("app/modules/dialog/dialog.service");
const ix_checkbox_component_1 = require("app/modules/forms/ix-forms/components/ix-checkbox/ix-checkbox.component");
const ix_fieldset_component_1 = require("app/modules/forms/ix-forms/components/ix-fieldset/ix-fieldset.component");
const ix_file_input_component_1 = require("app/modules/forms/ix-forms/components/ix-file-input/ix-file-input.component");
const ix_select_component_1 = require("app/modules/forms/ix-forms/components/ix-select/ix-select.component");
const job_selectors_1 = require("app/modules/jobs/store/job.selectors");
const test_directive_1 = require("app/modules/test-id/test.directive");
const manual_update_form_elements_1 = require("app/pages/system/update/components/manual-update-form/manual-update-form.elements");
const update_again_code_constant_1 = require("app/pages/system/update/utils/update-again-code.constant");
const auth_service_1 = require("app/services/auth/auth.service");
const error_handler_service_1 = require("app/services/error-handler.service");
const system_general_service_1 = require("app/services/system-general.service");
const upload_service_1 = require("app/services/upload.service");
const ws_service_1 = require("app/services/ws.service");
const ha_info_selectors_1 = require("app/store/ha-info/ha-info.selectors");
const preferences_actions_1 = require("app/store/preferences/preferences.actions");
const preferences_selectors_1 = require("app/store/preferences/preferences.selectors");
const system_info_selectors_1 = require("app/store/system-info/system-info.selectors");
let ManualUpdateFormComponent = class ManualUpdateFormComponent {
    constructor(dialogService, matDialog, router, systemService, formBuilder, ws, errorHandler, authService, translate, store$, cdr, upload) {
        this.dialogService = dialogService;
        this.matDialog = matDialog;
        this.router = router;
        this.systemService = systemService;
        this.formBuilder = formBuilder;
        this.ws = ws;
        this.errorHandler = errorHandler;
        this.authService = authService;
        this.translate = translate;
        this.store$ = store$;
        this.cdr = cdr;
        this.upload = upload;
        this.requiredRoles = [role_enum_1.Role.FullAdmin];
        this.searchableElements = manual_update_form_elements_1.systemManualUpdateFormElements;
        this.isFormLoading$ = new rxjs_1.BehaviorSubject(false);
        this.form = this.formBuilder.group({
            filelocation: ['', forms_1.Validators.required],
            updateFile: [null],
            rebootAfterManualUpdate: [false],
        });
        this.helptext = update_1.helptextSystemUpdate;
        this.currentVersion = '';
        this.isHaLicensed = false;
        this.handleUpdateFailure = (failure) => {
            this.isFormLoading$.next(false);
            this.cdr.markForCheck();
            if (failure.error.includes(update_again_code_constant_1.updateAgainCode)) {
                this.dialogService.confirm({
                    title: update_1.helptextSystemUpdate.continueDialogTitle,
                    message: failure.error.replace(update_again_code_constant_1.updateAgainCode, ''),
                    buttonText: update_1.helptextSystemUpdate.continueDialogAction,
                }).pipe((0, operators_1.filter)(Boolean), (0, until_destroy_1.untilDestroyed)(this)).subscribe(() => {
                    this.resumeUpdateAfterFailure();
                });
                return;
            }
            this.dialogService.error(this.errorHandler.parseError(failure));
        };
        this.authService.authToken$.pipe((0, operators_1.tap)((token) => {
            this.apiEndPoint = '/_upload?auth_token=' + token;
        }), (0, until_destroy_1.untilDestroyed)(this)).subscribe();
    }
    ngOnInit() {
        this.checkHaLicenseAndUpdateStatus();
        this.getVersionNoFromSysInfo();
        this.setPoolOptions();
        this.getUserPrefs();
    }
    getUserPrefs() {
        this.store$.pipe(preferences_selectors_1.waitForPreferences).pipe((0, operators_1.tap)((userPrefs) => {
            if (userPrefs.rebootAfterManualUpdate === undefined) {
                userPrefs.rebootAfterManualUpdate = false;
            }
            this.form.controls.rebootAfterManualUpdate.setValue(userPrefs.rebootAfterManualUpdate);
        }), (0, until_destroy_1.untilDestroyed)(this)).subscribe(rxjs_1.noop);
    }
    getVersionNoFromSysInfo() {
        this.store$.pipe(system_info_selectors_1.waitForSystemInfo, (0, until_destroy_1.untilDestroyed)(this)).subscribe((sysInfo) => {
            this.currentVersion = sysInfo.version;
            this.cdr.markForCheck();
        });
    }
    setPoolOptions() {
        this.ws.call('pool.query').pipe((0, until_destroy_1.untilDestroyed)(this)).subscribe((pools) => {
            if (!pools) {
                return;
            }
            const options = [{ label: this.translate.instant('Memory device'), value: ':temp:' }];
            pools.forEach((pool) => {
                options.push({
                    label: '/mnt/' + pool.name, value: '/mnt/' + pool.name,
                });
            });
            this.fileLocationOptions$ = (0, rxjs_1.of)(options);
        });
    }
    checkHaLicenseAndUpdateStatus() {
        if (this.systemService.isEnterprise) {
            this.store$.select(ha_info_selectors_1.selectIsHaLicensed).pipe((0, until_destroy_1.untilDestroyed)(this)).subscribe((isHaLicensed) => {
                this.isHaLicensed = isHaLicensed;
                this.checkForUpdateRunning();
                this.cdr.markForCheck();
                if (this.isHaLicensed) {
                    this.form.removeControl('filelocation');
                }
            });
        }
    }
    checkForUpdateRunning() {
        this.ws.call('core.get_jobs', [[['method', '=', 'failover.upgrade'], ['state', '=', job_state_enum_1.JobState.Running]]])
            .pipe((0, until_destroy_1.untilDestroyed)(this)).subscribe({
            next: (jobs) => {
                if (jobs && jobs.length > 0) {
                    this.showRunningUpdate(jobs[0].id);
                }
            },
            error: (err) => {
                console.error(err);
            },
        });
    }
    // TODO: Same code as in update-actions-card
    showRunningUpdate(jobId) {
        const job$ = this.store$.pipe((0, store_1.select)((0, job_selectors_1.selectJob)(jobId)), (0, observe_job_operator_1.observeJob)());
        this.dialogService.jobDialog(job$, {
            title: this.translate.instant('Update'),
            canMinimize: true,
        })
            .afterClosed()
            .pipe(this.errorHandler.catchError(), (0, until_destroy_1.untilDestroyed)(this))
            .subscribe(() => {
            this.router.navigate(['/system-tasks/restart'], { skipLocationChange: true });
        });
    }
    onSubmit() {
        this.isFormLoading$.next(true);
        const value = this.form.value;
        value.filelocation = value.filelocation === ':temp:' ? null : value.filelocation;
        this.store$.dispatch((0, preferences_actions_1.updateRebootAfterManualUpdate)({
            rebootAfterManualUpdate: value.rebootAfterManualUpdate,
        }));
        this.systemService.updateRunningNoticeSent.emit();
        this.cdr.markForCheck();
        this.setupAndOpenUpdateJobDialog(value.updateFile, value.filelocation);
    }
    setupAndOpenUpdateJobDialog(files, fileLocation) {
        if (!files.length) {
            return;
        }
        const params = this.isHaLicensed
            ? {
                method: 'failover.upgrade',
                file: files[0],
            }
            : {
                method: 'update.file',
                params: [{ destination: fileLocation }],
                file: files[0],
            };
        const job$ = this.upload.uploadAsJob(params);
        this.dialogService
            .jobDialog(job$, { title: this.translate.instant(update_1.helptextSystemUpdate.manual_update_action) })
            .afterClosed()
            .pipe((0, rxjs_1.finalize)(() => {
            this.isFormLoading$.next(false);
            this.cdr.markForCheck();
        }), (0, until_destroy_1.untilDestroyed)(this))
            .subscribe({
            next: () => this.handleUpdateSuccess(),
            error: (job) => this.handleUpdateFailure(job),
        });
    }
    finishNonHaUpdate() {
        if (this.form.value.rebootAfterManualUpdate) {
            this.router.navigate(['/system-tasks/restart'], { skipLocationChange: true });
        }
        else {
            this.dialogService.confirm({
                title: this.translate.instant('Restart'),
                message: this.translate.instant(update_1.helptextSystemUpdate.rebootAfterManualUpdate.manual_reboot_msg),
            }).pipe((0, operators_1.filter)(Boolean), (0, until_destroy_1.untilDestroyed)(this)).subscribe(() => this.router.navigate(['/system-tasks/restart'], { skipLocationChange: true }));
        }
    }
    finishHaUpdate() {
        this.dialogService.closeAllDialogs();
        this.systemService.updateDone(); // Send 'finished' signal to topbar
        this.cdr.markForCheck();
        this.router.navigate(['/']);
        this.dialogService.confirm({
            title: update_1.helptextSystemUpdate.ha_update.complete_title,
            message: update_1.helptextSystemUpdate.ha_update.complete_msg,
            hideCheckbox: true,
            buttonText: update_1.helptextSystemUpdate.ha_update.complete_action,
            hideCancel: true,
        }).pipe((0, until_destroy_1.untilDestroyed)(this)).subscribe(() => { });
    }
    handleUpdateSuccess() {
        if (this.isHaLicensed) {
            this.finishHaUpdate();
        }
        else {
            this.finishNonHaUpdate();
        }
    }
    resumeUpdateAfterFailure() {
        const job$ = this.isHaLicensed
            ? this.ws.job('failover.upgrade', [{ resume: true, resume_manual: true }])
            : this.ws.job('update.file', [{ resume: true }]);
        this.dialogService
            .jobDialog(job$, { title: update_1.helptextSystemUpdate.manual_update_action })
            .afterClosed()
            .pipe((0, until_destroy_1.untilDestroyed)(this))
            .subscribe({
            next: () => this.handleUpdateSuccess(),
            error: (job) => this.handleUpdateFailure(job),
        });
    }
};
exports.ManualUpdateFormComponent = ManualUpdateFormComponent;
ManualUpdateFormComponent.ctorParameters = () => [
    { type: dialog_service_1.DialogService },
    { type: dialog_1.MatDialog },
    { type: router_1.Router },
    { type: system_general_service_1.SystemGeneralService },
    { type: forms_1.FormBuilder },
    { type: ws_service_1.WebSocketService },
    { type: error_handler_service_1.ErrorHandlerService },
    { type: auth_service_1.AuthService },
    { type: core_2.TranslateService },
    { type: store_1.Store },
    { type: core_1.ChangeDetectorRef },
    { type: upload_service_1.UploadService }
];
exports.ManualUpdateFormComponent = ManualUpdateFormComponent = __decorate([
    (0, until_destroy_1.UntilDestroy)(),
    (0, core_1.Component)({
        selector: 'ix-manual-update-form',
        template: require("./manual-update-form.component.html"),
        changeDetection: core_1.ChangeDetectionStrategy.OnPush,
        standalone: true,
        imports: [
            card_1.MatCard,
            ui_search_directive_1.UiSearchDirective,
            card_1.MatCardContent,
            progress_bar_1.MatProgressBar,
            forms_1.ReactiveFormsModule,
            ix_fieldset_component_1.IxFieldsetComponent,
            ix_file_input_component_1.IxFileInputComponent,
            ix_select_component_1.IxSelectComponent,
            ix_checkbox_component_1.IxCheckboxComponent,
            requires_roles_directive_1.RequiresRolesDirective,
            button_1.MatButton,
            test_directive_1.TestDirective,
            core_2.TranslateModule,
            common_1.AsyncPipe,
        ],
    })
], ManualUpdateFormComponent);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL21hY2Jvb2sva2FycG92LXdvcmsvVHJ1ZU5BUy93ZWJ1aS9zcmMvYXBwL3BhZ2VzL3N5c3RlbS91cGRhdGUvY29tcG9uZW50cy9tYW51YWwtdXBkYXRlLWZvcm0vbWFudWFsLXVwZGF0ZS1mb3JtLmNvbXBvbmVudC50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQSw0Q0FBNEM7QUFDNUMsd0NBRXVCO0FBQ3ZCLDBDQUE4RTtBQUM5RSxxREFBcUQ7QUFDckQsaURBQWlFO0FBQ2pFLHFEQUFxRDtBQUNyRCxpRUFBZ0U7QUFDaEUsNENBQXlDO0FBQ3pDLHlEQUFxRTtBQUNyRSx1Q0FBNEM7QUFDNUMsOENBQXdFO0FBQ3hFLCtCQUVjO0FBQ2QsOENBRXdCO0FBQ3hCLHFHQUFnRztBQUNoRyw0RUFBdUU7QUFDdkUsNkRBQW9EO0FBQ3BELG1EQUEyQztBQUMzQyxxRkFBd0U7QUFDeEUsdURBQThFO0FBSTlFLHNFQUFrRTtBQUNsRSxtSEFBOEc7QUFDOUcsbUhBQThHO0FBQzlHLHlIQUFtSDtBQUNuSCw2R0FBd0c7QUFDeEcsd0VBQWlFO0FBQ2pFLHVFQUFtRTtBQUNuRSxtSUFBbUk7QUFDbkkseUdBQTJGO0FBQzNGLGlFQUE2RDtBQUM3RCw4RUFBeUU7QUFDekUsZ0ZBQTJFO0FBQzNFLGdFQUEyRTtBQUMzRSx3REFBMkQ7QUFFM0QsMkVBQXlFO0FBQ3pFLG1GQUEwRjtBQUMxRix1RkFBaUY7QUFDakYsdUZBQWdGO0FBMEJ6RSxJQUFNLHlCQUF5QixHQUEvQixNQUFNLHlCQUF5QjtJQW1CcEMsWUFDVSxhQUE0QixFQUM1QixTQUFvQixFQUNsQixNQUFjLEVBQ2pCLGFBQW1DLEVBQ2xDLFdBQXdCLEVBQ3hCLEVBQW9CLEVBQ3BCLFlBQWlDLEVBQ2pDLFdBQXdCLEVBQ3hCLFNBQTJCLEVBQzNCLE1BQXVCLEVBQ3ZCLEdBQXNCLEVBQ3RCLE1BQXFCO1FBWHJCLGtCQUFhLEdBQWIsYUFBYSxDQUFlO1FBQzVCLGNBQVMsR0FBVCxTQUFTLENBQVc7UUFDbEIsV0FBTSxHQUFOLE1BQU0s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cmMvYXBwL3BhZ2VzL3N5c3RlbS91cGRhdGUvY29tcG9uZW50cy9tYW51YWwtdXBkYXRlLWZvcm0vbWFudWFsLXVwZGF0ZS1mb3JtLmNvbXBvbmVudC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBc3luY1BpcGUgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xuaW1wb3J0IHtcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksIENoYW5nZURldGVjdG9yUmVmLCBDb21wb25lbnQsIE9uSW5pdCxcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBGb3JtQnVpbGRlciwgVmFsaWRhdG9ycywgUmVhY3RpdmVGb3Jtc01vZHVsZSB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IE1hdEJ1dHRvbiB9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsL2J1dHRvbic7XG5pbXBvcnQgeyBNYXRDYXJkLCBNYXRDYXJkQ29udGVudCB9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsL2NhcmQnO1xuaW1wb3J0IHsgTWF0RGlhbG9nIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwvZGlhbG9nJztcbmltcG9ydCB7IE1hdFByb2dyZXNzQmFyIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwvcHJvZ3Jlc3MtYmFyJztcbmltcG9ydCB7IFJvdXRlciB9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XG5pbXBvcnQgeyBVbnRpbERlc3Ryb3ksIHVudGlsRGVzdHJveWVkIH0gZnJvbSAnQG5nbmVhdC91bnRpbC1kZXN0cm95JztcbmltcG9ydCB7IHNlbGVjdCwgU3RvcmUgfSBmcm9tICdAbmdyeC9zdG9yZSc7XG5pbXBvcnQgeyBUcmFuc2xhdGVTZXJ2aWNlLCBUcmFuc2xhdGVNb2R1bGUgfSBmcm9tICdAbmd4LXRyYW5zbGF0ZS9jb3JlJztcbmltcG9ydCB7XG4gIEJlaGF2aW9yU3ViamVjdCwgZmluYWxpemUsIG5vb3AsIE9ic2VydmFibGUsIG9mLFxufSBmcm9tICdyeGpzJztcbmltcG9ydCB7XG4gIGZpbHRlciwgdGFwLFxufSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBSZXF1aXJlc1JvbGVzRGlyZWN0aXZlIH0gZnJvbSAnYXBwL2RpcmVjdGl2ZXMvcmVxdWlyZXMtcm9sZXMvcmVxdWlyZXMtcm9sZXMuZGlyZWN0aXZlJztcbmltcG9ydCB7IFVpU2VhcmNoRGlyZWN0aXZlIH0gZnJvbSAnYXBwL2RpcmVjdGl2ZXMvdWktc2VhcmNoLmRpcmVjdGl2ZSc7XG5pbXBvcnQgeyBKb2JTdGF0ZSB9IGZyb20gJ2FwcC9lbnVtcy9qb2Itc3RhdGUuZW51bSc7XG5pbXBvcnQgeyBSb2xlIH0gZnJvbSAnYXBwL2VudW1zL3JvbGUuZW51bSc7XG5pbXBvcnQgeyBvYnNlcnZlSm9iIH0gZnJvbSAnYXBwL2hlbHBlcnMvb3BlcmF0b3JzL29ic2VydmUtam9iLm9wZXJhdG9yJztcbmltcG9ydCB7IGhlbHB0ZXh0U3lzdGVtVXBkYXRlIGFzIGhlbHB0ZXh0IH0gZnJvbSAnYXBwL2hlbHB0ZXh0L3N5c3RlbS91cGRhdGUnO1xuaW1wb3J0IHsgQXBpSm9iTWV0aG9kIH0gZnJvbSAnYXBwL2ludGVyZmFjZXMvYXBpL2FwaS1qb2ItZGlyZWN0b3J5LmludGVyZmFjZSc7XG5pbXBvcnQgeyBKb2IgfSBmcm9tICdhcHAvaW50ZXJmYWNlcy9qb2IuaW50ZXJmYWNlJztcbmltcG9ydCB7IE9wdGlvbiB9IGZyb20gJ2FwcC9pbnRlcmZhY2VzL29wdGlvbi5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgRGlhbG9nU2VydmljZSB9IGZyb20gJ2FwcC9tb2R1bGVzL2RpYWxvZy9kaWFsb2cuc2VydmljZSc7XG5pbXBvcnQgeyBJeENoZWNrYm94Q29tcG9uZW50IH0gZnJvbSAnYXBwL21vZHVsZXMvZm9ybXMvaXgtZm9ybXMvY29tcG9uZW50cy9peC1jaGVja2JveC9peC1jaGVja2JveC5jb21wb25lbnQnO1xuaW1wb3J0IHsgSXhGaWVsZHNldENvbXBvbmVudCB9IGZyb20gJ2FwcC9tb2R1bGVzL2Zvcm1zL2l4LWZvcm1zL2NvbXBvbmVudHMvaXgtZmllbGRzZXQvaXgtZmllbGRzZXQuY29tcG9uZW50JztcbmltcG9ydCB7IEl4RmlsZUlucHV0Q29tcG9uZW50IH0gZnJvbSAnYXBwL21vZHVsZXMvZm9ybXMvaXgtZm9ybXMvY29tcG9uZW50cy9peC1maWxlLWlucHV0L2l4LWZpbGUtaW5wdXQuY29tcG9uZW50JztcbmltcG9ydCB7IEl4U2VsZWN0Q29tcG9uZW50IH0gZnJvbSAnYXBwL21vZHVsZXMvZm9ybXMvaXgtZm9ybXMvY29tcG9uZW50cy9peC1zZWxlY3QvaXgtc2VsZWN0LmNvbXBvbmVudCc7XG5pbXBvcnQgeyBzZWxlY3RKb2IgfSBmcm9tICdhcHAvbW9kdWxlcy9qb2JzL3N0b3JlL2pvYi5zZWxlY3RvcnMnO1xuaW1wb3J0IHsgVGVzdERpcmVjdGl2ZSB9IGZyb20gJ2FwcC9tb2R1bGVzL3Rlc3QtaWQvdGVzdC5kaXJlY3RpdmUnO1xuaW1wb3J0IHsgc3lzdGVtTWFudWFsVXBkYXRlRm9ybUVsZW1lbnRzIH0gZnJvbSAnYXBwL3BhZ2VzL3N5c3RlbS91cGRhdGUvY29tcG9uZW50cy9tYW51YWwtdXBkYXRlLWZvcm0vbWFudWFsLXVwZGF0ZS1mb3JtLmVsZW1lbnRzJztcbmltcG9ydCB7IHVwZGF0ZUFnYWluQ29kZSB9IGZyb20gJ2FwcC9wYWdlcy9zeXN0ZW0vdXBkYXRlL3V0aWxzL3VwZGF0ZS1hZ2Fpbi1jb2RlLmNvbnN0YW50JztcbmltcG9ydCB7IEF1dGhTZXJ2aWNlIH0gZnJvbSAnYXBwL3NlcnZpY2VzL2F1dGgvYXV0aC5zZXJ2aWNlJztcbmltcG9ydCB7IEVycm9ySGFuZGxlclNlcnZpY2UgfSBmcm9tICdhcHAvc2VydmljZXMvZXJyb3ItaGFuZGxlci5zZXJ2aWNlJztcbmltcG9ydCB7IFN5c3RlbUdlbmVyYWxTZXJ2aWNlIH0gZnJvbSAnYXBwL3NlcnZpY2VzL3N5c3RlbS1nZW5lcmFsLnNlcnZpY2UnO1xuaW1wb3J0IHsgVXBsb2FkT3B0aW9ucywgVXBsb2FkU2VydmljZSB9IGZyb20gJ2FwcC9zZXJ2aWNlcy91cGxvYWQuc2VydmljZSc7XG5pbXBvcnQgeyBXZWJTb2NrZXRTZXJ2aWNlIH0gZnJvbSAnYXBwL3NlcnZpY2VzL3dzLnNlcnZpY2UnO1xuaW1wb3J0IHsgQXBwU3RhdGUgfSBmcm9tICdhcHAvc3RvcmUnO1xuaW1wb3J0IHsgc2VsZWN0SXNIYUxpY2Vuc2VkIH0gZnJvbSAnYXBwL3N0b3JlL2hhLWluZm8vaGEtaW5mby5zZWxlY3RvcnMnO1xuaW1wb3J0IHsgdXBkYXRlUmVib290QWZ0ZXJNYW51YWxVcGRhdGUgfSBmcm9tICdhcHAvc3RvcmUvcHJlZmVyZW5jZXMvcHJlZmVyZW5jZXMuYWN0aW9ucyc7XG5pbXBvcnQgeyB3YWl0Rm9yUHJlZmVyZW5jZXMgfSBmcm9tICdhcHAvc3RvcmUvcHJlZmVyZW5jZXMvcHJlZmVyZW5jZXMuc2VsZWN0b3JzJztcbmltcG9ydCB7IHdhaXRGb3JTeXN0ZW1JbmZvIH0gZnJvbSAnYXBwL3N0b3JlL3N5c3RlbS1pbmZvL3N5c3RlbS1pbmZvLnNlbGVjdG9ycyc7XG5cbkBVbnRpbERlc3Ryb3koKVxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnaXgtbWFudWFsLXVwZGF0ZS1mb3JtJyxcbiAgdGVtcGxhdGVVcmw6ICcuL21hbnVhbC11cGRhdGUtZm9ybS5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWydtYW51YWwtdXBkYXRlLWZvcm0uY29tcG9uZW50LnNjc3MnXSxcbiAgY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXG4gIHN0YW5kYWxvbmU6IHRydWUsXG4gIGltcG9ydHM6IFtcbiAgICBNYXRDYXJkLFxuICAgIFVpU2VhcmNoRGlyZWN0aXZlLFxuICAgIE1hdENhcmRDb250ZW50LFxuICAgIE1hdFByb2dyZXNzQmFyLFxuICAgIFJlYWN0aXZlRm9ybXNNb2R1bGUsXG4gICAgSXhGaWVsZHNldENvbXBvbmVudCxcbiAgICBJeEZpbGVJbnB1dENvbXBvbmVudCxcbiAgICBJeFNlbGVjdENvbXBvbmVudCxcbiAgICBJeENoZWNrYm94Q29tcG9uZW50LFxuICAgIFJlcXVpcmVzUm9sZXNEaXJlY3RpdmUsXG4gICAgTWF0QnV0dG9uLFxuICAgIFRlc3REaXJlY3RpdmUsXG4gICAgVHJhbnNsYXRlTW9kdWxlLFxuICAgIEFzeW5jUGlwZSxcbiAgXSxcbn0pXG5leHBvcnQgY2xhc3MgTWFudWFsVXBkYXRlRm9ybUNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG4gIHByb3RlY3RlZCByZWFkb25seSByZXF1aXJlZFJvbGVzID0gW1JvbGUuRnVsbEFkbWluXTtcbiAgcHJvdGVjdGVkIHJlYWRvbmx5IHNlYXJjaGFibGVFbGVtZW50cyA9IHN5c3RlbU1hbnVhbFVwZGF0ZUZvcm1FbGVtZW50cztcblxuICBpc0Zvcm1Mb2FkaW5nJCA9IG5ldyBCZWhhdmlvclN1YmplY3QoZmFsc2UpO1xuICBmb3JtID0gdGhpcy5mb3JtQnVpbGRlci5ncm91cCh7XG4gICAgZmlsZWxvY2F0aW9uOiBbJycsIFZhbGlkYXRvcnMucmVxdWlyZWRdLFxuICAgIHVwZGF0ZUZpbGU6IFtudWxsIGFzIEZpbGVMaXN0XSxcbiAgICByZWJvb3RBZnRlck1hbnVhbFVwZGF0ZTogW2ZhbHNlXSxcbiAgfSk7XG5cbiAgcHJpdmF0ZSBhcGlFbmRQb2ludDogc3RyaW5nO1xuXG4gIHJlYWRvbmx5IGhlbHB0ZXh0ID0gaGVscHRleHQ7XG4gIGN1cnJlbnRWZXJzaW9uID0gJyc7XG4gIGZpbGVMb2NhdGlvbk9wdGlvbnMkOiBPYnNlcnZhYmxlPE9wdGlvbltdPjtcblxuICBpc0hhTGljZW5zZWQgPSBmYWxzZTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIGRpYWxvZ1NlcnZpY2U6IERpYWxvZ1NlcnZpY2UsXG4gICAgcHJpdmF0ZSBtYXREaWFsb2c6IE1hdERpYWxvZyxcbiAgICBwcm90ZWN0ZWQgcm91dGVyOiBSb3V0ZXIsXG4gICAgcHVibGljIHN5c3RlbVNlcnZpY2U6IFN5c3RlbUdlbmVyYWxTZXJ2aWNlLFxuICAgIHByaXZhdGUgZm9ybUJ1aWxkZXI6IEZvcm1CdWlsZGVyLFxuICAgIHByaXZhdGUgd3M6IFdlYlNvY2tldFNlcnZpY2UsXG4gICAgcHJpdmF0ZSBlcnJvckhhbmRsZXI6IEVycm9ySGFuZGxlclNlcnZpY2UsXG4gICAgcHJpdmF0ZSBhdXRoU2VydmljZTogQXV0aFNlcnZpY2UsXG4gICAgcHJpdmF0ZSB0cmFuc2xhdGU6IFRyYW5zbGF0ZVNlcnZpY2UsXG4gICAgcHJpdmF0ZSBzdG9yZSQ6IFN0b3JlPEFwcFN0YXRlPixcbiAgICBwcml2YXRlIGNkcjogQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gICAgcHJpdmF0ZSB1cGxvYWQ6IFVwbG9hZFNlcnZpY2UsXG4gICkge1xuICAgIHRoaXMuYXV0aFNlcnZpY2UuYXV0aFRva2VuJC5waXBlKFxuICAgICAgdGFwKCh0b2tlbikgPT4ge1xuICAgICAgICB0aGlzLmFwaUVuZFBvaW50ID0gJy9fdXBsb2FkP2F1dGhfdG9rZW49JyArIHRva2VuO1xuICAgICAgfSksXG4gICAgICB1bnRpbERlc3Ryb3llZCh0aGlzKSxcbiAgICApLnN1YnNjcmliZSgpO1xuICB9XG5cbiAgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgdGhpcy5jaGVja0hhTGljZW5zZUFuZFVwZGF0ZVN0YXR1cygpO1xuICAgIHRoaXMuZ2V0VmVyc2lvbk5vRnJvbVN5c0luZm8oKTtcbiAgICB0aGlzLnNldFBvb2xPcHRpb25zKCk7XG4gICAgdGhpcy5nZXRVc2VyUHJlZnMoKTtcbiAgfVxuXG4gIGdldFVzZXJQcmVmcygpOiB2b2lkIHtcbiAgICB0aGlzLnN0b3JlJC5waXBlKHdhaXRGb3JQcmVmZXJlbmNlcykucGlwZShcbiAgICAgIHRhcCgodXNlclByZWZzKSA9PiB7XG4gICAgICAgIGlmICh1c2VyUHJlZnMucmVib290QWZ0ZXJNYW51YWxVcGRhdGUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgIHVzZXJQcmVmcy5yZWJvb3RBZnRlck1hbnVhbFVwZGF0ZSA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZm9ybS5jb250cm9scy5yZWJvb3RBZnRlck1hbnVhbFVwZGF0ZS5zZXRWYWx1ZSh1c2VyUHJlZnMucmVib290QWZ0ZXJNYW51YWxVcGRhdGUpO1xuICAgICAgfSksXG4gICAgICB1bnRpbERlc3Ryb3llZCh0aGlzKSxcbiAgICApLnN1YnNjcmliZShub29wKTtcbiAgfVxuXG4gIGdldFZlcnNpb25Ob0Zyb21TeXNJbmZvKCk6IHZvaWQge1xuICAgIHRoaXMuc3RvcmUkLnBpcGUod2FpdEZvclN5c3RlbUluZm8sIHVudGlsRGVzdHJveWVkKHRoaXMpKS5zdWJzY3JpYmUoKHN5c0luZm8pID0+IHtcbiAgICAgIHRoaXMuY3VycmVudFZlcnNpb24gPSBzeXNJbmZvLnZlcnNpb247XG4gICAgICB0aGlzLmNkci5tYXJrRm9yQ2hlY2soKTtcbiAgICB9KTtcbiAgfVxuXG4gIHNldFBvb2xPcHRpb25zKCk6IHZvaWQge1xuICAgIHRoaXMud3MuY2FsbCgncG9vbC5xdWVyeScpLnBpcGUodW50aWxEZXN0cm95ZWQodGhpcykpLnN1YnNjcmliZSgocG9vbHMpID0+IHtcbiAgICAgIGlmICghcG9vbHMpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgY29uc3Qgb3B0aW9ucyA9IFt7IGxhYmVsOiB0aGlzLnRyYW5zbGF0ZS5pbnN0YW50KCdNZW1vcnkgZGV2aWNlJyksIHZhbHVlOiAnOnRlbXA6JyB9XTtcbiAgICAgIHBvb2xzLmZvckVhY2goKHBvb2wpID0+IHtcbiAgICAgICAgb3B0aW9ucy5wdXNoKHtcbiAgICAgICAgICBsYWJlbDogJy9tbnQvJyArIHBvb2wubmFtZSwgdmFsdWU6ICcvbW50LycgKyBwb29sLm5hbWUsXG4gICAgICAgIH0pO1xuICAgICAgfSk7XG4gICAgICB0aGlzLmZpbGVMb2NhdGlvbk9wdGlvbnMkID0gb2Yob3B0aW9ucyk7XG4gICAgfSk7XG4gIH1cblxuICBjaGVja0hhTGljZW5zZUFuZFVwZGF0ZVN0YXR1cygpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5zeXN0ZW1TZXJ2aWNlLmlzRW50ZXJwcmlzZSkge1xuICAgICAgdGhpcy5zdG9yZSQuc2VsZWN0KHNlbGVjdElzSGFMaWNlbnNlZCkucGlwZSh1bnRpbERlc3Ryb3llZCh0aGlzKSkuc3Vic2NyaWJlKChpc0hhTGljZW5zZWQpID0+IHtcbiAgICAgICAgdGhpcy5pc0hhTGljZW5zZWQgPSBpc0hhTGljZW5zZWQ7XG4gICAgICAgIHRoaXMuY2hlY2tGb3JVcGRhdGVSdW5uaW5nKCk7XG4gICAgICAgIHRoaXMuY2RyLm1hcmtGb3JDaGVjaygpO1xuXG4gICAgICAgIGlmICh0aGlzLmlzSGFMaWNlbnNlZCkge1xuICAgICAgICAgIHRoaXMuZm9ybS5yZW1vdmVDb250cm9sKCdmaWxlbG9jYXRpb24nKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgY2hlY2tGb3JVcGRhdGVSdW5uaW5nKCk6IHZvaWQge1xuICAgIHRoaXMud3MuY2FsbCgnY29yZS5nZXRfam9icycsIFtbWydtZXRob2QnLCAnPScsICdmYWlsb3Zlci51cGdyYWRlJ10sIFsnc3RhdGUnLCAnPScsIEpvYlN0YXRlLlJ1bm5pbmddXV0pXG4gICAgICAucGlwZSh1bnRpbERlc3Ryb3llZCh0aGlzKSkuc3Vic2NyaWJlKHtcbiAgICAgICAgbmV4dDogKGpvYnMpID0+IHtcbiAgICAgICAgICBpZiAoam9icyAmJiBqb2JzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHRoaXMuc2hvd1J1bm5pbmdVcGRhdGUoam9ic1swXS5pZCk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBlcnJvcjogKGVycikgPT4ge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICB9XG5cbiAgLy8gVE9ETzogU2FtZSBjb2RlIGFzIGluIHVwZGF0ZS1hY3Rpb25zLWNhcmRcbiAgc2hvd1J1bm5pbmdVcGRhdGUoam9iSWQ6IG51bWJlcik6IHZvaWQge1xuICAgIGNvbnN0IGpvYiQgPSB0aGlzLnN0b3JlJC5waXBlKFxuICAgICAgc2VsZWN0KHNlbGVjdEpvYihqb2JJZCkpLFxuICAgICAgb2JzZXJ2ZUpvYigpLFxuICAgICkgYXMgT2JzZXJ2YWJsZTxKb2I8QXBpSm9iTWV0aG9kPj47XG5cbiAgICB0aGlzLmRpYWxvZ1NlcnZpY2Uuam9iRGlhbG9nKFxuICAgICAgam9iJCxcbiAgICAgIHtcbiAgICAgICAgdGl0bGU6IHRoaXMudHJhbnNsYXRlLmluc3RhbnQoJ1VwZGF0ZScpLFxuICAgICAgICBjYW5NaW5pbWl6ZTogdHJ1ZSxcbiAgICAgIH0sXG4gICAgKVxuICAgICAgLmFmdGVyQ2xvc2VkKClcbiAgICAgIC5waXBlKFxuICAgICAgICB0aGlzLmVycm9ySGFuZGxlci5jYXRjaEVycm9yKCksXG4gICAgICAgIHVudGlsRGVzdHJveWVkKHRoaXMpLFxuICAgICAgKVxuICAgICAgLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgIHRoaXMucm91dGVyLm5hdmlnYXRlKFsnL3N5c3RlbS10YXNrcy9yZXN0YXJ0J10sIHsgc2tpcExvY2F0aW9uQ2hhbmdlOiB0cnVlIH0pO1xuICAgICAgfSk7XG4gIH1cblxuICBvblN1Ym1pdCgpOiB2b2lkIHtcbiAgICB0aGlzLmlzRm9ybUxvYWRpbmckLm5leHQodHJ1ZSk7XG4gICAgY29uc3QgdmFsdWUgPSB0aGlzLmZvcm0udmFsdWU7XG4gICAgdmFsdWUuZmlsZWxvY2F0aW9uID0gdmFsdWUuZmlsZWxvY2F0aW9uID09PSAnOnRlbXA6JyA/IG51bGwgOiB2YWx1ZS5maWxlbG9jYXRpb247XG4gICAgdGhpcy5zdG9yZSQuZGlzcGF0Y2godXBkYXRlUmVib290QWZ0ZXJNYW51YWxVcGRhdGUoe1xuICAgICAgcmVib290QWZ0ZXJNYW51YWxVcGRhdGU6IHZhbHVlLnJlYm9vdEFmdGVyTWFudWFsVXBkYXRlLFxuICAgIH0pKTtcbiAgICB0aGlzLnN5c3RlbVNlcnZpY2UudXBkYXRlUnVubmluZ05vdGljZVNlbnQuZW1pdCgpO1xuICAgIHRoaXMuY2RyLm1hcmtGb3JDaGVjaygpO1xuICAgIHRoaXMuc2V0dXBBbmRPcGVuVXBkYXRlSm9iRGlhbG9nKHZhbHVlLnVwZGF0ZUZpbGUsIHZhbHVlLmZpbGVsb2NhdGlvbik7XG4gIH1cblxuICBzZXR1cEFuZE9wZW5VcGRhdGVKb2JEaWFsb2coZmlsZXM6IEZpbGVMaXN0LCBmaWxlTG9jYXRpb246IHN0cmluZyk6IHZvaWQge1xuICAgIGlmICghZmlsZXMubGVuZ3RoKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgcGFyYW1zOiBVcGxvYWRPcHRpb25zID0gdGhpcy5pc0hhTGljZW5zZWRcbiAgICAgID8ge1xuICAgICAgICBtZXRob2Q6ICdmYWlsb3Zlci51cGdyYWRlJyxcbiAgICAgICAgZmlsZTogZmlsZXNbMF0sXG4gICAgICB9XG4gICAgICA6IHtcbiAgICAgICAgbWV0aG9kOiAndXBkYXRlLmZpbGUnLFxuICAgICAgICBwYXJhbXM6IFt7IGRlc3RpbmF0aW9uOiBmaWxlTG9jYXRpb24gfV0sXG4gICAgICAgIGZpbGU6IGZpbGVzWzBdLFxuICAgICAgfTtcblxuICAgIGNvbnN0IGpvYiQgPSB0aGlzLnVwbG9hZC51cGxvYWRBc0pvYihwYXJhbXMpO1xuICAgIHRoaXMuZGlhbG9nU2VydmljZVxuICAgICAgLmpvYkRpYWxvZyhqb2IkLCB7IHRpdGxlOiB0aGlzLnRyYW5zbGF0ZS5pbnN0YW50KGhlbHB0ZXh0Lm1hbnVhbF91cGRhdGVfYWN0aW9uKSB9KVxuICAgICAgLmFmdGVyQ2xvc2VkKClcbiAgICAgIC5waXBlKFxuICAgICAgICBmaW5hbGl6ZSgoKSA9PiB7XG4gICAgICAgICAgdGhpcy5pc0Zvcm1Mb2FkaW5nJC5uZXh0KGZhbHNlKTtcbiAgICAgICAgICB0aGlzLmNkci5tYXJrRm9yQ2hlY2soKTtcbiAgICAgICAgfSksXG4gICAgICAgIHVudGlsRGVzdHJveWVkKHRoaXMpLFxuICAgICAgKVxuICAgICAgLnN1YnNjcmliZSh7XG4gICAgICAgIG5leHQ6ICgpID0+IHRoaXMuaGFuZGxlVXBkYXRlU3VjY2VzcygpLFxuICAgICAgICBlcnJvcjogKGpvYjogSm9iKSA9PiB0aGlzLmhhbmRsZVVwZGF0ZUZhaWx1cmUoam9iKSxcbiAgICAgIH0pO1xuICB9XG5cbiAgZmluaXNoTm9uSGFVcGRhdGUoKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuZm9ybS52YWx1ZS5yZWJvb3RBZnRlck1hbnVhbFVwZGF0ZSkge1xuICAgICAgdGhpcy5yb3V0ZXIubmF2aWdhdGUoWycvc3lzdGVtLXRhc2tzL3Jlc3RhcnQnXSwgeyBza2lwTG9jYXRpb25DaGFuZ2U6IHRydWUgfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuZGlhbG9nU2VydmljZS5jb25maXJtKHtcbiAgICAgICAgdGl0bGU6IHRoaXMudHJhbnNsYXRlLmluc3RhbnQoJ1Jlc3RhcnQnKSxcbiAgICAgICAgbWVzc2FnZTogdGhpcy50cmFuc2xhdGUuaW5zdGFudChoZWxwdGV4dC5yZWJvb3RBZnRlck1hbnVhbFVwZGF0ZS5tYW51YWxfcmVib290X21zZyksXG4gICAgICB9KS5waXBlKFxuICAgICAgICBmaWx0ZXIoQm9vbGVhbiksXG4gICAgICAgIHVudGlsRGVzdHJveWVkKHRoaXMpLFxuICAgICAgKS5zdWJzY3JpYmUoKCkgPT4gdGhpcy5yb3V0ZXIubmF2aWdhdGUoWycvc3lzdGVtLXRhc2tzL3Jlc3RhcnQnXSwgeyBza2lwTG9jYXRpb25DaGFuZ2U6IHRydWUgfSkpO1xuICAgIH1cbiAgfVxuXG4gIGZpbmlzaEhhVXBkYXRlKCk6IHZvaWQge1xuICAgIHRoaXMuZGlhbG9nU2VydmljZS5jbG9zZUFsbERpYWxvZ3MoKTtcbiAgICB0aGlzLnN5c3RlbVNlcnZpY2UudXBkYXRlRG9uZSgpOyAvLyBTZW5kICdmaW5pc2hlZCcgc2lnbmFsIHRvIHRvcGJhclxuICAgIHRoaXMuY2RyLm1hcmtGb3JDaGVjaygpO1xuICAgIHRoaXMucm91dGVyLm5hdmlnYXRlKFsnLyddKTtcbiAgICB0aGlzLmRpYWxvZ1NlcnZpY2UuY29uZmlybSh7XG4gICAgICB0aXRsZTogaGVscHRleHQuaGFfdXBkYXRlLmNvbXBsZXRlX3RpdGxlLFxuICAgICAgbWVzc2FnZTogaGVscHRleHQuaGFfdXBkYXRlLmNvbXBsZXRlX21zZyxcbiAgICAgIGhpZGVDaGVja2JveDogdHJ1ZSxcbiAgICAgIGJ1dHRvblRleHQ6IGhlbHB0ZXh0LmhhX3VwZGF0ZS5jb21wbGV0ZV9hY3Rpb24sXG4gICAgICBoaWRlQ2FuY2VsOiB0cnVlLFxuICAgIH0pLnBpcGUodW50aWxEZXN0cm95ZWQodGhpcykpLnN1YnNjcmliZSgoKSA9PiB7fSk7XG4gIH1cblxuICBoYW5kbGVVcGRhdGVTdWNjZXNzKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLmlzSGFMaWNlbnNlZCkge1xuICAgICAgdGhpcy5maW5pc2hIYVVwZGF0ZSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmZpbmlzaE5vbkhhVXBkYXRlKCk7XG4gICAgfVxuICB9XG5cbiAgaGFuZGxlVXBkYXRlRmFpbHVyZSA9IChmYWlsdXJlOiBKb2IpOiB2b2lkID0+IHtcbiAgICB0aGlzLmlzRm9ybUxvYWRpbmckLm5leHQoZmFsc2UpO1xuICAgIHRoaXMuY2RyLm1hcmtGb3JDaGVjaygpO1xuICAgIGlmIChmYWlsdXJlLmVycm9yLmluY2x1ZGVzKHVwZGF0ZUFnYWluQ29kZSkpIHtcbiAgICAgIHRoaXMuZGlhbG9nU2VydmljZS5jb25maXJtKHtcbiAgICAgICAgdGl0bGU6IGhlbHB0ZXh0LmNvbnRpbnVlRGlhbG9nVGl0bGUsXG4gICAgICAgIG1lc3NhZ2U6IGZhaWx1cmUuZXJyb3IucmVwbGFjZSh1cGRhdGVBZ2FpbkNvZGUsICcnKSxcbiAgICAgICAgYnV0dG9uVGV4dDogaGVscHRleHQuY29udGludWVEaWFsb2dBY3Rpb24sXG4gICAgICB9KS5waXBlKFxuICAgICAgICBmaWx0ZXIoQm9vbGVhbiksXG4gICAgICAgIHVudGlsRGVzdHJveWVkKHRoaXMpLFxuICAgICAgKS5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICB0aGlzLnJlc3VtZVVwZGF0ZUFmdGVyRmFpbHVyZSgpO1xuICAgICAgfSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuZGlhbG9nU2VydmljZS5lcnJvcih0aGlzLmVycm9ySGFuZGxlci5wYXJzZUVycm9yKGZhaWx1cmUpKTtcbiAgfTtcblxuICBwcml2YXRlIHJlc3VtZVVwZGF0ZUFmdGVyRmFpbHVyZSgpOiB2b2lkIHtcbiAgICBjb25zdCBqb2IkOiBPYnNlcnZhYmxlPEpvYj4gPSB0aGlzLmlzSGFMaWNlbnNlZFxuICAgICAgPyB0aGlzLndzLmpvYignZmFpbG92ZXIudXBncmFkZScsIFt7IHJlc3VtZTogdHJ1ZSwgcmVzdW1lX21hbnVhbDogdHJ1ZSB9XSlcbiAgICAgIDogdGhpcy53cy5qb2IoJ3VwZGF0ZS5maWxlJywgW3sgcmVzdW1lOiB0cnVlIH1dKTtcblxuICAgIHRoaXMuZGlhbG9nU2VydmljZVxuICAgICAgLmpvYkRpYWxvZyhqb2IkLCB7IHRpdGxlOiBoZWxwdGV4dC5tYW51YWxfdXBkYXRlX2FjdGlvbiB9KVxuICAgICAgLmFmdGVyQ2xvc2VkKClcbiAgICAgIC5waXBlKHVudGlsRGVzdHJveWVkKHRoaXMpKVxuICAgICAgLnN1YnNjcmliZSh7XG4gICAgICAgIG5leHQ6ICgpID0+IHRoaXMuaGFuZGxlVXBkYXRlU3VjY2VzcygpLFxuICAgICAgICBlcnJvcjogKGpvYjogSm9iKSA9PiB0aGlzLmhhbmRsZVVwZGF0ZUZhaWx1cmUoam9iKSxcbiAgICAgIH0pO1xuICB9XG59XG4iXSwidmVyc2lvbiI6M30=