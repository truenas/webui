{"file":"/Users/macbook/karpov-work/TrueNAS/webui/src/app/pages/system/bootenv/boot-pool-delete-dialog/boot-pool-delete-dialog.component.ts","mappings":"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","names":[],"sources":["/Users/macbook/karpov-work/TrueNAS/webui/src/app/pages/system/bootenv/boot-pool-delete-dialog/boot-pool-delete-dialog.component.ts"],"sourcesContent":["import { KeyValue, KeyValuePipe } from '@angular/common';\nimport {\n  ChangeDetectionStrategy, ChangeDetectorRef, Component, Inject, TrackByFunction,\n} from '@angular/core';\nimport { Validators, FormBuilder, ReactiveFormsModule } from '@angular/forms';\nimport { MatButton } from '@angular/material/button';\nimport {\n  MatDialogRef, MAT_DIALOG_DATA, MatDialogTitle, MatDialogClose,\n} from '@angular/material/dialog';\nimport { UntilDestroy, untilDestroyed } from '@ngneat/until-destroy';\nimport { TranslateModule } from '@ngx-translate/core';\nimport { filter } from 'rxjs/operators';\nimport { RequiresRolesDirective } from 'app/directives/requires-roles/requires-roles.directive';\nimport { Role } from 'app/enums/role.enum';\nimport { Bootenv } from 'app/interfaces/bootenv.interface';\nimport { CoreBulkResponse } from 'app/interfaces/core-bulk.interface';\nimport { Job } from 'app/interfaces/job.interface';\nimport { IxCheckboxComponent } from 'app/modules/forms/ix-forms/components/ix-checkbox/ix-checkbox.component';\nimport { BulkListItemComponent } from 'app/modules/lists/bulk-list-item/bulk-list-item.component';\nimport { BulkListItem, BulkListItemState } from 'app/modules/lists/bulk-list-item/bulk-list-item.interface';\nimport { TestDirective } from 'app/modules/test-id/test.directive';\nimport { WebSocketService } from 'app/services/ws.service';\n\n@UntilDestroy()\n@Component({\n  selector: 'ix-boot-pool-delete-dialog',\n  templateUrl: './boot-pool-delete-dialog.component.html',\n  styleUrls: ['./boot-pool-delete-dialog.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    MatDialogTitle,\n    ReactiveFormsModule,\n    BulkListItemComponent,\n    IxCheckboxComponent,\n    RequiresRolesDirective,\n    MatButton,\n    TestDirective,\n    MatDialogClose,\n    TranslateModule,\n    KeyValuePipe,\n  ],\n})\nexport class BootPoolDeleteDialogComponent {\n  readonly requiredRoles = [Role.FullAdmin];\n\n  form = this.fb.group({\n    confirm: [false, [Validators.requiredTrue]],\n  });\n  isJobCompleted = false;\n  bulkItems = new Map<string, BulkListItem<Bootenv>>();\n\n  get successCount(): number {\n    return [...this.bulkItems.values()].filter((item) => item.state === BulkListItemState.Success).length;\n  }\n  get failedCount(): number {\n    return [...this.bulkItems.values()].filter((item) => item.state === BulkListItemState.Error).length;\n  }\n  readonly trackByKey: TrackByFunction<KeyValue<string, BulkListItem<Bootenv>>> = (_, entry) => entry.key;\n\n  constructor(\n    private fb: FormBuilder,\n    private ws: WebSocketService,\n    private cdr: ChangeDetectorRef,\n    private dialogRef: MatDialogRef<BootPoolDeleteDialogComponent>,\n    @Inject(MAT_DIALOG_DATA) public bootenvs: Bootenv[],\n  ) {\n    this.bootenvs.forEach((bootenv) => {\n      this.bulkItems.set(bootenv.id, { state: BulkListItemState.Initial, item: bootenv });\n    });\n  }\n\n  getSelectedNames(selectedBootenvs: Bootenv[]): string[][] {\n    return selectedBootenvs.map((bootenv) => [bootenv.id]);\n  }\n\n  onSubmit(): void {\n    const bootenvsToDelete = this.getSelectedNames(this.bootenvs);\n\n    this.bootenvs.forEach((bootenv) => {\n      this.bulkItems.set(bootenv.id, { state: BulkListItemState.Running, item: bootenv });\n    });\n\n    this.ws.job('core.bulk', ['bootenv.do_delete', bootenvsToDelete]).pipe(\n      filter((job: Job<CoreBulkResponse<void>[], string[][]>) => !!job.result),\n      untilDestroyed(this),\n    ).subscribe((response) => {\n      response.arguments[1].forEach((params, index: number) => {\n        const [bootenvId] = params.toString().split(',');\n        const bulkItem = this.bulkItems.get(bootenvId);\n        if (bulkItem) {\n          const item = response.result[index];\n          if (item.error) {\n            this.bulkItems.set(bootenvId, {\n              ...bulkItem,\n              state: BulkListItemState.Error,\n              message: item.error\n                .replace('[EFAULT]', '')\n                .replace('\\')', ''),\n            });\n          } else {\n            this.bulkItems.set(bootenvId, {\n              ...bulkItem,\n              state: BulkListItemState.Success,\n              message: null,\n            });\n            if (this.bulkItems.size === 1) {\n              this.dialogRef.close(true);\n            }\n          }\n        }\n      });\n      this.isJobCompleted = true;\n      this.cdr.markForCheck();\n    });\n  }\n}\n"],"version":3}