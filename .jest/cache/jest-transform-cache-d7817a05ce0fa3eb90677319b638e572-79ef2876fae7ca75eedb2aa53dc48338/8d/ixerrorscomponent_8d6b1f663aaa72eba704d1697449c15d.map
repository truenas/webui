{"file":"/Users/macbook/karpov-work/TrueNAS/webui/src/app/modules/forms/ix-forms/components/ix-errors/ix-errors.component.ts","mappings":"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","names":[],"sources":["/Users/macbook/karpov-work/TrueNAS/webui/src/app/modules/forms/ix-forms/components/ix-errors/ix-errors.component.ts"],"sourcesContent":["import {\n  ChangeDetectionStrategy, ChangeDetectorRef, Component, Input, OnChanges,\n} from '@angular/core';\nimport { AbstractControl, ValidationErrors } from '@angular/forms';\nimport { MatError } from '@angular/material/form-field';\nimport { MatTooltip } from '@angular/material/tooltip';\nimport { UntilDestroy, untilDestroyed } from '@ngneat/until-destroy';\nimport { TranslateService, TranslateModule } from '@ngx-translate/core';\nimport { Subscription } from 'rxjs';\nimport { filter } from 'rxjs/operators';\nimport { DefaultValidationError } from 'app/enums/default-validation-error.enum';\nimport { IxSimpleChanges } from 'app/interfaces/simple-changes.interface';\nimport { IxIconComponent } from 'app/modules/ix-icon/ix-icon.component';\n\ntype SomeError = Record<string, unknown>;\n\nexport const ixManualValidateError = 'ixManualValidateError';\n\n@UntilDestroy()\n@Component({\n  selector: 'ix-errors',\n  templateUrl: './ix-errors.component.html',\n  styleUrls: ['./ix-errors.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    MatError,\n    IxIconComponent,\n    MatTooltip,\n    TranslateModule,\n  ],\n})\nexport class IxErrorsComponent implements OnChanges {\n  @Input() control: AbstractControl;\n  @Input() label: string;\n  readonly ixManualValidateError = ixManualValidateError;\n\n  private statusChangeSubscription: Subscription;\n  messages: string[] = [];\n\n  readonly defaultErrMessages = {\n    min: (min: number) => this.translate.instant('Minimum value is {min}', { min }),\n    max: (max: number) => this.translate.instant('Maximum value is {max}', { max }),\n    required: () => {\n      if (this.label) {\n        return this.translate.instant('{field} is required', { field: this.label });\n      }\n\n      return this.translate.instant('Field is required');\n    },\n    email: () => this.translate.instant('Value must be a valid email address'),\n    minlength: (minLength: number) => this.translate.instant(\n      this.label\n        ? 'The length of {field} should be at least {minLength}'\n        : 'The length of the field should be at least {minLength}',\n      { field: this.label, minLength },\n    ),\n    maxlength: (maxLength: number) => this.translate.instant(\n      this.label\n        ? 'The length of {field} should be no more than {maxLength}'\n        : 'The length of the field should be no more than {maxLength}',\n      { field: this.label, maxLength },\n    ),\n    pattern: () => this.translate.instant('Invalid format or character'),\n    forbidden: (value: string) => this.translate.instant('The name \"{value}\" is already in use.', { value }),\n    range: (min: number, max: number) => this.translate.instant(\n      'The value is out of range. Enter a value between {min} and {max}.',\n      { min, max },\n    ),\n    number: () => this.translate.instant('Value must be a number'),\n    cron: () => this.translate.instant('Invalid cron expression'),\n    ip2: () => this.translate.instant('Invalid IP address'),\n  };\n\n  constructor(\n    private translate: TranslateService,\n    private cdr: ChangeDetectorRef,\n  ) {}\n\n  ngOnChanges(changes: IxSimpleChanges<this>): void {\n    if ('control' in changes && this.control) {\n      // This manually works around: https://github.com/angular/angular/issues/10816\n      this.statusChangeSubscription?.unsubscribe();\n      this.statusChangeSubscription = this.control.statusChanges.pipe(\n        filter((status) => status !== 'PENDING'),\n        untilDestroyed(this),\n      ).subscribe(() => {\n        const newErrors: (string | null)[] = Object.keys(this.control.errors || []).map((error) => {\n          if (error === ixManualValidateError) {\n            return null;\n          }\n          const message = (this.control.errors?.[error] as SomeError)?.message as string;\n          if (message) {\n            return message;\n          }\n\n          return this.getDefaultError(error as DefaultValidationError);\n        });\n\n        // eslint-disable-next-line @typescript-eslint/no-unnecessary-type-assertion\n        this.messages = newErrors.filter((message) => !!message) as string[];\n\n        if (this.control.errors) {\n          this.control.markAllAsTouched();\n        }\n\n        this.cdr.markForCheck();\n      });\n    }\n  }\n\n  /**\n   * This method takes in an error type and returns a default error\n   * message\n   * @param error The name of the error on control e.g., 'required'\n   * @returns A default error message for the error type\n   */\n  getDefaultError(error: DefaultValidationError): string {\n    // eslint-disable-next-line\n    const errors = this.control.errors as ValidationErrors;\n    switch (error) {\n      case DefaultValidationError.Min:\n        return this.defaultErrMessages.min((errors.min as SomeError).min as number);\n      case DefaultValidationError.Max:\n        return this.defaultErrMessages.max((errors.max as SomeError).max as number);\n      case DefaultValidationError.Required:\n        return this.defaultErrMessages.required();\n      case DefaultValidationError.Email:\n        return this.defaultErrMessages.email();\n      case DefaultValidationError.MinLength:\n        return this.defaultErrMessages.minlength((errors.minlength as SomeError).requiredLength as number);\n      case DefaultValidationError.MaxLength:\n        return this.defaultErrMessages.maxlength((errors.maxlength as SomeError).requiredLength as number);\n      case DefaultValidationError.Range:\n        return this.defaultErrMessages.range(\n          (errors.rangeValue as SomeError).min as number,\n          (errors.rangeValue as SomeError).max as number,\n        );\n      case DefaultValidationError.Pattern:\n        return this.defaultErrMessages.pattern();\n      case DefaultValidationError.Forbidden:\n        return this.defaultErrMessages.forbidden(errors.value as string);\n      case DefaultValidationError.Number:\n        return this.defaultErrMessages.number();\n      case DefaultValidationError.Cron:\n        return this.defaultErrMessages.cron();\n      case DefaultValidationError.Ip2:\n        return this.defaultErrMessages.ip2();\n      default:\n        return '';\n    }\n  }\n\n  removeManualError(): void {\n    if (this.control.errors) {\n      delete this.control.errors[ixManualValidateError];\n      delete this.control.errors.manualValidateError;\n      delete this.control.errors.manualValidateErrorMsg;\n    }\n    this.control.updateValueAndValidity();\n    this.cdr.markForCheck();\n  }\n\n  // TODO: Workaround for https://github.com/angular/angular/issues/56471\n  protected trackMessage(message: string): string {\n    return message;\n  }\n}\n"],"version":3}