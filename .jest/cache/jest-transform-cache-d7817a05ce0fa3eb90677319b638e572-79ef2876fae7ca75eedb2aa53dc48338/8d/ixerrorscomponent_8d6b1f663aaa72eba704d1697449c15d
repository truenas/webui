3ea9da58ba1faac39ea0aff61fe58313
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.IxErrorsComponent = exports.ixManualValidateError = void 0;
const core_1 = require("@angular/core");
const form_field_1 = require("@angular/material/form-field");
const tooltip_1 = require("@angular/material/tooltip");
const until_destroy_1 = require("@ngneat/until-destroy");
const core_2 = require("@ngx-translate/core");
const operators_1 = require("rxjs/operators");
const default_validation_error_enum_1 = require("app/enums/default-validation-error.enum");
const ix_icon_component_1 = require("app/modules/ix-icon/ix-icon.component");
exports.ixManualValidateError = 'ixManualValidateError';
let IxErrorsComponent = class IxErrorsComponent {
    constructor(translate, cdr) {
        this.translate = translate;
        this.cdr = cdr;
        this.ixManualValidateError = exports.ixManualValidateError;
        this.messages = [];
        this.defaultErrMessages = {
            min: (min) => this.translate.instant('Minimum value is {min}', { min }),
            max: (max) => this.translate.instant('Maximum value is {max}', { max }),
            required: () => {
                if (this.label) {
                    return this.translate.instant('{field} is required', { field: this.label });
                }
                return this.translate.instant('Field is required');
            },
            email: () => this.translate.instant('Value must be a valid email address'),
            minlength: (minLength) => this.translate.instant(this.label
                ? 'The length of {field} should be at least {minLength}'
                : 'The length of the field should be at least {minLength}', { field: this.label, minLength }),
            maxlength: (maxLength) => this.translate.instant(this.label
                ? 'The length of {field} should be no more than {maxLength}'
                : 'The length of the field should be no more than {maxLength}', { field: this.label, maxLength }),
            pattern: () => this.translate.instant('Invalid format or character'),
            forbidden: (value) => this.translate.instant('The name "{value}" is already in use.', { value }),
            range: (min, max) => this.translate.instant('The value is out of range. Enter a value between {min} and {max}.', { min, max }),
            number: () => this.translate.instant('Value must be a number'),
            cron: () => this.translate.instant('Invalid cron expression'),
            ip2: () => this.translate.instant('Invalid IP address'),
        };
    }
    ngOnChanges(changes) {
        var _a;
        if ('control' in changes && this.control) {
            // This manually works around: https://github.com/angular/angular/issues/10816
            (_a = this.statusChangeSubscription) === null || _a === void 0 ? void 0 : _a.unsubscribe();
            this.statusChangeSubscription = this.control.statusChanges.pipe((0, operators_1.filter)((status) => status !== 'PENDING'), (0, until_destroy_1.untilDestroyed)(this)).subscribe(() => {
                const newErrors = Object.keys(this.control.errors || []).map((error) => {
                    var _a, _b;
                    if (error === exports.ixManualValidateError) {
                        return null;
                    }
                    const message = (_b = (_a = this.control.errors) === null || _a === void 0 ? void 0 : _a[error]) === null || _b === void 0 ? void 0 : _b.message;
                    if (message) {
                        return message;
                    }
                    return this.getDefaultError(error);
                });
                // eslint-disable-next-line @typescript-eslint/no-unnecessary-type-assertion
                this.messages = newErrors.filter((message) => !!message);
                if (this.control.errors) {
                    this.control.markAllAsTouched();
                }
                this.cdr.markForCheck();
            });
        }
    }
    /**
     * This method takes in an error type and returns a default error
     * message
     * @param error The name of the error on control e.g., 'required'
     * @returns A default error message for the error type
     */
    getDefaultError(error) {
        // eslint-disable-next-line
        const errors = this.control.errors;
        switch (error) {
            case default_validation_error_enum_1.DefaultValidationError.Min:
                return this.defaultErrMessages.min(errors.min.min);
            case default_validation_error_enum_1.DefaultValidationError.Max:
                return this.defaultErrMessages.max(errors.max.max);
            case default_validation_error_enum_1.DefaultValidationError.Required:
                return this.defaultErrMessages.required();
            case default_validation_error_enum_1.DefaultValidationError.Email:
                return this.defaultErrMessages.email();
            case default_validation_error_enum_1.DefaultValidationError.MinLength:
                return this.defaultErrMessages.minlength(errors.minlength.requiredLength);
            case default_validation_error_enum_1.DefaultValidationError.MaxLength:
                return this.defaultErrMessages.maxlength(errors.maxlength.requiredLength);
            case default_validation_error_enum_1.DefaultValidationError.Range:
                return this.defaultErrMessages.range(errors.rangeValue.min, errors.rangeValue.max);
            case default_validation_error_enum_1.DefaultValidationError.Pattern:
                return this.defaultErrMessages.pattern();
            case default_validation_error_enum_1.DefaultValidationError.Forbidden:
                return this.defaultErrMessages.forbidden(errors.value);
            case default_validation_error_enum_1.DefaultValidationError.Number:
                return this.defaultErrMessages.number();
            case default_validation_error_enum_1.DefaultValidationError.Cron:
                return this.defaultErrMessages.cron();
            case default_validation_error_enum_1.DefaultValidationError.Ip2:
                return this.defaultErrMessages.ip2();
            default:
                return '';
        }
    }
    removeManualError() {
        if (this.control.errors) {
            delete this.control.errors[exports.ixManualValidateError];
            delete this.control.errors.manualValidateError;
            delete this.control.errors.manualValidateErrorMsg;
        }
        this.control.updateValueAndValidity();
        this.cdr.markForCheck();
    }
    // TODO: Workaround for https://github.com/angular/angular/issues/56471
    trackMessage(message) {
        return message;
    }
};
exports.IxErrorsComponent = IxErrorsComponent;
IxErrorsComponent.ctorParameters = () => [
    { type: core_2.TranslateService },
    { type: core_1.ChangeDetectorRef }
];
IxErrorsComponent.propDecorators = {
    control: [{ type: core_1.Input }],
    label: [{ type: core_1.Input }]
};
exports.IxErrorsComponent = IxErrorsComponent = __decorate([
    (0, until_destroy_1.UntilDestroy)(),
    (0, core_1.Component)({
        selector: 'ix-errors',
        template: require("./ix-errors.component.html"),
        changeDetection: core_1.ChangeDetectionStrategy.OnPush,
        standalone: true,
        imports: [
            form_field_1.MatError,
            ix_icon_component_1.IxIconComponent,
            tooltip_1.MatTooltip,
            core_2.TranslateModule,
        ],
    })
], IxErrorsComponent);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL21hY2Jvb2sva2FycG92LXdvcmsvVHJ1ZU5BUy93ZWJ1aS9zcmMvYXBwL21vZHVsZXMvZm9ybXMvaXgtZm9ybXMvY29tcG9uZW50cy9peC1lcnJvcnMvaXgtZXJyb3JzLmNvbXBvbmVudC50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQSx3Q0FFdUI7QUFFdkIsNkRBQXdEO0FBQ3hELHVEQUF1RDtBQUN2RCx5REFBcUU7QUFDckUsOENBQXdFO0FBRXhFLDhDQUF3QztBQUN4QywyRkFBaUY7QUFFakYsNkVBQXdFO0FBSTNELFFBQUEscUJBQXFCLEdBQUcsdUJBQXVCLENBQUM7QUFnQnRELElBQU0saUJBQWlCLEdBQXZCLE1BQU0saUJBQWlCO0lBMEM1QixZQUNVLFNBQTJCLEVBQzNCLEdBQXNCO1FBRHRCLGNBQVMsR0FBVCxTQUFTLENBQWtCO1FBQzNCLFFBQUcsR0FBSCxHQUFHLENBQW1CO1FBekN2QiwwQkFBcUIsR0FBRyw2QkFBcUIsQ0FBQztRQUd2RCxhQUFRLEdBQWEsRUFBRSxDQUFDO1FBRWYsdUJBQWtCLEdBQUc7WUFDNUIsR0FBRyxFQUFFLENBQUMsR0FBVyxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyx3QkFBd0IsRUFBRSxFQUFFLEdBQUcsRUFBRSxDQUFDO1lBQy9FLEdBQUcsRUFBRSxDQUFDLEdBQVcsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsd0JBQXdCLEVBQUUsRUFBRSxHQUFHLEVBQUUsQ0FBQztZQUMvRSxRQUFRLEVBQUUsR0FBRyxFQUFFO2dCQUNiLElBQUksSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO29CQUNmLE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMscUJBQXFCLEVBQUUsRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDLENBQUM7Z0JBQzlFLENBQUM7Z0JBRUQsT0FBTyxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO1lBQ3JELENBQUM7WUFDRCxLQUFLLEVBQUUsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMscUNBQXFDLENBQUM7WUFDMUUsU0FBUyxFQUFFLENBQUMsU0FBaUIsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQ3RELElBQUksQ0FBQyxLQUFLO2dCQUNSLENBQUMsQ0FBQyxzREFBc0Q7Z0JBQ3hELENBQUMsQ0FBQyx3REFBd0QsRUFDNUQsRUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDLEtBQUssRUFBRSxTQUFTLEVBQUUsQ0FDakM7WUFDRCxTQUFTLEVBQUUsQ0FBQyxTQUFpQixFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FDdEQsSUFBSSxDQUFDLEtBQUs7Z0JBQ1IsQ0FBQyxDQUFDLDBEQUEwRDtnQkFDNUQsQ0FBQyxDQUFDLDREQUE0RCxFQUNoRSxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsS0FBSyxFQUFFLFNBQVMsRUFBRSxDQUNqQztZQUNELE9BQU8sRUFBRSxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyw2QkFBNkIsQ0FBQztZQUNwRSxTQUFTLEVBQUUsQ0FBQyxLQUFhLEVBQUUsRUFBRSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLHVDQUF1QyxFQUFFLEVBQUUsS0FBSyxFQUFFLENBQUM7WUFDeEcsS0FBSyxFQUFFLENBQUMsR0FBVyxFQUFFLEdBQVcsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQ3pELG1FQUFtRSxFQUNuRSxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsQ0FDYjtZQUNELE1BQU0sRUFBRSxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyx3QkFBd0IsQ0FBQztZQUM5RCxJQUFJLEVBQUUsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMseUJBQXlCLENBQUM7WUFDN0QsR0FBRyxFQUFFLEdBQUcsRUFBRSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLG9CQUFvQixDQUFDO1NBQ3hELENBQUM7SUFLQyxDQUFDO0lBRUosV0FBVyxDQUFDLE9BQThCOztRQUN4QyxJQUFJLFNBQVMsSUFBSSxPQUFPLElBQUksSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDO1lBQ3pDLDhFQUE4RTtZQUM5RSxNQUFBLElBQUksQ0FBQyx3QkFBd0IsMENBQUUsV0FBVyxFQUFFLENBQUM7WUFDN0MsSUFBSSxDQUFDLHdCQUF3QixHQUFHLElBQUksQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDLElBQUksQ0FDN0QsSUFBQSxrQkFBTSxFQUFDLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyxNQUFNLEtBQUssU0FBUyxDQUFDLEVBQ3hDLElBQUEsOEJBQWMsRUFBQyxJQUFJLENBQUMsQ0FDckIsQ0FBQyxTQUFTLENBQUMsR0FBRyxFQUFFO2dCQUNmLE1BQU0sU0FBUyxHQUFzQixNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxJQUFJLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEtBQUssRUFBRSxFQUFFOztvQkFDeEYsSUFBSSxLQUFLLEtBQUssNkJBQXFCLEVBQUUsQ0FBQzt3QkFDcEMsT0FBTyxJQUFJLENBQUM7b0JBQ2QsQ0FBQztvQkFDRCxNQUFNLE9BQU8sR0FBRyxNQUFDLE1BQUEsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLDBDQUFHLEtBQUssQ0FBZSwwQ0FBRSxPQUFpQixDQUFDO29CQUMvRSxJQUFJLE9BQU8sRUFBRSxDQUFDO3dCQUNaLE9BQU8sT0FBTyxDQUFDO29CQUNqQixDQUFDO29CQUVELE9BQU8sSUFBSSxDQUFDLGVBQWUsQ0FBQyxLQUErQixDQUFDLENBQUM7Z0JBQy9ELENBQUMsQ0FBQyxDQUFDO2dCQUVILDRFQUE0RTtnQkFDNUUsSUFBSSxDQUFDLFFBQVEsR0FBRyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUMsT0FBTyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFhLENBQUM7Z0JBRXJFLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLEVBQUUsQ0FBQztvQkFDeEIsSUFBSSxDQUFDLE9BQU8sQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO2dCQUNsQyxDQUFDO2dCQUVELElBQUksQ0FBQyxHQUFHLENBQUMsWUFBWSxFQUFFLENBQUM7WUFDMUIsQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDO0lBQ0gsQ0FBQztJQUVEOzs7OztPQUtHO0lBQ0gsZUFBZSxDQUFDLEtBQTZCO1FBQzNDLDJCQUEyQjtRQUMzQixNQUFNLE1BQU0sR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQTBCLENBQUM7UUFDdkQsUUFBUSxLQUFLLEVBQUUsQ0FBQztZQUNkLEtBQUssc0RBQXNCLENBQUMsR0FBRztnQkFDN0IsT0FBTyxJQUFJLENBQUMsa0JBQWtCLENBQUMsR0FBRyxDQUFFLE1BQU0sQ0FBQyxHQUFpQixDQUFDLEdBQWEsQ0FBQyxDQUFDO1lBQzlFLEtBQUssc0RBQXNCLENBQUMsR0FBRztnQkFDN0IsT0FBTyxJQUFJLENBQUMsa0JBQWtCLENBQUMsR0FBRyxDQUFFLE1BQU0sQ0FBQyxHQUFpQixDQUFDLEdBQWEsQ0FBQyxDQUFDO1lBQzlFLEtBQUssc0RBQXNCLENBQUMsUUFBUTtnQkFDbEMsT0FBTyxJQUFJLENBQUMsa0JBQWtCLENBQUMsUUFBUSxFQUFFLENBQUM7WUFDNUMsS0FBSyxzREFBc0IsQ0FBQyxLQUFLO2dCQUMvQixPQUFPLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxLQUFLLEVBQUUsQ0FBQztZQUN6QyxLQUFLLHNEQUFzQixDQUFDLFNBQVM7Z0JBQ25DLE9BQU8sSUFBSSxDQUFDLGtCQUFrQixDQUFDLFNBQVMsQ0FBRSxNQUFNLENBQUMsU0FBdUIsQ0FBQyxjQUF3QixDQUFDLENBQUM7WUFDckcsS0FBSyxzREFBc0IsQ0FBQyxTQUFTO2dCQUNuQyxPQUFPLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxTQUFTLENBQUUsTUFBTSxDQUFDLFNBQXVCLENBQUMsY0FBd0IsQ0FBQyxDQUFDO1lBQ3JHLEtBQUssc0RBQXNCLENBQUMsS0FBSztnQkFDL0IsT0FBTyxJQUFJLENBQUMsa0JBQWtCLENBQUMsS0FBSyxDQUNqQyxNQUFNLENBQUMsVUFBd0IsQ0FBQyxHQUFhLEVBQzdDLE1BQU0sQ0FBQyxVQUF3QixDQUFDLEdBQWEsQ0FDL0MsQ0FBQztZQUNKLEtBQUssc0RBQXNCLENBQUMsT0FBTztnQkFDakMsT0FBTyxJQUFJLENBQUMsa0JBQWtCLENBQUMsT0FBTyxFQUFFLENBQUM7WUFDM0MsS0FBSyxzREFBc0IsQ0FBQyxTQUFTO2dCQUNuQyxPQUFPLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLEtBQWUsQ0FBQyxDQUFDO1lBQ25FLEtBQUssc0RBQXNCLENBQUMsTUFBTTtnQkFDaEMsT0FBTyxJQUFJLENBQUMsa0JBQWtCLENBQUMsTUFBTSxFQUFFLENBQUM7WUFDMUMsS0FBSyxzREFBc0IsQ0FBQyxJQUFJO2dCQUM5QixPQUFPLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLEVBQUUsQ0FBQztZQUN4QyxLQUFLLHNEQUFzQixDQUFDLEdBQUc7Z0JBQzdCLE9BQU8sSUFBSSxDQUFDLGtCQUFrQixDQUFDLEdBQUcsRUFBRSxDQUFDO1lBQ3ZDO2dCQUNFLE9BQU8sRUFBRSxDQUFDO1FBQ2QsQ0FBQztJQUNILENBQUM7SUFFRCxpQkFBaUI7UUFDZixJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFFLENBQUM7WUFDeEIsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyw2QkFBcUIsQ0FBQyxDQUFDO1lBQ2xELE9BQU8sSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsbUJBQW1CLENBQUM7WUFDL0MsT0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sQ0FBQyxzQkFBc0IsQ0FBQztRQUNwRCxDQUFDO1FBQ0QsSUFBSSxDQUFDLE9BQU8sQ0FBQyxzQkFBc0IsRUFBRSxDQUFDO1FBQ3RDLElBQUksQ0FBQyxHQUFHLENBQUMsWUFBWSxFQUFFLENBQUM7SUFDMUIsQ0FBQztJQUVELHVFQUF1RTtJQUM3RCxZQUFZLENBQUMsT0FBZTtRQUNwQyxPQUFPLE9BQU8sQ0FBQztJQUNqQixDQUFDOztBQXRJVSw4Q0FBaUI7Ozs7OztzQkFDM0IsWUFBSztvQkFDTCxZQUFLOzs0QkFGSyxpQkFBaUI7SUFkN0IsSUFBQSw0QkFBWSxHQUFFO0lBQ2QsSUFBQSxnQkFBUyxFQUFDO1FBQ1QsUUFBUSxFQUFFLFdBQVc7UUFDckIsK0NBQXlDO1FBRXpDLGVBQWUsRUFBRSw4QkFBdUIsQ0FBQyxNQUFNO1FBQy9DLFVBQVUsRUFBRSxJQUFJO1FBQ2hCLE9BQU8sRUFBRTtZQUNQLHFCQUFRO1lBQ1IsbUNBQWU7WUFDZixvQkFBVTtZQUNWLHNCQUFlO1NBQ2hCO0tBQ0YsQ0FBQztHQUNXLGlCQUFpQixDQXVJN0IiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL21hY2Jvb2sva2FycG92LXdvcmsvVHJ1ZU5BUy93ZWJ1aS9zcmMvYXBwL21vZHVsZXMvZm9ybXMvaXgtZm9ybXMvY29tcG9uZW50cy9peC1lcnJvcnMvaXgtZXJyb3JzLmNvbXBvbmVudC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSwgQ2hhbmdlRGV0ZWN0b3JSZWYsIENvbXBvbmVudCwgSW5wdXQsIE9uQ2hhbmdlcyxcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBBYnN0cmFjdENvbnRyb2wsIFZhbGlkYXRpb25FcnJvcnMgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBNYXRFcnJvciB9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsL2Zvcm0tZmllbGQnO1xuaW1wb3J0IHsgTWF0VG9vbHRpcCB9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsL3Rvb2x0aXAnO1xuaW1wb3J0IHsgVW50aWxEZXN0cm95LCB1bnRpbERlc3Ryb3llZCB9IGZyb20gJ0BuZ25lYXQvdW50aWwtZGVzdHJveSc7XG5pbXBvcnQgeyBUcmFuc2xhdGVTZXJ2aWNlLCBUcmFuc2xhdGVNb2R1bGUgfSBmcm9tICdAbmd4LXRyYW5zbGF0ZS9jb3JlJztcbmltcG9ydCB7IFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgZmlsdGVyIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgRGVmYXVsdFZhbGlkYXRpb25FcnJvciB9IGZyb20gJ2FwcC9lbnVtcy9kZWZhdWx0LXZhbGlkYXRpb24tZXJyb3IuZW51bSc7XG5pbXBvcnQgeyBJeFNpbXBsZUNoYW5nZXMgfSBmcm9tICdhcHAvaW50ZXJmYWNlcy9zaW1wbGUtY2hhbmdlcy5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgSXhJY29uQ29tcG9uZW50IH0gZnJvbSAnYXBwL21vZHVsZXMvaXgtaWNvbi9peC1pY29uLmNvbXBvbmVudCc7XG5cbnR5cGUgU29tZUVycm9yID0gUmVjb3JkPHN0cmluZywgdW5rbm93bj47XG5cbmV4cG9ydCBjb25zdCBpeE1hbnVhbFZhbGlkYXRlRXJyb3IgPSAnaXhNYW51YWxWYWxpZGF0ZUVycm9yJztcblxuQFVudGlsRGVzdHJveSgpXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdpeC1lcnJvcnMnLFxuICB0ZW1wbGF0ZVVybDogJy4vaXgtZXJyb3JzLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vaXgtZXJyb3JzLmNvbXBvbmVudC5zY3NzJ10sXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxuICBzdGFuZGFsb25lOiB0cnVlLFxuICBpbXBvcnRzOiBbXG4gICAgTWF0RXJyb3IsXG4gICAgSXhJY29uQ29tcG9uZW50LFxuICAgIE1hdFRvb2x0aXAsXG4gICAgVHJhbnNsYXRlTW9kdWxlLFxuICBdLFxufSlcbmV4cG9ydCBjbGFzcyBJeEVycm9yc0NvbXBvbmVudCBpbXBsZW1lbnRzIE9uQ2hhbmdlcyB7XG4gIEBJbnB1dCgpIGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbDtcbiAgQElucHV0KCkgbGFiZWw6IHN0cmluZztcbiAgcmVhZG9ubHkgaXhNYW51YWxWYWxpZGF0ZUVycm9yID0gaXhNYW51YWxWYWxpZGF0ZUVycm9yO1xuXG4gIHByaXZhdGUgc3RhdHVzQ2hhbmdlU3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247XG4gIG1lc3NhZ2VzOiBzdHJpbmdbXSA9IFtdO1xuXG4gIHJlYWRvbmx5IGRlZmF1bHRFcnJNZXNzYWdlcyA9IHtcbiAgICBtaW46IChtaW46IG51bWJlcikgPT4gdGhpcy50cmFuc2xhdGUuaW5zdGFudCgnTWluaW11bSB2YWx1ZSBpcyB7bWlufScsIHsgbWluIH0pLFxuICAgIG1heDogKG1heDogbnVtYmVyKSA9PiB0aGlzLnRyYW5zbGF0ZS5pbnN0YW50KCdNYXhpbXVtIHZhbHVlIGlzIHttYXh9JywgeyBtYXggfSksXG4gICAgcmVxdWlyZWQ6ICgpID0+IHtcbiAgICAgIGlmICh0aGlzLmxhYmVsKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnRyYW5zbGF0ZS5pbnN0YW50KCd7ZmllbGR9IGlzIHJlcXVpcmVkJywgeyBmaWVsZDogdGhpcy5sYWJlbCB9KTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRoaXMudHJhbnNsYXRlLmluc3RhbnQoJ0ZpZWxkIGlzIHJlcXVpcmVkJyk7XG4gICAgfSxcbiAgICBlbWFpbDogKCkgPT4gdGhpcy50cmFuc2xhdGUuaW5zdGFudCgnVmFsdWUgbXVzdCBiZSBhIHZhbGlkIGVtYWlsIGFkZHJlc3MnKSxcbiAgICBtaW5sZW5ndGg6IChtaW5MZW5ndGg6IG51bWJlcikgPT4gdGhpcy50cmFuc2xhdGUuaW5zdGFudChcbiAgICAgIHRoaXMubGFiZWxcbiAgICAgICAgPyAnVGhlIGxlbmd0aCBvZiB7ZmllbGR9IHNob3VsZCBiZSBhdCBsZWFzdCB7bWluTGVuZ3RofSdcbiAgICAgICAgOiAnVGhlIGxlbmd0aCBvZiB0aGUgZmllbGQgc2hvdWxkIGJlIGF0IGxlYXN0IHttaW5MZW5ndGh9JyxcbiAgICAgIHsgZmllbGQ6IHRoaXMubGFiZWwsIG1pbkxlbmd0aCB9LFxuICAgICksXG4gICAgbWF4bGVuZ3RoOiAobWF4TGVuZ3RoOiBudW1iZXIpID0+IHRoaXMudHJhbnNsYXRlLmluc3RhbnQoXG4gICAgICB0aGlzLmxhYmVsXG4gICAgICAgID8gJ1RoZSBsZW5ndGggb2Yge2ZpZWxkfSBzaG91bGQgYmUgbm8gbW9yZSB0aGFuIHttYXhMZW5ndGh9J1xuICAgICAgICA6ICdUaGUgbGVuZ3RoIG9mIHRoZSBmaWVsZCBzaG91bGQgYmUgbm8gbW9yZSB0aGFuIHttYXhMZW5ndGh9JyxcbiAgICAgIHsgZmllbGQ6IHRoaXMubGFiZWwsIG1heExlbmd0aCB9LFxuICAgICksXG4gICAgcGF0dGVybjogKCkgPT4gdGhpcy50cmFuc2xhdGUuaW5zdGFudCgnSW52YWxpZCBmb3JtYXQgb3IgY2hhcmFjdGVyJyksXG4gICAgZm9yYmlkZGVuOiAodmFsdWU6IHN0cmluZykgPT4gdGhpcy50cmFuc2xhdGUuaW5zdGFudCgnVGhlIG5hbWUgXCJ7dmFsdWV9XCIgaXMgYWxyZWFkeSBpbiB1c2UuJywgeyB2YWx1ZSB9KSxcbiAgICByYW5nZTogKG1pbjogbnVtYmVyLCBtYXg6IG51bWJlcikgPT4gdGhpcy50cmFuc2xhdGUuaW5zdGFudChcbiAgICAgICdUaGUgdmFsdWUgaXMgb3V0IG9mIHJhbmdlLiBFbnRlciBhIHZhbHVlIGJldHdlZW4ge21pbn0gYW5kIHttYXh9LicsXG4gICAgICB7IG1pbiwgbWF4IH0sXG4gICAgKSxcbiAgICBudW1iZXI6ICgpID0+IHRoaXMudHJhbnNsYXRlLmluc3RhbnQoJ1ZhbHVlIG11c3QgYmUgYSBudW1iZXInKSxcbiAgICBjcm9uOiAoKSA9PiB0aGlzLnRyYW5zbGF0ZS5pbnN0YW50KCdJbnZhbGlkIGNyb24gZXhwcmVzc2lvbicpLFxuICAgIGlwMjogKCkgPT4gdGhpcy50cmFuc2xhdGUuaW5zdGFudCgnSW52YWxpZCBJUCBhZGRyZXNzJyksXG4gIH07XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSB0cmFuc2xhdGU6IFRyYW5zbGF0ZVNlcnZpY2UsXG4gICAgcHJpdmF0ZSBjZHI6IENoYW5nZURldGVjdG9yUmVmLFxuICApIHt9XG5cbiAgbmdPbkNoYW5nZXMoY2hhbmdlczogSXhTaW1wbGVDaGFuZ2VzPHRoaXM+KTogdm9pZCB7XG4gICAgaWYgKCdjb250cm9sJyBpbiBjaGFuZ2VzICYmIHRoaXMuY29udHJvbCkge1xuICAgICAgLy8gVGhpcyBtYW51YWxseSB3b3JrcyBhcm91bmQ6IGh0dHBzOi8vZ2l0aHViLmNvbS9hbmd1bGFyL2FuZ3VsYXIvaXNzdWVzLzEwODE2XG4gICAgICB0aGlzLnN0YXR1c0NoYW5nZVN1YnNjcmlwdGlvbj8udW5zdWJzY3JpYmUoKTtcbiAgICAgIHRoaXMuc3RhdHVzQ2hhbmdlU3Vic2NyaXB0aW9uID0gdGhpcy5jb250cm9sLnN0YXR1c0NoYW5nZXMucGlwZShcbiAgICAgICAgZmlsdGVyKChzdGF0dXMpID0+IHN0YXR1cyAhPT0gJ1BFTkRJTkcnKSxcbiAgICAgICAgdW50aWxEZXN0cm95ZWQodGhpcyksXG4gICAgICApLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgIGNvbnN0IG5ld0Vycm9yczogKHN0cmluZyB8IG51bGwpW10gPSBPYmplY3Qua2V5cyh0aGlzLmNvbnRyb2wuZXJyb3JzIHx8IFtdKS5tYXAoKGVycm9yKSA9PiB7XG4gICAgICAgICAgaWYgKGVycm9yID09PSBpeE1hbnVhbFZhbGlkYXRlRXJyb3IpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCBtZXNzYWdlID0gKHRoaXMuY29udHJvbC5lcnJvcnM/LltlcnJvcl0gYXMgU29tZUVycm9yKT8ubWVzc2FnZSBhcyBzdHJpbmc7XG4gICAgICAgICAgaWYgKG1lc3NhZ2UpIHtcbiAgICAgICAgICAgIHJldHVybiBtZXNzYWdlO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHJldHVybiB0aGlzLmdldERlZmF1bHRFcnJvcihlcnJvciBhcyBEZWZhdWx0VmFsaWRhdGlvbkVycm9yKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby11bm5lY2Vzc2FyeS10eXBlLWFzc2VydGlvblxuICAgICAgICB0aGlzLm1lc3NhZ2VzID0gbmV3RXJyb3JzLmZpbHRlcigobWVzc2FnZSkgPT4gISFtZXNzYWdlKSBhcyBzdHJpbmdbXTtcblxuICAgICAgICBpZiAodGhpcy5jb250cm9sLmVycm9ycykge1xuICAgICAgICAgIHRoaXMuY29udHJvbC5tYXJrQWxsQXNUb3VjaGVkKCk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmNkci5tYXJrRm9yQ2hlY2soKTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBUaGlzIG1ldGhvZCB0YWtlcyBpbiBhbiBlcnJvciB0eXBlIGFuZCByZXR1cm5zIGEgZGVmYXVsdCBlcnJvclxuICAgKiBtZXNzYWdlXG4gICAqIEBwYXJhbSBlcnJvciBUaGUgbmFtZSBvZiB0aGUgZXJyb3Igb24gY29udHJvbCBlLmcuLCAncmVxdWlyZWQnXG4gICAqIEByZXR1cm5zIEEgZGVmYXVsdCBlcnJvciBtZXNzYWdlIGZvciB0aGUgZXJyb3IgdHlwZVxuICAgKi9cbiAgZ2V0RGVmYXVsdEVycm9yKGVycm9yOiBEZWZhdWx0VmFsaWRhdGlvbkVycm9yKTogc3RyaW5nIHtcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmVcbiAgICBjb25zdCBlcnJvcnMgPSB0aGlzLmNvbnRyb2wuZXJyb3JzIGFzIFZhbGlkYXRpb25FcnJvcnM7XG4gICAgc3dpdGNoIChlcnJvcikge1xuICAgICAgY2FzZSBEZWZhdWx0VmFsaWRhdGlvbkVycm9yLk1pbjpcbiAgICAgICAgcmV0dXJuIHRoaXMuZGVmYXVsdEVyck1lc3NhZ2VzLm1pbigoZXJyb3JzLm1pbiBhcyBTb21lRXJyb3IpLm1pbiBhcyBudW1iZXIpO1xuICAgICAgY2FzZSBEZWZhdWx0VmFsaWRhdGlvbkVycm9yLk1heDpcbiAgICAgICAgcmV0dXJuIHRoaXMuZGVmYXVsdEVyck1lc3NhZ2VzLm1heCgoZXJyb3JzLm1heCBhcyBTb21lRXJyb3IpLm1heCBhcyBudW1iZXIpO1xuICAgICAgY2FzZSBEZWZhdWx0VmFsaWRhdGlvbkVycm9yLlJlcXVpcmVkOlxuICAgICAgICByZXR1cm4gdGhpcy5kZWZhdWx0RXJyTWVzc2FnZXMucmVxdWlyZWQoKTtcbiAgICAgIGNhc2UgRGVmYXVsdFZhbGlkYXRpb25FcnJvci5FbWFpbDpcbiAgICAgICAgcmV0dXJuIHRoaXMuZGVmYXVsdEVyck1lc3NhZ2VzLmVtYWlsKCk7XG4gICAgICBjYXNlIERlZmF1bHRWYWxpZGF0aW9uRXJyb3IuTWluTGVuZ3RoOlxuICAgICAgICByZXR1cm4gdGhpcy5kZWZhdWx0RXJyTWVzc2FnZXMubWlubGVuZ3RoKChlcnJvcnMubWlubGVuZ3RoIGFzIFNvbWVFcnJvcikucmVxdWlyZWRMZW5ndGggYXMgbnVtYmVyKTtcbiAgICAgIGNhc2UgRGVmYXVsdFZhbGlkYXRpb25FcnJvci5NYXhMZW5ndGg6XG4gICAgICAgIHJldHVybiB0aGlzLmRlZmF1bHRFcnJNZXNzYWdlcy5tYXhsZW5ndGgoKGVycm9ycy5tYXhsZW5ndGggYXMgU29tZUVycm9yKS5yZXF1aXJlZExlbmd0aCBhcyBudW1iZXIpO1xuICAgICAgY2FzZSBEZWZhdWx0VmFsaWRhdGlvbkVycm9yLlJhbmdlOlxuICAgICAgICByZXR1cm4gdGhpcy5kZWZhdWx0RXJyTWVzc2FnZXMucmFuZ2UoXG4gICAgICAgICAgKGVycm9ycy5yYW5nZVZhbHVlIGFzIFNvbWVFcnJvcikubWluIGFzIG51bWJlcixcbiAgICAgICAgICAoZXJyb3JzLnJhbmdlVmFsdWUgYXMgU29tZUVycm9yKS5tYXggYXMgbnVtYmVyLFxuICAgICAgICApO1xuICAgICAgY2FzZSBEZWZhdWx0VmFsaWRhdGlvbkVycm9yLlBhdHRlcm46XG4gICAgICAgIHJldHVybiB0aGlzLmRlZmF1bHRFcnJNZXNzYWdlcy5wYXR0ZXJuKCk7XG4gICAgICBjYXNlIERlZmF1bHRWYWxpZGF0aW9uRXJyb3IuRm9yYmlkZGVuOlxuICAgICAgICByZXR1cm4gdGhpcy5kZWZhdWx0RXJyTWVzc2FnZXMuZm9yYmlkZGVuKGVycm9ycy52YWx1ZSBhcyBzdHJpbmcpO1xuICAgICAgY2FzZSBEZWZhdWx0VmFsaWRhdGlvbkVycm9yLk51bWJlcjpcbiAgICAgICAgcmV0dXJuIHRoaXMuZGVmYXVsdEVyck1lc3NhZ2VzLm51bWJlcigpO1xuICAgICAgY2FzZSBEZWZhdWx0VmFsaWRhdGlvbkVycm9yLkNyb246XG4gICAgICAgIHJldHVybiB0aGlzLmRlZmF1bHRFcnJNZXNzYWdlcy5jcm9uKCk7XG4gICAgICBjYXNlIERlZmF1bHRWYWxpZGF0aW9uRXJyb3IuSXAyOlxuICAgICAgICByZXR1cm4gdGhpcy5kZWZhdWx0RXJyTWVzc2FnZXMuaXAyKCk7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm4gJyc7XG4gICAgfVxuICB9XG5cbiAgcmVtb3ZlTWFudWFsRXJyb3IoKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuY29udHJvbC5lcnJvcnMpIHtcbiAgICAgIGRlbGV0ZSB0aGlzLmNvbnRyb2wuZXJyb3JzW2l4TWFudWFsVmFsaWRhdGVFcnJvcl07XG4gICAgICBkZWxldGUgdGhpcy5jb250cm9sLmVycm9ycy5tYW51YWxWYWxpZGF0ZUVycm9yO1xuICAgICAgZGVsZXRlIHRoaXMuY29udHJvbC5lcnJvcnMubWFudWFsVmFsaWRhdGVFcnJvck1zZztcbiAgICB9XG4gICAgdGhpcy5jb250cm9sLnVwZGF0ZVZhbHVlQW5kVmFsaWRpdHkoKTtcbiAgICB0aGlzLmNkci5tYXJrRm9yQ2hlY2soKTtcbiAgfVxuXG4gIC8vIFRPRE86IFdvcmthcm91bmQgZm9yIGh0dHBzOi8vZ2l0aHViLmNvbS9hbmd1bGFyL2FuZ3VsYXIvaXNzdWVzLzU2NDcxXG4gIHByb3RlY3RlZCB0cmFja01lc3NhZ2UobWVzc2FnZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICByZXR1cm4gbWVzc2FnZTtcbiAgfVxufVxuIl0sInZlcnNpb24iOjN9