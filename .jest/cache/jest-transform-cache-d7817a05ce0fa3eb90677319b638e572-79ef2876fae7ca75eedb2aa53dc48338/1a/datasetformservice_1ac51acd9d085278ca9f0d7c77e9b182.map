{"file":"/Users/macbook/karpov-work/TrueNAS/webui/src/app/pages/datasets/components/dataset-form/utils/dataset-form.service.ts","mappings":";;;;;;;;;AAAA,wCAA2C;AAC3C,8CAAuD;AACvD,+BAEc;AACd,8CAAqD;AACrD,uEAAoF;AACpF,mEAAsD;AACtD,qFAAyF;AAGzF,sEAAkE;AAClE,0EAAoE;AACpE,wDAA2D;AAKpD,IAAM,kBAAkB,GAAxB,MAAM,kBAAkB;IAC7B,YACU,MAAqB,EACrB,EAAoB,EACpB,SAA2B,EAC3B,cAAgC;QAHhC,WAAM,GAAN,MAAM,CAAe;QACrB,OAAE,GAAF,EAAE,CAAkB;QACpB,cAAS,GAAT,SAAS,CAAkB;QAC3B,mBAAc,GAAd,cAAc,CAAkB;IACvC,CAAC;IAEJ,6BAA6B,CAAC,IAAY;QACxC,OAAO,IAAA,SAAE,EAAC,CAAC,CAAC,IAAI,CAAC,CAAC,IAAI,CACpB,IAAA,qBAAS,EAAC,CAAC,UAAU,EAAE,EAAE;YACvB,IAAI,CAAC,UAAU,EAAE,CAAC;gBAChB,OAAO,IAAA,SAAE,EAAC,IAAI,CAAC,CAAC;YAClB,CAAC;YACD,IAAI,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,MAAM,IAAI,qCAAiB,EAAE,CAAC;gBAChD,OAAO,IAAI,CAAC,MAAM,CAAC,IAAI,CACrB,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,kCAAmB,CAAC,gBAAgB,CAAC,EAC5D,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,kCAAmB,CAAC,oBAAoB,CAAC,CACjE,CAAC,IAAI,CACJ,IAAA,eAAG,EAAC,GAAG,EAAE,CAAC,IAAI,CAAC,cAAc,CAAC,SAAS,EAAE,CAAC,EAC1C,IAAA,eAAG,EAAC,GAAG,EAAE,CAAC,KAAK,CAAC,CACjB,CAAC;YACJ,CAAC;YACD,IAAI,IAAI,CAAC,MAAM,IAAI,kCAAc,EAAE,CAAC;gBAClC,OAAO,IAAI,CAAC,MAAM,CAAC,IAAI,CACrB,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,kCAAmB,CAAC,gBAAgB,CAAC,EAC5D,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,kCAAmB,CAAC,oBAAoB,CAAC,CACjE,CAAC,IAAI,CACJ,IAAA,eAAG,EAAC,GAAG,EAAE,CAAC,IAAI,CAAC,cAAc,CAAC,SAAS,EAAE,CAAC,EAC1C,IAAA,eAAG,EAAC,GAAG,EAAE,CAAC,KAAK,CAAC,CACjB,CAAC;YACJ,CAAC;YACD,OAAO,IAAA,SAAE,EAAC,IAAI,CAAC,CAAC;QAClB,CAAC,CAAC,CACH,CAAC;IACJ,CAAC;IAED,WAAW,CAAC,SAAiB;QAC3B,OAAO,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,oBAAoB,EAAE,CAAC,CAAC,CAAC,IAAI,EAAE,GAAG,EAAE,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,CACxE,IAAA,eAAG,EAAC,CAAC,QAAQ,EAAE,EAAE,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAC/B,CAAC;IACJ,CAAC;IAED,gBAAgB,CAAC,WAAmB;QAClC,OAAO,IAAA,WAAI,EACT,IAAA,eAAG,EAAC,CAAC,OAAO,EAAE,EAAE,CAAC;YACf;gBACE,KAAK,EAAE,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,mBAAmB,EAAE,EAAE,KAAK,EAAE,WAAW,EAAE,CAAC;gBAC1E,KAAK,EAAE,2BAAO;aACf;YACD,GAAG,OAAO;SACX,CAAC,CACH,CAAC;IACJ,CAAC;;AArDU,gDAAkB;;;;;;;6BAAlB,kBAAkB;IAH9B,IAAA,iBAAU,EAAC;QACV,UAAU,EAAE,MAAM;KACnB,CAAC;GACW,kBAAkB,CAsD9B","names":[],"sources":["/Users/macbook/karpov-work/TrueNAS/webui/src/app/pages/datasets/components/dataset-form/utils/dataset-form.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\nimport { TranslateService } from '@ngx-translate/core';\nimport {\n  Observable, of, OperatorFunction, pipe,\n} from 'rxjs';\nimport { map, switchMap, tap } from 'rxjs/operators';\nimport { maxDatasetNesting, maxDatasetPath } from 'app/constants/dataset.constants';\nimport { inherit } from 'app/enums/with-inherit.enum';\nimport { helptextDatasetForm } from 'app/helptext/storage/volumes/datasets/dataset-form';\nimport { Dataset } from 'app/interfaces/dataset.interface';\nimport { Option } from 'app/interfaces/option.interface';\nimport { DialogService } from 'app/modules/dialog/dialog.service';\nimport { IxSlideInService } from 'app/services/ix-slide-in.service';\nimport { WebSocketService } from 'app/services/ws.service';\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class DatasetFormService {\n  constructor(\n    private dialog: DialogService,\n    private ws: WebSocketService,\n    private translate: TranslateService,\n    private slideInService: IxSlideInService,\n  ) {}\n\n  checkAndWarnForLengthAndDepth(path: string): Observable<boolean> {\n    return of(!!path).pipe(\n      switchMap((pathExists) => {\n        if (!pathExists) {\n          return of(true);\n        }\n        if (path.split('/').length >= maxDatasetNesting) {\n          return this.dialog.warn(\n            this.translate.instant(helptextDatasetForm.pathWarningTitle),\n            this.translate.instant(helptextDatasetForm.pathIsTooDeepWarning),\n          ).pipe(\n            tap(() => this.slideInService.closeLast()),\n            map(() => false),\n          );\n        }\n        if (path.length >= maxDatasetPath) {\n          return this.dialog.warn(\n            this.translate.instant(helptextDatasetForm.pathWarningTitle),\n            this.translate.instant(helptextDatasetForm.pathIsTooLongWarning),\n          ).pipe(\n            tap(() => this.slideInService.closeLast()),\n            map(() => false),\n          );\n        }\n        return of(true);\n      }),\n    );\n  }\n\n  loadDataset(datasetId: string): Observable<Dataset> {\n    return this.ws.call('pool.dataset.query', [[['id', '=', datasetId]]]).pipe(\n      map((response) => response[0]),\n    );\n  }\n\n  addInheritOption(parentValue: string): OperatorFunction<Option[], Option[]> {\n    return pipe(\n      map((options) => [\n        {\n          label: this.translate.instant('Inherit ({value})', { value: parentValue }),\n          value: inherit,\n        },\n        ...options,\n      ]),\n    );\n  }\n}\n"],"version":3}