{"file":"/Users/macbook/karpov-work/TrueNAS/webui/src/app/services/redirect.service.ts","mappings":";;;;;;;;;AAAA,wCAAmD;AACnD,qDAAqD;AACrD,yDAAqE;AACrE,uCAAoC;AACpC,8CAAuD;AACvD,8CAA8C;AAC9C,6DAAmD;AAEnD,uHAAkH;AAClH,wDAA2D;AAE3D,6FAAuF;AAMhF,IAAM,eAAe,GAArB,MAAM,eAAe;IAC1B,YACY,EAAoB,EACtB,SAA2B,EAC3B,SAAoB,EACpB,MAAuB,EACP,MAAc;QAJ5B,OAAE,GAAF,EAAE,CAAkB;QACtB,cAAS,GAAT,SAAS,CAAkB;QAC3B,cAAS,GAAT,SAAS,CAAW;QACpB,WAAM,GAAN,MAAM,CAAiB;QACP,WAAM,GAAN,MAAM,CAAQ;IACrC,CAAC;IAEJ,UAAU,CAAC,GAAW,EAAE,MAAe;QACrC,IAAI,CAAC,GAAG,CAAC,QAAQ,CAAC,SAAS,CAAC,EAAE,CAAC;YAC7B,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,GAAG,EAAE,MAAM,CAAC,CAAC;YAC9B,OAAO;QACT,CAAC;QACD,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,8CAAoB,EAAE,IAAA,gBAAI,EAAC,CAAC,CAAC,EAAE,IAAA,8BAAc,EAAC,IAAI,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,MAAM,EAAE,EAAE;YACzF,IAAI,CAAC,MAAM,CAAC,gBAAgB,EAAE,CAAC;gBAC7B,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,GAAG,EAAE,MAAM,CAAC,CAAC;gBAC9B,OAAO;YACT,CAAC;YACD,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,mDAAuB,EAAE;gBAC3C,IAAI,EAAE;oBACJ,KAAK,EAAE,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,wBAAwB,CAAC;oBACvD,OAAO,EAAE,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC;;;;;;uFAM6C,EAAE,EAAE,GAAG,EAAE,CAAC;oBACvF,GAAG;iBACkB;aACxB,CAAC,CAAC,WAAW,EAAE,CAAC,IAAI,CAAC,IAAA,kBAAM,EAAC,OAAO,CAAC,EAAE,IAAA,8BAAc,EAAC,IAAI,CAAC,CAAC,CAAC,SAAS,CAAC,GAAG,EAAE;gBAC1E,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,GAAG,EAAE,MAAM,CAAC,CAAC;YAChC,CAAC,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;IACL,CAAC;;AAnCU,0CAAe;;;;;;yCAMvB,aAAM,SAAC,sBAAM;;0BANL,eAAe;IAJ3B,IAAA,4BAAY,GAAE;IACd,IAAA,iBAAU,EAAC;QACV,UAAU,EAAE,MAAM;KACnB,CAAC;GACW,eAAe,CAoC3B","names":[],"sources":["/Users/macbook/karpov-work/TrueNAS/webui/src/app/services/redirect.service.ts"],"sourcesContent":["import { Inject, Injectable } from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\nimport { UntilDestroy, untilDestroyed } from '@ngneat/until-destroy';\nimport { Store } from '@ngrx/store';\nimport { TranslateService } from '@ngx-translate/core';\nimport { filter, take } from 'rxjs/operators';\nimport { WINDOW } from 'app/helpers/window.helper';\nimport { RedirectDialogData } from 'app/modules/dialog/components/redirect-dialog/redirect-dialog-data.interface';\nimport { RedirectDialogComponent } from 'app/modules/dialog/components/redirect-dialog/redirect-dialog.component';\nimport { WebSocketService } from 'app/services/ws.service';\nimport { AppState } from 'app/store';\nimport { waitForGeneralConfig } from 'app/store/system-config/system-config.selectors';\n\n@UntilDestroy()\n@Injectable({\n  providedIn: 'root',\n})\nexport class RedirectService {\n  constructor(\n    protected ws: WebSocketService,\n    private translate: TranslateService,\n    private matDialog: MatDialog,\n    private store$: Store<AppState>,\n    @Inject(WINDOW) private window: Window,\n  ) {}\n\n  openWindow(url: string, target?: string): void {\n    if (!url.includes('http://')) {\n      this.window.open(url, target);\n      return;\n    }\n    this.store$.pipe(waitForGeneralConfig, take(1), untilDestroyed(this)).subscribe((config) => {\n      if (!config.ui_httpsredirect) {\n        this.window.open(url, target);\n        return;\n      }\n      this.matDialog.open(RedirectDialogComponent, {\n        data: {\n          title: this.translate.instant('Enabled HTTPS Redirect'),\n          message: this.translate.instant(`You are trying to open:<br>\n{url}<br><br>\nBecause HTTP to HTTPS redirect is enabled in settings your browser will force HTTPS connection for this URL.<br>\nThis may create issues if app does not support secure connections.<br>\n<br>\nYou can try opening app url in an incognito mode.<br>\nAlternatively you can disable redirect in Settings, clear browser cache and try again.`, { url }),\n          url,\n        } as RedirectDialogData,\n      }).afterClosed().pipe(filter(Boolean), untilDestroyed(this)).subscribe(() => {\n        this.window.open(url, target);\n      });\n    });\n  }\n}\n"],"version":3}