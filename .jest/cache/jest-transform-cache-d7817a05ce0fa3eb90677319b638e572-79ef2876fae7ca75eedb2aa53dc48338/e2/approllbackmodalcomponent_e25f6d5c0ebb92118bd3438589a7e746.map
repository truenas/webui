{"file":"/Users/macbook/karpov-work/TrueNAS/webui/src/app/pages/apps/components/installed-apps/app-rollback-modal/app-rollback-modal.component.ts","mappings":"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","names":[],"sources":["/Users/macbook/karpov-work/TrueNAS/webui/src/app/pages/apps/components/installed-apps/app-rollback-modal/app-rollback-modal.component.ts"],"sourcesContent":["import {\n  ChangeDetectionStrategy, Component, Inject,\n} from '@angular/core';\nimport { FormBuilder, Validators } from '@angular/forms';\nimport { MAT_DIALOG_DATA, MatDialogRef } from '@angular/material/dialog';\nimport { UntilDestroy, untilDestroyed } from '@ngneat/until-destroy';\nimport { Observable, of, tap } from 'rxjs';\nimport { Role } from 'app/enums/role.enum';\nimport { helptextApps } from 'app/helptext/apps/apps';\nimport { App, AppRollbackParams } from 'app/interfaces/app.interface';\nimport { Option } from 'app/interfaces/option.interface';\nimport { DialogService } from 'app/modules/dialog/dialog.service';\nimport { ErrorHandlerService } from 'app/services/error-handler.service';\nimport { WebSocketService } from 'app/services/ws.service';\n\n@UntilDestroy()\n@Component({\n  selector: 'ix-app-rollback-modal',\n  templateUrl: './app-rollback-modal.component.html',\n  styleUrls: ['./app-rollback-modal.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class AppRollbackModalComponent {\n  form = this.formBuilder.group({\n    app_version: ['', Validators.required],\n    rollback_snapshot: [false],\n  });\n\n  versionOptions$: Observable<Option[]>;\n\n  readonly helptext = helptextApps.apps.rollback_dialog.version.tooltip;\n  protected readonly requiredRoles = [Role.AppsWrite];\n\n  constructor(\n    private dialogRef: MatDialogRef<AppRollbackModalComponent>,\n    private ws: WebSocketService,\n    private dialogService: DialogService,\n    private formBuilder: FormBuilder,\n    private errorHandler: ErrorHandlerService,\n    @Inject(MAT_DIALOG_DATA) private app: App,\n  ) {\n    this.setVersionOptions();\n  }\n\n  onRollback(): void {\n    const rollbackParams = [this.app.name, this.form.value] as Required<AppRollbackParams>;\n\n    this.dialogService.jobDialog(\n      this.ws.job('app.rollback', rollbackParams),\n      { title: helptextApps.apps.rollback_dialog.job },\n    )\n      .afterClosed()\n      .pipe(this.errorHandler.catchError(), untilDestroyed(this))\n      .subscribe(() => this.dialogRef.close(true));\n  }\n\n  private setVersionOptions(): void {\n    this.ws.call('app.rollback_versions', [this.app.name]).pipe(\n      tap((versions) => {\n        const options = versions.map((version) => ({\n          label: version,\n          value: version,\n        }));\n        this.versionOptions$ = of(options);\n        if (options.length) {\n          this.selectFirstVersion(options[0]);\n        }\n      }),\n      untilDestroyed(this),\n    ).subscribe();\n  }\n\n  private selectFirstVersion(firstOption: Option): void {\n    this.form.patchValue({\n      app_version: firstOption.value.toString(),\n    });\n  }\n}\n"],"version":3}