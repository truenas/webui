{"file":"/Users/macbook/karpov-work/TrueNAS/webui/src/app/modules/forms/ix-forms/components/ix-slide-in/ix-slide-in.component.ts","mappings":"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","names":[],"sources":["/Users/macbook/karpov-work/TrueNAS/webui/src/app/modules/forms/ix-forms/components/ix-slide-in/ix-slide-in.component.ts"],"sourcesContent":["import { CdkTrapFocus } from '@angular/cdk/a11y';\nimport {\n  ChangeDetectionStrategy, ChangeDetectorRef,\n  Component,\n  ElementRef,\n  HostListener,\n  Injector,\n  Input,\n  OnDestroy,\n  OnInit,\n  Renderer2,\n  Type,\n  ViewChild,\n  ViewContainerRef,\n} from '@angular/core';\nimport { UntilDestroy, untilDestroyed } from '@ngneat/until-destroy';\nimport { UUID } from 'angular2-uuid';\nimport { Subscription, timer } from 'rxjs';\nimport { IxSlideInRef } from 'app/modules/forms/ix-forms/components/ix-slide-in/ix-slide-in-ref';\nimport { SLIDE_IN_DATA } from 'app/modules/forms/ix-forms/components/ix-slide-in/ix-slide-in.token';\nimport { IxSlideInService } from 'app/services/ix-slide-in.service';\n\n@UntilDestroy()\n@Component({\n  selector: 'ix-slide-in',\n  templateUrl: './ix-slide-in.component.html',\n  styleUrls: ['./ix-slide-in.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [CdkTrapFocus],\n})\nexport class IxSlideInComponent implements OnInit, OnDestroy {\n  @Input() id: string;\n  @ViewChild('body', { static: true, read: ViewContainerRef }) slideInBody: ViewContainerRef;\n\n  @HostListener('document:keydown.escape') onKeydownHandler(): void {\n    this.onBackdropClicked();\n  }\n\n  isSlideInOpen = false;\n  wide = false;\n  private element: HTMLElement;\n  private wasBodyCleared = false;\n  private timeOutOfClear: Subscription;\n\n  constructor(\n    private el: ElementRef,\n    private slideInService: IxSlideInService,\n    private renderer: Renderer2,\n    private cdr: ChangeDetectorRef,\n    private defaultInjector: Injector,\n  ) {\n    this.element = this.el.nativeElement as HTMLElement;\n  }\n\n  ngOnInit(): void {\n    // ensure id attribute exists\n    if (!this.id) {\n      return;\n    }\n\n    // move element to bottom of page (just before </body>) so it can be displayed above everything else\n    document.body.appendChild(this.element);\n    this.slideInService.setSlideComponent(this);\n  }\n\n  onBackdropClicked(): void {\n    if (!this.element || !this.isSlideInOpen) { return; }\n    this.slideInService.closeLast();\n  }\n\n  closeSlideIn(): void {\n    this.isSlideInOpen = false;\n    this.renderer.removeStyle(document.body, 'overflow');\n    this.wasBodyCleared = true;\n    this.cdr.markForCheck();\n    this.timeOutOfClear = timer(200).pipe(untilDestroyed(this)).subscribe(() => {\n      // Destroying child component later improves performance a little bit.\n      // 200ms matches transition duration\n      this.slideInBody.clear();\n      this.wasBodyCleared = false;\n      this.cdr.markForCheck();\n    });\n  }\n\n  openSlideIn<T, D>(\n    componentType: Type<T>,\n    params?: { wide?: boolean; data?: D; injector?: Injector },\n  ): IxSlideInRef<T, D> {\n    if (this.isSlideInOpen) {\n      console.error('SlideIn is already open');\n    }\n\n    this.isSlideInOpen = true;\n    this.renderer.setStyle(document.body, 'overflow', 'hidden');\n    this.wide = !!params?.wide;\n\n    if (this.wasBodyCleared) {\n      this.timeOutOfClear.unsubscribe();\n    }\n    this.slideInBody.clear();\n    this.wasBodyCleared = false;\n    // clear body and close all slides\n\n    this.cdr.markForCheck();\n\n    return this.createSlideInRef<T, D>(\n      componentType,\n      params?.data,\n      params?.injector || this.defaultInjector,\n    );\n  }\n\n  private createSlideInRef<T, D>(\n    componentType: Type<T>,\n    data?: D,\n    parentInjector?: Injector,\n  ): IxSlideInRef<T, D> {\n    const slideInRef = new IxSlideInRef<T, D>();\n    const injector = Injector.create({\n      providers: [\n        { provide: SLIDE_IN_DATA, useValue: data },\n        { provide: IxSlideInRef, useValue: slideInRef },\n      ],\n      parent: parentInjector,\n    });\n    slideInRef.componentRef = this.slideInBody.createComponent<T>(componentType, { injector });\n    slideInRef.id = UUID.UUID();\n\n    return slideInRef;\n  }\n\n  ngOnDestroy(): void {\n    this.element.remove();\n    this.slideInService.closeAll();\n  }\n}\n"],"version":3}