8978de4293226bb9a7002b23146ea4c1
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.BaseDataProvider = void 0;
exports.sort = sort;
exports.paginate = paginate;
const core_1 = require("@angular/core");
const lodash_es_1 = require("lodash-es");
const rxjs_1 = require("rxjs");
const empty_type_enum_1 = require("app/enums/empty-type.enum");
const sort_direction_enum_1 = require("app/modules/ix-table/enums/sort-direction.enum");
const utils_1 = require("app/modules/ix-table/utils");
class BaseDataProvider {
    constructor() {
        this.emptyType$ = new rxjs_1.BehaviorSubject(empty_type_enum_1.EmptyType.Loading);
        this.controlsStateUpdated = new core_1.EventEmitter();
        this.currentPage$ = new rxjs_1.BehaviorSubject([]);
        this.expandedRow$ = new rxjs_1.BehaviorSubject(null);
        this.totalRows = 0;
        this.sorting = {
            propertyName: null,
            direction: null,
            active: null,
        };
        this.pagination = {
            pageNumber: null,
            pageSize: null,
        };
        this.subscription = new rxjs_1.Subscription();
        this.allRows = [];
    }
    get isLoading$() {
        return this.emptyType$.pipe((0, rxjs_1.map)((emptyType) => emptyType === empty_type_enum_1.EmptyType.Loading));
    }
    get isError$() {
        return this.emptyType$.pipe((0, rxjs_1.map)((emptyType) => emptyType === empty_type_enum_1.EmptyType.Errors));
    }
    get currentPageCount$() {
        return this.currentPage$.pipe((0, rxjs_1.map)((currentPage) => currentPage.length));
    }
    unsubscribe() {
        if (this.subscription) {
            this.subscription.unsubscribe();
        }
    }
    setRows(rows) {
        this.allRows = rows;
        this.totalRows = rows.length;
        this.updateCurrentPage(this.allRows);
    }
    setSorting(sorting) {
        this.sorting = sorting;
        this.updateCurrentPage(this.allRows);
        this.controlsStateUpdated.emit();
    }
    setFilter(filter) {
        const filteredRows = (0, utils_1.filterTableRows)(filter);
        this.totalRows = filteredRows.length;
        this.setRows(filteredRows);
    }
    setPagination(pagination) {
        this.pagination = pagination;
        this.updateCurrentPage(this.allRows);
        this.controlsStateUpdated.emit();
    }
    updateCurrentPage(rows) {
        this.currentPage$.next(paginate(sort(rows, this.sorting), this.pagination));
    }
}
exports.BaseDataProvider = BaseDataProvider;
function sort(rows, sorting) {
    const sorted = rows;
    const direction = sorting.direction;
    const propertyName = sorting.propertyName;
    if (direction === null || propertyName === null) {
        return sorted;
    }
    if (sorting.sortBy) {
        return direction === sort_direction_enum_1.SortDirection.Desc ? (0, lodash_es_1.sortBy)(sorted, sorting.sortBy).reverse() : (0, lodash_es_1.sortBy)(sorted, sorting.sortBy);
    }
    return (0, lodash_es_1.orderBy)(sorted, propertyName, direction);
}
function paginate(rows, pagination) {
    const paginated = rows;
    const pageNumber = pagination.pageNumber;
    const pageSize = pagination.pageSize;
    if (pageNumber === null || pageSize === null) {
        return paginated;
    }
    return paginated.slice((pageNumber - 1) * pageSize, pageNumber * pageSize);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL21hY2Jvb2sva2FycG92LXdvcmsvVHJ1ZU5BUy93ZWJ1aS9zcmMvYXBwL21vZHVsZXMvaXgtdGFibGUvY2xhc3Nlcy9iYXNlLWRhdGEtcHJvdmlkZXIudHMiLCJtYXBwaW5ncyI6Ijs7O0FBbUZBLG9CQWFDO0FBRUQsNEJBVUM7QUE1R0Qsd0NBQTZDO0FBQzdDLHlDQUE0QztBQUM1QywrQkFFYztBQUNkLCtEQUFzRDtBQUN0RCx3RkFBK0U7QUFLL0Usc0RBQTZEO0FBRTdELE1BQWEsZ0JBQWdCO0lBQTdCO1FBQ1csZUFBVSxHQUFHLElBQUksc0JBQWUsQ0FBWSwyQkFBUyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQy9ELHlCQUFvQixHQUFHLElBQUksbUJBQVksRUFBUSxDQUFDO1FBY3pELGlCQUFZLEdBQUcsSUFBSSxzQkFBZSxDQUFNLEVBQUUsQ0FBQyxDQUFDO1FBQzVDLGlCQUFZLEdBQUcsSUFBSSxzQkFBZSxDQUFJLElBQUksQ0FBQyxDQUFDO1FBRTVDLGNBQVMsR0FBRyxDQUFDLENBQUM7UUFFZCxZQUFPLEdBQWlCO1lBQ3RCLFlBQVksRUFBRSxJQUFJO1lBQ2xCLFNBQVMsRUFBRSxJQUFJO1lBQ2YsTUFBTSxFQUFFLElBQUk7U0FDYixDQUFDO1FBRUYsZUFBVSxHQUFvQjtZQUM1QixVQUFVLEVBQUUsSUFBSTtZQUNoQixRQUFRLEVBQUUsSUFBSTtTQUNmLENBQUM7UUFFUSxpQkFBWSxHQUFHLElBQUksbUJBQVksRUFBRSxDQUFDO1FBQ3BDLFlBQU8sR0FBUSxFQUFFLENBQUM7SUFtQzVCLENBQUM7SUFoRUMsSUFBSSxVQUFVO1FBQ1osT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxJQUFBLFVBQUcsRUFBQyxDQUFDLFNBQVMsRUFBRSxFQUFFLENBQUMsU0FBUyxLQUFLLDJCQUFTLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztJQUNuRixDQUFDO0lBRUQsSUFBSSxRQUFRO1FBQ1YsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxJQUFB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Q0FBQyxVQUFVLENBQUM7SUFDekMsTUFBTSxRQUFRLEdBQUcsVUFBVSxDQUFDLFFBQVEsQ0FBQztJQUVyQyxJQUFJLFVBQVUsS0FBSyxJQUFJLElBQUksUUFBUSxLQUFLLElBQUksRUFBRSxDQUFDO1FBQzdDLE9BQU8sU0FBUyxDQUFDO0lBQ25CLENBQUM7SUFFRCxPQUFPLFNBQVMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxVQUFVLEdBQUcsQ0FBQyxDQUFDLEdBQUcsUUFBUSxFQUFFLFVBQVUsR0FBRyxRQUFRLENBQUMsQ0FBQztBQUM3RSxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9tYWNib29rL2thcnBvdi13b3JrL1RydWVOQVMvd2VidWkvc3JjL2FwcC9tb2R1bGVzL2l4LXRhYmxlL2NsYXNzZXMvYmFzZS1kYXRhLXByb3ZpZGVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEV2ZW50RW1pdHRlciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgb3JkZXJCeSwgc29ydEJ5IH0gZnJvbSAnbG9kYXNoLWVzJztcbmltcG9ydCB7XG4gIEJlaGF2aW9yU3ViamVjdCwgT2JzZXJ2YWJsZSwgU3Vic2NyaXB0aW9uLCBtYXAsXG59IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgRW1wdHlUeXBlIH0gZnJvbSAnYXBwL2VudW1zL2VtcHR5LXR5cGUuZW51bSc7XG5pbXBvcnQgeyBTb3J0RGlyZWN0aW9uIH0gZnJvbSAnYXBwL21vZHVsZXMvaXgtdGFibGUvZW51bXMvc29ydC1kaXJlY3Rpb24uZW51bSc7XG5pbXBvcnQgeyBEYXRhUHJvdmlkZXIgfSBmcm9tICdhcHAvbW9kdWxlcy9peC10YWJsZS9pbnRlcmZhY2VzL2RhdGEtcHJvdmlkZXIuaW50ZXJmYWNlJztcbmltcG9ydCB7IFRhYmxlRmlsdGVyIH0gZnJvbSAnYXBwL21vZHVsZXMvaXgtdGFibGUvaW50ZXJmYWNlcy90YWJsZS1maWx0ZXIuaW50ZXJmYWNlJztcbmltcG9ydCB7IFRhYmxlUGFnaW5hdGlvbiB9IGZyb20gJ2FwcC9tb2R1bGVzL2l4LXRhYmxlL2ludGVyZmFjZXMvdGFibGUtcGFnaW5hdGlvbi5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgVGFibGVTb3J0IH0gZnJvbSAnYXBwL21vZHVsZXMvaXgtdGFibGUvaW50ZXJmYWNlcy90YWJsZS1zb3J0LmludGVyZmFjZSc7XG5pbXBvcnQgeyBmaWx0ZXJUYWJsZVJvd3MgfSBmcm9tICdhcHAvbW9kdWxlcy9peC10YWJsZS91dGlscyc7XG5cbmV4cG9ydCBjbGFzcyBCYXNlRGF0YVByb3ZpZGVyPFQ+IGltcGxlbWVudHMgRGF0YVByb3ZpZGVyPFQ+IHtcbiAgcmVhZG9ubHkgZW1wdHlUeXBlJCA9IG5ldyBCZWhhdmlvclN1YmplY3Q8RW1wdHlUeXBlPihFbXB0eVR5cGUuTG9hZGluZyk7XG4gIHJlYWRvbmx5IGNvbnRyb2xzU3RhdGVVcGRhdGVkID0gbmV3IEV2ZW50RW1pdHRlcjx2b2lkPigpO1xuXG4gIGdldCBpc0xvYWRpbmckKCk6IE9ic2VydmFibGU8Ym9vbGVhbj4ge1xuICAgIHJldHVybiB0aGlzLmVtcHR5VHlwZSQucGlwZShtYXAoKGVtcHR5VHlwZSkgPT4gZW1wdHlUeXBlID09PSBFbXB0eVR5cGUuTG9hZGluZykpO1xuICB9XG5cbiAgZ2V0IGlzRXJyb3IkKCk6IE9ic2VydmFibGU8Ym9vbGVhbj4ge1xuICAgIHJldHVybiB0aGlzLmVtcHR5VHlwZSQucGlwZShtYXAoKGVtcHR5VHlwZSkgPT4gZW1wdHlUeXBlID09PSBFbXB0eVR5cGUuRXJyb3JzKSk7XG4gIH1cblxuICBnZXQgY3VycmVudFBhZ2VDb3VudCQoKTogT2JzZXJ2YWJsZTxudW1iZXI+IHtcbiAgICByZXR1cm4gdGhpcy5jdXJyZW50UGFnZSQucGlwZShtYXAoKGN1cnJlbnRQYWdlKSA9PiBjdXJyZW50UGFnZS5sZW5ndGgpKTtcbiAgfVxuXG4gIGN1cnJlbnRQYWdlJCA9IG5ldyBCZWhhdmlvclN1YmplY3Q8VFtdPihbXSk7XG4gIGV4cGFuZGVkUm93JCA9IG5ldyBCZWhhdmlvclN1YmplY3Q8VD4obnVsbCk7XG4gIGV4cGFuZGVkUm93OiBUO1xuICB0b3RhbFJvd3MgPSAwO1xuXG4gIHNvcnRpbmc6IFRhYmxlU29ydDxUPiA9IHtcbiAgICBwcm9wZXJ0eU5hbWU6IG51bGwsXG4gICAgZGlyZWN0aW9uOiBudWxsLFxuICAgIGFjdGl2ZTogbnVsbCxcbiAgfTtcblxuICBwYWdpbmF0aW9uOiBUYWJsZVBhZ2luYXRpb24gPSB7XG4gICAgcGFnZU51bWJlcjogbnVsbCxcbiAgICBwYWdlU2l6ZTogbnVsbCxcbiAgfTtcblxuICBwcm90ZWN0ZWQgc3Vic2NyaXB0aW9uID0gbmV3IFN1YnNjcmlwdGlvbigpO1xuICBwcml2YXRlIGFsbFJvd3M6IFRbXSA9IFtdO1xuXG4gIHVuc3Vic2NyaWJlKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLnN1YnNjcmlwdGlvbikge1xuICAgICAgdGhpcy5zdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICB9XG4gIH1cblxuICBzZXRSb3dzKHJvd3M6IFRbXSk6IHZvaWQge1xuICAgIHRoaXMuYWxsUm93cyA9IHJvd3M7XG4gICAgdGhpcy50b3RhbFJvd3MgPSByb3dzLmxlbmd0aDtcbiAgICB0aGlzLnVwZGF0ZUN1cnJlbnRQYWdlKHRoaXMuYWxsUm93cyk7XG4gIH1cblxuICBzZXRTb3J0aW5nKHNvcnRpbmc6IFRhYmxlU29ydDxUPik6IHZvaWQge1xuICAgIHRoaXMuc29ydGluZyA9IHNvcnRpbmc7XG4gICAgdGhpcy51cGRhdGVDdXJyZW50UGFnZSh0aGlzLmFsbFJvd3MpO1xuICAgIHRoaXMuY29udHJvbHNTdGF0ZVVwZGF0ZWQuZW1pdCgpO1xuICB9XG5cbiAgc2V0RmlsdGVyKGZpbHRlcjogVGFibGVGaWx0ZXI8VD4pOiB2b2lkIHtcbiAgICBjb25zdCBmaWx0ZXJlZFJvd3MgPSBmaWx0ZXJUYWJsZVJvd3MoZmlsdGVyKTtcbiAgICB0aGlzLnRvdGFsUm93cyA9IGZpbHRlcmVkUm93cy5sZW5ndGg7XG4gICAgdGhpcy5zZXRSb3dzKGZpbHRlcmVkUm93cyk7XG4gIH1cblxuICBzZXRQYWdpbmF0aW9uKHBhZ2luYXRpb246IFRhYmxlUGFnaW5hdGlvbik6IHZvaWQge1xuICAgIHRoaXMucGFnaW5hdGlvbiA9IHBhZ2luYXRpb247XG4gICAgdGhpcy51cGRhdGVDdXJyZW50UGFnZSh0aGlzLmFsbFJvd3MpO1xuICAgIHRoaXMuY29udHJvbHNTdGF0ZVVwZGF0ZWQuZW1pdCgpO1xuICB9XG5cbiAgcHJvdGVjdGVkIHVwZGF0ZUN1cnJlbnRQYWdlKHJvd3M6IFRbXSk6IHZvaWQge1xuICAgIHRoaXMuY3VycmVudFBhZ2UkLm5leHQocGFnaW5hdGUoc29ydChyb3dzLCB0aGlzLnNvcnRpbmcpLCB0aGlzLnBhZ2luYXRpb24pKTtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gc29ydDxUPihyb3dzOiBUW10sIHNvcnRpbmc6IFRhYmxlU29ydDxUPik6IFRbXSB7XG4gIGNvbnN0IHNvcnRlZCA9IHJvd3M7XG4gIGNvbnN0IGRpcmVjdGlvbiA9IHNvcnRpbmcuZGlyZWN0aW9uO1xuICBjb25zdCBwcm9wZXJ0eU5hbWUgPSBzb3J0aW5nLnByb3BlcnR5TmFtZTtcblxuICBpZiAoZGlyZWN0aW9uID09PSBudWxsIHx8IHByb3BlcnR5TmFtZSA9PT0gbnVsbCkge1xuICAgIHJldHVybiBzb3J0ZWQ7XG4gIH1cbiAgaWYgKHNvcnRpbmcuc29ydEJ5KSB7XG4gICAgcmV0dXJuIGRpcmVjdGlvbiA9PT0gU29ydERpcmVjdGlvbi5EZXNjID8gc29ydEJ5KHNvcnRlZCwgc29ydGluZy5zb3J0QnkpLnJldmVyc2UoKSA6IHNvcnRCeShzb3J0ZWQsIHNvcnRpbmcuc29ydEJ5KTtcbiAgfVxuXG4gIHJldHVybiBvcmRlckJ5KHNvcnRlZCwgcHJvcGVydHlOYW1lLCBkaXJlY3Rpb24pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcGFnaW5hdGU8VD4ocm93czogVFtdLCBwYWdpbmF0aW9uOiBUYWJsZVBhZ2luYXRpb24pOiBUW10ge1xuICBjb25zdCBwYWdpbmF0ZWQgPSByb3dzO1xuICBjb25zdCBwYWdlTnVtYmVyID0gcGFnaW5hdGlvbi5wYWdlTnVtYmVyO1xuICBjb25zdCBwYWdlU2l6ZSA9IHBhZ2luYXRpb24ucGFnZVNpemU7XG5cbiAgaWYgKHBhZ2VOdW1iZXIgPT09IG51bGwgfHwgcGFnZVNpemUgPT09IG51bGwpIHtcbiAgICByZXR1cm4gcGFnaW5hdGVkO1xuICB9XG5cbiAgcmV0dXJuIHBhZ2luYXRlZC5zbGljZSgocGFnZU51bWJlciAtIDEpICogcGFnZVNpemUsIHBhZ2VOdW1iZXIgKiBwYWdlU2l6ZSk7XG59XG4iXSwidmVyc2lvbiI6M30=