{"file":"/Users/macbook/karpov-work/TrueNAS/webui/src/app/modules/feedback/components/similar-issues/similar-issues.component.ts","mappings":"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","names":[],"sources":["/Users/macbook/karpov-work/TrueNAS/webui/src/app/modules/feedback/components/similar-issues/similar-issues.component.ts"],"sourcesContent":["import { AsyncPipe } from '@angular/common';\nimport {\n  ChangeDetectionStrategy, Component, Input,\n} from '@angular/core';\nimport { UntilDestroy, untilDestroyed } from '@ngneat/until-destroy';\nimport { TranslateModule } from '@ngx-translate/core';\nimport { sortBy, uniqBy } from 'lodash-es';\nimport {\n  BehaviorSubject, Observable, debounceTime, distinctUntilChanged, filter, pairwise, switchMap,\n} from 'rxjs';\nimport { SimilarIssue } from 'app/modules/feedback/interfaces/file-ticket.interface';\nimport { FeedbackService } from 'app/modules/feedback/services/feedback.service';\nimport { IxIconComponent } from 'app/modules/ix-icon/ix-icon.component';\nimport { TestDirective } from 'app/modules/test-id/test.directive';\n\n@UntilDestroy()\n@Component({\n  selector: 'ix-similar-issues',\n  styleUrls: ['./similar-issues.component.scss'],\n  templateUrl: './similar-issues.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    TestDirective,\n    IxIconComponent,\n    TranslateModule,\n    AsyncPipe,\n  ],\n})\nexport class SimilarIssuesComponent {\n  @Input() set query(value: string) {\n    this.query$.next(value);\n  }\n\n  protected similarIssues$ = new BehaviorSubject<SimilarIssue[]>([]);\n  protected isLoading$ = new BehaviorSubject<boolean>(false);\n  private query$ = new BehaviorSubject<string>(null);\n\n  protected readonly jiraHostname = 'https://ixsystems.atlassian.net';\n\n  constructor(\n    private feedbackService: FeedbackService,\n  ) {\n    this.listenForQueryChanges();\n  }\n\n  private listenForQueryChanges(): void {\n    this.query$.pipe(\n      filter((query) => query?.length >= 3),\n      debounceTime(300),\n      distinctUntilChanged(),\n      switchMap((query) => this.fetchAndCombineSimilarIssues(query)),\n      untilDestroyed(this),\n    ).subscribe();\n\n    this.query$.pipe(\n      debounceTime(300),\n      distinctUntilChanged(),\n      pairwise(),\n      untilDestroyed(this),\n    ).subscribe(([oldQuery, newQuery]) => {\n      if (!newQuery?.length) {\n        this.similarIssues$.next([]);\n      }\n      if (oldQuery?.length && newQuery?.length) {\n        const resetSimilarIssues = !newQuery.trim().includes(oldQuery);\n        if (resetSimilarIssues) {\n          this.similarIssues$.next([]);\n        }\n      }\n    });\n  }\n\n  private fetchAndCombineSimilarIssues(query: string): Observable<SimilarIssue[]> {\n    this.isLoading$.next(true);\n    return this.feedbackService.getSimilarIssues(query).pipe(\n      switchMap((newIssues) => {\n        const combinedUniqueIssues = sortBy(uniqBy([\n          ...this.similarIssues$.value,\n          ...newIssues,\n        ], 'id'), { summaryText: query });\n        this.similarIssues$.next(combinedUniqueIssues);\n        this.isLoading$.next(false);\n        return this.similarIssues$;\n      }),\n    );\n  }\n}\n"],"version":3}