2629cd304d327db26a5b2b7e91412722
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.IxSlideInComponent = void 0;
const a11y_1 = require("@angular/cdk/a11y");
const core_1 = require("@angular/core");
const until_destroy_1 = require("@ngneat/until-destroy");
const angular2_uuid_1 = require("angular2-uuid");
const rxjs_1 = require("rxjs");
const ix_slide_in_ref_1 = require("app/modules/forms/ix-forms/components/ix-slide-in/ix-slide-in-ref");
const ix_slide_in_token_1 = require("app/modules/forms/ix-forms/components/ix-slide-in/ix-slide-in.token");
const ix_slide_in_service_1 = require("app/services/ix-slide-in.service");
let IxSlideInComponent = class IxSlideInComponent {
    onKeydownHandler() {
        this.onBackdropClicked();
    }
    constructor(el, slideInService, renderer, cdr, defaultInjector) {
        this.el = el;
        this.slideInService = slideInService;
        this.renderer = renderer;
        this.cdr = cdr;
        this.defaultInjector = defaultInjector;
        this.isSlideInOpen = false;
        this.wide = false;
        this.wasBodyCleared = false;
        this.element = this.el.nativeElement;
    }
    ngOnInit() {
        // ensure id attribute exists
        if (!this.id) {
            return;
        }
        // move element to bottom of page (just before </body>) so it can be displayed above everything else
        document.body.appendChild(this.element);
        this.slideInService.setSlideComponent(this);
    }
    onBackdropClicked() {
        if (!this.element || !this.isSlideInOpen) {
            return;
        }
        this.slideInService.closeLast();
    }
    closeSlideIn() {
        this.isSlideInOpen = false;
        this.renderer.removeStyle(document.body, 'overflow');
        this.wasBodyCleared = true;
        this.cdr.markForCheck();
        this.timeOutOfClear = (0, rxjs_1.timer)(200).pipe((0, until_destroy_1.untilDestroyed)(this)).subscribe(() => {
            // Destroying child component later improves performance a little bit.
            // 200ms matches transition duration
            this.slideInBody.clear();
            this.wasBodyCleared = false;
            this.cdr.markForCheck();
        });
    }
    openSlideIn(componentType, params) {
        if (this.isSlideInOpen) {
            console.error('SlideIn is already open');
        }
        this.isSlideInOpen = true;
        this.renderer.setStyle(document.body, 'overflow', 'hidden');
        this.wide = !!(params === null || params === void 0 ? void 0 : params.wide);
        if (this.wasBodyCleared) {
            this.timeOutOfClear.unsubscribe();
        }
        this.slideInBody.clear();
        this.wasBodyCleared = false;
        // clear body and close all slides
        this.cdr.markForCheck();
        return this.createSlideInRef(componentType, params === null || params === void 0 ? void 0 : params.data, (params === null || params === void 0 ? void 0 : params.injector) || this.defaultInjector);
    }
    createSlideInRef(componentType, data, parentInjector) {
        const slideInRef = new ix_slide_in_ref_1.IxSlideInRef();
        const injector = core_1.Injector.create({
            providers: [
                { provide: ix_slide_in_token_1.SLIDE_IN_DATA, useValue: data },
                { provide: ix_slide_in_ref_1.IxSlideInRef, useValue: slideInRef },
            ],
            parent: parentInjector,
        });
        slideInRef.componentRef = this.slideInBody.createComponent(componentType, { injector });
        slideInRef.id = angular2_uuid_1.UUID.UUID();
        return slideInRef;
    }
    ngOnDestroy() {
        this.element.remove();
        this.slideInService.closeAll();
    }
};
exports.IxSlideInComponent = IxSlideInComponent;
IxSlideInComponent.ctorParameters = () => [
    { type: core_1.ElementRef },
    { type: ix_slide_in_service_1.IxSlideInService },
    { type: core_1.Renderer2 },
    { type: core_1.ChangeDetectorRef },
    { type: core_1.Injector }
];
IxSlideInComponent.propDecorators = {
    id: [{ type: core_1.Input }],
    slideInBody: [{ type: core_1.ViewChild, args: ['body', { static: true, read: core_1.ViewContainerRef },] }],
    onKeydownHandler: [{ type: core_1.HostListener, args: ['document:keydown.escape',] }]
};
exports.IxSlideInComponent = IxSlideInComponent = __decorate([
    (0, until_destroy_1.UntilDestroy)(),
    (0, core_1.Component)({
        selector: 'ix-slide-in',
        template: require("./ix-slide-in.component.html"),
        changeDetection: core_1.ChangeDetectionStrategy.OnPush,
        standalone: true,
        imports: [a11y_1.CdkTrapFocus],
    })
], IxSlideInComponent);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL21hY2Jvb2sva2FycG92LXdvcmsvVHJ1ZU5BUy93ZWJ1aS9zcmMvYXBwL21vZHVsZXMvZm9ybXMvaXgtZm9ybXMvY29tcG9uZW50cy9peC1zbGlkZS1pbi9peC1zbGlkZS1pbi5jb21wb25lbnQudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQUEsNENBQWlEO0FBQ2pELHdDQWF1QjtBQUN2Qix5REFBcUU7QUFDckUsaURBQXFDO0FBQ3JDLCtCQUEyQztBQUMzQyx1R0FBaUc7QUFDakcsMkdBQW9HO0FBQ3BHLDBFQUFvRTtBQVc3RCxJQUFNLGtCQUFrQixHQUF4QixNQUFNLGtCQUFrQjtJQUlZLGdCQUFnQjtRQUN2RCxJQUFJLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztJQUMzQixDQUFDO0lBUUQsWUFDVSxFQUFjLEVBQ2QsY0FBZ0MsRUFDaEMsUUFBbUIsRUFDbkIsR0FBc0IsRUFDdEIsZUFBeUI7UUFKekIsT0FBRSxHQUFGLEVBQUUsQ0FBWTtRQUNkLG1CQUFjLEdBQWQsY0FBYyxDQUFrQjtRQUNoQyxhQUFRLEdBQVIsUUFBUSxDQUFXO1FBQ25CLFFBQUcsR0FBSCxHQUFHLENBQW1CO1FBQ3RCLG9CQUFlLEdBQWYsZUFBZSxDQUFVO1FBWG5DLGtCQUFhLEdBQUcsS0FBSyxDQUFDO1FBQ3RCLFNBQUksR0FBRyxLQUFLLENBQUM7UUFFTCxtQkFBYyxHQUFHLEtBQUssQ0FBQztRQVU3QixJQUFJLENBQUMsT0FBTyxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUMsYUFBNEIsQ0FBQztJQUN0RCxDQUFDO0lBRUQsUUFBUTtRQUNOLDZCQUE2QjtRQUM3QixJQUFJLENBQUMsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDO1lBQ2IsT0FBTztRQUNULENBQUM7UUFFRCxvR0FBb0c7UUFDcEcsUUFBUSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ3hDLElBQUksQ0FBQyxjQUFjLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDOUMsQ0FBQztJQUVELGlCQUFpQjtRQUNmLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO1lBQUMsT0FBTztRQUFDLENBQUM7UUFDckQsSUFBSSxDQUFDLGNBQWMsQ0FBQyxTQUFTLEVBQUUsQ0FBQztJQUNsQyxDQUFDO0lBRUQsWUFBWTtRQUNWLElBQUksQ0FBQyxhQUFhLEdBQUcsS0FBSyxDQUFDO1FBQzNCLElBQUksQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxJQUFJLEVBQUUsVUFBVSxDQUFDLENBQUM7UUFDckQsSUFBSSxDQUFDLGNBQWMsR0FBRyxJQUFJLENBQUM7UUFDM0IsSUFBSSxDQUFDLEdBQUcsQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUN4QixJQUFJLENBQUMsY0FBYyxHQUFHLElBQUEsWUFBSyxFQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFBLDhCQUFjLEVBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsR0FBRyxFQUFFO1lBQ3pFLHNFQUFzRTtZQUN0RSxvQ0FBb0M7WUFDcEMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxLQUFLLEVBQUUsQ0FBQztZQUN6QixJQUFJLENBQUMsY0FBYyxHQUFHLEtBQUssQ0FBQztZQUM1QixJQUFJLENBQUMsR0FBRyxDQUFDLFlBQVksRUFBRSxDQUFDO1FBQzFCLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELFdBQVcsQ0FDVCxhQUFzQixFQUN0QixNQUEwRDtRQUUxRCxJQUFJLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztZQUN2QixPQUFPLENBQUMsS0FBSyxDQUFDLHlCQUF5QixDQUFDLENBQUM7UUFDM0MsQ0FBQztRQUVELElBQUksQ0FBQyxhQUFhLEdBQUcsSUFBSSxDQUFDO1FBQzFCLElBQUksQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxJQUFJLEVBQUUsVUFBVSxFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBQzVELElBQUksQ0FBQyxJQUFJLEdBQUcsQ0FBQyxDQUFDLENBQUEsTUFBTSxhQUFOLE1BQU0sdUJBQU4sTUFBTSxDQUFFLElBQUksQ0FBQSxDQUFDO1FBRTNCLElBQUksSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO1lBQ3hCLElBQUksQ0FBQyxjQUFjLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDcEMsQ0FBQztRQUNELElBQUksQ0FBQyxXQUFXLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDekIsSUFBSSxDQUFDLGNBQWMsR0FBRyxLQUFLLENBQUM7UUFDNUIsa0NBQWtDO1FBRWxDLElBQUksQ0FBQyxHQUFHLENBQUMsWUFBWSxFQUFFLENBQUM7UUFFeEIsT0FBTyxJQUFJLENBQUMsZ0JBQWdCLENBQzFCLGFBQWEsRUFDYixNQUFNLGFBQU4sTUFBTSx1QkFBTixNQUFNLENBQUUsSUFBSSxFQUNaLENBQUEsTUFBTSxhQUFOLE1BQU0sdUJBQU4sTUFBTSxDQUFFLFFBQVEsS0FBSSxJQUFJLENBQUMsZUFBZSxDQUN6QyxDQUFDO0lBQ0osQ0FBQztJQUVPLGdCQUFnQixDQUN0QixhQUFzQixFQUN0QixJQUFRLEVBQ1IsY0FBeUI7UUFFekIsTUFBTSxVQUFVLEdBQUcsSUFBSSw4QkFBWSxFQUFRLENBQUM7UUFDNUMsTUFBTSxRQUFRLEdBQUcsZUFBUSxDQUFDLE1BQU0sQ0FBQztZQUMvQixTQUFTLEVBQUU7Z0JBQ1QsRUFBRSxPQUFPLEVBQUUsaUNBQWEsRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFO2dCQUMxQyxFQUFFLE9BQU8sRUFBRSw4QkFBWSxFQUFFLFFBQVEsRUFBRSxVQUFVLEVBQUU7YUFDaEQ7WUFDRCxNQUFNLEVBQUUsY0FBYztTQUN2QixDQUFDLENBQUM7UUFDSCxVQUFVLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsZUFBZSxDQUFJLGFBQWEsRUFBRSxFQUFFLFFBQVEsRUFBRSxDQUFDLENBQUM7UUFDM0YsVUFBVSxDQUFDLEVBQUUsR0FBRyxvQkFBSSxDQUFDLElBQUksRUFBRSxDQUFDO1FBRTVCLE9BQU8sVUFBVSxDQUFDO0lBQ3BCLENBQUM7SUFFRCxXQUFXO1FBQ1QsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLEVBQUUsQ0FBQztRQUN0QixJQUFJLENBQUMsY0FBYyxDQUFDLFFBQVEsRUFBRSxDQUFDO0lBQ2pDLENBQUM7O0FBeEdVLGdEQUFrQjs7Ozs7Ozs7O2lCQUM1QixZQUFLOzBCQUNMLGdCQUFTLFNBQUMsTUFBTSxFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxJQUFJLEVBQUUsdUJBQWdCLEVBQUU7K0JBRTFELG1CQUFZLFNBQUMseUJBQXlCOzs2QkFKNUIsa0JBQWtCO0lBVDlCLElBQUEsNEJBQVksR0FBRTtJQUNkLElBQUEsZ0JBQVMsRUFBQztRQUNULFFBQVEsRUFBRSxhQUFhO1FBQ3ZCLGlEQUEyQztRQUUzQyxlQUFlLEVBQUUsOEJBQXVCLENBQUMsTUFBTTtRQUMvQyxVQUFVLEVBQUUsSUFBSTtRQUNoQixPQUFPLEVBQUUsQ0FBQyxtQkFBWSxDQUFDO0tBQ3hCLENBQUM7R0FDVyxrQkFBa0IsQ0F5RzlCIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9tYWNib29rL2thcnBvdi13b3JrL1RydWVOQVMvd2VidWkvc3JjL2FwcC9tb2R1bGVzL2Zvcm1zL2l4LWZvcm1zL2NvbXBvbmVudHMvaXgtc2xpZGUtaW4vaXgtc2xpZGUtaW4uY29tcG9uZW50LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENka1RyYXBGb2N1cyB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9hMTF5JztcbmltcG9ydCB7XG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LCBDaGFuZ2VEZXRlY3RvclJlZixcbiAgQ29tcG9uZW50LFxuICBFbGVtZW50UmVmLFxuICBIb3N0TGlzdGVuZXIsXG4gIEluamVjdG9yLFxuICBJbnB1dCxcbiAgT25EZXN0cm95LFxuICBPbkluaXQsXG4gIFJlbmRlcmVyMixcbiAgVHlwZSxcbiAgVmlld0NoaWxkLFxuICBWaWV3Q29udGFpbmVyUmVmLFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFVudGlsRGVzdHJveSwgdW50aWxEZXN0cm95ZWQgfSBmcm9tICdAbmduZWF0L3VudGlsLWRlc3Ryb3knO1xuaW1wb3J0IHsgVVVJRCB9IGZyb20gJ2FuZ3VsYXIyLXV1aWQnO1xuaW1wb3J0IHsgU3Vic2NyaXB0aW9uLCB0aW1lciB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgSXhTbGlkZUluUmVmIH0gZnJvbSAnYXBwL21vZHVsZXMvZm9ybXMvaXgtZm9ybXMvY29tcG9uZW50cy9peC1zbGlkZS1pbi9peC1zbGlkZS1pbi1yZWYnO1xuaW1wb3J0IHsgU0xJREVfSU5fREFUQSB9IGZyb20gJ2FwcC9tb2R1bGVzL2Zvcm1zL2l4LWZvcm1zL2NvbXBvbmVudHMvaXgtc2xpZGUtaW4vaXgtc2xpZGUtaW4udG9rZW4nO1xuaW1wb3J0IHsgSXhTbGlkZUluU2VydmljZSB9IGZyb20gJ2FwcC9zZXJ2aWNlcy9peC1zbGlkZS1pbi5zZXJ2aWNlJztcblxuQFVudGlsRGVzdHJveSgpXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdpeC1zbGlkZS1pbicsXG4gIHRlbXBsYXRlVXJsOiAnLi9peC1zbGlkZS1pbi5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL2l4LXNsaWRlLWluLmNvbXBvbmVudC5zY3NzJ10sXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxuICBzdGFuZGFsb25lOiB0cnVlLFxuICBpbXBvcnRzOiBbQ2RrVHJhcEZvY3VzXSxcbn0pXG5leHBvcnQgY2xhc3MgSXhTbGlkZUluQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkRlc3Ryb3kge1xuICBASW5wdXQoKSBpZDogc3RyaW5nO1xuICBAVmlld0NoaWxkKCdib2R5JywgeyBzdGF0aWM6IHRydWUsIHJlYWQ6IFZpZXdDb250YWluZXJSZWYgfSkgc2xpZGVJbkJvZHk6IFZpZXdDb250YWluZXJSZWY7XG5cbiAgQEhvc3RMaXN0ZW5lcignZG9jdW1lbnQ6a2V5ZG93bi5lc2NhcGUnKSBvbktleWRvd25IYW5kbGVyKCk6IHZvaWQge1xuICAgIHRoaXMub25CYWNrZHJvcENsaWNrZWQoKTtcbiAgfVxuXG4gIGlzU2xpZGVJbk9wZW4gPSBmYWxzZTtcbiAgd2lkZSA9IGZhbHNlO1xuICBwcml2YXRlIGVsZW1lbnQ6IEhUTUxFbGVtZW50O1xuICBwcml2YXRlIHdhc0JvZHlDbGVhcmVkID0gZmFsc2U7XG4gIHByaXZhdGUgdGltZU91dE9mQ2xlYXI6IFN1YnNjcmlwdGlvbjtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIGVsOiBFbGVtZW50UmVmLFxuICAgIHByaXZhdGUgc2xpZGVJblNlcnZpY2U6IEl4U2xpZGVJblNlcnZpY2UsXG4gICAgcHJpdmF0ZSByZW5kZXJlcjogUmVuZGVyZXIyLFxuICAgIHByaXZhdGUgY2RyOiBDaGFuZ2VEZXRlY3RvclJlZixcbiAgICBwcml2YXRlIGRlZmF1bHRJbmplY3RvcjogSW5qZWN0b3IsXG4gICkge1xuICAgIHRoaXMuZWxlbWVudCA9IHRoaXMuZWwubmF0aXZlRWxlbWVudCBhcyBIVE1MRWxlbWVudDtcbiAgfVxuXG4gIG5nT25Jbml0KCk6IHZvaWQge1xuICAgIC8vIGVuc3VyZSBpZCBhdHRyaWJ1dGUgZXhpc3RzXG4gICAgaWYgKCF0aGlzLmlkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gbW92ZSBlbGVtZW50IHRvIGJvdHRvbSBvZiBwYWdlIChqdXN0IGJlZm9yZSA8L2JvZHk+KSBzbyBpdCBjYW4gYmUgZGlzcGxheWVkIGFib3ZlIGV2ZXJ5dGhpbmcgZWxzZVxuICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGhpcy5lbGVtZW50KTtcbiAgICB0aGlzLnNsaWRlSW5TZXJ2aWNlLnNldFNsaWRlQ29tcG9uZW50KHRoaXMpO1xuICB9XG5cbiAgb25CYWNrZHJvcENsaWNrZWQoKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLmVsZW1lbnQgfHwgIXRoaXMuaXNTbGlkZUluT3BlbikgeyByZXR1cm47IH1cbiAgICB0aGlzLnNsaWRlSW5TZXJ2aWNlLmNsb3NlTGFzdCgpO1xuICB9XG5cbiAgY2xvc2VTbGlkZUluKCk6IHZvaWQge1xuICAgIHRoaXMuaXNTbGlkZUluT3BlbiA9IGZhbHNlO1xuICAgIHRoaXMucmVuZGVyZXIucmVtb3ZlU3R5bGUoZG9jdW1lbnQuYm9keSwgJ292ZXJmbG93Jyk7XG4gICAgdGhpcy53YXNCb2R5Q2xlYXJlZCA9IHRydWU7XG4gICAgdGhpcy5jZHIubWFya0ZvckNoZWNrKCk7XG4gICAgdGhpcy50aW1lT3V0T2ZDbGVhciA9IHRpbWVyKDIwMCkucGlwZSh1bnRpbERlc3Ryb3llZCh0aGlzKSkuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgIC8vIERlc3Ryb3lpbmcgY2hpbGQgY29tcG9uZW50IGxhdGVyIGltcHJvdmVzIHBlcmZvcm1hbmNlIGEgbGl0dGxlIGJpdC5cbiAgICAgIC8vIDIwMG1zIG1hdGNoZXMgdHJhbnNpdGlvbiBkdXJhdGlvblxuICAgICAgdGhpcy5zbGlkZUluQm9keS5jbGVhcigpO1xuICAgICAgdGhpcy53YXNCb2R5Q2xlYXJlZCA9IGZhbHNlO1xuICAgICAgdGhpcy5jZHIubWFya0ZvckNoZWNrKCk7XG4gICAgfSk7XG4gIH1cblxuICBvcGVuU2xpZGVJbjxULCBEPihcbiAgICBjb21wb25lbnRUeXBlOiBUeXBlPFQ+LFxuICAgIHBhcmFtcz86IHsgd2lkZT86IGJvb2xlYW47IGRhdGE/OiBEOyBpbmplY3Rvcj86IEluamVjdG9yIH0sXG4gICk6IEl4U2xpZGVJblJlZjxULCBEPiB7XG4gICAgaWYgKHRoaXMuaXNTbGlkZUluT3Blbikge1xuICAgICAgY29uc29sZS5lcnJvcignU2xpZGVJbiBpcyBhbHJlYWR5IG9wZW4nKTtcbiAgICB9XG5cbiAgICB0aGlzLmlzU2xpZGVJbk9wZW4gPSB0cnVlO1xuICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUoZG9jdW1lbnQuYm9keSwgJ292ZXJmbG93JywgJ2hpZGRlbicpO1xuICAgIHRoaXMud2lkZSA9ICEhcGFyYW1zPy53aWRlO1xuXG4gICAgaWYgKHRoaXMud2FzQm9keUNsZWFyZWQpIHtcbiAgICAgIHRoaXMudGltZU91dE9mQ2xlYXIudW5zdWJzY3JpYmUoKTtcbiAgICB9XG4gICAgdGhpcy5zbGlkZUluQm9keS5jbGVhcigpO1xuICAgIHRoaXMud2FzQm9keUNsZWFyZWQgPSBmYWxzZTtcbiAgICAvLyBjbGVhciBib2R5IGFuZCBjbG9zZSBhbGwgc2xpZGVzXG5cbiAgICB0aGlzLmNkci5tYXJrRm9yQ2hlY2soKTtcblxuICAgIHJldHVybiB0aGlzLmNyZWF0ZVNsaWRlSW5SZWY8VCwgRD4oXG4gICAgICBjb21wb25lbnRUeXBlLFxuICAgICAgcGFyYW1zPy5kYXRhLFxuICAgICAgcGFyYW1zPy5pbmplY3RvciB8fCB0aGlzLmRlZmF1bHRJbmplY3RvcixcbiAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVTbGlkZUluUmVmPFQsIEQ+KFxuICAgIGNvbXBvbmVudFR5cGU6IFR5cGU8VD4sXG4gICAgZGF0YT86IEQsXG4gICAgcGFyZW50SW5qZWN0b3I/OiBJbmplY3RvcixcbiAgKTogSXhTbGlkZUluUmVmPFQsIEQ+IHtcbiAgICBjb25zdCBzbGlkZUluUmVmID0gbmV3IEl4U2xpZGVJblJlZjxULCBEPigpO1xuICAgIGNvbnN0IGluamVjdG9yID0gSW5qZWN0b3IuY3JlYXRlKHtcbiAgICAgIHByb3ZpZGVyczogW1xuICAgICAgICB7IHByb3ZpZGU6IFNMSURFX0lOX0RBVEEsIHVzZVZhbHVlOiBkYXRhIH0sXG4gICAgICAgIHsgcHJvdmlkZTogSXhTbGlkZUluUmVmLCB1c2VWYWx1ZTogc2xpZGVJblJlZiB9LFxuICAgICAgXSxcbiAgICAgIHBhcmVudDogcGFyZW50SW5qZWN0b3IsXG4gICAgfSk7XG4gICAgc2xpZGVJblJlZi5jb21wb25lbnRSZWYgPSB0aGlzLnNsaWRlSW5Cb2R5LmNyZWF0ZUNvbXBvbmVudDxUPihjb21wb25lbnRUeXBlLCB7IGluamVjdG9yIH0pO1xuICAgIHNsaWRlSW5SZWYuaWQgPSBVVUlELlVVSUQoKTtcblxuICAgIHJldHVybiBzbGlkZUluUmVmO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKTogdm9pZCB7XG4gICAgdGhpcy5lbGVtZW50LnJlbW92ZSgpO1xuICAgIHRoaXMuc2xpZGVJblNlcnZpY2UuY2xvc2VBbGwoKTtcbiAgfVxufVxuIl0sInZlcnNpb24iOjN9