{"file":"/Users/macbook/karpov-work/TrueNAS/webui/src/app/pages/system/bootenv/bootenv-form/bootenv-form.component.ts","mappings":"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","names":[],"sources":["/Users/macbook/karpov-work/TrueNAS/webui/src/app/pages/system/bootenv/bootenv-form/bootenv-form.component.ts"],"sourcesContent":["import {\n  ChangeDetectionStrategy,\n  Component,\n  ChangeDetectorRef,\n  OnInit,\n  Inject,\n} from '@angular/core';\nimport { Validators, ReactiveFormsModule } from '@angular/forms';\nimport { MatButton } from '@angular/material/button';\nimport { MatCard, MatCardContent } from '@angular/material/card';\nimport { FormBuilder, FormControl } from '@ngneat/reactive-forms';\nimport { UntilDestroy, untilDestroyed } from '@ngneat/until-destroy';\nimport { TranslateService, TranslateModule } from '@ngx-translate/core';\nimport { nameValidatorRegex } from 'app/constants/name-validator.constant';\nimport { RequiresRolesDirective } from 'app/directives/requires-roles/requires-roles.directive';\nimport { BootEnvironmentAction } from 'app/enums/boot-environment-action.enum';\nimport { Role } from 'app/enums/role.enum';\nimport { helptextSystemBootenv } from 'app/helptext/system/boot-env';\nimport {\n  BootenvTooltip,\n  CreateBootenvParams,\n  UpdateBootenvParams,\n} from 'app/interfaces/bootenv.interface';\nimport { FormActionsComponent } from 'app/modules/forms/ix-forms/components/form-actions/form-actions.component';\nimport { IxFieldsetComponent } from 'app/modules/forms/ix-forms/components/ix-fieldset/ix-fieldset.component';\nimport { IxInputComponent } from 'app/modules/forms/ix-forms/components/ix-input/ix-input.component';\nimport { IxModalHeaderComponent } from 'app/modules/forms/ix-forms/components/ix-slide-in/components/ix-modal-header/ix-modal-header.component';\nimport { IxSlideInRef } from 'app/modules/forms/ix-forms/components/ix-slide-in/ix-slide-in-ref';\nimport { SLIDE_IN_DATA } from 'app/modules/forms/ix-forms/components/ix-slide-in/ix-slide-in.token';\nimport { FormErrorHandlerService } from 'app/modules/forms/ix-forms/services/form-error-handler.service';\nimport { TestDirective } from 'app/modules/test-id/test.directive';\nimport { WebSocketService } from 'app/services/ws.service';\n\n@UntilDestroy()\n@Component({\n  selector: 'ix-bootenv-form',\n  templateUrl: './bootenv-form.component.html',\n  styleUrls: ['./bootenv-form.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    IxModalHeaderComponent,\n    MatCard,\n    MatCardContent,\n    ReactiveFormsModule,\n    IxFieldsetComponent,\n    IxInputComponent,\n    FormActionsComponent,\n    RequiresRolesDirective,\n    MatButton,\n    TestDirective,\n    TranslateModule,\n  ],\n})\nexport class BootEnvironmentFormComponent implements OnInit {\n  protected readonly requiredRoles = [Role.FullAdmin];\n\n  Operations = BootEnvironmentAction;\n  currentName?: string;\n  operation: BootEnvironmentAction;\n  title: string;\n\n  formGroup = this.formBuilder.group({\n    name: ['', [Validators.required, Validators.pattern(nameValidatorRegex)]],\n  });\n\n  isFormLoading = false;\n\n  tooltips: BootenvTooltip = {\n    name: helptextSystemBootenv.create_name_tooltip,\n  };\n\n  constructor(\n    private translate: TranslateService,\n    private formBuilder: FormBuilder,\n    private ws: WebSocketService,\n    private errorHandler: FormErrorHandlerService,\n    private changeDetectorRef: ChangeDetectorRef,\n    private slideInRef: IxSlideInRef<BootEnvironmentFormComponent>,\n    @Inject(SLIDE_IN_DATA) private slideInData: { operation: BootEnvironmentAction; name?: string },\n  ) {}\n\n  ngOnInit(): void {\n    if (this.slideInData) {\n      this.currentName = this.slideInData.name;\n      this.operation = this.slideInData.operation;\n      this.setupForm();\n    }\n  }\n\n  setupForm(): void {\n    switch (this.operation) {\n      case this.Operations.Rename:\n        this.title = this.translate.instant('Rename Boot Environment');\n        this.formGroup.patchValue({\n          name: this.currentName,\n        });\n\n        this.tooltips = {\n          name: helptextSystemBootenv.create_name_tooltip,\n        };\n        break;\n      case this.Operations.Clone:\n        this.title = this.translate.instant('Clone Boot Environment');\n\n        this.formGroup.addControl(\n          'source',\n          new FormControl({ value: this.currentName, disabled: true }, Validators.required),\n        );\n\n        this.tooltips = {\n          name: helptextSystemBootenv.clone_name_tooltip,\n          source: helptextSystemBootenv.clone_source_tooltip,\n        };\n        break;\n      default:\n        this.title = this.translate.instant('Create Boot Environment');\n        this.tooltips = {\n          name: helptextSystemBootenv.create_name_tooltip,\n        };\n        break;\n    }\n\n    this.changeDetectorRef.detectChanges();\n  }\n\n  onSubmit(): void {\n    this.isFormLoading = true;\n    switch (this.operation) {\n      case this.Operations.Create: {\n        const createParams: CreateBootenvParams = [{\n          name: this.formGroup.value.name,\n        }];\n\n        this.ws.call('bootenv.create', createParams).pipe(untilDestroyed(this)).subscribe({\n          next: () => {\n            this.isFormLoading = false;\n            this.slideInRef.close(true);\n          },\n          error: (error: unknown) => {\n            this.isFormLoading = false;\n            this.slideInRef.close(false);\n            this.errorHandler.handleWsFormError(error, this.formGroup);\n          },\n        });\n\n        break;\n      }\n      case this.Operations.Rename: {\n        const renameParams: UpdateBootenvParams = [\n          this.currentName,\n          {\n            name: this.formGroup.value.name,\n          },\n        ];\n\n        this.ws.call('bootenv.update', renameParams).pipe(untilDestroyed(this)).subscribe({\n          next: () => {\n            this.isFormLoading = false;\n            this.slideInRef.close(true);\n          },\n          error: (error: unknown) => {\n            this.isFormLoading = false;\n            this.slideInRef.close(false);\n            this.errorHandler.handleWsFormError(error, this.formGroup);\n          },\n        });\n\n        break;\n      }\n      case this.Operations.Clone: {\n        const cloneParams: CreateBootenvParams = [{\n          name: this.formGroup.value.name,\n          source: this.currentName,\n        }];\n\n        this.ws.call('bootenv.create', cloneParams).pipe(untilDestroyed(this)).subscribe({\n          next: () => {\n            this.isFormLoading = false;\n            this.slideInRef.close(true);\n          },\n          error: (error: unknown) => {\n            this.isFormLoading = false;\n            this.slideInRef.close(false);\n            this.errorHandler.handleWsFormError(error, this.formGroup);\n          },\n        });\n\n        break;\n      }\n    }\n  }\n}\n"],"version":3}