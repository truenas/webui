099401fa429ebb39729665b68d3e0e20
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.BootEnvironmentFormComponent = void 0;
const core_1 = require("@angular/core");
const forms_1 = require("@angular/forms");
const button_1 = require("@angular/material/button");
const card_1 = require("@angular/material/card");
const reactive_forms_1 = require("@ngneat/reactive-forms");
const until_destroy_1 = require("@ngneat/until-destroy");
const core_2 = require("@ngx-translate/core");
const name_validator_constant_1 = require("app/constants/name-validator.constant");
const requires_roles_directive_1 = require("app/directives/requires-roles/requires-roles.directive");
const boot_environment_action_enum_1 = require("app/enums/boot-environment-action.enum");
const role_enum_1 = require("app/enums/role.enum");
const boot_env_1 = require("app/helptext/system/boot-env");
const form_actions_component_1 = require("app/modules/forms/ix-forms/components/form-actions/form-actions.component");
const ix_fieldset_component_1 = require("app/modules/forms/ix-forms/components/ix-fieldset/ix-fieldset.component");
const ix_input_component_1 = require("app/modules/forms/ix-forms/components/ix-input/ix-input.component");
const ix_modal_header_component_1 = require("app/modules/forms/ix-forms/components/ix-slide-in/components/ix-modal-header/ix-modal-header.component");
const ix_slide_in_ref_1 = require("app/modules/forms/ix-forms/components/ix-slide-in/ix-slide-in-ref");
const ix_slide_in_token_1 = require("app/modules/forms/ix-forms/components/ix-slide-in/ix-slide-in.token");
const form_error_handler_service_1 = require("app/modules/forms/ix-forms/services/form-error-handler.service");
const test_directive_1 = require("app/modules/test-id/test.directive");
const ws_service_1 = require("app/services/ws.service");
let BootEnvironmentFormComponent = class BootEnvironmentFormComponent {
    constructor(translate, formBuilder, ws, errorHandler, changeDetectorRef, slideInRef, slideInData) {
        this.translate = translate;
        this.formBuilder = formBuilder;
        this.ws = ws;
        this.errorHandler = errorHandler;
        this.changeDetectorRef = changeDetectorRef;
        this.slideInRef = slideInRef;
        this.slideInData = slideInData;
        this.requiredRoles = [role_enum_1.Role.FullAdmin];
        this.Operations = boot_environment_action_enum_1.BootEnvironmentAction;
        this.formGroup = this.formBuilder.group({
            name: ['', [forms_1.Validators.required, forms_1.Validators.pattern(name_validator_constant_1.nameValidatorRegex)]],
        });
        this.isFormLoading = false;
        this.tooltips = {
            name: boot_env_1.helptextSystemBootenv.create_name_tooltip,
        };
    }
    ngOnInit() {
        if (this.slideInData) {
            this.currentName = this.slideInData.name;
            this.operation = this.slideInData.operation;
            this.setupForm();
        }
    }
    setupForm() {
        switch (this.operation) {
            case this.Operations.Rename:
                this.title = this.translate.instant('Rename Boot Environment');
                this.formGroup.patchValue({
                    name: this.currentName,
                });
                this.tooltips = {
                    name: boot_env_1.helptextSystemBootenv.create_name_tooltip,
                };
                break;
            case this.Operations.Clone:
                this.title = this.translate.instant('Clone Boot Environment');
                this.formGroup.addControl('source', new reactive_forms_1.FormControl({ value: this.currentName, disabled: true }, forms_1.Validators.required));
                this.tooltips = {
                    name: boot_env_1.helptextSystemBootenv.clone_name_tooltip,
                    source: boot_env_1.helptextSystemBootenv.clone_source_tooltip,
                };
                break;
            default:
                this.title = this.translate.instant('Create Boot Environment');
                this.tooltips = {
                    name: boot_env_1.helptextSystemBootenv.create_name_tooltip,
                };
                break;
        }
        this.changeDetectorRef.detectChanges();
    }
    onSubmit() {
        this.isFormLoading = true;
        switch (this.operation) {
            case this.Operations.Create: {
                const createParams = [{
                        name: this.formGroup.value.name,
                    }];
                this.ws.call('bootenv.create', createParams).pipe((0, until_destroy_1.untilDestroyed)(this)).subscribe({
                    next: () => {
                        this.isFormLoading = false;
                        this.slideInRef.close(true);
                    },
                    error: (error) => {
                        this.isFormLoading = false;
                        this.slideInRef.close(false);
                        this.errorHandler.handleWsFormError(error, this.formGroup);
                    },
                });
                break;
            }
            case this.Operations.Rename: {
                const renameParams = [
                    this.currentName,
                    {
                        name: this.formGroup.value.name,
                    },
                ];
                this.ws.call('bootenv.update', renameParams).pipe((0, until_destroy_1.untilDestroyed)(this)).subscribe({
                    next: () => {
                        this.isFormLoading = false;
                        this.slideInRef.close(true);
                    },
                    error: (error) => {
                        this.isFormLoading = false;
                        this.slideInRef.close(false);
                        this.errorHandler.handleWsFormError(error, this.formGroup);
                    },
                });
                break;
            }
            case this.Operations.Clone: {
                const cloneParams = [{
                        name: this.formGroup.value.name,
                        source: this.currentName,
                    }];
                this.ws.call('bootenv.create', cloneParams).pipe((0, until_destroy_1.untilDestroyed)(this)).subscribe({
                    next: () => {
                        this.isFormLoading = false;
                        this.slideInRef.close(true);
                    },
                    error: (error) => {
                        this.isFormLoading = false;
                        this.slideInRef.close(false);
                        this.errorHandler.handleWsFormError(error, this.formGroup);
                    },
                });
                break;
            }
        }
    }
};
exports.BootEnvironmentFormComponent = BootEnvironmentFormComponent;
BootEnvironmentFormComponent.ctorParameters = () => [
    { type: core_2.TranslateService },
    { type: reactive_forms_1.FormBuilder },
    { type: ws_service_1.WebSocketService },
    { type: form_error_handler_service_1.FormErrorHandlerService },
    { type: core_1.ChangeDetectorRef },
    { type: ix_slide_in_ref_1.IxSlideInRef },
    { type: undefined, decorators: [{ type: core_1.Inject, args: [ix_slide_in_token_1.SLIDE_IN_DATA,] }] }
];
exports.BootEnvironmentFormComponent = BootEnvironmentFormComponent = __decorate([
    (0, until_destroy_1.UntilDestroy)(),
    (0, core_1.Component)({
        selector: 'ix-bootenv-form',
        template: require("./bootenv-form.component.html"),
        changeDetection: core_1.ChangeDetectionStrategy.OnPush,
        standalone: true,
        imports: [
            ix_modal_header_component_1.IxModalHeaderComponent,
            card_1.MatCard,
            card_1.MatCardContent,
            forms_1.ReactiveFormsModule,
            ix_fieldset_component_1.IxFieldsetComponent,
            ix_input_component_1.IxInputComponent,
            form_actions_component_1.FormActionsComponent,
            requires_roles_directive_1.RequiresRolesDirective,
            button_1.MatButton,
            test_directive_1.TestDirective,
            core_2.TranslateModule,
        ],
    })
], BootEnvironmentFormComponent);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL21hY2Jvb2sva2FycG92LXdvcmsvVHJ1ZU5BUy93ZWJ1aS9zcmMvYXBwL3BhZ2VzL3N5c3RlbS9ib290ZW52L2Jvb3RlbnYtZm9ybS9ib290ZW52LWZvcm0uY29tcG9uZW50LnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBLHdDQU11QjtBQUN2QiwwQ0FBaUU7QUFDakUscURBQXFEO0FBQ3JELGlEQUFpRTtBQUNqRSwyREFBa0U7QUFDbEUseURBQXFFO0FBQ3JFLDhDQUF3RTtBQUN4RSxtRkFBMkU7QUFDM0UscUdBQWdHO0FBQ2hHLHlGQUErRTtBQUMvRSxtREFBMkM7QUFDM0MsMkRBQXFFO0FBTXJFLHNIQUFpSDtBQUNqSCxtSEFBOEc7QUFDOUcsMEdBQXFHO0FBQ3JHLHNKQUFnSjtBQUNoSix1R0FBaUc7QUFDakcsMkdBQW9HO0FBQ3BHLCtHQUF5RztBQUN6Ryx1RUFBbUU7QUFDbkUsd0RBQTJEO0FBdUJwRCxJQUFNLDRCQUE0QixHQUFsQyxNQUFNLDRCQUE0QjtJQWtCdkMsWUFDVSxTQUEyQixFQUMzQixXQUF3QixFQUN4QixFQUFvQixFQUNwQixZQUFxQyxFQUNyQyxpQkFBb0MsRUFDcEMsVUFBc0QsRUFDL0IsV0FBZ0U7UUFOdkYsY0FBUyxHQUFULFNBQVMsQ0FBa0I7UUFDM0IsZ0JBQVcsR0FBWCxXQUFXLENBQWE7UUFDeEIsT0FBRSxHQUFGLEVBQUUsQ0FBa0I7UUFDcEIsaUJBQVksR0FBWixZQUFZLENBQXlCO1FBQ3JDLHNCQUFpQixHQUFqQixpQkFBaUIsQ0FBbUI7UUFDcEMsZUFBVSxHQUFWLFVBQVUsQ0FBNEM7UUFDL0IsZ0JBQVcsR0FBWCxXQUFXLENBQXFEO1FBeEI5RSxrQkFBYSxHQUFHLENBQUMsZ0JBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUVwRCxlQUFVLEdBQUcsb0RBQXFCLENBQUM7UUFLbkMsY0FBUyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsS0FBSyxDQUFDO1lBQ2pDLElBQUksRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLGtCQUFV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QUFPLEVBQUU7WUFDUCxrREFBc0I7WUFDdEIsY0FBTztZQUNQLHFCQUFjO1lBQ2QsMkJBQW1CO1lBQ25CLDJDQUFtQjtZQUNuQixxQ0FBZ0I7WUFDaEIsNkNBQW9CO1lBQ3BCLGlEQUFzQjtZQUN0QixrQkFBUztZQUNULDhCQUFhO1lBQ2Isc0JBQWU7U0FDaEI7S0FDRixDQUFDO0dBQ1csNEJBQTRCLENBMEl4QyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvbWFjYm9vay9rYXJwb3Ytd29yay9UcnVlTkFTL3dlYnVpL3NyYy9hcHAvcGFnZXMvc3lzdGVtL2Jvb3RlbnYvYm9vdGVudi1mb3JtL2Jvb3RlbnYtZm9ybS5jb21wb25lbnQudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksXG4gIENvbXBvbmVudCxcbiAgQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gIE9uSW5pdCxcbiAgSW5qZWN0LFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFZhbGlkYXRvcnMsIFJlYWN0aXZlRm9ybXNNb2R1bGUgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBNYXRCdXR0b24gfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbC9idXR0b24nO1xuaW1wb3J0IHsgTWF0Q2FyZCwgTWF0Q2FyZENvbnRlbnQgfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbC9jYXJkJztcbmltcG9ydCB7IEZvcm1CdWlsZGVyLCBGb3JtQ29udHJvbCB9IGZyb20gJ0BuZ25lYXQvcmVhY3RpdmUtZm9ybXMnO1xuaW1wb3J0IHsgVW50aWxEZXN0cm95LCB1bnRpbERlc3Ryb3llZCB9IGZyb20gJ0BuZ25lYXQvdW50aWwtZGVzdHJveSc7XG5pbXBvcnQgeyBUcmFuc2xhdGVTZXJ2aWNlLCBUcmFuc2xhdGVNb2R1bGUgfSBmcm9tICdAbmd4LXRyYW5zbGF0ZS9jb3JlJztcbmltcG9ydCB7IG5hbWVWYWxpZGF0b3JSZWdleCB9IGZyb20gJ2FwcC9jb25zdGFudHMvbmFtZS12YWxpZGF0b3IuY29uc3RhbnQnO1xuaW1wb3J0IHsgUmVxdWlyZXNSb2xlc0RpcmVjdGl2ZSB9IGZyb20gJ2FwcC9kaXJlY3RpdmVzL3JlcXVpcmVzLXJvbGVzL3JlcXVpcmVzLXJvbGVzLmRpcmVjdGl2ZSc7XG5pbXBvcnQgeyBCb290RW52aXJvbm1lbnRBY3Rpb24gfSBmcm9tICdhcHAvZW51bXMvYm9vdC1lbnZpcm9ubWVudC1hY3Rpb24uZW51bSc7XG5pbXBvcnQgeyBSb2xlIH0gZnJvbSAnYXBwL2VudW1zL3JvbGUuZW51bSc7XG5pbXBvcnQgeyBoZWxwdGV4dFN5c3RlbUJvb3RlbnYgfSBmcm9tICdhcHAvaGVscHRleHQvc3lzdGVtL2Jvb3QtZW52JztcbmltcG9ydCB7XG4gIEJvb3RlbnZUb29sdGlwLFxuICBDcmVhdGVCb290ZW52UGFyYW1zLFxuICBVcGRhdGVCb290ZW52UGFyYW1zLFxufSBmcm9tICdhcHAvaW50ZXJmYWNlcy9ib290ZW52LmludGVyZmFjZSc7XG5pbXBvcnQgeyBGb3JtQWN0aW9uc0NvbXBvbmVudCB9IGZyb20gJ2FwcC9tb2R1bGVzL2Zvcm1zL2l4LWZvcm1zL2NvbXBvbmVudHMvZm9ybS1hY3Rpb25zL2Zvcm0tYWN0aW9ucy5jb21wb25lbnQnO1xuaW1wb3J0IHsgSXhGaWVsZHNldENvbXBvbmVudCB9IGZyb20gJ2FwcC9tb2R1bGVzL2Zvcm1zL2l4LWZvcm1zL2NvbXBvbmVudHMvaXgtZmllbGRzZXQvaXgtZmllbGRzZXQuY29tcG9uZW50JztcbmltcG9ydCB7IEl4SW5wdXRDb21wb25lbnQgfSBmcm9tICdhcHAvbW9kdWxlcy9mb3Jtcy9peC1mb3Jtcy9jb21wb25lbnRzL2l4LWlucHV0L2l4LWlucHV0LmNvbXBvbmVudCc7XG5pbXBvcnQgeyBJeE1vZGFsSGVhZGVyQ29tcG9uZW50IH0gZnJvbSAnYXBwL21vZHVsZXMvZm9ybXMvaXgtZm9ybXMvY29tcG9uZW50cy9peC1zbGlkZS1pbi9jb21wb25lbnRzL2l4LW1vZGFsLWhlYWRlci9peC1tb2RhbC1oZWFkZXIuY29tcG9uZW50JztcbmltcG9ydCB7IEl4U2xpZGVJblJlZiB9IGZyb20gJ2FwcC9tb2R1bGVzL2Zvcm1zL2l4LWZvcm1zL2NvbXBvbmVudHMvaXgtc2xpZGUtaW4vaXgtc2xpZGUtaW4tcmVmJztcbmltcG9ydCB7IFNMSURFX0lOX0RBVEEgfSBmcm9tICdhcHAvbW9kdWxlcy9mb3Jtcy9peC1mb3Jtcy9jb21wb25lbnRzL2l4LXNsaWRlLWluL2l4LXNsaWRlLWluLnRva2VuJztcbmltcG9ydCB7IEZvcm1FcnJvckhhbmRsZXJTZXJ2aWNlIH0gZnJvbSAnYXBwL21vZHVsZXMvZm9ybXMvaXgtZm9ybXMvc2VydmljZXMvZm9ybS1lcnJvci1oYW5kbGVyLnNlcnZpY2UnO1xuaW1wb3J0IHsgVGVzdERpcmVjdGl2ZSB9IGZyb20gJ2FwcC9tb2R1bGVzL3Rlc3QtaWQvdGVzdC5kaXJlY3RpdmUnO1xuaW1wb3J0IHsgV2ViU29ja2V0U2VydmljZSB9IGZyb20gJ2FwcC9zZXJ2aWNlcy93cy5zZXJ2aWNlJztcblxuQFVudGlsRGVzdHJveSgpXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdpeC1ib290ZW52LWZvcm0nLFxuICB0ZW1wbGF0ZVVybDogJy4vYm9vdGVudi1mb3JtLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vYm9vdGVudi1mb3JtLmNvbXBvbmVudC5zY3NzJ10sXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxuICBzdGFuZGFsb25lOiB0cnVlLFxuICBpbXBvcnRzOiBbXG4gICAgSXhNb2RhbEhlYWRlckNvbXBvbmVudCxcbiAgICBNYXRDYXJkLFxuICAgIE1hdENhcmRDb250ZW50LFxuICAgIFJlYWN0aXZlRm9ybXNNb2R1bGUsXG4gICAgSXhGaWVsZHNldENvbXBvbmVudCxcbiAgICBJeElucHV0Q29tcG9uZW50LFxuICAgIEZvcm1BY3Rpb25zQ29tcG9uZW50LFxuICAgIFJlcXVpcmVzUm9sZXNEaXJlY3RpdmUsXG4gICAgTWF0QnV0dG9uLFxuICAgIFRlc3REaXJlY3RpdmUsXG4gICAgVHJhbnNsYXRlTW9kdWxlLFxuICBdLFxufSlcbmV4cG9ydCBjbGFzcyBCb290RW52aXJvbm1lbnRGb3JtQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcbiAgcHJvdGVjdGVkIHJlYWRvbmx5IHJlcXVpcmVkUm9sZXMgPSBbUm9sZS5GdWxsQWRtaW5dO1xuXG4gIE9wZXJhdGlvbnMgPSBCb290RW52aXJvbm1lbnRBY3Rpb247XG4gIGN1cnJlbnROYW1lPzogc3RyaW5nO1xuICBvcGVyYXRpb246IEJvb3RFbnZpcm9ubWVudEFjdGlvbjtcbiAgdGl0bGU6IHN0cmluZztcblxuICBmb3JtR3JvdXAgPSB0aGlzLmZvcm1CdWlsZGVyLmdyb3VwKHtcbiAgICBuYW1lOiBbJycsIFtWYWxpZGF0b3JzLnJlcXVpcmVkLCBWYWxpZGF0b3JzLnBhdHRlcm4obmFtZVZhbGlkYXRvclJlZ2V4KV1dLFxuICB9KTtcblxuICBpc0Zvcm1Mb2FkaW5nID0gZmFsc2U7XG5cbiAgdG9vbHRpcHM6IEJvb3RlbnZUb29sdGlwID0ge1xuICAgIG5hbWU6IGhlbHB0ZXh0U3lzdGVtQm9vdGVudi5jcmVhdGVfbmFtZV90b29sdGlwLFxuICB9O1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgdHJhbnNsYXRlOiBUcmFuc2xhdGVTZXJ2aWNlLFxuICAgIHByaXZhdGUgZm9ybUJ1aWxkZXI6IEZvcm1CdWlsZGVyLFxuICAgIHByaXZhdGUgd3M6IFdlYlNvY2tldFNlcnZpY2UsXG4gICAgcHJpdmF0ZSBlcnJvckhhbmRsZXI6IEZvcm1FcnJvckhhbmRsZXJTZXJ2aWNlLFxuICAgIHByaXZhdGUgY2hhbmdlRGV0ZWN0b3JSZWY6IENoYW5nZURldGVjdG9yUmVmLFxuICAgIHByaXZhdGUgc2xpZGVJblJlZjogSXhTbGlkZUluUmVmPEJvb3RFbnZpcm9ubWVudEZvcm1Db21wb25lbnQ+LFxuICAgIEBJbmplY3QoU0xJREVfSU5fREFUQSkgcHJpdmF0ZSBzbGlkZUluRGF0YTogeyBvcGVyYXRpb246IEJvb3RFbnZpcm9ubWVudEFjdGlvbjsgbmFtZT86IHN0cmluZyB9LFxuICApIHt9XG5cbiAgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuc2xpZGVJbkRhdGEpIHtcbiAgICAgIHRoaXMuY3VycmVudE5hbWUgPSB0aGlzLnNsaWRlSW5EYXRhLm5hbWU7XG4gICAgICB0aGlzLm9wZXJhdGlvbiA9IHRoaXMuc2xpZGVJbkRhdGEub3BlcmF0aW9uO1xuICAgICAgdGhpcy5zZXR1cEZvcm0oKTtcbiAgICB9XG4gIH1cblxuICBzZXR1cEZvcm0oKTogdm9pZCB7XG4gICAgc3dpdGNoICh0aGlzLm9wZXJhdGlvbikge1xuICAgICAgY2FzZSB0aGlzLk9wZXJhdGlvbnMuUmVuYW1lOlxuICAgICAgICB0aGlzLnRpdGxlID0gdGhpcy50cmFuc2xhdGUuaW5zdGFudCgnUmVuYW1lIEJvb3QgRW52aXJvbm1lbnQnKTtcbiAgICAgICAgdGhpcy5mb3JtR3JvdXAucGF0Y2hWYWx1ZSh7XG4gICAgICAgICAgbmFtZTogdGhpcy5jdXJyZW50TmFtZSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy50b29sdGlwcyA9IHtcbiAgICAgICAgICBuYW1lOiBoZWxwdGV4dFN5c3RlbUJvb3RlbnYuY3JlYXRlX25hbWVfdG9vbHRpcCxcbiAgICAgICAgfTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlIHRoaXMuT3BlcmF0aW9ucy5DbG9uZTpcbiAgICAgICAgdGhpcy50aXRsZSA9IHRoaXMudHJhbnNsYXRlLmluc3RhbnQoJ0Nsb25lIEJvb3QgRW52aXJvbm1lbnQnKTtcblxuICAgICAgICB0aGlzLmZvcm1Hcm91cC5hZGRDb250cm9sKFxuICAgICAgICAgICdzb3VyY2UnLFxuICAgICAgICAgIG5ldyBGb3JtQ29udHJvbCh7IHZhbHVlOiB0aGlzLmN1cnJlbnROYW1lLCBkaXNhYmxlZDogdHJ1ZSB9LCBWYWxpZGF0b3JzLnJlcXVpcmVkKSxcbiAgICAgICAgKTtcblxuICAgICAgICB0aGlzLnRvb2x0aXBzID0ge1xuICAgICAgICAgIG5hbWU6IGhlbHB0ZXh0U3lzdGVtQm9vdGVudi5jbG9uZV9uYW1lX3Rvb2x0aXAsXG4gICAgICAgICAgc291cmNlOiBoZWxwdGV4dFN5c3RlbUJvb3RlbnYuY2xvbmVfc291cmNlX3Rvb2x0aXAsXG4gICAgICAgIH07XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdGhpcy50aXRsZSA9IHRoaXMudHJhbnNsYXRlLmluc3RhbnQoJ0NyZWF0ZSBCb290IEVudmlyb25tZW50Jyk7XG4gICAgICAgIHRoaXMudG9vbHRpcHMgPSB7XG4gICAgICAgICAgbmFtZTogaGVscHRleHRTeXN0ZW1Cb290ZW52LmNyZWF0ZV9uYW1lX3Rvb2x0aXAsXG4gICAgICAgIH07XG4gICAgICAgIGJyZWFrO1xuICAgIH1cblxuICAgIHRoaXMuY2hhbmdlRGV0ZWN0b3JSZWYuZGV0ZWN0Q2hhbmdlcygpO1xuICB9XG5cbiAgb25TdWJtaXQoKTogdm9pZCB7XG4gICAgdGhpcy5pc0Zvcm1Mb2FkaW5nID0gdHJ1ZTtcbiAgICBzd2l0Y2ggKHRoaXMub3BlcmF0aW9uKSB7XG4gICAgICBjYXNlIHRoaXMuT3BlcmF0aW9ucy5DcmVhdGU6IHtcbiAgICAgICAgY29uc3QgY3JlYXRlUGFyYW1zOiBDcmVhdGVCb290ZW52UGFyYW1zID0gW3tcbiAgICAgICAgICBuYW1lOiB0aGlzLmZvcm1Hcm91cC52YWx1ZS5uYW1lLFxuICAgICAgICB9XTtcblxuICAgICAgICB0aGlzLndzLmNhbGwoJ2Jvb3RlbnYuY3JlYXRlJywgY3JlYXRlUGFyYW1zKS5waXBlKHVudGlsRGVzdHJveWVkKHRoaXMpKS5zdWJzY3JpYmUoe1xuICAgICAgICAgIG5leHQ6ICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuaXNGb3JtTG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5zbGlkZUluUmVmLmNsb3NlKHRydWUpO1xuICAgICAgICAgIH0sXG4gICAgICAgICAgZXJyb3I6IChlcnJvcjogdW5rbm93bikgPT4ge1xuICAgICAgICAgICAgdGhpcy5pc0Zvcm1Mb2FkaW5nID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLnNsaWRlSW5SZWYuY2xvc2UoZmFsc2UpO1xuICAgICAgICAgICAgdGhpcy5lcnJvckhhbmRsZXIuaGFuZGxlV3NGb3JtRXJyb3IoZXJyb3IsIHRoaXMuZm9ybUdyb3VwKTtcbiAgICAgICAgICB9LFxuICAgICAgICB9KTtcblxuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICAgIGNhc2UgdGhpcy5PcGVyYXRpb25zLlJlbmFtZToge1xuICAgICAgICBjb25zdCByZW5hbWVQYXJhbXM6IFVwZGF0ZUJvb3RlbnZQYXJhbXMgPSBbXG4gICAgICAgICAgdGhpcy5jdXJyZW50TmFtZSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBuYW1lOiB0aGlzLmZvcm1Hcm91cC52YWx1ZS5uYW1lLFxuICAgICAgICAgIH0sXG4gICAgICAgIF07XG5cbiAgICAgICAgdGhpcy53cy5jYWxsKCdib290ZW52LnVwZGF0ZScsIHJlbmFtZVBhcmFtcykucGlwZSh1bnRpbERlc3Ryb3llZCh0aGlzKSkuc3Vic2NyaWJlKHtcbiAgICAgICAgICBuZXh0OiAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmlzRm9ybUxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuc2xpZGVJblJlZi5jbG9zZSh0cnVlKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGVycm9yOiAoZXJyb3I6IHVua25vd24pID0+IHtcbiAgICAgICAgICAgIHRoaXMuaXNGb3JtTG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5zbGlkZUluUmVmLmNsb3NlKGZhbHNlKTtcbiAgICAgICAgICAgIHRoaXMuZXJyb3JIYW5kbGVyLmhhbmRsZVdzRm9ybUVycm9yKGVycm9yLCB0aGlzLmZvcm1Hcm91cCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICBjYXNlIHRoaXMuT3BlcmF0aW9ucy5DbG9uZToge1xuICAgICAgICBjb25zdCBjbG9uZVBhcmFtczogQ3JlYXRlQm9vdGVudlBhcmFtcyA9IFt7XG4gICAgICAgICAgbmFtZTogdGhpcy5mb3JtR3JvdXAudmFsdWUubmFtZSxcbiAgICAgICAgICBzb3VyY2U6IHRoaXMuY3VycmVudE5hbWUsXG4gICAgICAgIH1dO1xuXG4gICAgICAgIHRoaXMud3MuY2FsbCgnYm9vdGVudi5jcmVhdGUnLCBjbG9uZVBhcmFtcykucGlwZSh1bnRpbERlc3Ryb3llZCh0aGlzKSkuc3Vic2NyaWJlKHtcbiAgICAgICAgICBuZXh0OiAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmlzRm9ybUxvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuc2xpZGVJblJlZi5jbG9zZSh0cnVlKTtcbiAgICAgICAgICB9LFxuICAgICAgICAgIGVycm9yOiAoZXJyb3I6IHVua25vd24pID0+IHtcbiAgICAgICAgICAgIHRoaXMuaXNGb3JtTG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5zbGlkZUluUmVmLmNsb3NlKGZhbHNlKTtcbiAgICAgICAgICAgIHRoaXMuZXJyb3JIYW5kbGVyLmhhbmRsZVdzRm9ybUVycm9yKGVycm9yLCB0aGlzLmZvcm1Hcm91cCk7XG4gICAgICAgICAgfSxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICB9XG59XG4iXSwidmVyc2lvbiI6M30=