e4c6d6e18b7c70bd8cb8cbe8ee7c022e
"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", { value: true });
const testbed_1 = require("@angular/cdk/testing/testbed");
const forms_1 = require("@angular/forms");
const testing_1 = require("@angular/material/button/testing");
const jest_1 = require("@ngneat/spectator/jest");
const mock_auth_utils_1 = require("app/core/testing/utils/mock-auth.utils");
const mock_websocket_utils_1 = require("app/core/testing/utils/mock-websocket.utils");
const ix_slide_in_ref_1 = require("app/modules/forms/ix-forms/components/ix-slide-in/ix-slide-in-ref");
const ix_slide_in_token_1 = require("app/modules/forms/ix-forms/components/ix-slide-in/ix-slide-in.token");
const form_error_handler_service_1 = require("app/modules/forms/ix-forms/services/form-error-handler.service");
const ix_form_harness_1 = require("app/modules/forms/ix-forms/testing/ix-form.harness");
const static_route_form_component_1 = require("app/pages/network/components/static-route-form/static-route-form.component");
const ix_slide_in_service_1 = require("app/services/ix-slide-in.service");
const ws_service_1 = require("app/services/ws.service");
describe('StaticRouteFormComponent', () => {
    let spectator;
    let loader;
    let ws;
    const createComponent = (0, jest_1.createComponentFactory)({
        component: static_route_form_component_1.StaticRouteFormComponent,
        imports: [
            forms_1.ReactiveFormsModule,
        ],
        providers: [
            (0, mock_websocket_utils_1.mockWebSocket)([
                (0, mock_websocket_utils_1.mockCall)('staticroute.create'),
                (0, mock_websocket_utils_1.mockCall)('staticroute.update'),
            ]),
            (0, jest_1.mockProvider)(ix_slide_in_service_1.IxSlideInService),
            (0, jest_1.mockProvider)(form_error_handler_service_1.FormErrorHandlerService),
            (0, jest_1.mockProvider)(ix_slide_in_ref_1.IxSlideInRef),
            (0, mock_auth_utils_1.mockAuth)(),
            { provide: ix_slide_in_token_1.SLIDE_IN_DATA, useValue: undefined },
        ],
    });
    describe('adding a static route', () => {
        beforeEach(() => {
            spectator = createComponent();
            loader = testbed_1.TestbedHarnessEnvironment.loader(spectator.fixture);
            ws = spectator.inject(ws_service_1.WebSocketService);
        });
        it('sends a create payload to websocket and closes modal when save is pressed', () => __awaiter(void 0, void 0, void 0, function* () {
            const form = yield loader.getHarness(ix_form_harness_1.IxFormHarness);
            yield form.fillForm({
                Destination: '10.24.12.13/16',
                Gateway: '10.24.12.1',
                Description: 'My route',
            });
            const saveButton = yield loader.getHarness(testing_1.MatButtonHarness.with({ text: 'Save' }));
            yield saveButton.click();
            expect(ws.call).toHaveBeenCalledWith('staticroute.create', [{
                    destination: '10.24.12.13/16',
                    gateway: '10.24.12.1',
                    description: 'My route',
                }]);
        }));
    });
    describe('editing a group', () => {
        beforeEach(() => {
            spectator = createComponent({
                providers: [
                    {
                        provide: ix_slide_in_token_1.SLIDE_IN_DATA,
                        useValue: {
                            id: 13,
                            description: 'Existing route',
                            destination: '20.24.12.13/16',
                            gateway: '20.24.12.1',
                        },
                    },
                ],
            });
            loader = testbed_1.TestbedHarnessEnvironment.loader(spectator.fixture);
            ws = spectator.inject(ws_service_1.WebSocketService);
        });
        it('shows current group values when form is being edited', () => __awaiter(void 0, void 0, void 0, function* () {
            const form = yield loader.getHarness(ix_form_harness_1.IxFormHarness);
            const values = yield form.getValues();
            expect(values).toEqual({
                Destination: '20.24.12.13/16',
                Gateway: '20.24.12.1',
                Description: 'Existing route',
            });
        }));
        it('sends an update payload to websocket and closes modal when save is pressed', () => __awaiter(void 0, void 0, void 0, function* () {
            const form = yield loader.getHarness(ix_form_harness_1.IxFormHarness);
            yield form.fillForm({
                Destination: '15.24.12.13/16',
                Gateway: '15.24.12.1',
                Description: 'Updated route',
            });
            const saveButton = yield loader.getHarness(testing_1.MatButtonHarness.with({ text: 'Save' }));
            yield saveButton.click();
            expect(ws.call).toHaveBeenCalledWith('staticroute.update', [
                13,
                {
                    destination: '15.24.12.13/16',
                    gateway: '15.24.12.1',
                    description: 'Updated route',
                },
            ]);
        }));
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL21hY2Jvb2sva2FycG92LXdvcmsvVHJ1ZU5BUy93ZWJ1aS9zcmMvYXBwL3BhZ2VzL25ldHdvcmsvY29tcG9uZW50cy9zdGF0aWMtcm91dGUtZm9ybS9zdGF0aWMtcm91dGUtZm9ybS5jb21wb25lbnQuc3BlYy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7OztBQUNBLDBEQUF5RTtBQUN6RSwwQ0FBcUQ7QUFDckQsOERBQW9FO0FBQ3BFLGlEQUF5RjtBQUN6Riw0RUFBa0U7QUFDbEUsc0ZBQXNGO0FBRXRGLHVHQUFpRztBQUNqRywyR0FBb0c7QUFDcEcsK0dBQXlHO0FBQ3pHLHdGQUFtRjtBQUNuRiw0SEFBc0g7QUFDdEgsMEVBQW9FO0FBQ3BFLHdEQUEyRDtBQUUzRCxRQUFRLENBQUMsMEJBQTBCLEVBQUUsR0FBRyxFQUFFO0lBQ3hDLElBQUksU0FBOEMsQ0FBQztJQUNuRCxJQUFJLE1BQXFCLENBQUM7SUFDMUIsSUFBSSxFQUFvQixDQUFDO0lBQ3pCLE1BQU0sZUFBZSxHQUFHLElBQUEsNkJBQXNCLEVBQUM7UUFDN0MsU0FBUyxFQUFFLHNEQUF3QjtRQUNuQyxPQUFPLEVBQUU7WUFDUCwyQkFBbUI7U0FDcEI7UUFDRCxTQUFTLEVBQUU7WUFDVCxJQUFBLG9DQUFhLEVBQUM7Z0JBQ1osSUFBQSwrQkFBUSxFQUFDLG9CQUFvQixDQUFDO2dCQUM5QixJQUFBLCtCQUFRLEVBQUMsb0JBQW9CLENBQUM7YUFDL0IsQ0FBQztZQUNGLElBQUEsbUJBQVksRUFBQyxzQ0FBZ0IsQ0FBQztZQUM5QixJQUFBLG1CQUFZLEVBQUMsb0RBQXVCLENBQUM7WUFDckMsSUFBQSxtQkFBWSxFQUFDLDhCQUFZLENBQUM7WUFDMUIsSUFBQSwwQkFBUSxHQUFFO1lBQ1YsRUFBRSxPQUFPLEVBQUUsaUNBQWEsRUFBRSxRQUFRLEVBQUUsU0FBUyxFQUFFO1NBQ2hEO0tBQ0YsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLHVCQUF1QixFQUFFLEdBQUcsRUFBRTtRQUNyQyxVQUFVLENBQUMsR0FBRyxFQUFF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QUV6QixNQUFNLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxDQUFDLG9CQUFvQixDQUFDLG9CQUFvQixFQUFFO2dCQUN6RCxFQUFFO2dCQUNGO29CQUNFLFdBQVcsRUFBRSxnQkFBZ0I7b0JBQzdCLE9BQU8sRUFBRSxZQUFZO29CQUNyQixXQUFXLEVBQUUsZUFBZTtpQkFDN0I7YUFDRixDQUFDLENBQUM7UUFDTCxDQUFDLENBQUEsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvbWFjYm9vay9rYXJwb3Ytd29yay9UcnVlTkFTL3dlYnVpL3NyYy9hcHAvcGFnZXMvbmV0d29yay9jb21wb25lbnRzL3N0YXRpYy1yb3V0ZS1mb3JtL3N0YXRpYy1yb3V0ZS1mb3JtLmNvbXBvbmVudC5zcGVjLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEhhcm5lc3NMb2FkZXIgfSBmcm9tICdAYW5ndWxhci9jZGsvdGVzdGluZyc7XG5pbXBvcnQgeyBUZXN0YmVkSGFybmVzc0Vudmlyb25tZW50IH0gZnJvbSAnQGFuZ3VsYXIvY2RrL3Rlc3RpbmcvdGVzdGJlZCc7XG5pbXBvcnQgeyBSZWFjdGl2ZUZvcm1zTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHsgTWF0QnV0dG9uSGFybmVzcyB9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsL2J1dHRvbi90ZXN0aW5nJztcbmltcG9ydCB7IGNyZWF0ZUNvbXBvbmVudEZhY3RvcnksIG1vY2tQcm92aWRlciwgU3BlY3RhdG9yIH0gZnJvbSAnQG5nbmVhdC9zcGVjdGF0b3IvamVzdCc7XG5pbXBvcnQgeyBtb2NrQXV0aCB9IGZyb20gJ2FwcC9jb3JlL3Rlc3RpbmcvdXRpbHMvbW9jay1hdXRoLnV0aWxzJztcbmltcG9ydCB7IG1vY2tDYWxsLCBtb2NrV2ViU29ja2V0IH0gZnJvbSAnYXBwL2NvcmUvdGVzdGluZy91dGlscy9tb2NrLXdlYnNvY2tldC51dGlscyc7XG5pbXBvcnQgeyBTdGF0aWNSb3V0ZSB9IGZyb20gJ2FwcC9pbnRlcmZhY2VzL3N0YXRpYy1yb3V0ZS5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgSXhTbGlkZUluUmVmIH0gZnJvbSAnYXBwL21vZHVsZXMvZm9ybXMvaXgtZm9ybXMvY29tcG9uZW50cy9peC1zbGlkZS1pbi9peC1zbGlkZS1pbi1yZWYnO1xuaW1wb3J0IHsgU0xJREVfSU5fREFUQSB9IGZyb20gJ2FwcC9tb2R1bGVzL2Zvcm1zL2l4LWZvcm1zL2NvbXBvbmVudHMvaXgtc2xpZGUtaW4vaXgtc2xpZGUtaW4udG9rZW4nO1xuaW1wb3J0IHsgRm9ybUVycm9ySGFuZGxlclNlcnZpY2UgfSBmcm9tICdhcHAvbW9kdWxlcy9mb3Jtcy9peC1mb3Jtcy9zZXJ2aWNlcy9mb3JtLWVycm9yLWhhbmRsZXIuc2VydmljZSc7XG5pbXBvcnQgeyBJeEZvcm1IYXJuZXNzIH0gZnJvbSAnYXBwL21vZHVsZXMvZm9ybXMvaXgtZm9ybXMvdGVzdGluZy9peC1mb3JtLmhhcm5lc3MnO1xuaW1wb3J0IHsgU3RhdGljUm91dGVGb3JtQ29tcG9uZW50IH0gZnJvbSAnYXBwL3BhZ2VzL25ldHdvcmsvY29tcG9uZW50cy9zdGF0aWMtcm91dGUtZm9ybS9zdGF0aWMtcm91dGUtZm9ybS5jb21wb25lbnQnO1xuaW1wb3J0IHsgSXhTbGlkZUluU2VydmljZSB9IGZyb20gJ2FwcC9zZXJ2aWNlcy9peC1zbGlkZS1pbi5zZXJ2aWNlJztcbmltcG9ydCB7IFdlYlNvY2tldFNlcnZpY2UgfSBmcm9tICdhcHAvc2VydmljZXMvd3Muc2VydmljZSc7XG5cbmRlc2NyaWJlKCdTdGF0aWNSb3V0ZUZvcm1Db21wb25lbnQnLCAoKSA9PiB7XG4gIGxldCBzcGVjdGF0b3I6IFNwZWN0YXRvcjxTdGF0aWNSb3V0ZUZvcm1Db21wb25lbnQ+O1xuICBsZXQgbG9hZGVyOiBIYXJuZXNzTG9hZGVyO1xuICBsZXQgd3M6IFdlYlNvY2tldFNlcnZpY2U7XG4gIGNvbnN0IGNyZWF0ZUNvbXBvbmVudCA9IGNyZWF0ZUNvbXBvbmVudEZhY3Rvcnkoe1xuICAgIGNvbXBvbmVudDogU3RhdGljUm91dGVGb3JtQ29tcG9uZW50LFxuICAgIGltcG9ydHM6IFtcbiAgICAgIFJlYWN0aXZlRm9ybXNNb2R1bGUsXG4gICAgXSxcbiAgICBwcm92aWRlcnM6IFtcbiAgICAgIG1vY2tXZWJTb2NrZXQoW1xuICAgICAgICBtb2NrQ2FsbCgnc3RhdGljcm91dGUuY3JlYXRlJyksXG4gICAgICAgIG1vY2tDYWxsKCdzdGF0aWNyb3V0ZS51cGRhdGUnKSxcbiAgICAgIF0pLFxuICAgICAgbW9ja1Byb3ZpZGVyKEl4U2xpZGVJblNlcnZpY2UpLFxuICAgICAgbW9ja1Byb3ZpZGVyKEZvcm1FcnJvckhhbmRsZXJTZXJ2aWNlKSxcbiAgICAgIG1vY2tQcm92aWRlcihJeFNsaWRlSW5SZWYpLFxuICAgICAgbW9ja0F1dGgoKSxcbiAgICAgIHsgcHJvdmlkZTogU0xJREVfSU5fREFUQSwgdXNlVmFsdWU6IHVuZGVmaW5lZCB9LFxuICAgIF0sXG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdhZGRpbmcgYSBzdGF0aWMgcm91dGUnLCAoKSA9PiB7XG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICBzcGVjdGF0b3IgPSBjcmVhdGVDb21wb25lbnQoKTtcbiAgICAgIGxvYWRlciA9IFRlc3RiZWRIYXJuZXNzRW52aXJvbm1lbnQubG9hZGVyKHNwZWN0YXRvci5maXh0dXJlKTtcbiAgICAgIHdzID0gc3BlY3RhdG9yLmluamVjdChXZWJTb2NrZXRTZXJ2aWNlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzZW5kcyBhIGNyZWF0ZSBwYXlsb2FkIHRvIHdlYnNvY2tldCBhbmQgY2xvc2VzIG1vZGFsIHdoZW4gc2F2ZSBpcyBwcmVzc2VkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZm9ybSA9IGF3YWl0IGxvYWRlci5nZXRIYXJuZXNzKEl4Rm9ybUhhcm5lc3MpO1xuICAgICAgYXdhaXQgZm9ybS5maWxsRm9ybSh7XG4gICAgICAgIERlc3RpbmF0aW9uOiAnMTAuMjQuMTIuMTMvMTYnLFxuICAgICAgICBHYXRld2F5OiAnMTAuMjQuMTIuMScsXG4gICAgICAgIERlc2NyaXB0aW9uOiAnTXkgcm91dGUnLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHNhdmVCdXR0b24gPSBhd2FpdCBsb2FkZXIuZ2V0SGFybmVzcyhNYXRCdXR0b25IYXJuZXNzLndpdGgoeyB0ZXh0OiAnU2F2ZScgfSkpO1xuICAgICAgYXdhaXQgc2F2ZUJ1dHRvbi5jbGljaygpO1xuXG4gICAgICBleHBlY3Qod3MuY2FsbCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3N0YXRpY3JvdXRlLmNyZWF0ZScsIFt7XG4gICAgICAgIGRlc3RpbmF0aW9uOiAnMTAuMjQuMTIuMTMvMTYnLFxuICAgICAgICBnYXRld2F5OiAnMTAuMjQuMTIuMScsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnTXkgcm91dGUnLFxuICAgICAgfV0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZWRpdGluZyBhIGdyb3VwJywgKCkgPT4ge1xuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgc3BlY3RhdG9yID0gY3JlYXRlQ29tcG9uZW50KHtcbiAgICAgICAgcHJvdmlkZXJzOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgcHJvdmlkZTogU0xJREVfSU5fREFUQSxcbiAgICAgICAgICAgIHVzZVZhbHVlOiB7XG4gICAgICAgICAgICAgIGlkOiAxMyxcbiAgICAgICAgICAgICAgZGVzY3JpcHRpb246ICdFeGlzdGluZyByb3V0ZScsXG4gICAgICAgICAgICAgIGRlc3RpbmF0aW9uOiAnMjAuMjQuMTIuMTMvMTYnLFxuICAgICAgICAgICAgICBnYXRld2F5OiAnMjAuMjQuMTIuMScsXG4gICAgICAgICAgICB9IGFzIFN0YXRpY1JvdXRlLFxuICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgICB9KTtcbiAgICAgIGxvYWRlciA9IFRlc3RiZWRIYXJuZXNzRW52aXJvbm1lbnQubG9hZGVyKHNwZWN0YXRvci5maXh0dXJlKTtcbiAgICAgIHdzID0gc3BlY3RhdG9yLmluamVjdChXZWJTb2NrZXRTZXJ2aWNlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG93cyBjdXJyZW50IGdyb3VwIHZhbHVlcyB3aGVuIGZvcm0gaXMgYmVpbmcgZWRpdGVkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZm9ybSA9IGF3YWl0IGxvYWRlci5nZXRIYXJuZXNzKEl4Rm9ybUhhcm5lc3MpO1xuICAgICAgY29uc3QgdmFsdWVzID0gYXdhaXQgZm9ybS5nZXRWYWx1ZXMoKTtcblxuICAgICAgZXhwZWN0KHZhbHVlcykudG9FcXVhbCh7XG4gICAgICAgIERlc3RpbmF0aW9uOiAnMjAuMjQuMTIuMTMvMTYnLFxuICAgICAgICBHYXRld2F5OiAnMjAuMjQuMTIuMScsXG4gICAgICAgIERlc2NyaXB0aW9uOiAnRXhpc3Rpbmcgcm91dGUnLFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2VuZHMgYW4gdXBkYXRlIHBheWxvYWQgdG8gd2Vic29ja2V0IGFuZCBjbG9zZXMgbW9kYWwgd2hlbiBzYXZlIGlzIHByZXNzZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBmb3JtID0gYXdhaXQgbG9hZGVyLmdldEhhcm5lc3MoSXhGb3JtSGFybmVzcyk7XG4gICAgICBhd2FpdCBmb3JtLmZpbGxGb3JtKHtcbiAgICAgICAgRGVzdGluYXRpb246ICcxNS4yNC4xMi4xMy8xNicsXG4gICAgICAgIEdhdGV3YXk6ICcxNS4yNC4xMi4xJyxcbiAgICAgICAgRGVzY3JpcHRpb246ICdVcGRhdGVkIHJvdXRlJyxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBzYXZlQnV0dG9uID0gYXdhaXQgbG9hZGVyLmdldEhhcm5lc3MoTWF0QnV0dG9uSGFybmVzcy53aXRoKHsgdGV4dDogJ1NhdmUnIH0pKTtcbiAgICAgIGF3YWl0IHNhdmVCdXR0b24uY2xpY2soKTtcblxuICAgICAgZXhwZWN0KHdzLmNhbGwpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdzdGF0aWNyb3V0ZS51cGRhdGUnLCBbXG4gICAgICAgIDEzLFxuICAgICAgICB7XG4gICAgICAgICAgZGVzdGluYXRpb246ICcxNS4yNC4xMi4xMy8xNicsXG4gICAgICAgICAgZ2F0ZXdheTogJzE1LjI0LjEyLjEnLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiAnVXBkYXRlZCByb3V0ZScsXG4gICAgICAgIH0sXG4gICAgICBdKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==