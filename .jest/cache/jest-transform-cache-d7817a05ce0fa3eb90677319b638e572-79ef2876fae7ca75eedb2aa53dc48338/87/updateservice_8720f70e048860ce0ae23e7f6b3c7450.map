{"file":"/Users/macbook/karpov-work/TrueNAS/webui/src/app/services/update.service.ts","mappings":";;;;;;;;;AAAA,wCAAmD;AAEnD,8CAAqC;AACrC,6DAAmD;AACnD,wDAA2D;AAKpD,IAAM,aAAa,GAAnB,MAAM,aAAa;IAGxB,YACU,EAAoB,EACJ,MAAc;QAD9B,OAAE,GAAF,EAAE,CAAkB;QACJ,WAAM,GAAN,MAAM,CAAQ;IACrC,CAAC;IAEJ;;OAEG;IACH,mBAAmB;QACjB,OAAO,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC,IAAI,CACxC,IAAA,eAAG,EAAC,CAAC,MAAM,EAAE,EAAE;YACb,IAAI,CAAC,IAAI,CAAC,cAAc,EAAE,CAAC;gBACzB,cAAc;gBACd,IAAI,CAAC,cAAc,GAAG,MAAM,CAAC;gBAC7B,OAAO;YACT,CAAC;YAED,IAAI,IAAI,CAAC,cAAc,KAAK,MAAM,EAAE,CAAC;gBACnC,aAAa;gBACb,OAAO;YACT,CAAC;YAED,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,MAAM,EAAE,CAAC;QAChC,CAAC,CAAC,CACH,CAAC;IACJ,CAAC;;AA5BU,sCAAa;;;yCAKrB,aAAM,SAAC,sBAAM;;wBALL,aAAa;IAHzB,IAAA,iBAAU,EAAC;QACV,UAAU,EAAE,MAAM;KACnB,CAAC;GACW,aAAa,CA6BzB","names":[],"sources":["/Users/macbook/karpov-work/TrueNAS/webui/src/app/services/update.service.ts"],"sourcesContent":["import { Inject, Injectable } from '@angular/core';\nimport { Observable } from 'rxjs';\nimport { tap } from 'rxjs/operators';\nimport { WINDOW } from 'app/helpers/window.helper';\nimport { WebSocketService } from 'app/services/ws.service';\n\n@Injectable({\n  providedIn: 'root',\n})\nexport class UpdateService {\n  private lastSeenBootId: string;\n\n  constructor(\n    private ws: WebSocketService,\n    @Inject(WINDOW) private window: Window,\n  ) {}\n\n  /**\n   * Hard refresh is needed to load new html and js after the update.\n   */\n  hardRefreshIfNeeded(): Observable<string> {\n    return this.ws.call('system.boot_id').pipe(\n      tap((bootId) => {\n        if (!this.lastSeenBootId) {\n          // First boot.\n          this.lastSeenBootId = bootId;\n          return;\n        }\n\n        if (this.lastSeenBootId === bootId) {\n          // No update.\n          return;\n        }\n\n        this.window.location.reload();\n      }),\n    );\n  }\n}\n"],"version":3}