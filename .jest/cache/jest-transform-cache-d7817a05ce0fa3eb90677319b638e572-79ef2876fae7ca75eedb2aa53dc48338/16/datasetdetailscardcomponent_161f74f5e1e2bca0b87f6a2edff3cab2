b26806e99c0273b774807755ed6ec483
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.DatasetDetailsCardComponent = void 0;
const core_1 = require("@angular/core");
const dialog_1 = require("@angular/material/dialog");
const router_1 = require("@angular/router");
const until_destroy_1 = require("@ngneat/until-destroy");
const core_2 = require("@ngx-translate/core");
const operators_1 = require("rxjs/operators");
const dataset_enum_1 = require("app/enums/dataset.enum");
const on_off_enum_1 = require("app/enums/on-off.enum");
const role_enum_1 = require("app/enums/role.enum");
const zfs_property_source_enum_1 = require("app/enums/zfs-property-source.enum");
const snackbar_service_1 = require("app/modules/snackbar/services/snackbar.service");
const dataset_form_component_1 = require("app/pages/datasets/components/dataset-form/dataset-form.component");
const delete_dataset_dialog_component_1 = require("app/pages/datasets/components/delete-dataset-dialog/delete-dataset-dialog.component");
const zvol_form_component_1 = require("app/pages/datasets/components/zvol-form/zvol-form.component");
const dataset_store_service_1 = require("app/pages/datasets/store/dataset-store.service");
const error_handler_service_1 = require("app/services/error-handler.service");
const ix_slide_in_service_1 = require("app/services/ix-slide-in.service");
const ws_service_1 = require("app/services/ws.service");
const i0 = __importStar(require("@angular/core"));
let DatasetDetailsCardComponent = class DatasetDetailsCardComponent {
    constructor(translate, matDialog, datasetStore, slideInService, errorHandler, router, ws, snackbar) {
        this.translate = translate;
        this.matDialog = matDialog;
        this.datasetStore = datasetStore;
        this.slideInService = slideInService;
        this.errorHandler = errorHandler;
        this.router = router;
        this.ws = ws;
        this.snackbar = snackbar;
        this.dataset = core_1.input.required();
        this.Role = role_enum_1.Role;
        this.OnOff = on_off_enum_1.OnOff;
        this.datasetCompression = (0, core_1.computed)(() => {
            var _a, _b, _c, _d;
            return ((_b = (_a = this.dataset()) === null || _a === void 0 ? void 0 : _a.compression) === null || _b === void 0 ? void 0 : _b.source) === zfs_property_source_enum_1.ZfsPropertySource.Inherited
                ? this.translate.instant('Inherit ({value})', { value: (_c = this.dataset().compression) === null || _c === void 0 ? void 0 : _c.value })
                : (_d = this.dataset().compression) === null || _d === void 0 ? void 0 : _d.value;
        });
        this.isFilesystem = (0, core_1.computed)(() => this.dataset().type === dataset_enum_1.DatasetType.Filesystem);
        this.isZvol = (0, core_1.computed)(() => this.dataset().type === dataset_enum_1.DatasetType.Volume);
        this.hasComments = (0, core_1.computed)(() => {
            var _a, _b, _c;
            return ((_a = this.dataset().comments) === null || _a === void 0 ? void 0 : _a.source) === zfs_property_source_enum_1.ZfsPropertySource.Local && !!((_c = (_b = this.dataset().comments) === null || _b === void 0 ? void 0 : _b.value) === null || _c === void 0 ? void 0 : _c.length);
        });
        this.canBePromoted = (0, core_1.computed)(() => { var _a; return Boolean((_a = this.dataset().origin) === null || _a === void 0 ? void 0 : _a.parsed); });
    }
    deleteDataset() {
        this.matDialog.open(delete_dataset_dialog_component_1.DeleteDatasetDialogComponent, { data: this.dataset() })
            .afterClosed()
            .pipe((0, operators_1.filter)(Boolean), (0, operators_1.switchMap)(() => {
            this.datasetStore.datasetUpdated();
            return this.datasetStore.selectedParentDataset$.pipe((0, operators_1.first)());
        }), (0, until_destroy_1.untilDestroyed)(this))
            .subscribe((parent) => {
            this.router.navigate(['/datasets', parent === null || parent === void 0 ? void 0 : parent.id], { state: { hideMobileDetails: true } });
        });
    }
    promoteDataset() {
        this.ws.call('pool.dataset.promote', [this.dataset().id])
            .pipe(this.errorHandler.catchError(), (0, until_destroy_1.untilDestroyed)(this))
            .subscribe(() => {
            this.snackbar.success(this.translate.instant('Dataset promoted successfully.'));
            this.datasetStore.datasetUpdated();
        });
    }
    editDataset() {
        const slideInRef = this.slideInService.open(dataset_form_component_1.DatasetFormComponent, {
            wide: true, data: { datasetId: this.dataset().id, isNew: false },
        });
        slideInRef.slideInClosed$.pipe((0, operators_1.filter)(Boolean), (0, until_destroy_1.untilDestroyed)(this)).subscribe(() => this.datasetStore.datasetUpdated());
    }
    editZvol() {
        const slideInRef = this.slideInService.open(zvol_form_component_1.ZvolFormComponent, {
            data: { isNew: false, parentId: this.dataset().id },
        });
        slideInRef.slideInClosed$.pipe((0, operators_1.filter)(Boolean), (0, until_destroy_1.untilDestroyed)(this)).subscribe(() => this.datasetStore.datasetUpdated());
    }
};
exports.DatasetDetailsCardComponent = DatasetDetailsCardComponent;
DatasetDetailsCardComponent.ctorParameters = () => [
    { type: core_2.TranslateService },
    { type: dialog_1.MatDialog },
    { type: dataset_store_service_1.DatasetTreeStore },
    { type: ix_slide_in_service_1.IxSlideInService },
    { type: error_handler_service_1.ErrorHandlerService },
    { type: router_1.Router },
    { type: ws_service_1.WebSocketService },
    { type: snackbar_service_1.SnackbarService }
];
DatasetDetailsCardComponent.propDecorators = {
    dataset: [{ type: i0.Input, args: [{ isSignal: true, alias: "dataset", required: true, transform: undefined },] }]
};
exports.DatasetDetailsCardComponent = DatasetDetailsCardComponent = __decorate([
    (0, until_destroy_1.UntilDestroy)(),
    (0, core_1.Component)({
        selector: 'ix-dataset-details-card',
        template: require("./dataset-details-card.component.html"),
        changeDetection: core_1.ChangeDetectionStrategy.OnPush,
    })
], DatasetDetailsCardComponent);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL21hY2Jvb2sva2FycG92LXdvcmsvVHJ1ZU5BUy93ZWJ1aS9zcmMvYXBwL3BhZ2VzL2RhdGFzZXRzL2NvbXBvbmVudHMvZGF0YXNldC1kZXRhaWxzLWNhcmQvZGF0YXNldC1kZXRhaWxzLWNhcmQuY29tcG9uZW50LnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsd0NBRXVCO0FBQ3ZCLHFEQUFxRDtBQUNyRCw0Q0FBeUM7QUFDekMseURBQXFFO0FBQ3JFLDhDQUF1RDtBQUN2RCw4Q0FBMEQ7QUFDMUQseURBQXFEO0FBQ3JELHVEQUE4QztBQUM5QyxtREFBMkM7QUFDM0MsaUZBQXVFO0FBRXZFLHFGQUFpRjtBQUNqRiw4R0FBeUc7QUFDekcseUlBQW1JO0FBQ25JLHFHQUFnRztBQUNoRywwRkFBa0Y7QUFDbEYsOEVBQXlFO0FBQ3pFLDBFQUFvRTtBQUNwRSx3REFBMkQ7O0FBU3BELElBQU0sMkJBQTJCLEdBQWpDLE1BQU0sMkJBQTJCO0lBTXRDLFlBQ1UsU0FBMkIsRUFDM0IsU0FBb0IsRUFDcEIsWUFBOEIsRUFDOUIsY0FBZ0MsRUFDaEMsWUFBaUMsRUFDakMsTUFBYyxFQUNkLEVBQW9CLEVBQ3BCLFFBQXlCO1FBUHpCLGNBQVMsR0FBVCxTQUFTLENBQWtCO1FBQzNCLGNBQVMsR0FBVCxTQUFTLENBQVc7UUFDcEIsaUJBQVksR0FBWixZQUFZLENBQWtCO1FBQzlCLG1CQUFjLEdBQWQsY0FBYyxDQUFrQjtRQUNoQyxpQkFBWSxHQUFaLFlBQVksQ0FBcUI7UUFDakMsV0FBTSxHQUFOLE1BQU0sQ0FBUTtRQUNkLE9BQUUsR0FBRixFQUFFLENBQWtCO1FBQ3BCLGFBQVEsR0FBUixRQUFRLENBQWlCO3VCQWJoQixZQUFLLENBQUMsUUFBUSxFQUFrQjtRQUVoQyxTQUFJLEdBQUcsZ0JBQUksQ0FBQztRQUN0QixVQUFLLEdBQUcsbUJBQUssQ0FBQztRQWFKLHVCQUFrQixHQUFHLElBQUEsZUFBUSxFQUFDLEdBQUcsRUFBRTs7WUFDcEQs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O1FBRXBELGVBQWUsRUFBRSw4QkFBdUIsQ0FBQyxNQUFNO0tBQ2hELENBQUM7R0FDVywyQkFBMkIsQ0E0RXZDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9tYWNib29rL2thcnBvdi13b3JrL1RydWVOQVMvd2VidWkvc3JjL2FwcC9wYWdlcy9kYXRhc2V0cy9jb21wb25lbnRzL2RhdGFzZXQtZGV0YWlscy1jYXJkL2RhdGFzZXQtZGV0YWlscy1jYXJkLmNvbXBvbmVudC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSwgQ29tcG9uZW50LCBjb21wdXRlZCwgaW5wdXQsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgTWF0RGlhbG9nIH0gZnJvbSAnQGFuZ3VsYXIvbWF0ZXJpYWwvZGlhbG9nJztcbmltcG9ydCB7IFJvdXRlciB9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XG5pbXBvcnQgeyBVbnRpbERlc3Ryb3ksIHVudGlsRGVzdHJveWVkIH0gZnJvbSAnQG5nbmVhdC91bnRpbC1kZXN0cm95JztcbmltcG9ydCB7IFRyYW5zbGF0ZVNlcnZpY2UgfSBmcm9tICdAbmd4LXRyYW5zbGF0ZS9jb3JlJztcbmltcG9ydCB7IGZpbHRlciwgZmlyc3QsIHN3aXRjaE1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IERhdGFzZXRUeXBlIH0gZnJvbSAnYXBwL2VudW1zL2RhdGFzZXQuZW51bSc7XG5pbXBvcnQgeyBPbk9mZiB9IGZyb20gJ2FwcC9lbnVtcy9vbi1vZmYuZW51bSc7XG5pbXBvcnQgeyBSb2xlIH0gZnJvbSAnYXBwL2VudW1zL3JvbGUuZW51bSc7XG5pbXBvcnQgeyBaZnNQcm9wZXJ0eVNvdXJjZSB9IGZyb20gJ2FwcC9lbnVtcy96ZnMtcHJvcGVydHktc291cmNlLmVudW0nO1xuaW1wb3J0IHsgRGF0YXNldERldGFpbHMgfSBmcm9tICdhcHAvaW50ZXJmYWNlcy9kYXRhc2V0LmludGVyZmFjZSc7XG5pbXBvcnQgeyBTbmFja2JhclNlcnZpY2UgfSBmcm9tICdhcHAvbW9kdWxlcy9zbmFja2Jhci9zZXJ2aWNlcy9zbmFja2Jhci5zZXJ2aWNlJztcbmltcG9ydCB7IERhdGFzZXRGb3JtQ29tcG9uZW50IH0gZnJvbSAnYXBwL3BhZ2VzL2RhdGFzZXRzL2NvbXBvbmVudHMvZGF0YXNldC1mb3JtL2RhdGFzZXQtZm9ybS5jb21wb25lbnQnO1xuaW1wb3J0IHsgRGVsZXRlRGF0YXNldERpYWxvZ0NvbXBvbmVudCB9IGZyb20gJ2FwcC9wYWdlcy9kYXRhc2V0cy9jb21wb25lbnRzL2RlbGV0ZS1kYXRhc2V0LWRpYWxvZy9kZWxldGUtZGF0YXNldC1kaWFsb2cuY29tcG9uZW50JztcbmltcG9ydCB7IFp2b2xGb3JtQ29tcG9uZW50IH0gZnJvbSAnYXBwL3BhZ2VzL2RhdGFzZXRzL2NvbXBvbmVudHMvenZvbC1mb3JtL3p2b2wtZm9ybS5jb21wb25lbnQnO1xuaW1wb3J0IHsgRGF0YXNldFRyZWVTdG9yZSB9IGZyb20gJ2FwcC9wYWdlcy9kYXRhc2V0cy9zdG9yZS9kYXRhc2V0LXN0b3JlLnNlcnZpY2UnO1xuaW1wb3J0IHsgRXJyb3JIYW5kbGVyU2VydmljZSB9IGZyb20gJ2FwcC9zZXJ2aWNlcy9lcnJvci1oYW5kbGVyLnNlcnZpY2UnO1xuaW1wb3J0IHsgSXhTbGlkZUluU2VydmljZSB9IGZyb20gJ2FwcC9zZXJ2aWNlcy9peC1zbGlkZS1pbi5zZXJ2aWNlJztcbmltcG9ydCB7IFdlYlNvY2tldFNlcnZpY2UgfSBmcm9tICdhcHAvc2VydmljZXMvd3Muc2VydmljZSc7XG5cbkBVbnRpbERlc3Ryb3koKVxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnaXgtZGF0YXNldC1kZXRhaWxzLWNhcmQnLFxuICB0ZW1wbGF0ZVVybDogJy4vZGF0YXNldC1kZXRhaWxzLWNhcmQuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9kYXRhc2V0LWRldGFpbHMtY2FyZC5jb21wb25lbnQuc2NzcyddLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcbn0pXG5leHBvcnQgY2xhc3MgRGF0YXNldERldGFpbHNDYXJkQ29tcG9uZW50IHtcbiAgcmVhZG9ubHkgZGF0YXNldCA9IGlucHV0LnJlcXVpcmVkPERhdGFzZXREZXRhaWxzPigpO1xuXG4gIHByb3RlY3RlZCByZWFkb25seSBSb2xlID0gUm9sZTtcbiAgcmVhZG9ubHkgT25PZmYgPSBPbk9mZjtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIHRyYW5zbGF0ZTogVHJhbnNsYXRlU2VydmljZSxcbiAgICBwcml2YXRlIG1hdERpYWxvZzogTWF0RGlhbG9nLFxuICAgIHByaXZhdGUgZGF0YXNldFN0b3JlOiBEYXRhc2V0VHJlZVN0b3JlLFxuICAgIHByaXZhdGUgc2xpZGVJblNlcnZpY2U6IEl4U2xpZGVJblNlcnZpY2UsXG4gICAgcHJpdmF0ZSBlcnJvckhhbmRsZXI6IEVycm9ySGFuZGxlclNlcnZpY2UsXG4gICAgcHJpdmF0ZSByb3V0ZXI6IFJvdXRlcixcbiAgICBwcml2YXRlIHdzOiBXZWJTb2NrZXRTZXJ2aWNlLFxuICAgIHByaXZhdGUgc25hY2tiYXI6IFNuYWNrYmFyU2VydmljZSxcbiAgKSB7IH1cblxuICBwcm90ZWN0ZWQgcmVhZG9ubHkgZGF0YXNldENvbXByZXNzaW9uID0gY29tcHV0ZWQoKCkgPT4ge1xuICAgIHJldHVybiB0aGlzLmRhdGFzZXQoKT8uY29tcHJlc3Npb24/LnNvdXJjZSA9PT0gWmZzUHJvcGVydHlTb3VyY2UuSW5oZXJpdGVkXG4gICAgICA/IHRoaXMudHJhbnNsYXRlLmluc3RhbnQoJ0luaGVyaXQgKHt2YWx1ZX0pJywgeyB2YWx1ZTogdGhpcy5kYXRhc2V0KCkuY29tcHJlc3Npb24/LnZhbHVlIH0pXG4gICAgICA6IHRoaXMuZGF0YXNldCgpLmNvbXByZXNzaW9uPy52YWx1ZTtcbiAgfSk7XG5cbiAgcHJvdGVjdGVkIHJlYWRvbmx5IGlzRmlsZXN5c3RlbSA9IGNvbXB1dGVkKCgpID0+IHRoaXMuZGF0YXNldCgpLnR5cGUgPT09IERhdGFzZXRUeXBlLkZpbGVzeXN0ZW0pO1xuICBwcm90ZWN0ZWQgcmVhZG9ubHkgaXNadm9sID0gY29tcHV0ZWQoKCkgPT4gdGhpcy5kYXRhc2V0KCkudHlwZSA9PT0gRGF0YXNldFR5cGUuVm9sdW1lKTtcblxuICBwcm90ZWN0ZWQgcmVhZG9ubHkgaGFzQ29tbWVudHMgPSBjb21wdXRlZCgoKSA9PiB7XG4gICAgcmV0dXJuIHRoaXMuZGF0YXNldCgpLmNvbW1lbnRzPy5zb3VyY2UgPT09IFpmc1Byb3BlcnR5U291cmNlLkxvY2FsICYmICEhdGhpcy5kYXRhc2V0KCkuY29tbWVudHM/LnZhbHVlPy5sZW5ndGg7XG4gIH0pO1xuXG4gIHByb3RlY3RlZCByZWFkb25seSBjYW5CZVByb21vdGVkID0gY29tcHV0ZWQoKCkgPT4gQm9vbGVhbih0aGlzLmRhdGFzZXQoKS5vcmlnaW4/LnBhcnNlZCkpO1xuXG4gIGRlbGV0ZURhdGFzZXQoKTogdm9pZCB7XG4gICAgdGhpcy5tYXREaWFsb2cub3BlbihEZWxldGVEYXRhc2V0RGlhbG9nQ29tcG9uZW50LCB7IGRhdGE6IHRoaXMuZGF0YXNldCgpIH0pXG4gICAgICAuYWZ0ZXJDbG9zZWQoKVxuICAgICAgLnBpcGUoXG4gICAgICAgIGZpbHRlcihCb29sZWFuKSxcbiAgICAgICAgc3dpdGNoTWFwKCgpID0+IHtcbiAgICAgICAgICB0aGlzLmRhdGFzZXRTdG9yZS5kYXRhc2V0VXBkYXRlZCgpO1xuICAgICAgICAgIHJldHVybiB0aGlzLmRhdGFzZXRTdG9yZS5zZWxlY3RlZFBhcmVudERhdGFzZXQkLnBpcGUoZmlyc3QoKSk7XG4gICAgICAgIH0pLFxuICAgICAgICB1bnRpbERlc3Ryb3llZCh0aGlzKSxcbiAgICAgIClcbiAgICAgIC5zdWJzY3JpYmUoKHBhcmVudCkgPT4ge1xuICAgICAgICB0aGlzLnJvdXRlci5uYXZpZ2F0ZShbJy9kYXRhc2V0cycsIHBhcmVudD8uaWRdLCB7IHN0YXRlOiB7IGhpZGVNb2JpbGVEZXRhaWxzOiB0cnVlIH0gfSk7XG4gICAgICB9KTtcbiAgfVxuXG4gIHByb21vdGVEYXRhc2V0KCk6IHZvaWQge1xuICAgIHRoaXMud3MuY2FsbCgncG9vbC5kYXRhc2V0LnByb21vdGUnLCBbdGhpcy5kYXRhc2V0KCkuaWRdKVxuICAgICAgLnBpcGUodGhpcy5lcnJvckhhbmRsZXIuY2F0Y2hFcnJvcigpLCB1bnRpbERlc3Ryb3llZCh0aGlzKSlcbiAgICAgIC5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICB0aGlzLnNuYWNrYmFyLnN1Y2Nlc3ModGhpcy50cmFuc2xhdGUuaW5zdGFudCgnRGF0YXNldCBwcm9tb3RlZCBzdWNjZXNzZnVsbHkuJykpO1xuICAgICAgICB0aGlzLmRhdGFzZXRTdG9yZS5kYXRhc2V0VXBkYXRlZCgpO1xuICAgICAgfSk7XG4gIH1cblxuICBlZGl0RGF0YXNldCgpOiB2b2lkIHtcbiAgICBjb25zdCBzbGlkZUluUmVmID0gdGhpcy5zbGlkZUluU2VydmljZS5vcGVuKERhdGFzZXRGb3JtQ29tcG9uZW50LCB7XG4gICAgICB3aWRlOiB0cnVlLCBkYXRhOiB7IGRhdGFzZXRJZDogdGhpcy5kYXRhc2V0KCkuaWQsIGlzTmV3OiBmYWxzZSB9LFxuICAgIH0pO1xuICAgIHNsaWRlSW5SZWYuc2xpZGVJbkNsb3NlZCQucGlwZShcbiAgICAgIGZpbHRlcihCb29sZWFuKSxcbiAgICAgIHVudGlsRGVzdHJveWVkKHRoaXMpLFxuICAgICkuc3Vic2NyaWJlKCgpID0+IHRoaXMuZGF0YXNldFN0b3JlLmRhdGFzZXRVcGRhdGVkKCkpO1xuICB9XG5cbiAgZWRpdFp2b2woKTogdm9pZCB7XG4gICAgY29uc3Qgc2xpZGVJblJlZiA9IHRoaXMuc2xpZGVJblNlcnZpY2Uub3Blbihadm9sRm9ybUNvbXBvbmVudCwge1xuICAgICAgZGF0YTogeyBpc05ldzogZmFsc2UsIHBhcmVudElkOiB0aGlzLmRhdGFzZXQoKS5pZCB9LFxuICAgIH0pO1xuICAgIHNsaWRlSW5SZWYuc2xpZGVJbkNsb3NlZCQucGlwZShcbiAgICAgIGZpbHRlcihCb29sZWFuKSxcbiAgICAgIHVudGlsRGVzdHJveWVkKHRoaXMpLFxuICAgICkuc3Vic2NyaWJlKCgpID0+IHRoaXMuZGF0YXNldFN0b3JlLmRhdGFzZXRVcGRhdGVkKCkpO1xuICB9XG59XG4iXSwidmVyc2lvbiI6M30=