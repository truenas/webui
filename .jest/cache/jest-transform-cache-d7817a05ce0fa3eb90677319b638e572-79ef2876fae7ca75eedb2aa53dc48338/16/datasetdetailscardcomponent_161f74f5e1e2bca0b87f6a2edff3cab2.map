{"file":"/Users/macbook/karpov-work/TrueNAS/webui/src/app/pages/datasets/components/dataset-details-card/dataset-details-card.component.ts","mappings":"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","names":[],"sources":["/Users/macbook/karpov-work/TrueNAS/webui/src/app/pages/datasets/components/dataset-details-card/dataset-details-card.component.ts"],"sourcesContent":["import {\n  ChangeDetectionStrategy, Component, computed, input,\n} from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\nimport { Router } from '@angular/router';\nimport { UntilDestroy, untilDestroyed } from '@ngneat/until-destroy';\nimport { TranslateService } from '@ngx-translate/core';\nimport { filter, first, switchMap } from 'rxjs/operators';\nimport { DatasetType } from 'app/enums/dataset.enum';\nimport { OnOff } from 'app/enums/on-off.enum';\nimport { Role } from 'app/enums/role.enum';\nimport { ZfsPropertySource } from 'app/enums/zfs-property-source.enum';\nimport { DatasetDetails } from 'app/interfaces/dataset.interface';\nimport { SnackbarService } from 'app/modules/snackbar/services/snackbar.service';\nimport { DatasetFormComponent } from 'app/pages/datasets/components/dataset-form/dataset-form.component';\nimport { DeleteDatasetDialogComponent } from 'app/pages/datasets/components/delete-dataset-dialog/delete-dataset-dialog.component';\nimport { ZvolFormComponent } from 'app/pages/datasets/components/zvol-form/zvol-form.component';\nimport { DatasetTreeStore } from 'app/pages/datasets/store/dataset-store.service';\nimport { ErrorHandlerService } from 'app/services/error-handler.service';\nimport { IxSlideInService } from 'app/services/ix-slide-in.service';\nimport { WebSocketService } from 'app/services/ws.service';\n\n@UntilDestroy()\n@Component({\n  selector: 'ix-dataset-details-card',\n  templateUrl: './dataset-details-card.component.html',\n  styleUrls: ['./dataset-details-card.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class DatasetDetailsCardComponent {\n  readonly dataset = input.required<DatasetDetails>();\n\n  protected readonly Role = Role;\n  readonly OnOff = OnOff;\n\n  constructor(\n    private translate: TranslateService,\n    private matDialog: MatDialog,\n    private datasetStore: DatasetTreeStore,\n    private slideInService: IxSlideInService,\n    private errorHandler: ErrorHandlerService,\n    private router: Router,\n    private ws: WebSocketService,\n    private snackbar: SnackbarService,\n  ) { }\n\n  protected readonly datasetCompression = computed(() => {\n    return this.dataset()?.compression?.source === ZfsPropertySource.Inherited\n      ? this.translate.instant('Inherit ({value})', { value: this.dataset().compression?.value })\n      : this.dataset().compression?.value;\n  });\n\n  protected readonly isFilesystem = computed(() => this.dataset().type === DatasetType.Filesystem);\n  protected readonly isZvol = computed(() => this.dataset().type === DatasetType.Volume);\n\n  protected readonly hasComments = computed(() => {\n    return this.dataset().comments?.source === ZfsPropertySource.Local && !!this.dataset().comments?.value?.length;\n  });\n\n  protected readonly canBePromoted = computed(() => Boolean(this.dataset().origin?.parsed));\n\n  deleteDataset(): void {\n    this.matDialog.open(DeleteDatasetDialogComponent, { data: this.dataset() })\n      .afterClosed()\n      .pipe(\n        filter(Boolean),\n        switchMap(() => {\n          this.datasetStore.datasetUpdated();\n          return this.datasetStore.selectedParentDataset$.pipe(first());\n        }),\n        untilDestroyed(this),\n      )\n      .subscribe((parent) => {\n        this.router.navigate(['/datasets', parent?.id], { state: { hideMobileDetails: true } });\n      });\n  }\n\n  promoteDataset(): void {\n    this.ws.call('pool.dataset.promote', [this.dataset().id])\n      .pipe(this.errorHandler.catchError(), untilDestroyed(this))\n      .subscribe(() => {\n        this.snackbar.success(this.translate.instant('Dataset promoted successfully.'));\n        this.datasetStore.datasetUpdated();\n      });\n  }\n\n  editDataset(): void {\n    const slideInRef = this.slideInService.open(DatasetFormComponent, {\n      wide: true, data: { datasetId: this.dataset().id, isNew: false },\n    });\n    slideInRef.slideInClosed$.pipe(\n      filter(Boolean),\n      untilDestroyed(this),\n    ).subscribe(() => this.datasetStore.datasetUpdated());\n  }\n\n  editZvol(): void {\n    const slideInRef = this.slideInService.open(ZvolFormComponent, {\n      data: { isNew: false, parentId: this.dataset().id },\n    });\n    slideInRef.slideInClosed$.pipe(\n      filter(Boolean),\n      untilDestroyed(this),\n    ).subscribe(() => this.datasetStore.datasetUpdated());\n  }\n}\n"],"version":3}