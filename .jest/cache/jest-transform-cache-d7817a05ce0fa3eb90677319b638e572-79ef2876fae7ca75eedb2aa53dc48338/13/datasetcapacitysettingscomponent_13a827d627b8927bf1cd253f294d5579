38557bcea5dda8b1e6d333a0a6add7da
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.DatasetCapacitySettingsComponent = void 0;
const core_1 = require("@angular/core");
const forms_1 = require("@angular/forms");
const until_destroy_1 = require("@ngneat/until-destroy");
const core_2 = require("@ngx-translate/core");
const bytes_constant_1 = require("app/constants/bytes.constant");
const role_enum_1 = require("app/enums/role.enum");
const with_inherit_enum_1 = require("app/enums/with-inherit.enum");
const dataset_form_1 = require("app/helptext/storage/volumes/datasets/dataset-form");
const dataset_interface_1 = require("app/interfaces/dataset.interface");
const ix_slide_in_ref_1 = require("app/modules/forms/ix-forms/components/ix-slide-in/ix-slide-in-ref");
const ix_slide_in_token_1 = require("app/modules/forms/ix-forms/components/ix-slide-in/ix-slide-in.token");
const form_error_handler_service_1 = require("app/modules/forms/ix-forms/services/form-error-handler.service");
const ix_formatter_service_1 = require("app/modules/forms/ix-forms/services/ix-formatter.service");
const ix_validators_service_1 = require("app/modules/forms/ix-forms/services/ix-validators.service");
const snackbar_service_1 = require("app/modules/snackbar/services/snackbar.service");
const dataset_utils_1 = require("app/pages/datasets/utils/dataset.utils");
const ws_service_1 = require("app/services/ws.service");
let DatasetCapacitySettingsComponent = class DatasetCapacitySettingsComponent {
    constructor(ws, formBuilder, formatter, cdr, errorHandler, snackbarService, translate, validators, slideInRef, dataset) {
        this.ws = ws;
        this.formBuilder = formBuilder;
        this.formatter = formatter;
        this.cdr = cdr;
        this.errorHandler = errorHandler;
        this.snackbarService = snackbarService;
        this.translate = translate;
        this.validators = validators;
        this.slideInRef = slideInRef;
        this.dataset = dataset;
        this.requiredRoles = [role_enum_1.Role.DatasetWrite];
        this.defaultQuotaWarning = 80;
        this.defaultQuotaCritical = 95;
        this.form = this.formBuilder.group({
            refquota: [null, this.validators.withMessage(forms_1.Validators.min(bytes_constant_1.GiB), this.translate.instant(dataset_form_1.helptextDatasetForm.dataset_form_quota_too_small))],
            refquota_warning: [this.defaultQuotaWarning, [
                    forms_1.Validators.min(0),
                    forms_1.Validators.max(100),
                ]],
            refquota_warning_inherit: [false],
            refquota_critical: [this.defaultQuotaCritical, [
                    forms_1.Validators.min(0),
                    forms_1.Validators.max(100),
                ]],
            refquota_critical_inherit: [false],
            quota: [null, this.validators.withMessage(forms_1.Validators.min(bytes_constant_1.GiB), this.translate.instant(dataset_form_1.helptextDatasetForm.dataset_form_quota_too_small))],
            quota_warning: [this.defaultQuotaWarning, [
                    forms_1.Validators.min(0),
                    forms_1.Validators.max(100),
                ]],
            quota_warning_inherit: [false],
            quota_critical: [this.defaultQuotaCritical, [
                    forms_1.Validators.min(0),
                    forms_1.Validators.max(100),
                ]],
            quota_critical_inherit: [false],
            refreservation: [null],
            reservation: [null],
        });
        this.isLoading = false;
        this.helptext = dataset_form_1.helptextDatasetForm;
        this.inheritRelations = {
            refquota_warning_inherit: 'refquota_warning',
            refquota_critical_inherit: 'refquota_critical',
            quota_warning_inherit: 'quota_warning',
            quota_critical_inherit: 'quota_critical',
        };
        this.setFormRelations();
    }
    ngOnInit() {
        if (this.dataset) {
            this.setDatasetForEdit();
        }
    }
    setFormRelations() {
        this.form.valueChanges.pipe((0, until_destroy_1.untilDestroyed)(this)).subscribe((values) => {
            Object.entries(this.inheritRelations).forEach(([inheritField, valueField]) => {
                if (values[inheritField]) {
                    this.form.controls[valueField].disable({ emitEvent: false });
                    this.form.controls[valueField].removeValidators(forms_1.Validators.required);
                }
                else {
                    this.form.controls[valueField].enable({ emitEvent: false });
                    this.form.controls[valueField].addValidators(forms_1.Validators.required);
                }
            });
        });
    }
    get isRoot() {
        return (0, dataset_utils_1.isRootDataset)(this.dataset);
    }
    setDatasetForEdit() {
        var _a, _b, _c, _d, _e, _f, _g, _h;
        this.oldValues = {
            refquota: this.dataset.refquota.parsed,
            refquota_warning: (_b = (_a = this.dataset.refquota_warning) === null || _a === void 0 ? void 0 : _a.parsed) !== null && _b !== void 0 ? _b : this.defaultQuotaWarning,
            refquota_warning_inherit: (0, dataset_utils_1.isPropertyInherited)(this.dataset.refquota_warning),
            refquota_critical: (_d = (_c = this.dataset.refquota_critical) === null || _c === void 0 ? void 0 : _c.parsed) !== null && _d !== void 0 ? _d : this.defaultQuotaCritical,
            refquota_critical_inherit: (0, dataset_utils_1.isPropertyInherited)(this.dataset.refquota_critical),
            quota: this.dataset.quota.parsed,
            quota_warning: (_f = (_e = this.dataset.quota_warning) === null || _e === void 0 ? void 0 : _e.parsed) !== null && _f !== void 0 ? _f : this.defaultQuotaWarning,
            quota_warning_inherit: (0, dataset_utils_1.isPropertyInherited)(this.dataset.quota_warning),
            quota_critical: (_h = (_g = this.dataset.quota_critical) === null || _g === void 0 ? void 0 : _g.parsed) !== null && _h !== void 0 ? _h : this.defaultQuotaCritical,
            quota_critical_inherit: (0, dataset_utils_1.isPropertyInherited)(this.dataset.quota_critical),
            refreservation: this.dataset.refreservation.parsed,
            reservation: this.dataset.reservation.parsed,
        };
        this.form.patchValue(this.oldValues);
        this.cdr.markForCheck();
    }
    onSubmit() {
        this.isLoading = true;
        this.cdr.markForCheck();
        const payload = this.getChangedFormValues();
        this.ws.call('pool.dataset.update', [this.dataset.id, payload])
            .pipe((0, until_destroy_1.untilDestroyed)(this))
            .subscribe({
            next: () => {
                this.isLoading = false;
                this.snackbarService.success(this.translate.instant('Dataset settings updated.'));
                this.slideInRef.close();
                this.cdr.markForCheck();
            },
            error: (error) => {
                this.errorHandler.handleWsFormError(error, this.form);
                this.isLoading = false;
                this.cdr.markForCheck();
            },
        });
    }
    getChangedFormValues() {
        const newValues = this.form.getRawValue();
        const oldValues = this.oldValues;
        const changedValues = {};
        ['refquota', 'quota', 'refreservation', 'reservation'].forEach((field) => {
            if (newValues[field] !== oldValues[field]) {
                changedValues[field] = newValues[field] || 0;
            }
        });
        ['refquota_warning', 'refquota_critical', 'quota_warning', 'quota_critical'].forEach((field) => {
            if (newValues[field] !== oldValues[field]) {
                changedValues[field] = newValues[field];
            }
        });
        Object.entries(this.inheritRelations).forEach(([untypedInheritField, valueField]) => {
            const inheritField = untypedInheritField;
            if (newValues[inheritField] === oldValues[inheritField]) {
                if (newValues[valueField] !== oldValues[valueField]) {
                    // Inherit checkbox wasn't changed, but value was.
                    changedValues[valueField] = newValues[valueField];
                }
                return;
            }
            // Inherit checkbox was changed.
            changedValues[valueField] = newValues[inheritField] ? with_inherit_enum_1.inherit : newValues[valueField];
        });
        return changedValues;
    }
};
exports.DatasetCapacitySettingsComponent = DatasetCapacitySettingsComponent;
DatasetCapacitySettingsComponent.ctorParameters = () => [
    { type: ws_service_1.WebSocketService },
    { type: forms_1.FormBuilder },
    { type: ix_formatter_service_1.IxFormatterService },
    { type: core_1.ChangeDetectorRef },
    { type: form_error_handler_service_1.FormErrorHandlerService },
    { type: snackbar_service_1.SnackbarService },
    { type: core_2.TranslateService },
    { type: ix_validators_service_1.IxValidatorsService },
    { type: ix_slide_in_ref_1.IxSlideInRef },
    { type: dataset_interface_1.DatasetDetails, decorators: [{ type: core_1.Inject, args: [ix_slide_in_token_1.SLIDE_IN_DATA,] }] }
];
exports.DatasetCapacitySettingsComponent = DatasetCapacitySettingsComponent = __decorate([
    (0, until_destroy_1.UntilDestroy)(),
    (0, core_1.Component)({
        selector: 'ix-dataset-capacity-settings',
        template: require("./dataset-capacity-settings.component.html"),
        changeDetection: core_1.ChangeDetectionStrategy.OnPush,
    })
], DatasetCapacitySettingsComponent);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL21hY2Jvb2sva2FycG92LXdvcmsvVHJ1ZU5BUy93ZWJ1aS9zcmMvYXBwL3BhZ2VzL2RhdGFzZXRzL2NvbXBvbmVudHMvZGF0YXNldC1jYXBhY2l0eS1tYW5hZ2VtZW50LWNhcmQvZGF0YXNldC1jYXBhY2l0eS1zZXR0aW5ncy9kYXRhc2V0LWNhcGFjaXR5LXNldHRpbmdzLmNvbXBvbmVudC50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQSx3Q0FFdUI7QUFDdkIsMENBQXlEO0FBQ3pELHlEQUFxRTtBQUNyRSw4Q0FBdUQ7QUFDdkQsaUVBQW1EO0FBQ25ELG1EQUEyQztBQUMzQyxtRUFBc0Q7QUFDdEQscUZBQXlGO0FBQ3pGLHdFQUFpRjtBQUNqRix1R0FBaUc7QUFDakcsMkdBQW9HO0FBQ3BHLCtHQUF5RztBQUN6RyxtR0FBOEY7QUFDOUYscUdBQWdHO0FBQ2hHLHFGQUFpRjtBQUNqRiwwRUFBNEY7QUFDNUYsd0RBQTJEO0FBU3BELElBQU0sZ0NBQWdDLEdBQXRDLE1BQU0sZ0NBQWdDO0lBcUQzQyxZQUNVLEVBQW9CLEVBQ3BCLFdBQXdCLEVBQ3pCLFNBQTZCLEVBQzVCLEdBQXNCLEVBQ3RCLFlBQXFDLEVBQ3JDLGVBQWdDLEVBQ2hDLFNBQTJCLEVBQzNCLFVBQStCLEVBQy9CLFVBQTBELEVBQ3BDLE9BQXVCO1FBVDdDLE9BQUUsR0FBRixFQUFFLENBQWtCO1FBQ3BCLGdCQUFXLEdBQVgsV0FBVyxDQUFhO1FBQ3pCLGNBQVMsR0FBVCxTQUFTLENBQW9CO1FBQzVCLFFBQUcsR0FBSCxHQUFHLENBQW1CO1FBQ3RCLGlCQUFZLEdBQVosWUFBWSxDQUF5QjtRQUNyQyxvQkFBZSxHQUFmLGVBQWUsQ0FBaUI7UUFDaEMsY0FBUyxHQUFULFNBQVMsQ0FBa0I7UUFDM0IsZUFBVSxHQUFWLFVBQVUsQ0FBcUI7UUFDL0IsZUFBVSxHQUFWLFVBQVUsQ0FBZ0Q7UUFDcEMsWUFBTyxHQUFQLE9BQU8sQ0FBZ0I7UUE5RDlDLGtCQUFhLEdBQUcsQ0FBQyxnQkFBSSxDQUFDLFlBQVksQ0FB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Q2hELENBQUM7R0FDVyxnQ0FBZ0MsQ0F3SzVDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9tYWNib29rL2thcnBvdi13b3JrL1RydWVOQVMvd2VidWkvc3JjL2FwcC9wYWdlcy9kYXRhc2V0cy9jb21wb25lbnRzL2RhdGFzZXQtY2FwYWNpdHktbWFuYWdlbWVudC1jYXJkL2RhdGFzZXQtY2FwYWNpdHktc2V0dGluZ3MvZGF0YXNldC1jYXBhY2l0eS1zZXR0aW5ncy5jb21wb25lbnQudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3ksIENoYW5nZURldGVjdG9yUmVmLCBDb21wb25lbnQsIEluamVjdCwgT25Jbml0LFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEZvcm1CdWlsZGVyLCBWYWxpZGF0b3JzIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHsgVW50aWxEZXN0cm95LCB1bnRpbERlc3Ryb3llZCB9IGZyb20gJ0BuZ25lYXQvdW50aWwtZGVzdHJveSc7XG5pbXBvcnQgeyBUcmFuc2xhdGVTZXJ2aWNlIH0gZnJvbSAnQG5neC10cmFuc2xhdGUvY29yZSc7XG5pbXBvcnQgeyBHaUIgfSBmcm9tICdhcHAvY29uc3RhbnRzL2J5dGVzLmNvbnN0YW50JztcbmltcG9ydCB7IFJvbGUgfSBmcm9tICdhcHAvZW51bXMvcm9sZS5lbnVtJztcbmltcG9ydCB7IGluaGVyaXQgfSBmcm9tICdhcHAvZW51bXMvd2l0aC1pbmhlcml0LmVudW0nO1xuaW1wb3J0IHsgaGVscHRleHREYXRhc2V0Rm9ybSB9IGZyb20gJ2FwcC9oZWxwdGV4dC9zdG9yYWdlL3ZvbHVtZXMvZGF0YXNldHMvZGF0YXNldC1mb3JtJztcbmltcG9ydCB7IERhdGFzZXREZXRhaWxzLCBEYXRhc2V0VXBkYXRlIH0gZnJvbSAnYXBwL2ludGVyZmFjZXMvZGF0YXNldC5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgSXhTbGlkZUluUmVmIH0gZnJvbSAnYXBwL21vZHVsZXMvZm9ybXMvaXgtZm9ybXMvY29tcG9uZW50cy9peC1zbGlkZS1pbi9peC1zbGlkZS1pbi1yZWYnO1xuaW1wb3J0IHsgU0xJREVfSU5fREFUQSB9IGZyb20gJ2FwcC9tb2R1bGVzL2Zvcm1zL2l4LWZvcm1zL2NvbXBvbmVudHMvaXgtc2xpZGUtaW4vaXgtc2xpZGUtaW4udG9rZW4nO1xuaW1wb3J0IHsgRm9ybUVycm9ySGFuZGxlclNlcnZpY2UgfSBmcm9tICdhcHAvbW9kdWxlcy9mb3Jtcy9peC1mb3Jtcy9zZXJ2aWNlcy9mb3JtLWVycm9yLWhhbmRsZXIuc2VydmljZSc7XG5pbXBvcnQgeyBJeEZvcm1hdHRlclNlcnZpY2UgfSBmcm9tICdhcHAvbW9kdWxlcy9mb3Jtcy9peC1mb3Jtcy9zZXJ2aWNlcy9peC1mb3JtYXR0ZXIuc2VydmljZSc7XG5pbXBvcnQgeyBJeFZhbGlkYXRvcnNTZXJ2aWNlIH0gZnJvbSAnYXBwL21vZHVsZXMvZm9ybXMvaXgtZm9ybXMvc2VydmljZXMvaXgtdmFsaWRhdG9ycy5zZXJ2aWNlJztcbmltcG9ydCB7IFNuYWNrYmFyU2VydmljZSB9IGZyb20gJ2FwcC9tb2R1bGVzL3NuYWNrYmFyL3NlcnZpY2VzL3NuYWNrYmFyLnNlcnZpY2UnO1xuaW1wb3J0IHsgaXNQcm9wZXJ0eUluaGVyaXRlZCwgaXNSb290RGF0YXNldCB9IGZyb20gJ2FwcC9wYWdlcy9kYXRhc2V0cy91dGlscy9kYXRhc2V0LnV0aWxzJztcbmltcG9ydCB7IFdlYlNvY2tldFNlcnZpY2UgfSBmcm9tICdhcHAvc2VydmljZXMvd3Muc2VydmljZSc7XG5cbkBVbnRpbERlc3Ryb3koKVxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnaXgtZGF0YXNldC1jYXBhY2l0eS1zZXR0aW5ncycsXG4gIHRlbXBsYXRlVXJsOiAnLi9kYXRhc2V0LWNhcGFjaXR5LXNldHRpbmdzLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vZGF0YXNldC1jYXBhY2l0eS1zZXR0aW5ncy5jb21wb25lbnQuc2NzcyddLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaCxcbn0pXG5leHBvcnQgY2xhc3MgRGF0YXNldENhcGFjaXR5U2V0dGluZ3NDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuICByZWFkb25seSByZXF1aXJlZFJvbGVzID0gW1JvbGUuRGF0YXNldFdyaXRlXTtcblxuICByZWFkb25seSBkZWZhdWx0UXVvdGFXYXJuaW5nID0gODA7XG4gIHJlYWRvbmx5IGRlZmF1bHRRdW90YUNyaXRpY2FsID0gOTU7XG5cbiAgZm9ybSA9IHRoaXMuZm9ybUJ1aWxkZXIuZ3JvdXAoe1xuICAgIHJlZnF1b3RhOiBbbnVsbCBhcyBudW1iZXIsIHRoaXMudmFsaWRhdG9ycy53aXRoTWVzc2FnZShcbiAgICAgIFZhbGlkYXRvcnMubWluKEdpQiksXG4gICAgICB0aGlzLnRyYW5zbGF0ZS5pbnN0YW50KGhlbHB0ZXh0RGF0YXNldEZvcm0uZGF0YXNldF9mb3JtX3F1b3RhX3Rvb19zbWFsbCksXG4gICAgKV0sXG4gICAgcmVmcXVvdGFfd2FybmluZzogW3RoaXMuZGVmYXVsdFF1b3RhV2FybmluZywgW1xuICAgICAgVmFsaWRhdG9ycy5taW4oMCksXG4gICAgICBWYWxpZGF0b3JzLm1heCgxMDApLFxuICAgIF1dLFxuICAgIHJlZnF1b3RhX3dhcm5pbmdfaW5oZXJpdDogW2ZhbHNlXSxcbiAgICByZWZxdW90YV9jcml0aWNhbDogW3RoaXMuZGVmYXVsdFF1b3RhQ3JpdGljYWwsIFtcbiAgICAgIFZhbGlkYXRvcnMubWluKDApLFxuICAgICAgVmFsaWRhdG9ycy5tYXgoMTAwKSxcbiAgICBdXSxcbiAgICByZWZxdW90YV9jcml0aWNhbF9pbmhlcml0OiBbZmFsc2VdLFxuXG4gICAgcXVvdGE6IFtudWxsIGFzIG51bWJlciwgdGhpcy52YWxpZGF0b3JzLndpdGhNZXNzYWdlKFxuICAgICAgVmFsaWRhdG9ycy5taW4oR2lCKSxcbiAgICAgIHRoaXMudHJhbnNsYXRlLmluc3RhbnQoaGVscHRleHREYXRhc2V0Rm9ybS5kYXRhc2V0X2Zvcm1fcXVvdGFfdG9vX3NtYWxsKSxcbiAgICApXSxcbiAgICBxdW90YV93YXJuaW5nOiBbdGhpcy5kZWZhdWx0UXVvdGFXYXJuaW5nLCBbXG4gICAgICBWYWxpZGF0b3JzLm1pbigwKSxcbiAgICAgIFZhbGlkYXRvcnMubWF4KDEwMCksXG4gICAgXV0sXG4gICAgcXVvdGFfd2FybmluZ19pbmhlcml0OiBbZmFsc2VdLFxuICAgIHF1b3RhX2NyaXRpY2FsOiBbdGhpcy5kZWZhdWx0UXVvdGFDcml0aWNhbCwgW1xuICAgICAgVmFsaWRhdG9ycy5taW4oMCksXG4gICAgICBWYWxpZGF0b3JzLm1heCgxMDApLFxuICAgIF1dLFxuICAgIHF1b3RhX2NyaXRpY2FsX2luaGVyaXQ6IFtmYWxzZV0sXG5cbiAgICByZWZyZXNlcnZhdGlvbjogW251bGwgYXMgbnVtYmVyXSxcbiAgICByZXNlcnZhdGlvbjogW251bGwgYXMgbnVtYmVyXSxcbiAgfSk7XG5cbiAgaXNMb2FkaW5nID0gZmFsc2U7XG5cbiAgcmVhZG9ubHkgaGVscHRleHQgPSBoZWxwdGV4dERhdGFzZXRGb3JtO1xuXG4gIHByaXZhdGUgb2xkVmFsdWVzOiBEYXRhc2V0Q2FwYWNpdHlTZXR0aW5nc0NvbXBvbmVudFsnZm9ybSddWyd2YWx1ZSddO1xuICBwcml2YXRlIHJlYWRvbmx5IGluaGVyaXRSZWxhdGlvbnMgPSB7XG4gICAgcmVmcXVvdGFfd2FybmluZ19pbmhlcml0OiAncmVmcXVvdGFfd2FybmluZycsXG4gICAgcmVmcXVvdGFfY3JpdGljYWxfaW5oZXJpdDogJ3JlZnF1b3RhX2NyaXRpY2FsJyxcbiAgICBxdW90YV93YXJuaW5nX2luaGVyaXQ6ICdxdW90YV93YXJuaW5nJyxcbiAgICBxdW90YV9jcml0aWNhbF9pbmhlcml0OiAncXVvdGFfY3JpdGljYWwnLFxuICB9IGFzIGNvbnN0O1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgd3M6IFdlYlNvY2tldFNlcnZpY2UsXG4gICAgcHJpdmF0ZSBmb3JtQnVpbGRlcjogRm9ybUJ1aWxkZXIsXG4gICAgcHVibGljIGZvcm1hdHRlcjogSXhGb3JtYXR0ZXJTZXJ2aWNlLFxuICAgIHByaXZhdGUgY2RyOiBDaGFuZ2VEZXRlY3RvclJlZixcbiAgICBwcml2YXRlIGVycm9ySGFuZGxlcjogRm9ybUVycm9ySGFuZGxlclNlcnZpY2UsXG4gICAgcHJpdmF0ZSBzbmFja2JhclNlcnZpY2U6IFNuYWNrYmFyU2VydmljZSxcbiAgICBwcml2YXRlIHRyYW5zbGF0ZTogVHJhbnNsYXRlU2VydmljZSxcbiAgICBwcml2YXRlIHZhbGlkYXRvcnM6IEl4VmFsaWRhdG9yc1NlcnZpY2UsXG4gICAgcHJpdmF0ZSBzbGlkZUluUmVmOiBJeFNsaWRlSW5SZWY8RGF0YXNldENhcGFjaXR5U2V0dGluZ3NDb21wb25lbnQ+LFxuICAgIEBJbmplY3QoU0xJREVfSU5fREFUQSkgcHVibGljIGRhdGFzZXQ6IERhdGFzZXREZXRhaWxzLFxuICApIHtcbiAgICB0aGlzLnNldEZvcm1SZWxhdGlvbnMoKTtcbiAgfVxuXG4gIG5nT25Jbml0KCk6IHZvaWQge1xuICAgIGlmICh0aGlzLmRhdGFzZXQpIHtcbiAgICAgIHRoaXMuc2V0RGF0YXNldEZvckVkaXQoKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHNldEZvcm1SZWxhdGlvbnMoKTogdm9pZCB7XG4gICAgdGhpcy5mb3JtLnZhbHVlQ2hhbmdlcy5waXBlKHVudGlsRGVzdHJveWVkKHRoaXMpKS5zdWJzY3JpYmUoKHZhbHVlcykgPT4ge1xuICAgICAgT2JqZWN0LmVudHJpZXModGhpcy5pbmhlcml0UmVsYXRpb25zKS5mb3JFYWNoKChbaW5oZXJpdEZpZWxkLCB2YWx1ZUZpZWxkXSkgPT4ge1xuICAgICAgICBpZiAodmFsdWVzW2luaGVyaXRGaWVsZCBhcyBrZXlvZiBEYXRhc2V0Q2FwYWNpdHlTZXR0aW5nc0NvbXBvbmVudFsnaW5oZXJpdFJlbGF0aW9ucyddXSkge1xuICAgICAgICAgIHRoaXMuZm9ybS5jb250cm9sc1t2YWx1ZUZpZWxkXS5kaXNhYmxlKHsgZW1pdEV2ZW50OiBmYWxzZSB9KTtcbiAgICAgICAgICB0aGlzLmZvcm0uY29udHJvbHNbdmFsdWVGaWVsZF0ucmVtb3ZlVmFsaWRhdG9ycyhWYWxpZGF0b3JzLnJlcXVpcmVkKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLmZvcm0uY29udHJvbHNbdmFsdWVGaWVsZF0uZW5hYmxlKHsgZW1pdEV2ZW50OiBmYWxzZSB9KTtcbiAgICAgICAgICB0aGlzLmZvcm0uY29udHJvbHNbdmFsdWVGaWVsZF0uYWRkVmFsaWRhdG9ycyhWYWxpZGF0b3JzLnJlcXVpcmVkKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICBnZXQgaXNSb290KCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiBpc1Jvb3REYXRhc2V0KHRoaXMuZGF0YXNldCk7XG4gIH1cblxuICBzZXREYXRhc2V0Rm9yRWRpdCgpOiB2b2lkIHtcbiAgICB0aGlzLm9sZFZhbHVlcyA9IHtcbiAgICAgIHJlZnF1b3RhOiB0aGlzLmRhdGFzZXQucmVmcXVvdGEucGFyc2VkLFxuICAgICAgcmVmcXVvdGFfd2FybmluZzogdGhpcy5kYXRhc2V0LnJlZnF1b3RhX3dhcm5pbmc/LnBhcnNlZCA/PyB0aGlzLmRlZmF1bHRRdW90YVdhcm5pbmcsXG4gICAgICByZWZxdW90YV93YXJuaW5nX2luaGVyaXQ6IGlzUHJvcGVydHlJbmhlcml0ZWQodGhpcy5kYXRhc2V0LnJlZnF1b3RhX3dhcm5pbmcpLFxuICAgICAgcmVmcXVvdGFfY3JpdGljYWw6IHRoaXMuZGF0YXNldC5yZWZxdW90YV9jcml0aWNhbD8ucGFyc2VkID8/IHRoaXMuZGVmYXVsdFF1b3RhQ3JpdGljYWwsXG4gICAgICByZWZxdW90YV9jcml0aWNhbF9pbmhlcml0OiBpc1Byb3BlcnR5SW5oZXJpdGVkKHRoaXMuZGF0YXNldC5yZWZxdW90YV9jcml0aWNhbCksXG4gICAgICBxdW90YTogdGhpcy5kYXRhc2V0LnF1b3RhLnBhcnNlZCxcbiAgICAgIHF1b3RhX3dhcm5pbmc6IHRoaXMuZGF0YXNldC5xdW90YV93YXJuaW5nPy5wYXJzZWQgPz8gdGhpcy5kZWZhdWx0UXVvdGFXYXJuaW5nLFxuICAgICAgcXVvdGFfd2FybmluZ19pbmhlcml0OiBpc1Byb3BlcnR5SW5oZXJpdGVkKHRoaXMuZGF0YXNldC5xdW90YV93YXJuaW5nKSxcbiAgICAgIHF1b3RhX2NyaXRpY2FsOiB0aGlzLmRhdGFzZXQucXVvdGFfY3JpdGljYWw/LnBhcnNlZCA/PyB0aGlzLmRlZmF1bHRRdW90YUNyaXRpY2FsLFxuICAgICAgcXVvdGFfY3JpdGljYWxfaW5oZXJpdDogaXNQcm9wZXJ0eUluaGVyaXRlZCh0aGlzLmRhdGFzZXQucXVvdGFfY3JpdGljYWwpLFxuICAgICAgcmVmcmVzZXJ2YXRpb246IHRoaXMuZGF0YXNldC5yZWZyZXNlcnZhdGlvbi5wYXJzZWQsXG4gICAgICByZXNlcnZhdGlvbjogdGhpcy5kYXRhc2V0LnJlc2VydmF0aW9uLnBhcnNlZCxcbiAgICB9O1xuICAgIHRoaXMuZm9ybS5wYXRjaFZhbHVlKHRoaXMub2xkVmFsdWVzKTtcbiAgICB0aGlzLmNkci5tYXJrRm9yQ2hlY2soKTtcbiAgfVxuXG4gIG9uU3VibWl0KCk6IHZvaWQge1xuICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTtcbiAgICB0aGlzLmNkci5tYXJrRm9yQ2hlY2soKTtcbiAgICBjb25zdCBwYXlsb2FkID0gdGhpcy5nZXRDaGFuZ2VkRm9ybVZhbHVlcygpO1xuXG4gICAgdGhpcy53cy5jYWxsKCdwb29sLmRhdGFzZXQudXBkYXRlJywgW3RoaXMuZGF0YXNldC5pZCwgcGF5bG9hZF0pXG4gICAgICAucGlwZSh1bnRpbERlc3Ryb3llZCh0aGlzKSlcbiAgICAgIC5zdWJzY3JpYmUoe1xuICAgICAgICBuZXh0OiAoKSA9PiB7XG4gICAgICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTtcbiAgICAgICAgICB0aGlzLnNuYWNrYmFyU2VydmljZS5zdWNjZXNzKFxuICAgICAgICAgICAgdGhpcy50cmFuc2xhdGUuaW5zdGFudCgnRGF0YXNldCBzZXR0aW5ncyB1cGRhdGVkLicpLFxuICAgICAgICAgICk7XG4gICAgICAgICAgdGhpcy5zbGlkZUluUmVmLmNsb3NlKCk7XG4gICAgICAgICAgdGhpcy5jZHIubWFya0ZvckNoZWNrKCk7XG4gICAgICAgIH0sXG4gICAgICAgIGVycm9yOiAoZXJyb3I6IHVua25vd24pID0+IHtcbiAgICAgICAgICB0aGlzLmVycm9ySGFuZGxlci5oYW5kbGVXc0Zvcm1FcnJvcihlcnJvciwgdGhpcy5mb3JtKTtcbiAgICAgICAgICB0aGlzLmlzTG9hZGluZyA9IGZhbHNlO1xuICAgICAgICAgIHRoaXMuY2RyLm1hcmtGb3JDaGVjaygpO1xuICAgICAgICB9LFxuICAgICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGdldENoYW5nZWRGb3JtVmFsdWVzKCk6IERhdGFzZXRVcGRhdGUge1xuICAgIGNvbnN0IG5ld1ZhbHVlcyA9IHRoaXMuZm9ybS5nZXRSYXdWYWx1ZSgpO1xuICAgIGNvbnN0IG9sZFZhbHVlcyA9IHRoaXMub2xkVmFsdWVzO1xuXG4gICAgY29uc3QgY2hhbmdlZFZhbHVlczogRGF0YXNldFVwZGF0ZSA9IHt9O1xuICAgIChbJ3JlZnF1b3RhJywgJ3F1b3RhJywgJ3JlZnJlc2VydmF0aW9uJywgJ3Jlc2VydmF0aW9uJ10gYXMgY29uc3QpLmZvckVhY2goKGZpZWxkKSA9PiB7XG4gICAgICBpZiAobmV3VmFsdWVzW2ZpZWxkXSAhPT0gb2xkVmFsdWVzW2ZpZWxkXSkge1xuICAgICAgICBjaGFuZ2VkVmFsdWVzW2ZpZWxkXSA9IG5ld1ZhbHVlc1tmaWVsZF0gfHwgMDtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIChbJ3JlZnF1b3RhX3dhcm5pbmcnLCAncmVmcXVvdGFfY3JpdGljYWwnLCAncXVvdGFfd2FybmluZycsICdxdW90YV9jcml0aWNhbCddIGFzIGNvbnN0KS5mb3JFYWNoKChmaWVsZCkgPT4ge1xuICAgICAgaWYgKG5ld1ZhbHVlc1tmaWVsZF0gIT09IG9sZFZhbHVlc1tmaWVsZF0pIHtcbiAgICAgICAgY2hhbmdlZFZhbHVlc1tmaWVsZF0gPSBuZXdWYWx1ZXNbZmllbGRdO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgT2JqZWN0LmVudHJpZXModGhpcy5pbmhlcml0UmVsYXRpb25zKS5mb3JFYWNoKChbdW50eXBlZEluaGVyaXRGaWVsZCwgdmFsdWVGaWVsZF0pID0+IHtcbiAgICAgIGNvbnN0IGluaGVyaXRGaWVsZCA9IHVudHlwZWRJbmhlcml0RmllbGQgYXMga2V5b2YgRGF0YXNldENhcGFjaXR5U2V0dGluZ3NDb21wb25lbnRbJ2luaGVyaXRSZWxhdGlvbnMnXTtcbiAgICAgIGlmIChuZXdWYWx1ZXNbaW5oZXJpdEZpZWxkXSA9PT0gb2xkVmFsdWVzW2luaGVyaXRGaWVsZF0pIHtcbiAgICAgICAgaWYgKG5ld1ZhbHVlc1t2YWx1ZUZpZWxkXSAhPT0gb2xkVmFsdWVzW3ZhbHVlRmllbGRdKSB7XG4gICAgICAgICAgLy8gSW5oZXJpdCBjaGVja2JveCB3YXNuJ3QgY2hhbmdlZCwgYnV0IHZhbHVlIHdhcy5cbiAgICAgICAgICBjaGFuZ2VkVmFsdWVzW3ZhbHVlRmllbGRdID0gbmV3VmFsdWVzW3ZhbHVlRmllbGRdO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgLy8gSW5oZXJpdCBjaGVja2JveCB3YXMgY2hhbmdlZC5cbiAgICAgIGNoYW5nZWRWYWx1ZXNbdmFsdWVGaWVsZF0gPSBuZXdWYWx1ZXNbaW5oZXJpdEZpZWxkXSA/IGluaGVyaXQgOiBuZXdWYWx1ZXNbdmFsdWVGaWVsZF07XG4gICAgfSk7XG5cbiAgICByZXR1cm4gY2hhbmdlZFZhbHVlcztcbiAgfVxufVxuIl0sInZlcnNpb24iOjN9