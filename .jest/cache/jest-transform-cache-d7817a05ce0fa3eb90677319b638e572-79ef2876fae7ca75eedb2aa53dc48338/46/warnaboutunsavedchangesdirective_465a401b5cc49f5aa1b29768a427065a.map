{"file":"/Users/macbook/karpov-work/TrueNAS/webui/src/app/directives/warn-about-unsaved-changes/warn-about-unsaved-changes.directive.ts","mappings":";;;;;;;;;AAAA,wCAEuB;AAEvB,yDAAqE;AACrE,8CAAuD;AACvD,+BAAsC;AACtC,8CAAmD;AACnD,sEAAkE;AAClE,uGAAiG;AAO1F,IAAM,gCAAgC,GAAtC,MAAM,gCAAgC;IAK3C,YACU,SAA2B,EAC3B,aAA4B,EAC5B,UAA2B;QAF3B,cAAS,GAAT,SAAS,CAAkB;QAC3B,kBAAa,GAAb,aAAa,CAAe;QAC5B,eAAU,GAAV,UAAU,CAAiB;QALrC,gBAAW,GAAG,KAAK,CAAC;IAMjB,CAAC;IAEJ,QAAQ;QACN,IAAI,CAAC,gBAAgB,EAAE,CAAC;QACxB,IAAI,CAAC,oBAAoB,EAAE,CAAC;IAC9B,CAAC;IAED,qBAAqB,CAAC,QAAY;QAChC,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE,CAAC;YACtB,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC;YACzB,OAAO,IAAA,SAAE,EAAC,IAAI,CAAC,CAAC;QAClB,CAAC;QAED,OAAO,IAAI,CAAC,iBAAiB,EAAE,CAAC,IAAI,CAClC,IAAA,qBAAS,EAAC,CAAC,WAAW,EAAE,EAAE;YACxB,IAAI,WAAW,EAAE,CAAC;gBAChB,IAAI,CAAC,WAAW,GAAG,KAAK,CAAC;gBACzB,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,CAAC;YAC3B,CAAC;YACD,OAAO,IAAA,SAAE,EAAC,WAAW,CAAC,CAAC;QACzB,CAAC,CAAC,CACH,CAAC;IACJ,CAAC;IAEO,gBAAgB;QACtB,IAAI,CAAC,SAAS,CAAC,YAAY;aACxB,IAAI,CACH,IAAA,kBAAM,EAAC,GAAG,EAAE,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,EACtC,IAAA,8BAAc,EAAC,IAAI,CAAC,CACrB;aACA,SAAS,CAAC,GAAG,EAAE;YACd,IAAI,CAAC,WAAW,GAAG,IAAI,CAAC;QAC1B,CAAC,CAAC,CAAC;IACP,CAAC;IAEO,oBAAoB;QAC1B,IAAI,CAAC,UAAU,CAAC,KAAK,GAAG,CAAC,QAAY,EAAE,EAAE,CAAC,IAAI,CAAC,qBAAqB,CAAC,QAAQ,CAAC;aAC3E,IAAI,CAAC,IAAA,8BAAc,EAAC,IAAI,CAAC,CAAC;aAC1B,SAAS,EAAE,CAAC;IACjB,CAAC;IAEO,iBAAiB;QACvB,OAAO,IAAI,CAAC,aAAa,CAAC,OAAO,CAAC;YAChC,KAAK,EAAE,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,iBAAiB,CAAC;YAChD,OAAO,EAAE,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,2DAA2D,CAAC;YAC5F,UAAU,EAAE,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,IAAI,CAAC;YACxC,UAAU,EAAE,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,KAAK,CAAC;YACzC,WAAW,EAAE,KAAK;YAClB,YAAY,EAAE,IAAI;SACnB,CAAC,CAAC;IACL,CAAC;IAEO,SAAS,CAAC,QAAY;QAC5B,IAAI,CAAC,UAAU,CAAC,cAAc,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QAC9C,IAAI,CAAC,UAAU,CAAC,cAAc,CAAC,QAAQ,EAAE,CAAC;IAC5C,CAAC;;AAhEU,4EAAgC;;;;;;;wBAC1C,YAAK;;2CADK,gCAAgC;IAL5C,IAAA,4BAAY,GAAE;IACd,IAAA,gBAAS,EAAC;QACT,QAAQ,EAAE,2BAA2B;QACrC,UAAU,EAAE,IAAI;KACjB,CAAC;GACW,gCAAgC,CAiE5C","names":[],"sources":["/Users/macbook/karpov-work/TrueNAS/webui/src/app/directives/warn-about-unsaved-changes/warn-about-unsaved-changes.directive.ts"],"sourcesContent":["import {\n  Directive, Input, OnInit,\n} from '@angular/core';\nimport { FormGroup } from '@angular/forms';\nimport { UntilDestroy, untilDestroyed } from '@ngneat/until-destroy';\nimport { TranslateService } from '@ngx-translate/core';\nimport { Observable, of } from 'rxjs';\nimport { filter, switchMap } from 'rxjs/operators';\nimport { DialogService } from 'app/modules/dialog/dialog.service';\nimport { IxSlideInRef } from 'app/modules/forms/ix-forms/components/ix-slide-in/ix-slide-in-ref';\n\n@UntilDestroy()\n@Directive({\n  selector: '[warnAboutUnsavedChanges]',\n  standalone: true,\n})\nexport class WarnAboutUnsavedChangesDirective<T> implements OnInit {\n  @Input() formGroup: FormGroup;\n\n  formChanged = false;\n\n  constructor(\n    private translate: TranslateService,\n    private dialogService: DialogService,\n    private slideInRef: IxSlideInRef<T>,\n  ) {}\n\n  ngOnInit(): void {\n    this.trackFormChanges();\n    this.overrideSlideInClose();\n  }\n\n  closeWithConfirmation(response?: T): Observable<boolean> {\n    if (!this.formChanged) {\n      this.emitClose(response);\n      return of(true);\n    }\n\n    return this.showConfirmDialog().pipe(\n      switchMap((shouldClose) => {\n        if (shouldClose) {\n          this.formChanged = false;\n          this.emitClose(response);\n        }\n        return of(shouldClose);\n      }),\n    );\n  }\n\n  private trackFormChanges(): void {\n    this.formGroup.valueChanges\n      .pipe(\n        filter(() => !this.formGroup.pristine),\n        untilDestroyed(this),\n      )\n      .subscribe(() => {\n        this.formChanged = true;\n      });\n  }\n\n  private overrideSlideInClose(): void {\n    this.slideInRef.close = (response?: T) => this.closeWithConfirmation(response)\n      .pipe(untilDestroyed(this))\n      .subscribe();\n  }\n\n  private showConfirmDialog(): Observable<boolean> {\n    return this.dialogService.confirm({\n      title: this.translate.instant('Unsaved Changes'),\n      message: this.translate.instant('You have unsaved changes. Are you sure you want to close?'),\n      cancelText: this.translate.instant('No'),\n      buttonText: this.translate.instant('Yes'),\n      buttonColor: 'red',\n      hideCheckbox: true,\n    });\n  }\n\n  private emitClose(response?: T): void {\n    this.slideInRef.slideInClosed$.next(response);\n    this.slideInRef.slideInClosed$.complete();\n  }\n}\n"],"version":3}