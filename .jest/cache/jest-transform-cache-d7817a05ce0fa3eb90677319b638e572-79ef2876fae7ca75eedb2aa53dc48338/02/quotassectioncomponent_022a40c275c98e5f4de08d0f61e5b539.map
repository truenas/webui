{"file":"/Users/macbook/karpov-work/TrueNAS/webui/src/app/pages/datasets/components/dataset-form/sections/quotas-section/quotas-section.component.ts","mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,wCAEuB;AACvB,0CAA0E;AAC1E,yDAAqE;AACrE,8CAAuD;AACvD,yCAAmC;AACnC,iEAAmD;AACnD,qFAAyF;AAEzF,mGAA8F;AAC9F,qGAAgG;;AAEhG,MAAM,OAAO,GAAG,EAAE,CAAC;AACnB,MAAM,QAAQ,GAAG,EAAE,CAAC;AASb,IAAM,sBAAsB,GAA5B,MAAM,sBAAsB;IA4BjC,YACU,WAAwB,EACzB,SAA6B,EAC5B,UAA+B,EAC/B,SAA2B;QAH3B,gBAAW,GAAX,WAAW,CAAa;QACzB,cAAS,GAAT,SAAS,CAAoB;QAC5B,eAAU,GAAV,UAAU,CAAqB;QAC/B,cAAS,GAAT,SAAS,CAAkB;QA7B5B,uBAAkB,GAAG,IAAA,aAAM,GAAW;QAEtC,SAAI,GAAG,IAAI,CAAC,WAAW,CAAC,KAAK,CAAC;YACrC,QAAQ,EAAE,CAAC,IAAc,EAAE,IAAI,CAAC,UAAU,CAAC,WAAW,CACpD,kBAAU,CAAC,GAAG,CAAC,oBAAG,CAAC,EACnB,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,kCAAmB,CAAC,4BAA4B,CAAC,CACzE,CAAC;YACF,gBAAgB,EAAE,CAAC,OAAO,EAAE,CAAC,kBAAU,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,kBAAU,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC;YACrE,wBAAwB,EAAE,CAAC,IAAI,CAAC;YAChC,iBAAiB,EAAE,CAAC,QAAQ,EAAE,CAAC,kBAAU,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,kBAAU,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC;YACvE,yBAAyB,EAAE,CAAC,IAAI,CAAC;YACjC,cAAc,EAAE,CAAC,IAAc,CAAC;YAChC,KAAK,EAAE,CAAC,IAAc,EAAE,IAAI,CAAC,UAAU,CAAC,WAAW,CACjD,kBAAU,CAAC,GAAG,CAAC,oBAAG,CAAC,EACnB,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,kCAAmB,CAAC,4BAA4B,CAAC,CACzE,CAAC;YACF,aAAa,EAAE,CAAC,OAAO,EAAE,CAAC,kBAAU,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,kBAAU,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC;YAClE,qBAAqB,EAAE,CAAC,IAAI,CAAC;YAC7B,cAAc,EAAE,CAAC,QAAQ,EAAE,CAAC,kBAAU,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,kBAAU,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,CAAC;YACpE,sBAAsB,EAAE,CAAC,IAAI,CAAC;YAC9B,WAAW,EAAE,CAAC,IAAc,CAAC;SAC9B,CAAC,CAAC;QAEM,aAAQ,GAAG,kCAAmB,CAAC;IAOrC,CAAC;IAEJ,QAAQ;QACN,IAAI,CAAC,gBAAgB,EAAE,CAAC;QAExB,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,IAAA,8BAAc,EAAC,IAAI,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,MAAM,EAAE,EAAE;YACtE,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,MAAM,KAAK,OAAO,CAAC,CAAC;QACnD,CAAC,CAAC,CAAC;IACL,CAAC;IAED,UAAU;QACR,MAAM,MAAM,GAAG,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC;QAC/B,MAAM,OAAO,GAA2B,IAAA,kBAAM,EAAC,MAAM,EAAE,CAAC,KAAK,EAAE,GAAG,EAAE,EAAE;YACpE,OAAO;gBACL,UAAU;gBACV,gBAAgB;gBAChB,OAAO;gBACP,aAAa;aACd,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAI,KAAK,KAAK,IAAI,CAAC;QACpC,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,MAAM,CAAC,wBAAwB,EAAE,CAAC;YACrC,OAAO,CAAC,gBAAgB,GAAG,MAAM,CAAC,gBAAgB,CAAC;QACrD,CAAC;QACD,IAAI,CAAC,MAAM,CAAC,yBAAyB,EAAE,CAAC;YACtC,OAAO,CAAC,iBAAiB,GAAG,MAAM,CAAC,iBAAiB,CAAC;QACvD,CAAC;QACD,IAAI,CAAC,MAAM,CAAC,qBAAqB,EAAE,CAAC;YAClC,OAAO,CAAC,aAAa,GAAG,MAAM,CAAC,aAAa,CAAC;QAC/C,CAAC;QACD,IAAI,CAAC,MAAM,CAAC,sBAAsB,EAAE,CAAC;YACnC,OAAO,CAAC,cAAc,GAAG,MAAM,CAAC,cAAc,CAAC;QACjD,CAAC;QACD,OAAO,OAAO,CAAC;IACjB,CAAC;IAEO,gBAAgB;QACtB,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,wBAAwB,CAAC,YAAY,CAAC,IAAI,CAAC,IAAA,8BAAc,EAAC,IAAI,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,SAAS,EAAE,EAAE;YAC1G,IAAI,CAAC,qBAAqB,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,gBAAgB,EAAE,SAAS,CAAC,CAAC;QAC7E,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,yBAAyB,CAAC,YAAY,CAAC,IAAI,CAAC,IAAA,8BAAc,EAAC,IAAI,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,SAAS,EAAE,EAAE;YAC3G,IAAI,CAAC,qBAAqB,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,iBAAiB,EAAE,SAAS,CAAC,CAAC;QAC9E,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,qBAAqB,CAAC,YAAY,CAAC,IAAI,CAAC,IAAA,8BAAc,EAAC,IAAI,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,SAAS,EAAE,EAAE;YACvG,IAAI,CAAC,qBAAqB,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,aAAa,EAAE,SAAS,CAAC,CAAC;QAC1E,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,sBAAsB,CAAC,YAAY,CAAC,IAAI,CAAC,IAAA,8BAAc,EAAC,IAAI,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,SAAS,EAAE,EAAE;YACxG,IAAI,CAAC,qBAAqB,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,cAAc,EAAE,SAAS,CAAC,CAAC;QAC3E,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,wBAAwB,CAAC,sBAAsB,EAAE,CAAC;QACrE,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,yBAAyB,CAAC,sBAAsB,EAAE,CAAC;QACtE,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,qBAAqB,CAAC,sBAAsB,EAAE,CAAC;QAClE,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,sBAAsB,CAAC,sBAAsB,EAAE,CAAC;IACrE,CAAC;IAEO,qBAAqB,CAAC,OAAwB,EAAE,UAAmB;QACzE,IAAI,UAAU,EAAE,CAAC;YACf,OAAO,CAAC,OAAO,EAAE,CAAC;QACpB,CAAC;aAAM,CAAC;YACN,OAAO,CAAC,MAAM,EAAE,CAAC;QACnB,CAAC;IACH,CAAC;;AAlGU,wDAAsB;;;;;;;;qBAChC,YAAK;;;iCADK,sBAAsB;IAPlC,IAAA,4BAAY,GAAE;IACd,IAAA,gBAAS,EAAC;QACT,QAAQ,EAAE,mBAAmB;QAE7B,oDAA8C;QAC9C,eAAe,EAAE,8BAAuB,CAAC,MAAM;KAChD,CAAC;GACW,sBAAsB,CAmGlC","names":[],"sources":["/Users/macbook/karpov-work/TrueNAS/webui/src/app/pages/datasets/components/dataset-form/sections/quotas-section/quotas-section.component.ts"],"sourcesContent":["import {\n  ChangeDetectionStrategy, Component, Input, OnInit, output,\n} from '@angular/core';\nimport { AbstractControl, FormBuilder, Validators } from '@angular/forms';\nimport { UntilDestroy, untilDestroyed } from '@ngneat/until-destroy';\nimport { TranslateService } from '@ngx-translate/core';\nimport { pickBy } from 'lodash-es';\nimport { GiB } from 'app/constants/bytes.constant';\nimport { helptextDatasetForm } from 'app/helptext/storage/volumes/datasets/dataset-form';\nimport { Dataset, DatasetCreate } from 'app/interfaces/dataset.interface';\nimport { IxFormatterService } from 'app/modules/forms/ix-forms/services/ix-formatter.service';\nimport { IxValidatorsService } from 'app/modules/forms/ix-forms/services/ix-validators.service';\n\nconst warning = 80;\nconst critical = 95;\n\n@UntilDestroy()\n@Component({\n  selector: 'ix-quotas-section',\n  styleUrls: ['./quotas-section.component.scss'],\n  templateUrl: './quotas-section.component.html',\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class QuotasSectionComponent implements OnInit {\n  @Input() parent: Dataset;\n\n  readonly formValidityChange = output<boolean>();\n\n  readonly form = this.formBuilder.group({\n    refquota: [null as number, this.validators.withMessage(\n      Validators.min(GiB),\n      this.translate.instant(helptextDatasetForm.dataset_form_quota_too_small),\n    )],\n    refquota_warning: [warning, [Validators.min(0), Validators.max(100)]],\n    refquota_warning_inherit: [true],\n    refquota_critical: [critical, [Validators.min(0), Validators.max(100)]],\n    refquota_critical_inherit: [true],\n    refreservation: [null as number],\n    quota: [null as number, this.validators.withMessage(\n      Validators.min(GiB),\n      this.translate.instant(helptextDatasetForm.dataset_form_quota_too_small),\n    )],\n    quota_warning: [warning, [Validators.min(0), Validators.max(100)]],\n    quota_warning_inherit: [true],\n    quota_critical: [critical, [Validators.min(0), Validators.max(100)]],\n    quota_critical_inherit: [true],\n    reservation: [null as number],\n  });\n\n  readonly helptext = helptextDatasetForm;\n\n  constructor(\n    private formBuilder: FormBuilder,\n    public formatter: IxFormatterService,\n    private validators: IxValidatorsService,\n    private translate: TranslateService,\n  ) {}\n\n  ngOnInit(): void {\n    this.setFormRelations();\n\n    this.form.statusChanges.pipe(untilDestroyed(this)).subscribe((status) => {\n      this.formValidityChange.emit(status === 'VALID');\n    });\n  }\n\n  getPayload(): Partial<DatasetCreate> {\n    const values = this.form.value;\n    const payload: Partial<DatasetCreate> = pickBy(values, (value, key) => {\n      return [\n        'refquota',\n        'refreservation',\n        'quota',\n        'reservation',\n      ].includes(key) && value !== null;\n    });\n\n    if (!values.refquota_warning_inherit) {\n      payload.refquota_warning = values.refquota_warning;\n    }\n    if (!values.refquota_critical_inherit) {\n      payload.refquota_critical = values.refquota_critical;\n    }\n    if (!values.quota_warning_inherit) {\n      payload.quota_warning = values.quota_warning;\n    }\n    if (!values.quota_critical_inherit) {\n      payload.quota_critical = values.quota_critical;\n    }\n    return payload;\n  }\n\n  private setFormRelations(): void {\n    this.form.controls.refquota_warning_inherit.valueChanges.pipe(untilDestroyed(this)).subscribe((isInherit) => {\n      this.setDisabledForControl(this.form.controls.refquota_warning, isInherit);\n    });\n\n    this.form.controls.refquota_critical_inherit.valueChanges.pipe(untilDestroyed(this)).subscribe((isInherit) => {\n      this.setDisabledForControl(this.form.controls.refquota_critical, isInherit);\n    });\n\n    this.form.controls.quota_warning_inherit.valueChanges.pipe(untilDestroyed(this)).subscribe((isInherit) => {\n      this.setDisabledForControl(this.form.controls.quota_warning, isInherit);\n    });\n\n    this.form.controls.quota_critical_inherit.valueChanges.pipe(untilDestroyed(this)).subscribe((isInherit) => {\n      this.setDisabledForControl(this.form.controls.quota_critical, isInherit);\n    });\n\n    this.form.controls.refquota_warning_inherit.updateValueAndValidity();\n    this.form.controls.refquota_critical_inherit.updateValueAndValidity();\n    this.form.controls.quota_warning_inherit.updateValueAndValidity();\n    this.form.controls.quota_critical_inherit.updateValueAndValidity();\n  }\n\n  private setDisabledForControl(control: AbstractControl, isDisabled: boolean): void {\n    if (isDisabled) {\n      control.disable();\n    } else {\n      control.enable();\n    }\n  }\n}\n"],"version":3}