{"file":"/Users/macbook/karpov-work/TrueNAS/webui/src/app/modules/dialog/components/multi-error-dialog/error-template/error-template.component.ts","mappings":"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","names":[],"sources":["/Users/macbook/karpov-work/TrueNAS/webui/src/app/modules/dialog/components/multi-error-dialog/error-template/error-template.component.ts"],"sourcesContent":["import { HttpErrorResponse } from '@angular/common/http';\nimport {\n  ChangeDetectionStrategy, Component, ElementRef, Input, ViewChild,\n} from '@angular/core';\nimport { MatButton } from '@angular/material/button';\nimport { MatDialogTitle } from '@angular/material/dialog';\nimport { UntilDestroy, untilDestroyed } from '@ngneat/until-destroy';\nimport { TranslateModule } from '@ngx-translate/core';\nimport { Job } from 'app/interfaces/job.interface';\nimport { DialogService } from 'app/modules/dialog/dialog.service';\nimport { IxIconComponent } from 'app/modules/ix-icon/ix-icon.component';\nimport { TestDirective } from 'app/modules/test-id/test.directive';\nimport { DownloadService } from 'app/services/download.service';\nimport { ErrorHandlerService } from 'app/services/error-handler.service';\nimport { WebSocketService } from 'app/services/ws.service';\n\n@UntilDestroy()\n@Component({\n  selector: 'ix-error-template',\n  templateUrl: './error-template.component.html',\n  styleUrls: ['./error-template.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    MatDialogTitle,\n    IxIconComponent,\n    MatButton,\n    TranslateModule,\n    TestDirective,\n  ],\n})\nexport class ErrorTemplateComponent {\n  @ViewChild('errorMessageWrapper') errorMessageWrapper: ElementRef<HTMLElement>;\n  @ViewChild('errorTitle') errorTitle: ElementRef<HTMLElement>;\n  @ViewChild('errorMdContent') errorMdContent: ElementRef<HTMLElement>;\n  @ViewChild('errorBtPanel') errorBtPanel: ElementRef<HTMLElement>;\n  @ViewChild('errorBtText') errorBtText: ElementRef<HTMLElement>;\n\n  @Input() title: string;\n  @Input() message: string;\n  @Input() backtrace: string;\n  isCloseMoreInfo = true;\n  @Input() logs: Job;\n\n  constructor(\n    private ws: WebSocketService,\n    private download: DownloadService,\n    private errorHandler: ErrorHandlerService,\n    private dialogService: DialogService,\n  ) {}\n\n  toggleOpen(): void {\n    const messageWrapper = this.errorMessageWrapper.nativeElement;\n    const content = this.errorMdContent.nativeElement;\n    const btPanel = this.errorBtPanel.nativeElement;\n    const txtarea = this.errorBtText.nativeElement;\n\n    this.isCloseMoreInfo = !this.isCloseMoreInfo;\n    if (!this.isCloseMoreInfo) {\n      messageWrapper.setAttribute('style', 'max-height: 63px; overflow: auto');\n      btPanel.setAttribute('style', 'width: 750px; max-height: calc(80vh - 240px)');\n    } else {\n      content.removeAttribute('style');\n      btPanel.removeAttribute('style');\n      messageWrapper.removeAttribute('style');\n      txtarea.removeAttribute('style');\n    }\n  }\n\n  downloadLogs(): void {\n    this.ws.call('core.job_download_logs', [this.logs.id, `${this.logs.id}.log`])\n      .pipe(this.errorHandler.catchError(), untilDestroyed(this))\n      .subscribe((url) => {\n        const mimetype = 'text/plain';\n        this.download.streamDownloadFile(url, `${this.logs.id}.log`, mimetype).pipe(untilDestroyed(this)).subscribe({\n          next: (file) => {\n            this.download.downloadBlob(file, `${this.logs.id}.log`);\n          },\n          error: (error: HttpErrorResponse) => {\n            this.dialogService.error(this.errorHandler.parseHttpError(error));\n          },\n        });\n      });\n  }\n}\n"],"version":3}