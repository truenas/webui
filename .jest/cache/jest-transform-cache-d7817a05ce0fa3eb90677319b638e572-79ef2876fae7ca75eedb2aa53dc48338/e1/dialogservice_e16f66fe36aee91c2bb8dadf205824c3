805341dde3f73b464599782f9711e0a1
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.DialogService = void 0;
const core_1 = require("@angular/core");
const dialog_1 = require("@angular/material/dialog");
const until_destroy_1 = require("@ngneat/until-destroy");
const core_2 = require("@ngx-translate/core");
const rxjs_1 = require("rxjs");
const job_progress_dialog_ref_class_1 = require("app/classes/job-progress-dialog-ref.class");
const confirm_dialog_component_1 = require("app/modules/dialog/components/confirm-dialog/confirm-dialog.component");
const error_dialog_component_1 = require("app/modules/dialog/components/error-dialog/error-dialog.component");
const full_screen_dialog_component_1 = require("app/modules/dialog/components/full-screen-dialog/full-screen-dialog.component");
const general_dialog_component_1 = require("app/modules/dialog/components/general-dialog/general-dialog.component");
const info_dialog_component_1 = require("app/modules/dialog/components/info-dialog/info-dialog.component");
const job_progress_dialog_component_1 = require("app/modules/dialog/components/job-progress/job-progress-dialog.component");
const multi_error_dialog_component_1 = require("app/modules/dialog/components/multi-error-dialog/multi-error-dialog.component");
let DialogService = class DialogService {
    constructor(matDialog, translate) {
        this.matDialog = matDialog;
        this.translate = translate;
    }
    confirm(options) {
        return this.matDialog.open(confirm_dialog_component_1.ConfirmDialogComponent, {
            disableClose: options.disableClose || false,
            data: options,
            autoFocus: false,
        })
            .afterClosed();
    }
    error(error) {
        if (Array.isArray(error)) {
            error = this.cleanErrors(error);
            if (error.length > 1) {
                const dialogRef = this.matDialog.open(multi_error_dialog_component_1.MultiErrorDialogComponent, {
                    data: error,
                });
                return dialogRef.afterClosed();
            }
            error = error[0];
        }
        if (!(error === null || error === void 0 ? void 0 : error.message)) {
            return (0, rxjs_1.of)(false);
        }
        const dialogRef = this.matDialog.open(error_dialog_component_1.ErrorDialogComponent, {
            data: error,
        });
        dialogRef.componentInstance.title = error.title;
        dialogRef.componentInstance.message = error.message;
        dialogRef.componentInstance.backtrace = error.backtrace;
        if (error.logs) {
            dialogRef.componentInstance.logs = error.logs;
        }
        return dialogRef.afterClosed();
    }
    cleanErrors(errorReports) {
        const newErrorReports = [];
        for (const errorReport of errorReports) {
            if (errorReport.message) {
                newErrorReports.push(Object.assign({}, errorReport));
            }
        }
        return newErrorReports;
    }
    info(title, info, isHtml = false) {
        const dialogRef = this.matDialog.open(info_dialog_component_1.InfoDialogComponent);
        dialogRef.componentInstance.title = title;
        dialogRef.componentInstance.info = info;
        dialogRef.componentInstance.icon = 'info';
        dialogRef.componentInstance.isHtml = isHtml;
        return dialogRef.afterClosed();
    }
    warn(title, info, isHtml = false) {
        const dialogRef = this.matDialog.open(info_dialog_component_1.InfoDialogComponent);
        dialogRef.componentInstance.title = title;
        dialogRef.componentInstance.info = info;
        dialogRef.componentInstance.icon = 'warning';
        dialogRef.componentInstance.isHtml = isHtml;
        return dialogRef.afterClosed();
    }
    generalDialog(conf, matConfig) {
        const dialogRef = this.matDialog.open(general_dialog_component_1.GeneralDialogComponent, matConfig);
        dialogRef.componentInstance.conf = conf;
        return dialogRef.afterClosed();
    }
    fullScreenDialog(title, message, showClose = false, pre = false) {
        const dialogRef = this.matDialog.open(full_screen_dialog_component_1.FullScreenDialogComponent, {
            maxWidth: '100vw',
            maxHeight: '100vh',
            height: '100%',
            width: '100%',
            panelClass: 'full-screen-modal',
            disableClose: true,
            data: { showClose, pre },
        });
        dialogRef.componentInstance.title = title;
        dialogRef.componentInstance.message = message;
        return dialogRef.afterClosed();
    }
    closeAllDialogs() {
        for (const openDialog of (this.matDialog.openDialogs || [])) {
            openDialog.close();
        }
    }
    /**
     * Usage:
     * ```
     * this.dialogService.jobDialog(
     *   this.ws.call('pool.create', [pool]),
     * )
     *  .afterClosed()
     *  .pipe(
     *    this.errorHandler.catchError(),
     *    untilDestroyed(this),
     *  )
     *  .subscribe(() => {
     *    // Job completed.
     *  });
     * ```
     *
     * If you need more control over JobProgressDialogComponent, use it directly.
     */
    jobDialog(job$, { title, description, canMinimize } = {}) {
        const matDialogRef = this.matDialog.open((job_progress_dialog_component_1.JobProgressDialogComponent), {
            data: {
                job$,
                title,
                description,
                canMinimize,
            },
        });
        return new job_progress_dialog_ref_class_1.JobProgressDialogRef(matDialogRef, this.translate);
    }
};
exports.DialogService = DialogService;
DialogService.ctorParameters = () => [
    { type: dialog_1.MatDialog },
    { type: core_2.TranslateService }
];
exports.DialogService = DialogService = __decorate([
    (0, until_destroy_1.UntilDestroy)(),
    (0, core_1.Injectable)({
        providedIn: 'root',
    })
], DialogService);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL21hY2Jvb2sva2FycG92LXdvcmsvVHJ1ZU5BUy93ZWJ1aS9zcmMvYXBwL21vZHVsZXMvZGlhbG9nL2RpYWxvZy5zZXJ2aWNlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBLHdDQUEyQztBQUMzQyxxREFBc0U7QUFDdEUseURBQXFEO0FBQ3JELDhDQUF1RDtBQUN2RCwrQkFBc0M7QUFDdEMsNkZBQWlGO0FBUWpGLG9IQUErRztBQUMvRyw4R0FBeUc7QUFDekcsZ0lBQTBIO0FBQzFILG9IQUFvSTtBQUNwSSwyR0FBc0c7QUFDdEcsNEhBQXNIO0FBQ3RILGdJQUEwSDtBQU1uSCxJQUFNLGFBQWEsR0FBbkIsTUFBTSxhQUFhO0lBQ3hCLFlBQ1UsU0FBb0IsRUFDcEIsU0FBMkI7UUFEM0IsY0FBUyxHQUFULFNBQVMsQ0FBVztRQUNwQixjQUFTLEdBQVQsU0FBUyxDQUFrQjtJQUNqQyxDQUFDO0lBSUwsT0FBTyxDQUNMLE9BQTZEO1FBRTdELE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsaURBQXNCLEVBQUU7WUFDakQsWUFBWSxFQUFFLE9BQU8sQ0FBQyxZQUFZLElBQUksS0FBSztZQUMzQyxJQUFJLEVBQUUsT0FBTztZQUNiLFNBQVMsRUFBRSxLQUFLO1NBQ2pCLENBQUM7YUFDQyxXQUFXLEVBQUUsQ0FBQztJQUNuQixDQUFDO0lBRUQsS0FBSyxDQUFDLEtBQWtDO1FBQ3RDLElBQUksS0FBSyxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDO1lBQ3pCLEtBQUssR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQ2hDLElBQUksS0FBSyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUUsQ0FBQztnQkFDckIsTUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsd0RBQXlCLEVBQUU7b0JBQy9ELElBQUksRUFBRSxLQUFLO2lCQUNaLENBQUMsQ0FBQztnQkFDSCxPQUFPLFNBQVMsQ0FBQyxXQUFX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QkFBYixhQUFhO0lBSnpCLElBQUEsNEJBQVksR0FBRTtJQUNkLElBQUEsaUJBQVUsRUFBQztRQUNWLFVBQVUsRUFBRSxNQUFNO0tBQ25CLENBQUM7R0FDVyxhQUFhLENBaUp6QiIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvbWFjYm9vay9rYXJwb3Ytd29yay9UcnVlTkFTL3dlYnVpL3NyYy9hcHAvbW9kdWxlcy9kaWFsb2cvZGlhbG9nLnNlcnZpY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgTWF0RGlhbG9nLCBNYXREaWFsb2dDb25maWcgfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbC9kaWFsb2cnO1xuaW1wb3J0IHsgVW50aWxEZXN0cm95IH0gZnJvbSAnQG5nbmVhdC91bnRpbC1kZXN0cm95JztcbmltcG9ydCB7IFRyYW5zbGF0ZVNlcnZpY2UgfSBmcm9tICdAbmd4LXRyYW5zbGF0ZS9jb3JlJztcbmltcG9ydCB7IE9ic2VydmFibGUsIG9mIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBKb2JQcm9ncmVzc0RpYWxvZ1JlZiB9IGZyb20gJ2FwcC9jbGFzc2VzL2pvYi1wcm9ncmVzcy1kaWFsb2ctcmVmLmNsYXNzJztcbmltcG9ydCB7XG4gIENvbmZpcm1PcHRpb25zLFxuICBDb25maXJtT3B0aW9uc1dpdGhTZWNvbmRhcnlDaGVja2JveCxcbiAgRGlhbG9nV2l0aFNlY29uZGFyeUNoZWNrYm94UmVzdWx0LFxufSBmcm9tICdhcHAvaW50ZXJmYWNlcy9kaWFsb2cuaW50ZXJmYWNlJztcbmltcG9ydCB7IEVycm9yUmVwb3J0IH0gZnJvbSAnYXBwL2ludGVyZmFjZXMvZXJyb3ItcmVwb3J0LmludGVyZmFjZSc7XG5pbXBvcnQgeyBKb2IgfSBmcm9tICdhcHAvaW50ZXJmYWNlcy9qb2IuaW50ZXJmYWNlJztcbmltcG9ydCB7IENvbmZpcm1EaWFsb2dDb21wb25lbnQgfSBmcm9tICdhcHAvbW9kdWxlcy9kaWFsb2cvY29tcG9uZW50cy9jb25maXJtLWRpYWxvZy9jb25maXJtLWRpYWxvZy5jb21wb25lbnQnO1xuaW1wb3J0IHsgRXJyb3JEaWFsb2dDb21wb25lbnQgfSBmcm9tICdhcHAvbW9kdWxlcy9kaWFsb2cvY29tcG9uZW50cy9lcnJvci1kaWFsb2cvZXJyb3ItZGlhbG9nLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBGdWxsU2NyZWVuRGlhbG9nQ29tcG9uZW50IH0gZnJvbSAnYXBwL21vZHVsZXMvZGlhbG9nL2NvbXBvbmVudHMvZnVsbC1zY3JlZW4tZGlhbG9nL2Z1bGwtc2NyZWVuLWRpYWxvZy5jb21wb25lbnQnO1xuaW1wb3J0IHsgR2VuZXJhbERpYWxvZ0NvbXBvbmVudCwgR2VuZXJhbERpYWxvZ0NvbmZpZyB9IGZyb20gJ2FwcC9tb2R1bGVzL2RpYWxvZy9jb21wb25lbnRzL2dlbmVyYWwtZGlhbG9nL2dlbmVyYWwtZGlhbG9nLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBJbmZvRGlhbG9nQ29tcG9uZW50IH0gZnJvbSAnYXBwL21vZHVsZXMvZGlhbG9nL2NvbXBvbmVudHMvaW5mby1kaWFsb2cvaW5mby1kaWFsb2cuY29tcG9uZW50JztcbmltcG9ydCB7IEpvYlByb2dyZXNzRGlhbG9nQ29tcG9uZW50IH0gZnJvbSAnYXBwL21vZHVsZXMvZGlhbG9nL2NvbXBvbmVudHMvam9iLXByb2dyZXNzL2pvYi1wcm9ncmVzcy1kaWFsb2cuY29tcG9uZW50JztcbmltcG9ydCB7IE11bHRpRXJyb3JEaWFsb2dDb21wb25lbnQgfSBmcm9tICdhcHAvbW9kdWxlcy9kaWFsb2cvY29tcG9uZW50cy9tdWx0aS1lcnJvci1kaWFsb2cvbXVsdGktZXJyb3ItZGlhbG9nLmNvbXBvbmVudCc7XG5cbkBVbnRpbERlc3Ryb3koKVxuQEluamVjdGFibGUoe1xuICBwcm92aWRlZEluOiAncm9vdCcsXG59KVxuZXhwb3J0IGNsYXNzIERpYWxvZ1NlcnZpY2Uge1xuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIG1hdERpYWxvZzogTWF0RGlhbG9nLFxuICAgIHByaXZhdGUgdHJhbnNsYXRlOiBUcmFuc2xhdGVTZXJ2aWNlLFxuICApIHsgfVxuXG4gIGNvbmZpcm0oY29uZmlybU9wdGlvbnM6IENvbmZpcm1PcHRpb25zKTogT2JzZXJ2YWJsZTxib29sZWFuPjtcbiAgY29uZmlybShjb25maXJtT3B0aW9uczogQ29uZmlybU9wdGlvbnNXaXRoU2Vjb25kYXJ5Q2hlY2tib3gpOiBPYnNlcnZhYmxlPERpYWxvZ1dpdGhTZWNvbmRhcnlDaGVja2JveFJlc3VsdD47XG4gIGNvbmZpcm0oXG4gICAgb3B0aW9uczogQ29uZmlybU9wdGlvbnMgfCBDb25maXJtT3B0aW9uc1dpdGhTZWNvbmRhcnlDaGVja2JveCxcbiAgKTogT2JzZXJ2YWJsZTxib29sZWFuPiB8IE9ic2VydmFibGU8RGlhbG9nV2l0aFNlY29uZGFyeUNoZWNrYm94UmVzdWx0PiB7XG4gICAgcmV0dXJuIHRoaXMubWF0RGlhbG9nLm9wZW4oQ29uZmlybURpYWxvZ0NvbXBvbmVudCwge1xuICAgICAgZGlzYWJsZUNsb3NlOiBvcHRpb25zLmRpc2FibGVDbG9zZSB8fCBmYWxzZSxcbiAgICAgIGRhdGE6IG9wdGlvbnMsXG4gICAgICBhdXRvRm9jdXM6IGZhbHNlLFxuICAgIH0pXG4gICAgICAuYWZ0ZXJDbG9zZWQoKTtcbiAgfVxuXG4gIGVycm9yKGVycm9yOiBFcnJvclJlcG9ydCB8IEVycm9yUmVwb3J0W10pOiBPYnNlcnZhYmxlPGJvb2xlYW4+IHtcbiAgICBpZiAoQXJyYXkuaXNBcnJheShlcnJvcikpIHtcbiAgICAgIGVycm9yID0gdGhpcy5jbGVhbkVycm9ycyhlcnJvcik7XG4gICAgICBpZiAoZXJyb3IubGVuZ3RoID4gMSkge1xuICAgICAgICBjb25zdCBkaWFsb2dSZWYgPSB0aGlzLm1hdERpYWxvZy5vcGVuKE11bHRpRXJyb3JEaWFsb2dDb21wb25lbnQsIHtcbiAgICAgICAgICBkYXRhOiBlcnJvcixcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBkaWFsb2dSZWYuYWZ0ZXJDbG9zZWQoKTtcbiAgICAgIH1cbiAgICAgIGVycm9yID0gZXJyb3JbMF07XG4gICAgfVxuICAgIGlmICghZXJyb3I/Lm1lc3NhZ2UpIHtcbiAgICAgIHJldHVybiBvZihmYWxzZSk7XG4gICAgfVxuICAgIGNvbnN0IGRpYWxvZ1JlZiA9IHRoaXMubWF0RGlhbG9nLm9wZW4oRXJyb3JEaWFsb2dDb21wb25lbnQsIHtcbiAgICAgIGRhdGE6IGVycm9yLFxuICAgIH0pO1xuICAgIGRpYWxvZ1JlZi5jb21wb25lbnRJbnN0YW5jZS50aXRsZSA9IGVycm9yLnRpdGxlO1xuICAgIGRpYWxvZ1JlZi5jb21wb25lbnRJbnN0YW5jZS5tZXNzYWdlID0gZXJyb3IubWVzc2FnZTtcbiAgICBkaWFsb2dSZWYuY29tcG9uZW50SW5zdGFuY2UuYmFja3RyYWNlID0gZXJyb3IuYmFja3RyYWNlO1xuICAgIGlmIChlcnJvci5sb2dzKSB7XG4gICAgICBkaWFsb2dSZWYuY29tcG9uZW50SW5zdGFuY2UubG9ncyA9IGVycm9yLmxvZ3M7XG4gICAgfVxuICAgIHJldHVybiBkaWFsb2dSZWYuYWZ0ZXJDbG9zZWQoKTtcbiAgfVxuXG4gIHByaXZhdGUgY2xlYW5FcnJvcnMoZXJyb3JSZXBvcnRzOiBFcnJvclJlcG9ydFtdKTogRXJyb3JSZXBvcnRbXSB7XG4gICAgY29uc3QgbmV3RXJyb3JSZXBvcnRzID0gW107XG4gICAgZm9yIChjb25zdCBlcnJvclJlcG9ydCBvZiBlcnJvclJlcG9ydHMpIHtcbiAgICAgIGlmIChlcnJvclJlcG9ydC5tZXNzYWdlKSB7XG4gICAgICAgIG5ld0Vycm9yUmVwb3J0cy5wdXNoKHsgLi4uZXJyb3JSZXBvcnQgfSk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBuZXdFcnJvclJlcG9ydHM7XG4gIH1cblxuICBpbmZvKHRpdGxlOiBzdHJpbmcsIGluZm86IHN0cmluZywgaXNIdG1sID0gZmFsc2UpOiBPYnNlcnZhYmxlPGJvb2xlYW4+IHtcbiAgICBjb25zdCBkaWFsb2dSZWYgPSB0aGlzLm1hdERpYWxvZy5vcGVuKEluZm9EaWFsb2dDb21wb25lbnQpO1xuXG4gICAgZGlhbG9nUmVmLmNvbXBvbmVudEluc3RhbmNlLnRpdGxlID0gdGl0bGU7XG4gICAgZGlhbG9nUmVmLmNvbXBvbmVudEluc3RhbmNlLmluZm8gPSBpbmZvO1xuICAgIGRpYWxvZ1JlZi5jb21wb25lbnRJbnN0YW5jZS5pY29uID0gJ2luZm8nO1xuICAgIGRpYWxvZ1JlZi5jb21wb25lbnRJbnN0YW5jZS5pc0h0bWwgPSBpc0h0bWw7XG5cbiAgICByZXR1cm4gZGlhbG9nUmVmLmFmdGVyQ2xvc2VkKCk7XG4gIH1cblxuICB3YXJuKHRpdGxlOiBzdHJpbmcsIGluZm86IHN0cmluZywgaXNIdG1sID0gZmFsc2UpOiBPYnNlcnZhYmxlPGJvb2xlYW4+IHtcbiAgICBjb25zdCBkaWFsb2dSZWYgPSB0aGlzLm1hdERpYWxvZy5vcGVuKEluZm9EaWFsb2dDb21wb25lbnQpO1xuXG4gICAgZGlhbG9nUmVmLmNvbXBvbmVudEluc3RhbmNlLnRpdGxlID0gdGl0bGU7XG4gICAgZGlhbG9nUmVmLmNvbXBvbmVudEluc3RhbmNlLmluZm8gPSBpbmZvO1xuICAgIGRpYWxvZ1JlZi5jb21wb25lbnRJbnN0YW5jZS5pY29uID0gJ3dhcm5pbmcnO1xuICAgIGRpYWxvZ1JlZi5jb21wb25lbnRJbnN0YW5jZS5pc0h0bWwgPSBpc0h0bWw7XG5cbiAgICByZXR1cm4gZGlhbG9nUmVmLmFmdGVyQ2xvc2VkKCk7XG4gIH1cblxuICBnZW5lcmFsRGlhbG9nKGNvbmY6IEdlbmVyYWxEaWFsb2dDb25maWcsIG1hdENvbmZpZz86IE1hdERpYWxvZ0NvbmZpZyk6IE9ic2VydmFibGU8Ym9vbGVhbj4ge1xuICAgIGNvbnN0IGRpYWxvZ1JlZiA9IHRoaXMubWF0RGlhbG9nLm9wZW4oR2VuZXJhbERpYWxvZ0NvbXBvbmVudCwgbWF0Q29uZmlnKTtcbiAgICBkaWFsb2dSZWYuY29tcG9uZW50SW5zdGFuY2UuY29uZiA9IGNvbmY7XG5cbiAgICByZXR1cm4gZGlhbG9nUmVmLmFmdGVyQ2xvc2VkKCk7XG4gIH1cblxuICBmdWxsU2NyZWVuRGlhbG9nKHRpdGxlOiBzdHJpbmcsIG1lc3NhZ2U6IHN0cmluZywgc2hvd0Nsb3NlID0gZmFsc2UsIHByZSA9IGZhbHNlKTogT2JzZXJ2YWJsZTxib29sZWFuPiB7XG4gICAgY29uc3QgZGlhbG9nUmVmID0gdGhpcy5tYXREaWFsb2cub3BlbihGdWxsU2NyZWVuRGlhbG9nQ29tcG9uZW50LCB7XG4gICAgICBtYXhXaWR0aDogJzEwMHZ3JyxcbiAgICAgIG1heEhlaWdodDogJzEwMHZoJyxcbiAgICAgIGhlaWdodDogJzEwMCUnLFxuICAgICAgd2lkdGg6ICcxMDAlJyxcbiAgICAgIHBhbmVsQ2xhc3M6ICdmdWxsLXNjcmVlbi1tb2RhbCcsXG4gICAgICBkaXNhYmxlQ2xvc2U6IHRydWUsXG4gICAgICBkYXRhOiB7IHNob3dDbG9zZSwgcHJlIH0sXG4gICAgfSk7XG4gICAgZGlhbG9nUmVmLmNvbXBvbmVudEluc3RhbmNlLnRpdGxlID0gdGl0bGU7XG4gICAgZGlhbG9nUmVmLmNvbXBvbmVudEluc3RhbmNlLm1lc3NhZ2UgPSBtZXNzYWdlO1xuXG4gICAgcmV0dXJuIGRpYWxvZ1JlZi5hZnRlckNsb3NlZCgpO1xuICB9XG5cbiAgY2xvc2VBbGxEaWFsb2dzKCk6IHZvaWQge1xuICAgIGZvciAoY29uc3Qgb3BlbkRpYWxvZyBvZiAodGhpcy5tYXREaWFsb2cub3BlbkRpYWxvZ3MgfHwgW10pKSB7XG4gICAgICBvcGVuRGlhbG9nLmNsb3NlKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFVzYWdlOlxuICAgKiBgYGBcbiAgICogdGhpcy5kaWFsb2dTZXJ2aWNlLmpvYkRpYWxvZyhcbiAgICogICB0aGlzLndzLmNhbGwoJ3Bvb2wuY3JlYXRlJywgW3Bvb2xdKSxcbiAgICogKVxuICAgKiAgLmFmdGVyQ2xvc2VkKClcbiAgICogIC5waXBlKFxuICAgKiAgICB0aGlzLmVycm9ySGFuZGxlci5jYXRjaEVycm9yKCksXG4gICAqICAgIHVudGlsRGVzdHJveWVkKHRoaXMpLFxuICAgKiAgKVxuICAgKiAgLnN1YnNjcmliZSgoKSA9PiB7XG4gICAqICAgIC8vIEpvYiBjb21wbGV0ZWQuXG4gICAqICB9KTtcbiAgICogYGBgXG4gICAqXG4gICAqIElmIHlvdSBuZWVkIG1vcmUgY29udHJvbCBvdmVyIEpvYlByb2dyZXNzRGlhbG9nQ29tcG9uZW50LCB1c2UgaXQgZGlyZWN0bHkuXG4gICAqL1xuICBqb2JEaWFsb2c8Uj4oXG4gICAgam9iJDogT2JzZXJ2YWJsZTxKb2I8Uj4+LFxuICAgIHsgdGl0bGUsIGRlc2NyaXB0aW9uLCBjYW5NaW5pbWl6ZSB9OiB7XG4gICAgICB0aXRsZT86IHN0cmluZztcbiAgICAgIGRlc2NyaXB0aW9uPzogc3RyaW5nO1xuXG4gICAgICAvLyBVc2UgZm9yIGxvbmcgam9icyB3aGVyZSBpdCdzIG5vdCByZXF1aXJlZCBmb3IgdXNlciB0byB3YWl0IGZvciB0aGUgcmVzdWx0LlxuICAgICAgLy8gTm90ZSB0aGF0IGBjb21wbGV0ZWAgaGFuZGxlciB3aWxsIGJlIGNhbGxlZCBpbW1lZGlhdGVseSBhbmQgYG5leHRgIHdpbGwgbmV2ZXIgYmUgY2FsbGVkLlxuICAgICAgY2FuTWluaW1pemU/OiBib29sZWFuO1xuICAgIH0gPSB7fSxcbiAgKTogSm9iUHJvZ3Jlc3NEaWFsb2dSZWY8Uj4ge1xuICAgIGNvbnN0IG1hdERpYWxvZ1JlZiA9IHRoaXMubWF0RGlhbG9nLm9wZW4oSm9iUHJvZ3Jlc3NEaWFsb2dDb21wb25lbnQ8Uj4sIHtcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgam9iJCxcbiAgICAgICAgdGl0bGUsXG4gICAgICAgIGRlc2NyaXB0aW9uLFxuICAgICAgICBjYW5NaW5pbWl6ZSxcbiAgICAgIH0sXG4gICAgfSk7XG4gICAgcmV0dXJuIG5ldyBKb2JQcm9ncmVzc0RpYWxvZ1JlZjxSPihtYXREaWFsb2dSZWYsIHRoaXMudHJhbnNsYXRlKTtcbiAgfVxufVxuIl0sInZlcnNpb24iOjN9