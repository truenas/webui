a0cd106f801897a11ca592c6fdaac5ae
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const http_1 = require("@angular/common/http");
const core_1 = require("@angular/core");
const jest_1 = require("@ngneat/spectator/jest");
const core_2 = require("@ngx-translate/core");
const rxjs_1 = require("rxjs");
const job_state_enum_1 = require("app/enums/job-state.enum");
const response_error_type_enum_1 = require("app/enums/response-error-type.enum");
const websocket_error_name_enum_1 = require("app/enums/websocket-error-name.enum");
const dialog_service_1 = require("app/modules/dialog/dialog.service");
const error_handler_service_1 = require("app/services/error-handler.service");
const error = new Error('Dummy Error');
const wsError = {
    error: 11,
    errname: websocket_error_name_enum_1.WebSocketErrorName.Again,
    type: response_error_type_enum_1.ResponseErrorType.Validation,
    reason: '[EINVAL] user_update.smb: This attribute cannot be changed\n[EINVAL] user_update.smb: Password must be changed in order to enable SMB authentication\n',
    trace: {},
    extra: [],
};
const failedJob = {
    method: 'cloudsync.sync_onetime',
    description: null,
    error: 'DUMMY_ERROR',
    exception: 'EXCEPTION',
    exc_info: null,
    logs_excerpt: 'LOGS',
    state: job_state_enum_1.JobState.Failed,
};
const excInfo = {
    repr: 'ValidationErrors()',
    type: 'VALIDATION',
    extra: [
        [
            'cloud_sync_sync_onetime.path',
            'DUMMY_ERROR',
            22,
        ],
    ],
};
const httpError = {
    error: { name: 'This error' },
    name: 'HttpErrorResponse',
    message: 'This error occurred',
    headers: new http_1.HttpHeaders(),
    ok: false,
    status: 409,
    statusText: 'Conflict',
    type: http_1.HttpEventType.Response,
    url: '',
};
describe('ErrorHandlerService', () => {
    let spectator;
    const createService = (0, jest_1.createServiceFactory)({
        service: error_handler_service_1.ErrorHandlerService,
        providers: [
            (0, jest_1.mockProvider)(core_1.Injector, {
                get: jest.fn(),
            }),
        ],
    });
    beforeEach(() => {
        jest.resetAllMocks();
        spectator = createService();
        const dialogService = spectator.inject(dialog_service_1.DialogService);
        Object.defineProperty(dialogService, 'error', {
            value: jest.fn(() => (0, rxjs_1.of)(true)),
        });
        Object.defineProperty(spectator.service, 'dialog', {
            get: () => dialogService,
        });
        const translateService = spectator.inject(core_2.TranslateService);
        Object.defineProperty(spectator.service, 'translate', {
            value: translateService,
        });
        Object.defineProperty(spectator.service, 'logToSentry', {
            value: jest.fn(),
        });
        jest.spyOn(console, 'error').mockImplementation();
    });
    afterAll(() => {
        jest.restoreAllMocks();
    });
    describe('handleError', () => {
        it('logs normal error to console and sentry', () => {
            jest.spyOn(spectator.service, 'parseError');
            spectator.service.handleError(error);
            expect(console.error).toHaveBeenCalledWith(error);
            expect(spectator.service.parseError).toHaveBeenCalledWith(error);
            expect(spectator.service.logToSentry).toHaveBeenCalledWith({
                message: 'Dummy Error',
                title: 'Error',
            });
        });
        it('does not log Websocket CloseEvent to Sentry', () => {
            spectator.service.handleError(new CloseEvent('close'));
            expect(spectator.service.logToSentry).not.toHaveBeenCalled();
        });
        it('logs websocket error', () => {
            spectator.service.handleError(wsError);
            expect(spectator.service.logToSentry).toHaveBeenCalledWith({
                backtrace: '',
                message: wsError.reason,
                title: 'VALIDATION',
            });
        });
        it('logs job errors', () => {
            spectator.service.handleError(failedJob);
            expect(spectator.service.logToSentry).toHaveBeenCalledWith({
                title: 'FAILED',
                backtrace: 'LOGS',
                message: 'DUMMY_ERROR',
            });
        });
        it('logs job error for jobs with `extra` available', () => {
            spectator.service.handleError(Object.assign(Object.assign({}, failedJob), { exc_info: excInfo }));
            expect(spectator.service.logToSentry).toHaveBeenCalledWith([{
                    backtrace: 'EXCEPTION',
                    message: 'DUMMY_ERROR',
                    title: 'Error: path',
                }]);
        });
    });
    describe('parseHttpError', () => {
        it('returns correct error object with 409 error', () => {
            const errorReport = spectator.service.parseHttpError(httpError);
            expect(errorReport).toEqual([{ message: 'This error', title: 'Error' }]);
        });
        it('returns correct error object with 409 error with object', () => {
            const errorReport = spectator.service.parseHttpError(Object.assign(Object.assign({}, httpError), { error: { name: ['This error'] } }));
            expect(errorReport).toEqual([{ message: 'This error', title: 'Error' }]);
        });
        it('returns correct object with 400 error', () => {
            const errorReport = spectator.service.parseHttpError(Object.assign(Object.assign({}, httpError), { status: 400, statusText: 'Bad Request' }));
            expect(errorReport).toEqual([{ message: 'This error', title: 'Error' }]);
        });
        it('returns correct object with 400 error without error object', () => {
            const errorReport = spectator.service.parseHttpError(Object.assign(Object.assign({}, httpError), { status: 400, statusText: 'Bad Request', error: 'That error' }));
            expect(errorReport).toEqual({ message: 'That error', title: 'Error (400)' });
        });
        it('returns correct object with 404 error', () => {
            const errorReport = spectator.service.parseHttpError(Object.assign(Object.assign({}, httpError), { status: 404, statusText: 'Not Found' }));
            expect(errorReport).toEqual({ message: 'This error occurred', title: 'Not Found' });
        });
        it('returns correct object with 500 error', () => {
            const errorReport = spectator.service.parseHttpError(Object.assign(Object.assign({}, httpError), { status: 500, statusText: 'Bad Request', error: { error_message: 'Even error' } }));
            expect(errorReport).toEqual({ message: 'Even error', title: 'Error (500)' });
        });
        it('returns correct object with 500 error and string', () => {
            const errorReport = spectator.service.parseHttpError(Object.assign(Object.assign({}, httpError), { status: 500, statusText: 'Bad Request', message: 'Odd error' }));
            expect(errorReport).toEqual({ message: 'Server error: Odd error', title: 'Error (500)' });
        });
        it('returns proper object when unknown error', () => {
            const errorReport = spectator.service.parseHttpError(Object.assign(Object.assign({}, httpError), { status: 510, statusText: 'Bad Request', error: 'Odd error' }));
            expect(console.error).toHaveBeenCalledWith(Object.assign(Object.assign({}, httpError), { status: 510, statusText: 'Bad Request', error: 'Odd error' }));
            expect(errorReport).toEqual({ message: 'This error occurred', title: 'Error (510)' });
        });
    });
    describe('parseError', () => {
        it('parses a websocket error', () => {
            const errorReport = spectator.service.parseError(wsError);
            expect(errorReport).toEqual({
                title: 'VALIDATION',
                message: wsError.reason,
                backtrace: '',
            });
        });
        it('parses a failed job', () => {
            const errorReport = spectator.service.parseError(failedJob);
            expect(errorReport).toEqual({
                title: 'FAILED',
                message: 'DUMMY_ERROR',
                backtrace: 'LOGS',
            });
        });
        it('parses a failed job with exc info', () => {
            const errorReport = spectator.service.parseError(Object.assign(Object.assign({}, failedJob), { exc_info: excInfo }));
            expect(errorReport).toEqual([{
                    title: 'Error: path',
                    message: 'DUMMY_ERROR',
                    backtrace: 'EXCEPTION',
                }]);
        });
        it('parses a generic JS error', () => {
            const errorReport = spectator.service.parseError(error);
            expect(errorReport).toEqual({
                title: 'Error',
                message: 'Dummy Error',
            });
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL21hY2Jvb2sva2FycG92LXdvcmsvVHJ1ZU5BUy93ZWJ1aS9zcmMvYXBwL3NlcnZpY2VzL2Vycm9yLWhhbmRsZXIuc2VydmljZS5zcGVjLnRzIiwibWFwcGluZ3MiOiI7O0FBQUEsK0NBQXFGO0FBQ3JGLHdDQUF5QztBQUN6QyxpREFBOEY7QUFDOUYsOENBQXVEO0FBQ3ZELCtCQUEwQjtBQUMxQiw2REFBb0Q7QUFDcEQsaUZBQXVFO0FBQ3ZFLG1GQUF5RTtBQUd6RSxzRUFBa0U7QUFDbEUsOEVBQXlFO0FBRXpFLE1BQU0sS0FBSyxHQUFHLElBQUksS0FBSyxDQUFDLGFBQWEsQ0FBQyxDQUFDO0FBQ3ZDLE1BQU0sT0FBTyxHQUFHO0lBQ2QsS0FBSyxFQUFFLEVBQUU7SUFDVCxPQUFPLEVBQUUsOENBQWtCLENBQUMsS0FBSztJQUNqQyxJQUFJLEVBQUUsNENBQWlCLENBQUMsVUFBVTtJQUNsQyxNQUFNLEVBQUUsd0pBQXdKO0lBQ2hLLEtBQUssRUFBRSxFQUFFO0lBQ1QsS0FBSyxFQUFFLEVBQUU7Q0FDUSxDQUFDO0FBRXBCLE1BQU0sU0FBUyxHQUFHO0lBQ2hCLE1BQU0sRUFBRSx3QkFBd0I7SUFDaEMsV0FBVyxFQUFFLElBQUk7SUFDakIsS0FBSyxFQUFFLGFBQWE7SUFDcEIsU0FBUyxFQUFFLFdBQVc7SUFDdEIsUUFBUSxFQUFFLElBQUk7SUFDZCxZQUFZLEVBQUUsTUFBTTtJQUNwQixLQUFLLEVBQUUseUJBQVEsQ0FBQyxNQUFNO0NBQ2hCLENBQUM7QUFFVCxNQUFNLE9BQU8sR0FBRztJQUNkLElBQUksRUFBRSxvQkFBb0I7SUFDMUIsSUFBSSxFQUFFLFlBQVk7SUFDbEIsS0FBSyxFQUFFO1FBQ0w7WUFDRSw4QkFBOEI7WUFDOUIsYUFBYTtZQUNiLEVBQUU7U0FDSDtLQUNGO0NBQ0YsQ0FBQztBQUVGLE1BQU0sU0FBUyxHQUFzQjtJQUNuQyxLQUFLLEVBQUUsRUFBRSxJQUFJLEVBQUUsWUFBWSxFQUFFO0lBQzdCLElBQUksRUFBRSxtQkFBbUI7SUFDekIsT0FBTyxFQUFF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UUFFSCxFQUFFLENBQUMscUJBQXFCLEVBQUUsR0FBRyxFQUFFO1lBQzdCLE1BQU0sV0FBVyxHQUFHLFNBQVMsQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1lBRTVELE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQyxPQUFPLENBQUM7Z0JBQzFCLEtBQUssRUFBRSxRQUFRO2dCQUNmLE9BQU8sRUFBRSxhQUFhO2dCQUN0QixTQUFTLEVBQUUsTUFBTTthQUNsQixDQUFDLENBQUM7UUFDTCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxtQ0FBbUMsRUFBRSxHQUFHLEVBQUU7WUFDM0MsTUFBTSxXQUFXLEdBQUcsU0FBUyxDQUFDLE9BQU8sQ0FBQyxVQUFVLGlDQUMzQyxTQUFTLEtBQ1osUUFBUSxFQUFFLE9BQU8sSUFDakIsQ0FBQztZQUVILE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQztvQkFDM0IsS0FBSyxFQUFFLGFBQWE7b0JBQ3BCLE9BQU8sRUFBRSxhQUFhO29CQUN0QixTQUFTLEVBQUUsV0FBVztpQkFDdkIsQ0FBQyxDQUFDLENBQUM7UUFDTixDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQywyQkFBMkIsRUFBRSxHQUFHLEVBQUU7WUFDbkMsTUFBTSxXQUFXLEdBQUcsU0FBUyxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsS0FBSyxDQUFDLENBQUM7WUFFeEQsTUFBTSxDQUFDLFdBQVcsQ0FBQyxDQUFDLE9BQU8sQ0FBQztnQkFDMUIsS0FBSyxFQUFFLE9BQU87Z0JBQ2QsT0FBTyxFQUFFLGFBQWE7YUFDdkIsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9tYWNib29rL2thcnBvdi13b3JrL1RydWVOQVMvd2VidWkvc3JjL2FwcC9zZXJ2aWNlcy9lcnJvci1oYW5kbGVyLnNlcnZpY2Uuc3BlYy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBIdHRwRXJyb3JSZXNwb25zZSwgSHR0cEV2ZW50VHlwZSwgSHR0cEhlYWRlcnMgfSBmcm9tICdAYW5ndWxhci9jb21tb24vaHR0cCc7XG5pbXBvcnQgeyBJbmplY3RvciB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgY3JlYXRlU2VydmljZUZhY3RvcnksIG1vY2tQcm92aWRlciwgU3BlY3RhdG9yU2VydmljZSB9IGZyb20gJ0BuZ25lYXQvc3BlY3RhdG9yL2plc3QnO1xuaW1wb3J0IHsgVHJhbnNsYXRlU2VydmljZSB9IGZyb20gJ0BuZ3gtdHJhbnNsYXRlL2NvcmUnO1xuaW1wb3J0IHsgb2YgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IEpvYlN0YXRlIH0gZnJvbSAnYXBwL2VudW1zL2pvYi1zdGF0ZS5lbnVtJztcbmltcG9ydCB7IFJlc3BvbnNlRXJyb3JUeXBlIH0gZnJvbSAnYXBwL2VudW1zL3Jlc3BvbnNlLWVycm9yLXR5cGUuZW51bSc7XG5pbXBvcnQgeyBXZWJTb2NrZXRFcnJvck5hbWUgfSBmcm9tICdhcHAvZW51bXMvd2Vic29ja2V0LWVycm9yLW5hbWUuZW51bSc7XG5pbXBvcnQgeyBKb2IgfSBmcm9tICdhcHAvaW50ZXJmYWNlcy9qb2IuaW50ZXJmYWNlJztcbmltcG9ydCB7IFdlYlNvY2tldEVycm9yIH0gZnJvbSAnYXBwL2ludGVyZmFjZXMvd2Vic29ja2V0LWVycm9yLmludGVyZmFjZSc7XG5pbXBvcnQgeyBEaWFsb2dTZXJ2aWNlIH0gZnJvbSAnYXBwL21vZHVsZXMvZGlhbG9nL2RpYWxvZy5zZXJ2aWNlJztcbmltcG9ydCB7IEVycm9ySGFuZGxlclNlcnZpY2UgfSBmcm9tICdhcHAvc2VydmljZXMvZXJyb3ItaGFuZGxlci5zZXJ2aWNlJztcblxuY29uc3QgZXJyb3IgPSBuZXcgRXJyb3IoJ0R1bW15IEVycm9yJyk7XG5jb25zdCB3c0Vycm9yID0ge1xuICBlcnJvcjogMTEsXG4gIGVycm5hbWU6IFdlYlNvY2tldEVycm9yTmFtZS5BZ2FpbixcbiAgdHlwZTogUmVzcG9uc2VFcnJvclR5cGUuVmFsaWRhdGlvbixcbiAgcmVhc29uOiAnW0VJTlZBTF0gdXNlcl91cGRhdGUuc21iOiBUaGlzIGF0dHJpYnV0ZSBjYW5ub3QgYmUgY2hhbmdlZFxcbltFSU5WQUxdIHVzZXJfdXBkYXRlLnNtYjogUGFzc3dvcmQgbXVzdCBiZSBjaGFuZ2VkIGluIG9yZGVyIHRvIGVuYWJsZSBTTUIgYXV0aGVudGljYXRpb25cXG4nLFxuICB0cmFjZToge30sXG4gIGV4dHJhOiBbXSxcbn0gYXMgV2ViU29ja2V0RXJyb3I7XG5cbmNvbnN0IGZhaWxlZEpvYiA9IHtcbiAgbWV0aG9kOiAnY2xvdWRzeW5jLnN5bmNfb25ldGltZScsXG4gIGRlc2NyaXB0aW9uOiBudWxsLFxuICBlcnJvcjogJ0RVTU1ZX0VSUk9SJyxcbiAgZXhjZXB0aW9uOiAnRVhDRVBUSU9OJyxcbiAgZXhjX2luZm86IG51bGwsXG4gIGxvZ3NfZXhjZXJwdDogJ0xPR1MnLFxuICBzdGF0ZTogSm9iU3RhdGUuRmFpbGVkLFxufSBhcyBKb2I7XG5cbmNvbnN0IGV4Y0luZm8gPSB7XG4gIHJlcHI6ICdWYWxpZGF0aW9uRXJyb3JzKCknLFxuICB0eXBlOiAnVkFMSURBVElPTicsXG4gIGV4dHJhOiBbXG4gICAgW1xuICAgICAgJ2Nsb3VkX3N5bmNfc3luY19vbmV0aW1lLnBhdGgnLFxuICAgICAgJ0RVTU1ZX0VSUk9SJyxcbiAgICAgIDIyLFxuICAgIF0sXG4gIF0sXG59O1xuXG5jb25zdCBodHRwRXJyb3I6IEh0dHBFcnJvclJlc3BvbnNlID0ge1xuICBlcnJvcjogeyBuYW1lOiAnVGhpcyBlcnJvcicgfSxcbiAgbmFtZTogJ0h0dHBFcnJvclJlc3BvbnNlJyxcbiAgbWVzc2FnZTogJ1RoaXMgZXJyb3Igb2NjdXJyZWQnLFxuICBoZWFkZXJzOiBuZXcgSHR0cEhlYWRlcnMoKSxcbiAgb2s6IGZhbHNlLFxuICBzdGF0dXM6IDQwOSxcbiAgc3RhdHVzVGV4dDogJ0NvbmZsaWN0JyxcbiAgdHlwZTogSHR0cEV2ZW50VHlwZS5SZXNwb25zZSxcbiAgdXJsOiAnJyxcbn07XG5cbmRlc2NyaWJlKCdFcnJvckhhbmRsZXJTZXJ2aWNlJywgKCkgPT4ge1xuICBsZXQgc3BlY3RhdG9yOiBTcGVjdGF0b3JTZXJ2aWNlPEVycm9ySGFuZGxlclNlcnZpY2U+O1xuICBjb25zdCBjcmVhdGVTZXJ2aWNlID0gY3JlYXRlU2VydmljZUZhY3Rvcnkoe1xuICAgIHNlcnZpY2U6IEVycm9ySGFuZGxlclNlcnZpY2UsXG4gICAgcHJvdmlkZXJzOiBbXG4gICAgICBtb2NrUHJvdmlkZXIoSW5qZWN0b3IsIHtcbiAgICAgICAgZ2V0OiBqZXN0LmZuKCksXG4gICAgICB9KSxcbiAgICBdLFxuICB9KTtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBqZXN0LnJlc2V0QWxsTW9ja3MoKTtcbiAgICBzcGVjdGF0b3IgPSBjcmVhdGVTZXJ2aWNlKCk7XG5cbiAgICBjb25zdCBkaWFsb2dTZXJ2aWNlID0gc3BlY3RhdG9yLmluamVjdChEaWFsb2dTZXJ2aWNlKTtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoZGlhbG9nU2VydmljZSwgJ2Vycm9yJywge1xuICAgICAgdmFsdWU6IGplc3QuZm4oKCkgPT4gb2YodHJ1ZSkpLFxuICAgIH0pO1xuXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHNwZWN0YXRvci5zZXJ2aWNlLCAnZGlhbG9nJywge1xuICAgICAgZ2V0OiAoKSA9PiBkaWFsb2dTZXJ2aWNlLFxuICAgIH0pO1xuXG4gICAgY29uc3QgdHJhbnNsYXRlU2VydmljZSA9IHNwZWN0YXRvci5pbmplY3QoVHJhbnNsYXRlU2VydmljZSk7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHNwZWN0YXRvci5zZXJ2aWNlLCAndHJhbnNsYXRlJywge1xuICAgICAgdmFsdWU6IHRyYW5zbGF0ZVNlcnZpY2UsXG4gICAgfSk7XG5cbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoc3BlY3RhdG9yLnNlcnZpY2UsICdsb2dUb1NlbnRyeScsIHtcbiAgICAgIHZhbHVlOiBqZXN0LmZuKCksXG4gICAgfSk7XG5cbiAgICBqZXN0LnNweU9uKGNvbnNvbGUsICdlcnJvcicpLm1vY2tJbXBsZW1lbnRhdGlvbigpO1xuICB9KTtcblxuICBhZnRlckFsbCgoKSA9PiB7XG4gICAgamVzdC5yZXN0b3JlQWxsTW9ja3MoKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2hhbmRsZUVycm9yJywgKCkgPT4ge1xuICAgIGl0KCdsb2dzIG5vcm1hbCBlcnJvciB0byBjb25zb2xlIGFuZCBzZW50cnknLCAoKSA9PiB7XG4gICAgICBqZXN0LnNweU9uKHNwZWN0YXRvci5zZXJ2aWNlLCAncGFyc2VFcnJvcicpO1xuICAgICAgc3BlY3RhdG9yLnNlcnZpY2UuaGFuZGxlRXJyb3IoZXJyb3IpO1xuXG4gICAgICBleHBlY3QoY29uc29sZS5lcnJvcikudG9IYXZlQmVlbkNhbGxlZFdpdGgoZXJyb3IpO1xuICAgICAgZXhwZWN0KHNwZWN0YXRvci5zZXJ2aWNlLnBhcnNlRXJyb3IpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKGVycm9yKTtcbiAgICAgIGV4cGVjdChzcGVjdGF0b3Iuc2VydmljZS5sb2dUb1NlbnRyeSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICBtZXNzYWdlOiAnRHVtbXkgRXJyb3InLFxuICAgICAgICB0aXRsZTogJ0Vycm9yJyxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ2RvZXMgbm90IGxvZyBXZWJzb2NrZXQgQ2xvc2VFdmVudCB0byBTZW50cnknLCAoKSA9PiB7XG4gICAgICBzcGVjdGF0b3Iuc2VydmljZS5oYW5kbGVFcnJvcihuZXcgQ2xvc2VFdmVudCgnY2xvc2UnKSk7XG5cbiAgICAgIGV4cGVjdChzcGVjdGF0b3Iuc2VydmljZS5sb2dUb1NlbnRyeSkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdsb2dzIHdlYnNvY2tldCBlcnJvcicsICgpID0+IHtcbiAgICAgIHNwZWN0YXRvci5zZXJ2aWNlLmhhbmRsZUVycm9yKHdzRXJyb3IpO1xuXG4gICAgICBleHBlY3Qoc3BlY3RhdG9yLnNlcnZpY2UubG9nVG9TZW50cnkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgYmFja3RyYWNlOiAnJyxcbiAgICAgICAgbWVzc2FnZTogd3NFcnJvci5yZWFzb24sXG4gICAgICAgIHRpdGxlOiAnVkFMSURBVElPTicsXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdsb2dzIGpvYiBlcnJvcnMnLCAoKSA9PiB7XG4gICAgICBzcGVjdGF0b3Iuc2VydmljZS5oYW5kbGVFcnJvcihmYWlsZWRKb2IpO1xuXG4gICAgICBleHBlY3Qoc3BlY3RhdG9yLnNlcnZpY2UubG9nVG9TZW50cnkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgdGl0bGU6ICdGQUlMRUQnLFxuICAgICAgICBiYWNrdHJhY2U6ICdMT0dTJyxcbiAgICAgICAgbWVzc2FnZTogJ0RVTU1ZX0VSUk9SJyxcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ2xvZ3Mgam9iIGVycm9yIGZvciBqb2JzIHdpdGggYGV4dHJhYCBhdmFpbGFibGUnLCAoKSA9PiB7XG4gICAgICBzcGVjdGF0b3Iuc2VydmljZS5oYW5kbGVFcnJvcih7XG4gICAgICAgIC4uLmZhaWxlZEpvYixcbiAgICAgICAgZXhjX2luZm86IGV4Y0luZm8sXG4gICAgICB9KTtcblxuICAgICAgZXhwZWN0KHNwZWN0YXRvci5zZXJ2aWNlLmxvZ1RvU2VudHJ5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChbe1xuICAgICAgICBiYWNrdHJhY2U6ICdFWENFUFRJT04nLFxuICAgICAgICBtZXNzYWdlOiAnRFVNTVlfRVJST1InLFxuICAgICAgICB0aXRsZTogJ0Vycm9yOiBwYXRoJyxcbiAgICAgIH1dKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3BhcnNlSHR0cEVycm9yJywgKCkgPT4ge1xuICAgIGl0KCdyZXR1cm5zIGNvcnJlY3QgZXJyb3Igb2JqZWN0IHdpdGggNDA5IGVycm9yJywgKCkgPT4ge1xuICAgICAgY29uc3QgZXJyb3JSZXBvcnQgPSBzcGVjdGF0b3Iuc2VydmljZS5wYXJzZUh0dHBFcnJvcihodHRwRXJyb3IpO1xuICAgICAgZXhwZWN0KGVycm9yUmVwb3J0KS50b0VxdWFsKFt7IG1lc3NhZ2U6ICdUaGlzIGVycm9yJywgdGl0bGU6ICdFcnJvcicgfV0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3JldHVybnMgY29ycmVjdCBlcnJvciBvYmplY3Qgd2l0aCA0MDkgZXJyb3Igd2l0aCBvYmplY3QnLCAoKSA9PiB7XG4gICAgICBjb25zdCBlcnJvclJlcG9ydCA9IHNwZWN0YXRvci5zZXJ2aWNlLnBhcnNlSHR0cEVycm9yKHtcbiAgICAgICAgLi4uaHR0cEVycm9yLFxuICAgICAgICBlcnJvcjogeyBuYW1lOiBbJ1RoaXMgZXJyb3InXSB9LFxuICAgICAgfSk7XG4gICAgICBleHBlY3QoZXJyb3JSZXBvcnQpLnRvRXF1YWwoW3sgbWVzc2FnZTogJ1RoaXMgZXJyb3InLCB0aXRsZTogJ0Vycm9yJyB9XSk7XG4gICAgfSk7XG5cbiAgICBpdCgncmV0dXJucyBjb3JyZWN0IG9iamVjdCB3aXRoIDQwMCBlcnJvcicsICgpID0+IHtcbiAgICAgIGNvbnN0IGVycm9yUmVwb3J0ID0gc3BlY3RhdG9yLnNlcnZpY2UucGFyc2VIdHRwRXJyb3Ioe1xuICAgICAgICAuLi5odHRwRXJyb3IsXG4gICAgICAgIHN0YXR1czogNDAwLFxuICAgICAgICBzdGF0dXNUZXh0OiAnQmFkIFJlcXVlc3QnLFxuICAgICAgfSk7XG4gICAgICBleHBlY3QoZXJyb3JSZXBvcnQpLnRvRXF1YWwoW3sgbWVzc2FnZTogJ1RoaXMgZXJyb3InLCB0aXRsZTogJ0Vycm9yJyB9XSk7XG4gICAgfSk7XG5cbiAgICBpdCgncmV0dXJucyBjb3JyZWN0IG9iamVjdCB3aXRoIDQwMCBlcnJvciB3aXRob3V0IGVycm9yIG9iamVjdCcsICgpID0+IHtcbiAgICAgIGNvbnN0IGVycm9yUmVwb3J0ID0gc3BlY3RhdG9yLnNlcnZpY2UucGFyc2VIdHRwRXJyb3Ioe1xuICAgICAgICAuLi5odHRwRXJyb3IsXG4gICAgICAgIHN0YXR1czogNDAwLFxuICAgICAgICBzdGF0dXNUZXh0OiAnQmFkIFJlcXVlc3QnLFxuICAgICAgICBlcnJvcjogJ1RoYXQgZXJyb3InLFxuICAgICAgfSk7XG4gICAgICBleHBlY3QoZXJyb3JSZXBvcnQpLnRvRXF1YWwoeyBtZXNzYWdlOiAnVGhhdCBlcnJvcicsIHRpdGxlOiAnRXJyb3IgKDQwMCknIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3JldHVybnMgY29ycmVjdCBvYmplY3Qgd2l0aCA0MDQgZXJyb3InLCAoKSA9PiB7XG4gICAgICBjb25zdCBlcnJvclJlcG9ydCA9IHNwZWN0YXRvci5zZXJ2aWNlLnBhcnNlSHR0cEVycm9yKHtcbiAgICAgICAgLi4uaHR0cEVycm9yLFxuICAgICAgICBzdGF0dXM6IDQwNCxcbiAgICAgICAgc3RhdHVzVGV4dDogJ05vdCBGb3VuZCcsXG4gICAgICB9KTtcbiAgICAgIGV4cGVjdChlcnJvclJlcG9ydCkudG9FcXVhbCh7IG1lc3NhZ2U6ICdUaGlzIGVycm9yIG9jY3VycmVkJywgdGl0bGU6ICdOb3QgRm91bmQnIH0pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3JldHVybnMgY29ycmVjdCBvYmplY3Qgd2l0aCA1MDAgZXJyb3InLCAoKSA9PiB7XG4gICAgICBjb25zdCBlcnJvclJlcG9ydCA9IHNwZWN0YXRvci5zZXJ2aWNlLnBhcnNlSHR0cEVycm9yKHtcbiAgICAgICAgLi4uaHR0cEVycm9yLFxuICAgICAgICBzdGF0dXM6IDUwMCxcbiAgICAgICAgc3RhdHVzVGV4dDogJ0JhZCBSZXF1ZXN0JyxcbiAgICAgICAgZXJyb3I6IHsgZXJyb3JfbWVzc2FnZTogJ0V2ZW4gZXJyb3InIH0sXG4gICAgICB9KTtcbiAgICAgIGV4cGVjdChlcnJvclJlcG9ydCkudG9FcXVhbCh7IG1lc3NhZ2U6ICdFdmVuIGVycm9yJywgdGl0bGU6ICdFcnJvciAoNTAwKScgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgncmV0dXJucyBjb3JyZWN0IG9iamVjdCB3aXRoIDUwMCBlcnJvciBhbmQgc3RyaW5nJywgKCkgPT4ge1xuICAgICAgY29uc3QgZXJyb3JSZXBvcnQgPSBzcGVjdGF0b3Iuc2VydmljZS5wYXJzZUh0dHBFcnJvcih7XG4gICAgICAgIC4uLmh0dHBFcnJvcixcbiAgICAgICAgc3RhdHVzOiA1MDAsXG4gICAgICAgIHN0YXR1c1RleHQ6ICdCYWQgUmVxdWVzdCcsXG4gICAgICAgIG1lc3NhZ2U6ICdPZGQgZXJyb3InLFxuICAgICAgfSk7XG4gICAgICBleHBlY3QoZXJyb3JSZXBvcnQpLnRvRXF1YWwoeyBtZXNzYWdlOiAnU2VydmVyIGVycm9yOiBPZGQgZXJyb3InLCB0aXRsZTogJ0Vycm9yICg1MDApJyB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdyZXR1cm5zIHByb3BlciBvYmplY3Qgd2hlbiB1bmtub3duIGVycm9yJywgKCkgPT4ge1xuICAgICAgY29uc3QgZXJyb3JSZXBvcnQgPSBzcGVjdGF0b3Iuc2VydmljZS5wYXJzZUh0dHBFcnJvcih7XG4gICAgICAgIC4uLmh0dHBFcnJvcixcbiAgICAgICAgc3RhdHVzOiA1MTAsXG4gICAgICAgIHN0YXR1c1RleHQ6ICdCYWQgUmVxdWVzdCcsXG4gICAgICAgIGVycm9yOiAnT2RkIGVycm9yJyxcbiAgICAgIH0pO1xuXG4gICAgICBleHBlY3QoY29uc29sZS5lcnJvcikudG9IYXZlQmVlbkNhbGxlZFdpdGgoe1xuICAgICAgICAuLi5odHRwRXJyb3IsXG4gICAgICAgIHN0YXR1czogNTEwLFxuICAgICAgICBzdGF0dXNUZXh0OiAnQmFkIFJlcXVlc3QnLFxuICAgICAgICBlcnJvcjogJ09kZCBlcnJvcicsXG4gICAgICB9KTtcblxuICAgICAgZXhwZWN0KGVycm9yUmVwb3J0KS50b0VxdWFsKHsgbWVzc2FnZTogJ1RoaXMgZXJyb3Igb2NjdXJyZWQnLCB0aXRsZTogJ0Vycm9yICg1MTApJyB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3BhcnNlRXJyb3InLCAoKSA9PiB7XG4gICAgaXQoJ3BhcnNlcyBhIHdlYnNvY2tldCBlcnJvcicsICgpID0+IHtcbiAgICAgIGNvbnN0IGVycm9yUmVwb3J0ID0gc3BlY3RhdG9yLnNlcnZpY2UucGFyc2VFcnJvcih3c0Vycm9yKTtcblxuICAgICAgZXhwZWN0KGVycm9yUmVwb3J0KS50b0VxdWFsKHtcbiAgICAgICAgdGl0bGU6ICdWQUxJREFUSU9OJyxcbiAgICAgICAgbWVzc2FnZTogd3NFcnJvci5yZWFzb24sXG4gICAgICAgIGJhY2t0cmFjZTogJycsXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdwYXJzZXMgYSBmYWlsZWQgam9iJywgKCkgPT4ge1xuICAgICAgY29uc3QgZXJyb3JSZXBvcnQgPSBzcGVjdGF0b3Iuc2VydmljZS5wYXJzZUVycm9yKGZhaWxlZEpvYik7XG5cbiAgICAgIGV4cGVjdChlcnJvclJlcG9ydCkudG9FcXVhbCh7XG4gICAgICAgIHRpdGxlOiAnRkFJTEVEJyxcbiAgICAgICAgbWVzc2FnZTogJ0RVTU1ZX0VSUk9SJyxcbiAgICAgICAgYmFja3RyYWNlOiAnTE9HUycsXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdwYXJzZXMgYSBmYWlsZWQgam9iIHdpdGggZXhjIGluZm8nLCAoKSA9PiB7XG4gICAgICBjb25zdCBlcnJvclJlcG9ydCA9IHNwZWN0YXRvci5zZXJ2aWNlLnBhcnNlRXJyb3Ioe1xuICAgICAgICAuLi5mYWlsZWRKb2IsXG4gICAgICAgIGV4Y19pbmZvOiBleGNJbmZvLFxuICAgICAgfSk7XG5cbiAgICAgIGV4cGVjdChlcnJvclJlcG9ydCkudG9FcXVhbChbe1xuICAgICAgICB0aXRsZTogJ0Vycm9yOiBwYXRoJyxcbiAgICAgICAgbWVzc2FnZTogJ0RVTU1ZX0VSUk9SJyxcbiAgICAgICAgYmFja3RyYWNlOiAnRVhDRVBUSU9OJyxcbiAgICAgIH1dKTtcbiAgICB9KTtcblxuICAgIGl0KCdwYXJzZXMgYSBnZW5lcmljIEpTIGVycm9yJywgKCkgPT4ge1xuICAgICAgY29uc3QgZXJyb3JSZXBvcnQgPSBzcGVjdGF0b3Iuc2VydmljZS5wYXJzZUVycm9yKGVycm9yKTtcblxuICAgICAgZXhwZWN0KGVycm9yUmVwb3J0KS50b0VxdWFsKHtcbiAgICAgICAgdGl0bGU6ICdFcnJvcicsXG4gICAgICAgIG1lc3NhZ2U6ICdEdW1teSBFcnJvcicsXG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==