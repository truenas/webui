63299043eea36fbd49fb63224efe6514
"use strict";
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.BootenvStatsDialogComponent = void 0;
const core_1 = require("@angular/core");
const forms_1 = require("@angular/forms");
const button_1 = require("@angular/material/button");
const dialog_1 = require("@angular/material/dialog");
const until_destroy_1 = require("@ngneat/until-destroy");
const store_1 = require("@ngrx/store");
const core_2 = require("@ngx-translate/core");
const requires_roles_directive_1 = require("app/directives/requires-roles/requires-roles.directive");
const pool_status_enum_1 = require("app/enums/pool-status.enum");
const role_enum_1 = require("app/enums/role.enum");
const dialog_service_1 = require("app/modules/dialog/dialog.service");
const form_actions_component_1 = require("app/modules/forms/ix-forms/components/form-actions/form-actions.component");
const ix_input_component_1 = require("app/modules/forms/ix-forms/components/ix-input/ix-input.component");
const form_error_handler_service_1 = require("app/modules/forms/ix-forms/services/form-error-handler.service");
const app_loader_service_1 = require("app/modules/loader/app-loader.service");
const file_size_pipe_1 = require("app/modules/pipes/file-size/file-size.pipe");
const format_datetime_pipe_1 = require("app/modules/pipes/format-date-time/format-datetime.pipe");
const map_value_pipe_1 = require("app/modules/pipes/map-value/map-value.pipe");
const snackbar_service_1 = require("app/modules/snackbar/services/snackbar.service");
const test_directive_1 = require("app/modules/test-id/test.directive");
const error_handler_service_1 = require("app/services/error-handler.service");
const ws_service_1 = require("app/services/ws.service");
const system_config_selectors_1 = require("app/store/system-config/system-config.selectors");
let BootenvStatsDialogComponent = class BootenvStatsDialogComponent {
    constructor(ws, loader, store$, dialogRef, translate, fb, errorHandler, dialogService, formErrorHandler, cdr, snackbar) {
        this.ws = ws;
        this.loader = loader;
        this.store$ = store$;
        this.dialogRef = dialogRef;
        this.translate = translate;
        this.fb = fb;
        this.errorHandler = errorHandler;
        this.dialogService = dialogService;
        this.formErrorHandler = formErrorHandler;
        this.cdr = cdr;
        this.snackbar = snackbar;
        this.form = this.fb.group({
            interval: [null, [forms_1.Validators.required, forms_1.Validators.min(1)]],
        });
        this.PoolStatus = pool_status_enum_1.PoolStatus;
        this.poolStatusLabels = pool_status_enum_1.poolStatusLabels;
        this.Role = role_enum_1.Role;
    }
    get condition() {
        return this.state.status;
    }
    ngOnInit() {
        this.loadBootState();
        this.loadScrubInterval();
    }
    onSubmit() {
        const interval = this.form.value.interval;
        this.ws.call('boot.set_scrub_interval', [interval])
            .pipe(this.loader.withLoader(), (0, until_destroy_1.untilDestroyed)(this))
            .subscribe({
            next: () => {
                this.dialogRef.close();
                this.snackbar.success(this.translate.instant('Scrub interval set to {scrubIntervalValue} days', { scrubIntervalValue: interval }));
            },
            error: (error) => {
                this.formErrorHandler.handleWsFormError(error, this.form);
            },
        });
    }
    loadScrubInterval() {
        this.store$.pipe(system_config_selectors_1.waitForAdvancedConfig, (0, until_destroy_1.untilDestroyed)(this)).subscribe((config) => {
            this.form.patchValue({ interval: config.boot_scrub });
        });
    }
    loadBootState() {
        this.ws.call('boot.get_state')
            .pipe(this.loader.withLoader(), this.errorHandler.catchError(), (0, until_destroy_1.untilDestroyed)(this))
            .subscribe((state) => {
            this.state = state;
            this.cdr.markForCheck();
        });
    }
};
exports.BootenvStatsDialogComponent = BootenvStatsDialogComponent;
BootenvStatsDialogComponent.ctorParameters = () => [
    { type: ws_service_1.WebSocketService },
    { type: app_loader_service_1.AppLoaderService },
    { type: store_1.Store },
    { type: dialog_1.MatDialogRef },
    { type: core_2.TranslateService },
    { type: forms_1.FormBuilder },
    { type: error_handler_service_1.ErrorHandlerService },
    { type: dialog_service_1.DialogService },
    { type: form_error_handler_service_1.FormErrorHandlerService },
    { type: core_1.ChangeDetectorRef },
    { type: snackbar_service_1.SnackbarService }
];
exports.BootenvStatsDialogComponent = BootenvStatsDialogComponent = __decorate([
    (0, until_destroy_1.UntilDestroy)(),
    (0, core_1.Component)({
        selector: 'ix-bootenv-stats-dialog',
        template: require("./bootenv-stats-dialog.component.html"),
        changeDetection: core_1.ChangeDetectionStrategy.OnPush,
        standalone: true,
        imports: [
            dialog_1.MatDialogTitle,
            forms_1.ReactiveFormsModule,
            ix_input_component_1.IxInputComponent,
            form_actions_component_1.FormActionsComponent,
            button_1.MatButton,
            dialog_1.MatDialogClose,
            test_directive_1.TestDirective,
            requires_roles_directive_1.RequiresRolesDirective,
            core_2.TranslateModule,
            file_size_pipe_1.FileSizePipe,
            format_datetime_pipe_1.FormatDateTimePipe,
            map_value_pipe_1.MapValuePipe,
        ],
    })
], BootenvStatsDialogComponent);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL21hY2Jvb2sva2FycG92LXdvcmsvVHJ1ZU5BUy93ZWJ1aS9zcmMvYXBwL3BhZ2VzL3N5c3RlbS9ib290ZW52L2Jvb3RlbnYtc3RhdHMtZGlhbG9nL2Jvb3RlbnYtc3RhdHMtZGlhbG9nLmNvbXBvbmVudC50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQSx3Q0FFdUI7QUFDdkIsMENBQThFO0FBQzlFLHFEQUFxRDtBQUNyRCxxREFBd0Y7QUFDeEYseURBQXFFO0FBQ3JFLHVDQUFvQztBQUNwQyw4Q0FBd0U7QUFDeEUscUdBQWdHO0FBQ2hHLGlFQUEwRTtBQUMxRSxtREFBMkM7QUFFM0Msc0VBQWtFO0FBQ2xFLHNIQUFpSDtBQUNqSCwwR0FBcUc7QUFDckcsK0dBQXlHO0FBQ3pHLDhFQUF5RTtBQUN6RSwrRUFBMEU7QUFDMUUsa0dBQTZGO0FBQzdGLCtFQUEwRTtBQUMxRSxxRkFBaUY7QUFDakYsdUVBQW1FO0FBQ25FLDhFQUF5RTtBQUN6RSx3REFBMkQ7QUFFM0QsNkZBQXdGO0FBd0JqRixJQUFNLDJCQUEyQixHQUFqQyxNQUFNLDJCQUEyQjtJQVd0QyxZQUNVLEVBQW9CLEVBQ3BCLE1BQXdCLEVBQ3hCLE1BQXVCLEVBQ3ZCLFNBQW9ELEVBQ3BELFNBQTJCLEVBQzNCLEVBQWUsRUFDZixZQUFpQyxFQUNqQyxhQUE0QixFQUM1QixnQkFBeUMsRUFDekMsR0FBc0IsRUFDdEIsUUFBeUI7UUFWekIsT0FBRSxHQUFGLEVBQUUsQ0FBa0I7UUFDcEIsV0FBTSxHQUFOLE1BQU0sQ0FBa0I7UUFDeEIsV0FBTSxHQUFOLE1BQU0sQ0FBaUI7UUFDdkIsY0FBUyxHQUFULFNBQVMsQ0FBMkM7UUFDcEQsY0FBUyxHQUFULFNBQVMsQ0FBa0I7UUFDM0IsT0FBRSxHQUFGLEVBQUUsQ0FBYTtRQUNmLGlCQUFZLEdBQVosWUFBWSxDQUFxQjtRQUNqQyxrQkFBYSxHQUFiLGFBQWEsQ0FBZTtRQUM1QixxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQXlCO1FBQ3pDLFFBQUcsR0FBSCxHQUFHLENBQW1C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WUFDaEIsNkNBQW9CO1lBQ3BCLGtCQUFTO1lBQ1QsdUJBQWM7WUFDZCw4QkFBYTtZQUNiLGlEQUFzQjtZQUN0QixzQkFBZTtZQUNmLDZCQUFZO1lBQ1oseUNBQWtCO1lBQ2xCLDZCQUFZO1NBQ2I7S0FDRixDQUFDO0dBQ1csMkJBQTJCLENBcUV2QyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvbWFjYm9vay9rYXJwb3Ytd29yay9UcnVlTkFTL3dlYnVpL3NyYy9hcHAvcGFnZXMvc3lzdGVtL2Jvb3RlbnYvYm9vdGVudi1zdGF0cy1kaWFsb2cvYm9vdGVudi1zdGF0cy1kaWFsb2cuY29tcG9uZW50LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LCBDaGFuZ2VEZXRlY3RvclJlZiwgQ29tcG9uZW50LCBPbkluaXQsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgRm9ybUJ1aWxkZXIsIFZhbGlkYXRvcnMsIFJlYWN0aXZlRm9ybXNNb2R1bGUgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBNYXRCdXR0b24gfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbC9idXR0b24nO1xuaW1wb3J0IHsgTWF0RGlhbG9nUmVmLCBNYXREaWFsb2dUaXRsZSwgTWF0RGlhbG9nQ2xvc2UgfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbC9kaWFsb2cnO1xuaW1wb3J0IHsgVW50aWxEZXN0cm95LCB1bnRpbERlc3Ryb3llZCB9IGZyb20gJ0BuZ25lYXQvdW50aWwtZGVzdHJveSc7XG5pbXBvcnQgeyBTdG9yZSB9IGZyb20gJ0BuZ3J4L3N0b3JlJztcbmltcG9ydCB7IFRyYW5zbGF0ZVNlcnZpY2UsIFRyYW5zbGF0ZU1vZHVsZSB9IGZyb20gJ0BuZ3gtdHJhbnNsYXRlL2NvcmUnO1xuaW1wb3J0IHsgUmVxdWlyZXNSb2xlc0RpcmVjdGl2ZSB9IGZyb20gJ2FwcC9kaXJlY3RpdmVzL3JlcXVpcmVzLXJvbGVzL3JlcXVpcmVzLXJvbGVzLmRpcmVjdGl2ZSc7XG5pbXBvcnQgeyBQb29sU3RhdHVzLCBwb29sU3RhdHVzTGFiZWxzIH0gZnJvbSAnYXBwL2VudW1zL3Bvb2wtc3RhdHVzLmVudW0nO1xuaW1wb3J0IHsgUm9sZSB9IGZyb20gJ2FwcC9lbnVtcy9yb2xlLmVudW0nO1xuaW1wb3J0IHsgUG9vbEluc3RhbmNlIH0gZnJvbSAnYXBwL2ludGVyZmFjZXMvcG9vbC5pbnRlcmZhY2UnO1xuaW1wb3J0IHsgRGlhbG9nU2VydmljZSB9IGZyb20gJ2FwcC9tb2R1bGVzL2RpYWxvZy9kaWFsb2cuc2VydmljZSc7XG5pbXBvcnQgeyBGb3JtQWN0aW9uc0NvbXBvbmVudCB9IGZyb20gJ2FwcC9tb2R1bGVzL2Zvcm1zL2l4LWZvcm1zL2NvbXBvbmVudHMvZm9ybS1hY3Rpb25zL2Zvcm0tYWN0aW9ucy5jb21wb25lbnQnO1xuaW1wb3J0IHsgSXhJbnB1dENvbXBvbmVudCB9IGZyb20gJ2FwcC9tb2R1bGVzL2Zvcm1zL2l4LWZvcm1zL2NvbXBvbmVudHMvaXgtaW5wdXQvaXgtaW5wdXQuY29tcG9uZW50JztcbmltcG9ydCB7IEZvcm1FcnJvckhhbmRsZXJTZXJ2aWNlIH0gZnJvbSAnYXBwL21vZHVsZXMvZm9ybXMvaXgtZm9ybXMvc2VydmljZXMvZm9ybS1lcnJvci1oYW5kbGVyLnNlcnZpY2UnO1xuaW1wb3J0IHsgQXBwTG9hZGVyU2VydmljZSB9IGZyb20gJ2FwcC9tb2R1bGVzL2xvYWRlci9hcHAtbG9hZGVyLnNlcnZpY2UnO1xuaW1wb3J0IHsgRmlsZVNpemVQaXBlIH0gZnJvbSAnYXBwL21vZHVsZXMvcGlwZXMvZmlsZS1zaXplL2ZpbGUtc2l6ZS5waXBlJztcbmltcG9ydCB7IEZvcm1hdERhdGVUaW1lUGlwZSB9IGZyb20gJ2FwcC9tb2R1bGVzL3BpcGVzL2Zvcm1hdC1kYXRlLXRpbWUvZm9ybWF0LWRhdGV0aW1lLnBpcGUnO1xuaW1wb3J0IHsgTWFwVmFsdWVQaXBlIH0gZnJvbSAnYXBwL21vZHVsZXMvcGlwZXMvbWFwLXZhbHVlL21hcC12YWx1ZS5waXBlJztcbmltcG9ydCB7IFNuYWNrYmFyU2VydmljZSB9IGZyb20gJ2FwcC9tb2R1bGVzL3NuYWNrYmFyL3NlcnZpY2VzL3NuYWNrYmFyLnNlcnZpY2UnO1xuaW1wb3J0IHsgVGVzdERpcmVjdGl2ZSB9IGZyb20gJ2FwcC9tb2R1bGVzL3Rlc3QtaWQvdGVzdC5kaXJlY3RpdmUnO1xuaW1wb3J0IHsgRXJyb3JIYW5kbGVyU2VydmljZSB9IGZyb20gJ2FwcC9zZXJ2aWNlcy9lcnJvci1oYW5kbGVyLnNlcnZpY2UnO1xuaW1wb3J0IHsgV2ViU29ja2V0U2VydmljZSB9IGZyb20gJ2FwcC9zZXJ2aWNlcy93cy5zZXJ2aWNlJztcbmltcG9ydCB7IEFwcFN0YXRlIH0gZnJvbSAnYXBwL3N0b3JlJztcbmltcG9ydCB7IHdhaXRGb3JBZHZhbmNlZENvbmZpZyB9IGZyb20gJ2FwcC9zdG9yZS9zeXN0ZW0tY29uZmlnL3N5c3RlbS1jb25maWcuc2VsZWN0b3JzJztcblxuQFVudGlsRGVzdHJveSgpXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdpeC1ib290ZW52LXN0YXRzLWRpYWxvZycsXG4gIHRlbXBsYXRlVXJsOiAnLi9ib290ZW52LXN0YXRzLWRpYWxvZy5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL2Jvb3RlbnYtc3RhdHMtZGlhbG9nLmNvbXBvbmVudC5zY3NzJ10sXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxuICBzdGFuZGFsb25lOiB0cnVlLFxuICBpbXBvcnRzOiBbXG4gICAgTWF0RGlhbG9nVGl0bGUsXG4gICAgUmVhY3RpdmVGb3Jtc01vZHVsZSxcbiAgICBJeElucHV0Q29tcG9uZW50LFxuICAgIEZvcm1BY3Rpb25zQ29tcG9uZW50LFxuICAgIE1hdEJ1dHRvbixcbiAgICBNYXREaWFsb2dDbG9zZSxcbiAgICBUZXN0RGlyZWN0aXZlLFxuICAgIFJlcXVpcmVzUm9sZXNEaXJlY3RpdmUsXG4gICAgVHJhbnNsYXRlTW9kdWxlLFxuICAgIEZpbGVTaXplUGlwZSxcbiAgICBGb3JtYXREYXRlVGltZVBpcGUsXG4gICAgTWFwVmFsdWVQaXBlLFxuICBdLFxufSlcbmV4cG9ydCBjbGFzcyBCb290ZW52U3RhdHNEaWFsb2dDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuICBmb3JtID0gdGhpcy5mYi5ncm91cCh7XG4gICAgaW50ZXJ2YWw6IFtudWxsIGFzIG51bWJlciwgW1ZhbGlkYXRvcnMucmVxdWlyZWQsIFZhbGlkYXRvcnMubWluKDEpXV0sXG4gIH0pO1xuXG4gIHN0YXRlOiBQb29sSW5zdGFuY2U7XG5cbiAgcmVhZG9ubHkgUG9vbFN0YXR1cyA9IFBvb2xTdGF0dXM7XG4gIHJlYWRvbmx5IHBvb2xTdGF0dXNMYWJlbHMgPSBwb29sU3RhdHVzTGFiZWxzO1xuICBwcm90ZWN0ZWQgcmVhZG9ubHkgUm9sZSA9IFJvbGU7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSB3czogV2ViU29ja2V0U2VydmljZSxcbiAgICBwcml2YXRlIGxvYWRlcjogQXBwTG9hZGVyU2VydmljZSxcbiAgICBwcml2YXRlIHN0b3JlJDogU3RvcmU8QXBwU3RhdGU+LFxuICAgIHByaXZhdGUgZGlhbG9nUmVmOiBNYXREaWFsb2dSZWY8Qm9vdGVudlN0YXRzRGlhbG9nQ29tcG9uZW50PixcbiAgICBwcml2YXRlIHRyYW5zbGF0ZTogVHJhbnNsYXRlU2VydmljZSxcbiAgICBwcml2YXRlIGZiOiBGb3JtQnVpbGRlcixcbiAgICBwcml2YXRlIGVycm9ySGFuZGxlcjogRXJyb3JIYW5kbGVyU2VydmljZSxcbiAgICBwcml2YXRlIGRpYWxvZ1NlcnZpY2U6IERpYWxvZ1NlcnZpY2UsXG4gICAgcHJpdmF0ZSBmb3JtRXJyb3JIYW5kbGVyOiBGb3JtRXJyb3JIYW5kbGVyU2VydmljZSxcbiAgICBwcml2YXRlIGNkcjogQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gICAgcHJpdmF0ZSBzbmFja2JhcjogU25hY2tiYXJTZXJ2aWNlLFxuICApIHt9XG5cbiAgZ2V0IGNvbmRpdGlvbigpOiBQb29sU3RhdHVzIHtcbiAgICByZXR1cm4gdGhpcy5zdGF0ZS5zdGF0dXM7XG4gIH1cblxuICBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICB0aGlzLmxvYWRCb290U3RhdGUoKTtcbiAgICB0aGlzLmxvYWRTY3J1YkludGVydmFsKCk7XG4gIH1cblxuICBvblN1Ym1pdCgpOiB2b2lkIHtcbiAgICBjb25zdCBpbnRlcnZhbCA9IHRoaXMuZm9ybS52YWx1ZS5pbnRlcnZhbDtcbiAgICB0aGlzLndzLmNhbGwoJ2Jvb3Quc2V0X3NjcnViX2ludGVydmFsJywgW2ludGVydmFsXSlcbiAgICAgIC5waXBlKHRoaXMubG9hZGVyLndpdGhMb2FkZXIoKSwgdW50aWxEZXN0cm95ZWQodGhpcykpXG4gICAgICAuc3Vic2NyaWJlKHtcbiAgICAgICAgbmV4dDogKCkgPT4ge1xuICAgICAgICAgIHRoaXMuZGlhbG9nUmVmLmNsb3NlKCk7XG4gICAgICAgICAgdGhpcy5zbmFja2Jhci5zdWNjZXNzKFxuICAgICAgICAgICAgdGhpcy50cmFuc2xhdGUuaW5zdGFudCgnU2NydWIgaW50ZXJ2YWwgc2V0IHRvIHtzY3J1YkludGVydmFsVmFsdWV9IGRheXMnLCB7IHNjcnViSW50ZXJ2YWxWYWx1ZTogaW50ZXJ2YWwgfSksXG4gICAgICAgICAgKTtcbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3I6IChlcnJvcjogdW5rbm93bikgPT4ge1xuICAgICAgICAgIHRoaXMuZm9ybUVycm9ySGFuZGxlci5oYW5kbGVXc0Zvcm1FcnJvcihlcnJvciwgdGhpcy5mb3JtKTtcbiAgICAgICAgfSxcbiAgICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBsb2FkU2NydWJJbnRlcnZhbCgpOiB2b2lkIHtcbiAgICB0aGlzLnN0b3JlJC5waXBlKHdhaXRGb3JBZHZhbmNlZENvbmZpZywgdW50aWxEZXN0cm95ZWQodGhpcykpLnN1YnNjcmliZSgoY29uZmlnKSA9PiB7XG4gICAgICB0aGlzLmZvcm0ucGF0Y2hWYWx1ZSh7IGludGVydmFsOiBjb25maWcuYm9vdF9zY3J1YiB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgbG9hZEJvb3RTdGF0ZSgpOiB2b2lkIHtcbiAgICB0aGlzLndzLmNhbGwoJ2Jvb3QuZ2V0X3N0YXRlJylcbiAgICAgIC5waXBlKFxuICAgICAgICB0aGlzLmxvYWRlci53aXRoTG9hZGVyKCksXG4gICAgICAgIHRoaXMuZXJyb3JIYW5kbGVyLmNhdGNoRXJyb3IoKSxcbiAgICAgICAgdW50aWxEZXN0cm95ZWQodGhpcyksXG4gICAgICApXG4gICAgICAuc3Vic2NyaWJlKChzdGF0ZSkgPT4ge1xuICAgICAgICB0aGlzLnN0YXRlID0gc3RhdGU7XG4gICAgICAgIHRoaXMuY2RyLm1hcmtGb3JDaGVjaygpO1xuICAgICAgfSk7XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==