{"file":"/Users/macbook/karpov-work/TrueNAS/webui/src/app/pages/system/bootenv/bootenv-stats-dialog/bootenv-stats-dialog.component.ts","mappings":"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","names":[],"sources":["/Users/macbook/karpov-work/TrueNAS/webui/src/app/pages/system/bootenv/bootenv-stats-dialog/bootenv-stats-dialog.component.ts"],"sourcesContent":["import {\n  ChangeDetectionStrategy, ChangeDetectorRef, Component, OnInit,\n} from '@angular/core';\nimport { FormBuilder, Validators, ReactiveFormsModule } from '@angular/forms';\nimport { MatButton } from '@angular/material/button';\nimport { MatDialogRef, MatDialogTitle, MatDialogClose } from '@angular/material/dialog';\nimport { UntilDestroy, untilDestroyed } from '@ngneat/until-destroy';\nimport { Store } from '@ngrx/store';\nimport { TranslateService, TranslateModule } from '@ngx-translate/core';\nimport { RequiresRolesDirective } from 'app/directives/requires-roles/requires-roles.directive';\nimport { PoolStatus, poolStatusLabels } from 'app/enums/pool-status.enum';\nimport { Role } from 'app/enums/role.enum';\nimport { PoolInstance } from 'app/interfaces/pool.interface';\nimport { DialogService } from 'app/modules/dialog/dialog.service';\nimport { FormActionsComponent } from 'app/modules/forms/ix-forms/components/form-actions/form-actions.component';\nimport { IxInputComponent } from 'app/modules/forms/ix-forms/components/ix-input/ix-input.component';\nimport { FormErrorHandlerService } from 'app/modules/forms/ix-forms/services/form-error-handler.service';\nimport { AppLoaderService } from 'app/modules/loader/app-loader.service';\nimport { FileSizePipe } from 'app/modules/pipes/file-size/file-size.pipe';\nimport { FormatDateTimePipe } from 'app/modules/pipes/format-date-time/format-datetime.pipe';\nimport { MapValuePipe } from 'app/modules/pipes/map-value/map-value.pipe';\nimport { SnackbarService } from 'app/modules/snackbar/services/snackbar.service';\nimport { TestDirective } from 'app/modules/test-id/test.directive';\nimport { ErrorHandlerService } from 'app/services/error-handler.service';\nimport { WebSocketService } from 'app/services/ws.service';\nimport { AppState } from 'app/store';\nimport { waitForAdvancedConfig } from 'app/store/system-config/system-config.selectors';\n\n@UntilDestroy()\n@Component({\n  selector: 'ix-bootenv-stats-dialog',\n  templateUrl: './bootenv-stats-dialog.component.html',\n  styleUrls: ['./bootenv-stats-dialog.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    MatDialogTitle,\n    ReactiveFormsModule,\n    IxInputComponent,\n    FormActionsComponent,\n    MatButton,\n    MatDialogClose,\n    TestDirective,\n    RequiresRolesDirective,\n    TranslateModule,\n    FileSizePipe,\n    FormatDateTimePipe,\n    MapValuePipe,\n  ],\n})\nexport class BootenvStatsDialogComponent implements OnInit {\n  form = this.fb.group({\n    interval: [null as number, [Validators.required, Validators.min(1)]],\n  });\n\n  state: PoolInstance;\n\n  readonly PoolStatus = PoolStatus;\n  readonly poolStatusLabels = poolStatusLabels;\n  protected readonly Role = Role;\n\n  constructor(\n    private ws: WebSocketService,\n    private loader: AppLoaderService,\n    private store$: Store<AppState>,\n    private dialogRef: MatDialogRef<BootenvStatsDialogComponent>,\n    private translate: TranslateService,\n    private fb: FormBuilder,\n    private errorHandler: ErrorHandlerService,\n    private dialogService: DialogService,\n    private formErrorHandler: FormErrorHandlerService,\n    private cdr: ChangeDetectorRef,\n    private snackbar: SnackbarService,\n  ) {}\n\n  get condition(): PoolStatus {\n    return this.state.status;\n  }\n\n  ngOnInit(): void {\n    this.loadBootState();\n    this.loadScrubInterval();\n  }\n\n  onSubmit(): void {\n    const interval = this.form.value.interval;\n    this.ws.call('boot.set_scrub_interval', [interval])\n      .pipe(this.loader.withLoader(), untilDestroyed(this))\n      .subscribe({\n        next: () => {\n          this.dialogRef.close();\n          this.snackbar.success(\n            this.translate.instant('Scrub interval set to {scrubIntervalValue} days', { scrubIntervalValue: interval }),\n          );\n        },\n        error: (error: unknown) => {\n          this.formErrorHandler.handleWsFormError(error, this.form);\n        },\n      });\n  }\n\n  private loadScrubInterval(): void {\n    this.store$.pipe(waitForAdvancedConfig, untilDestroyed(this)).subscribe((config) => {\n      this.form.patchValue({ interval: config.boot_scrub });\n    });\n  }\n\n  private loadBootState(): void {\n    this.ws.call('boot.get_state')\n      .pipe(\n        this.loader.withLoader(),\n        this.errorHandler.catchError(),\n        untilDestroyed(this),\n      )\n      .subscribe((state) => {\n        this.state = state;\n        this.cdr.markForCheck();\n      });\n  }\n}\n"],"version":3}