f431bf3063b6101ecb7dd61596ccbf83
"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.IxTableHarness = void 0;
const testing_1 = require("@angular/cdk/testing");
const testing_2 = require("@angular/material/button/testing");
const cell_harness_1 = require("app/modules/ix-table/components/ix-table/cell.harness");
const row_harness_1 = require("app/modules/ix-table/components/ix-table/row.harness");
class IxTableHarness extends testing_1.ContentContainerComponentHarness {
    constructor() {
        super(...arguments);
        this.getCells = this.locatorForAll(cell_harness_1.IxCellHarness);
        this.getRows = this.locatorForAll(row_harness_1.IxRowHarness);
    }
    getHeaderTexts() {
        return __awaiter(this, void 0, void 0, function* () {
            const headerCells = yield this.locatorForAll('th')();
            return Promise.all(headerCells.map((cell) => cell.text()));
        });
    }
    getRowCount() {
        return __awaiter(this, void 0, void 0, function* () {
            const rows = yield this.locatorForAll('.row')();
            return rows.length;
        });
    }
    getColumnCount() {
        return __awaiter(this, void 0, void 0, function* () {
            const headerCells = yield this.locatorForAll('th')();
            return headerCells.length;
        });
    }
    getCell(row, column) {
        return __awaiter(this, void 0, void 0, function* () {
            const cells = yield this.getCells();
            const columnCount = yield this.getColumnCount();
            return cells[row * columnCount + column];
        });
    }
    getHarnessInCell(query, row, column) {
        return __awaiter(this, void 0, void 0, function* () {
            const cell = yield this.getCell(row, column);
            if (!cell) {
                throw new Error(`No cell found at row ${row} and column ${column}`);
            }
            return cell.getHarness(query);
        });
    }
    getAllHarnessesInCell(query, row, column) {
        return __awaiter(this, void 0, void 0, function* () {
            const cell = yield this.getCell(row, column);
            if (!cell) {
                throw new Error(`No cell found at row ${row} and column ${column}`);
            }
            return cell.getAllHarnesses(query);
        });
    }
    getHarnessInRow(query, text) {
        return __awaiter(this, void 0, void 0, function* () {
            const rowNumber = yield this.getNumberRowByText(text);
            const row = (yield this.getRows())[rowNumber];
            if (!row) {
                throw new Error(`No row found with number ${rowNumber}`);
            }
            return row.getHarness(query);
        });
    }
    getAllHarnessesInRow(query, text) {
        return __awaiter(this, void 0, void 0, function* () {
            const rowNumber = yield this.getNumberRowByText(text);
            const row = (yield this.getRows())[rowNumber];
            if (!row) {
                throw new Error(`No row found with number ${rowNumber}`);
            }
            return row.getAllHarnesses(query);
        });
    }
    getNumberRowByText(text) {
        return __awaiter(this, void 0, void 0, function* () {
            const texts = (yield this.getCellTexts()).slice(1);
            for (let i = 0; i < texts.length; i += 1) {
                if (texts[i].includes(text)) {
                    return i;
                }
            }
            throw new Error(`No row found with the text '${text}'`);
        });
    }
    getRowElement(row) {
        return __awaiter(this, void 0, void 0, function* () {
            const rows = yield this.locatorForAll('.row')();
            return rows[row];
        });
    }
    getToggle(row) {
        return __awaiter(this, void 0, void 0, function* () {
            const toggles = yield this.locatorForAll(testing_2.MatButtonHarness.with({ selector: '[ixTest="toggle-row"]' }))();
            return toggles[row];
        });
    }
    getCellTexts() {
        return __awaiter(this, void 0, void 0, function* () {
            const cells = yield this.getCells();
            const texts = yield (0, testing_1.parallel)(() => cells.map((cell) => cell.getText()));
            const columnCount = yield this.getColumnCount();
            if (!columnCount) {
                throw new Error('Could not determine column count');
            }
            const result = [];
            for (let i = 0; i < texts.length; i += columnCount) {
                result.push(texts.slice(i, i + columnCount));
            }
            return result;
        });
    }
    clickRow(row) {
        return __awaiter(this, void 0, void 0, function* () {
            (yield this.getRowElement(row)).click();
        });
    }
    clickToggle(row) {
        return __awaiter(this, void 0, void 0, function* () {
            (yield this.getToggle(row)).click();
        });
    }
}
exports.IxTableHarness = IxTableHarness;
IxTableHarness.hostSelector = 'ix-table';
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL21hY2Jvb2sva2FycG92LXdvcmsvVHJ1ZU5BUy93ZWJ1aS9zcmMvYXBwL21vZHVsZXMvaXgtdGFibGUvY29tcG9uZW50cy9peC10YWJsZS9peC10YWJsZS5oYXJuZXNzLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQUFBLGtEQUs4QjtBQUM5Qiw4REFBb0U7QUFDcEUsd0ZBQXNGO0FBQ3RGLHNGQUFvRjtBQUVwRixNQUFhLGNBQWUsU0FBUSwwQ0FBZ0M7SUFBcEU7O1FBR1csYUFBUSxHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsNEJBQWEsQ0FBQyxDQUFDO1FBQzdDLFlBQU8sR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLDBCQUFZLENBQUMsQ0FBQztJQTJIdEQsQ0FBQztJQXpITyxjQUFjOztZQUNsQixNQUFNLFdBQVcsR0FBRyxNQUFNLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztZQUNyRCxPQUFPLE9BQU8sQ0FBQyxHQUFHLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQztRQUM3RCxDQUFDO0tBQUE7SUFFSyxXQUFXOztZQUNmLE1BQU0sSUFBSSxHQUFHLE1BQU0sSUFBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDO1lBQ2hELE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQztRQUNyQixDQUFDO0tBQUE7SUFFSyxjQUFjOztZQUNsQixNQUFNLFdBQVcsR0FBRyxNQUFNLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztZQUNyRCxPQUFPLFdBQVcsQ0FBQyxNQUFNLENBQUM7UUFDNUIsQ0FBQztLQUFBO0lBRUssT0FBTyxDQUFDLEdBQVcsRUFBRSxNQUFjOztZQUN2QyxNQUFNLEtBQUssR0FBRyxNQUFNLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztZQUNwQyxNQUFNLFdBQVcsR0FBRyxNQUFNLElBQUksQ0FBQyxjQUFjLEVBQUUsQ0FBQztZQUNoRCxPQUFPLEtBQUssQ0FBQyxHQUFHLEdBQUcsV0FBVyxHQUFHLE1BQU0sQ0FBQyxDQUFDO1FBQzNDLENBQUM7S0FBQTtJQUVLLGdCQUFnQixDQUNwQixLQUFzQixFQUN0QixHQUFXLEVBQ1gsTUFBYzs7WUFFZCxNQUFNLElBQUksR0FBRyxNQUFNLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1lBRTdDLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztnQkFDVixNQUFNLElBQUksS0FBSyxDQUFDLHdCQUF3QixHQUFHLGVBQWUsTUFBTSxFQUFFLENBQUMsQ0FBQztZQUN0RSxDQUFDO1lBRUQsT0FBTyxJQUFJLENBQUMsVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ2hDLENBQUM7S0FBQTtJQUVLLHFCQUFxQixDQUN6QixLQUFzQixFQUN0QixHQUFXLEVBQ1gsTUFBYzs7WUFFZCxNQUFNLElBQUksR0FBRyxNQUFNLElBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1lBRTdDLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztnQkFDVixNQUFNLElBQUksS0FBSyxDQUFDLHdCQUF3QixHQUFHLGVBQWUsTUFBTSxFQUFFLENBQUMsQ0FBQztZQUN0RSxDQUFDO1lBRUQsT0FBTyxJQUFJLENBQUMsZUFBZSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ3JDLENBQUM7S0FBQTtJQUVLLGVBQWUsQ0FDbkIsS0FBc0IsRUFDdEIsSUFBWTs7WUFFWixNQUFNLFNBQVMsR0FBRyxNQUFNLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUN0RCxNQUFNLEdBQUcsR0FBRyxDQUFDLE1BQU0sSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUM7WUFFOUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDO2dCQUNULE1BQU0sSUFBSSxLQUFLLENBQUMsNEJBQTRCLFNBQVMsRUFBRSxDQUFDLENBQUM7WUFDM0QsQ0FBQztZQUVELE9BQU8sR0FBRyxDQUFDLFVBQVUsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUMvQixDQUFDO0tBQUE7SUFFSyxvQkFBb0IsQ0FDeEIsS0FBc0IsRUFDdEIsSUFBWTs7WUFFWixNQUFNLFNBQVMsR0FBRyxNQUFNLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUN0RCxNQUFNLEdBQUcsR0FBRyxDQUFDLE1BQU0sSUFBSSxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUMsU0FBUyxDQUFDLENBQUM7WUFFOUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDO2dCQUNULE1BQU0sSUFBSSxLQUFLLENBQUMsNEJBQTRCLFNBQVMsRUFBRSxDQUFDLENBQUM7WUFDM0QsQ0FBQztZQUVELE9BQU8sR0FBRyxDQUFDLGVBQWUsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNwQyxDQUFDO0tBQUE7SUFFSyxrQkFBa0IsQ0FBQyxJQUFZOztZQUNuQyxNQUFNLEtBQUssR0FBRyxDQUFDLE1BQU0sSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ25ELEtBQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxLQUFLLENBQUMsTUFBTSxFQUFFLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQztnQkFDekMsSUFBSSxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUM7b0JBQzVCLE9BQU8sQ0FBQyxDQUFDO2dCQUNYLENBQUM7WUFDSCxDQUFDO1lBQ0QsTUFBTSxJQUFJLEtBQUssQ0FBQywrQkFBK0IsSUFBSSxHQUFHLENBQUMsQ0FBQztRQUMxRCxDQUFDO0tBQUE7SUFFSyxhQUFhLENBQUMsR0FBVzs7WUFDN0IsTUFBTSxJQUFJLEdBQUcsTUFBTSxJQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUM7WUFDaEQsT0FBTyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDbkIsQ0FBQztLQUFBO0lBRUssU0FBUyxDQUFDLEdBQVc7O1lBQ3pCLE1BQU0sT0FBTyxHQUFHLE1BQU0sSUFBSSxDQUFDLGFBQWEsQ0FBQywwQkFBZ0IsQ0FBQyxJQUFJLENBQUMsRUFBRSxRQUFRLEVBQUUsdUJBQXVCLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQztZQUN6RyxPQUFPLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUN0QixDQUFDO0tBQUE7SUFFSyxZQUFZOztZQUNoQixNQUFNLEtBQUssR0FBRyxNQUFNLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQztZQUNwQyxNQUFNLEtBQUssR0FBRyxNQUFNLElBQUEsa0JBQVEsRUFBQyxHQUFHLEVBQUUsQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsSUFBSSxFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQ3hFLE1BQU0sV0FBVyxHQUFHLE1BQU0sSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO1lBRWhELElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQztnQkFDakIsTUFBTSxJQUFJLEtBQUssQ0FBQyxrQ0FBa0MsQ0FBQyxDQUFDO1lBQ3RELENBQUM7WUFFRCxNQUFNLE1BQU0sR0FBZSxFQUFFLENBQUM7WUFDOUIsS0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLEtBQUssQ0FBQyxNQUFNLEVBQUUsQ0FBQyxJQUFJLFdBQVcsRUFBRSxDQUFDO2dCQUNuRCxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsR0FBRyxXQUFXLENBQUMsQ0FBQyxDQUFDO1lBQy9DLENBQUM7WUFFRCxPQUFPLE1BQU0sQ0FBQztRQUNoQixDQUFDO0tBQUE7SUFFSyxRQUFRLENBQUMsR0FBVzs7WUFDeEIsQ0FBQyxNQUFNLElBQUksQ0FBQyxhQUFhLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUMxQyxDQUFDO0tBQUE7SUFFSyxXQUFXLENBQUMsR0FBVzs7WUFDM0IsQ0FBQyxNQUFNLElBQUksQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxLQUFLLEVBQUUsQ0FBQztRQUN0QyxDQUFDO0tBQUE7O0FBOUhILHdDQStIQztBQTlIUSwyQkFBWSxHQUFHLFVBQVUsQUFBYixDQUFjIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9tYWNib29rL2thcnBvdi13b3JrL1RydWVOQVMvd2VidWkvc3JjL2FwcC9tb2R1bGVzL2l4LXRhYmxlL2NvbXBvbmVudHMvaXgtdGFibGUvaXgtdGFibGUuaGFybmVzcy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge1xuICBDb21wb25lbnRIYXJuZXNzLFxuICBDb250ZW50Q29udGFpbmVyQ29tcG9uZW50SGFybmVzcyxcbiAgSGFybmVzc1F1ZXJ5LCBwYXJhbGxlbCxcbiAgVGVzdEVsZW1lbnQsXG59IGZyb20gJ0Bhbmd1bGFyL2Nkay90ZXN0aW5nJztcbmltcG9ydCB7IE1hdEJ1dHRvbkhhcm5lc3MgfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbC9idXR0b24vdGVzdGluZyc7XG5pbXBvcnQgeyBJeENlbGxIYXJuZXNzIH0gZnJvbSAnYXBwL21vZHVsZXMvaXgtdGFibGUvY29tcG9uZW50cy9peC10YWJsZS9jZWxsLmhhcm5lc3MnO1xuaW1wb3J0IHsgSXhSb3dIYXJuZXNzIH0gZnJvbSAnYXBwL21vZHVsZXMvaXgtdGFibGUvY29tcG9uZW50cy9peC10YWJsZS9yb3cuaGFybmVzcyc7XG5cbmV4cG9ydCBjbGFzcyBJeFRhYmxlSGFybmVzcyBleHRlbmRzIENvbnRlbnRDb250YWluZXJDb21wb25lbnRIYXJuZXNzIHtcbiAgc3RhdGljIGhvc3RTZWxlY3RvciA9ICdpeC10YWJsZSc7XG5cbiAgcmVhZG9ubHkgZ2V0Q2VsbHMgPSB0aGlzLmxvY2F0b3JGb3JBbGwoSXhDZWxsSGFybmVzcyk7XG4gIHJlYWRvbmx5IGdldFJvd3MgPSB0aGlzLmxvY2F0b3JGb3JBbGwoSXhSb3dIYXJuZXNzKTtcblxuICBhc3luYyBnZXRIZWFkZXJUZXh0cygpOiBQcm9taXNlPHN0cmluZ1tdPiB7XG4gICAgY29uc3QgaGVhZGVyQ2VsbHMgPSBhd2FpdCB0aGlzLmxvY2F0b3JGb3JBbGwoJ3RoJykoKTtcbiAgICByZXR1cm4gUHJvbWlzZS5hbGwoaGVhZGVyQ2VsbHMubWFwKChjZWxsKSA9PiBjZWxsLnRleHQoKSkpO1xuICB9XG5cbiAgYXN5bmMgZ2V0Um93Q291bnQoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICBjb25zdCByb3dzID0gYXdhaXQgdGhpcy5sb2NhdG9yRm9yQWxsKCcucm93JykoKTtcbiAgICByZXR1cm4gcm93cy5sZW5ndGg7XG4gIH1cblxuICBhc3luYyBnZXRDb2x1bW5Db3VudCgpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgIGNvbnN0IGhlYWRlckNlbGxzID0gYXdhaXQgdGhpcy5sb2NhdG9yRm9yQWxsKCd0aCcpKCk7XG4gICAgcmV0dXJuIGhlYWRlckNlbGxzLmxlbmd0aDtcbiAgfVxuXG4gIGFzeW5jIGdldENlbGwocm93OiBudW1iZXIsIGNvbHVtbjogbnVtYmVyKTogUHJvbWlzZTxJeENlbGxIYXJuZXNzPiB7XG4gICAgY29uc3QgY2VsbHMgPSBhd2FpdCB0aGlzLmdldENlbGxzKCk7XG4gICAgY29uc3QgY29sdW1uQ291bnQgPSBhd2FpdCB0aGlzLmdldENvbHVtbkNvdW50KCk7XG4gICAgcmV0dXJuIGNlbGxzW3JvdyAqIGNvbHVtbkNvdW50ICsgY29sdW1uXTtcbiAgfVxuXG4gIGFzeW5jIGdldEhhcm5lc3NJbkNlbGw8VCBleHRlbmRzIENvbXBvbmVudEhhcm5lc3M+KFxuICAgIHF1ZXJ5OiBIYXJuZXNzUXVlcnk8VD4sXG4gICAgcm93OiBudW1iZXIsXG4gICAgY29sdW1uOiBudW1iZXIsXG4gICk6IFByb21pc2U8VD4ge1xuICAgIGNvbnN0IGNlbGwgPSBhd2FpdCB0aGlzLmdldENlbGwocm93LCBjb2x1bW4pO1xuXG4gICAgaWYgKCFjZWxsKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYE5vIGNlbGwgZm91bmQgYXQgcm93ICR7cm93fSBhbmQgY29sdW1uICR7Y29sdW1ufWApO1xuICAgIH1cblxuICAgIHJldHVybiBjZWxsLmdldEhhcm5lc3MocXVlcnkpO1xuICB9XG5cbiAgYXN5bmMgZ2V0QWxsSGFybmVzc2VzSW5DZWxsPFQgZXh0ZW5kcyBDb21wb25lbnRIYXJuZXNzPihcbiAgICBxdWVyeTogSGFybmVzc1F1ZXJ5PFQ+LFxuICAgIHJvdzogbnVtYmVyLFxuICAgIGNvbHVtbjogbnVtYmVyLFxuICApOiBQcm9taXNlPFRbXT4ge1xuICAgIGNvbnN0IGNlbGwgPSBhd2FpdCB0aGlzLmdldENlbGwocm93LCBjb2x1bW4pO1xuXG4gICAgaWYgKCFjZWxsKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYE5vIGNlbGwgZm91bmQgYXQgcm93ICR7cm93fSBhbmQgY29sdW1uICR7Y29sdW1ufWApO1xuICAgIH1cblxuICAgIHJldHVybiBjZWxsLmdldEFsbEhhcm5lc3NlcyhxdWVyeSk7XG4gIH1cblxuICBhc3luYyBnZXRIYXJuZXNzSW5Sb3c8VCBleHRlbmRzIENvbXBvbmVudEhhcm5lc3M+KFxuICAgIHF1ZXJ5OiBIYXJuZXNzUXVlcnk8VD4sXG4gICAgdGV4dDogc3RyaW5nLFxuICApOiBQcm9taXNlPFQ+IHtcbiAgICBjb25zdCByb3dOdW1iZXIgPSBhd2FpdCB0aGlzLmdldE51bWJlclJvd0J5VGV4dCh0ZXh0KTtcbiAgICBjb25zdCByb3cgPSAoYXdhaXQgdGhpcy5nZXRSb3dzKCkpW3Jvd051bWJlcl07XG5cbiAgICBpZiAoIXJvdykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBObyByb3cgZm91bmQgd2l0aCBudW1iZXIgJHtyb3dOdW1iZXJ9YCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJvdy5nZXRIYXJuZXNzKHF1ZXJ5KTtcbiAgfVxuXG4gIGFzeW5jIGdldEFsbEhhcm5lc3Nlc0luUm93PFQgZXh0ZW5kcyBDb21wb25lbnRIYXJuZXNzPihcbiAgICBxdWVyeTogSGFybmVzc1F1ZXJ5PFQ+LFxuICAgIHRleHQ6IHN0cmluZyxcbiAgKTogUHJvbWlzZTxUW10+IHtcbiAgICBjb25zdCByb3dOdW1iZXIgPSBhd2FpdCB0aGlzLmdldE51bWJlclJvd0J5VGV4dCh0ZXh0KTtcbiAgICBjb25zdCByb3cgPSAoYXdhaXQgdGhpcy5nZXRSb3dzKCkpW3Jvd051bWJlcl07XG5cbiAgICBpZiAoIXJvdykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBObyByb3cgZm91bmQgd2l0aCBudW1iZXIgJHtyb3dOdW1iZXJ9YCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJvdy5nZXRBbGxIYXJuZXNzZXMocXVlcnkpO1xuICB9XG5cbiAgYXN5bmMgZ2V0TnVtYmVyUm93QnlUZXh0KHRleHQ6IHN0cmluZyk6IFByb21pc2U8bnVtYmVyPiB7XG4gICAgY29uc3QgdGV4dHMgPSAoYXdhaXQgdGhpcy5nZXRDZWxsVGV4dHMoKSkuc2xpY2UoMSk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0ZXh0cy5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgaWYgKHRleHRzW2ldLmluY2x1ZGVzKHRleHQpKSB7XG4gICAgICAgIHJldHVybiBpO1xuICAgICAgfVxuICAgIH1cbiAgICB0aHJvdyBuZXcgRXJyb3IoYE5vIHJvdyBmb3VuZCB3aXRoIHRoZSB0ZXh0ICcke3RleHR9J2ApO1xuICB9XG5cbiAgYXN5bmMgZ2V0Um93RWxlbWVudChyb3c6IG51bWJlcik6IFByb21pc2U8VGVzdEVsZW1lbnQ+IHtcbiAgICBjb25zdCByb3dzID0gYXdhaXQgdGhpcy5sb2NhdG9yRm9yQWxsKCcucm93JykoKTtcbiAgICByZXR1cm4gcm93c1tyb3ddO1xuICB9XG5cbiAgYXN5bmMgZ2V0VG9nZ2xlKHJvdzogbnVtYmVyKTogUHJvbWlzZTxNYXRCdXR0b25IYXJuZXNzPiB7XG4gICAgY29uc3QgdG9nZ2xlcyA9IGF3YWl0IHRoaXMubG9jYXRvckZvckFsbChNYXRCdXR0b25IYXJuZXNzLndpdGgoeyBzZWxlY3RvcjogJ1tpeFRlc3Q9XCJ0b2dnbGUtcm93XCJdJyB9KSkoKTtcbiAgICByZXR1cm4gdG9nZ2xlc1tyb3ddO1xuICB9XG5cbiAgYXN5bmMgZ2V0Q2VsbFRleHRzKCk6IFByb21pc2U8c3RyaW5nW11bXT4ge1xuICAgIGNvbnN0IGNlbGxzID0gYXdhaXQgdGhpcy5nZXRDZWxscygpO1xuICAgIGNvbnN0IHRleHRzID0gYXdhaXQgcGFyYWxsZWwoKCkgPT4gY2VsbHMubWFwKChjZWxsKSA9PiBjZWxsLmdldFRleHQoKSkpO1xuICAgIGNvbnN0IGNvbHVtbkNvdW50ID0gYXdhaXQgdGhpcy5nZXRDb2x1bW5Db3VudCgpO1xuXG4gICAgaWYgKCFjb2x1bW5Db3VudCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdDb3VsZCBub3QgZGV0ZXJtaW5lIGNvbHVtbiBjb3VudCcpO1xuICAgIH1cblxuICAgIGNvbnN0IHJlc3VsdDogc3RyaW5nW11bXSA9IFtdO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGV4dHMubGVuZ3RoOyBpICs9IGNvbHVtbkNvdW50KSB7XG4gICAgICByZXN1bHQucHVzaCh0ZXh0cy5zbGljZShpLCBpICsgY29sdW1uQ291bnQpKTtcbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgYXN5bmMgY2xpY2tSb3cocm93OiBudW1iZXIpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAoYXdhaXQgdGhpcy5nZXRSb3dFbGVtZW50KHJvdykpLmNsaWNrKCk7XG4gIH1cblxuICBhc3luYyBjbGlja1RvZ2dsZShyb3c6IG51bWJlcik6IFByb21pc2U8dm9pZD4ge1xuICAgIChhd2FpdCB0aGlzLmdldFRvZ2dsZShyb3cpKS5jbGljaygpO1xuICB9XG59XG4iXSwidmVyc2lvbiI6M30=